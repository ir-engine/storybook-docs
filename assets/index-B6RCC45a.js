import{r as F,R as f}from"./index-CBqU2yxZ.js";import{m as E,c as G}from"./NotificationService-BtHCxsFA.js";import{a as t}from"./AssetType-LSGL9ANY.js";import{g as j}from"./ActionFunctions-CxzuxLxN.js";import{a as P,g as x}from"./assetFunctions-Bvb93VNm.js";import{E as M}from"./EditorServices-BJKHmurs.js";import{u as b}from"./useTranslation-C8TD7CCW.js";import{u as w,I as A}from"./useDrop-DvNNwWYR.js";import{C as h}from"./index-OAa3bMdv.js";const D=[".mp3",".mpeg","audio/mpeg",".ogg"],U=[".mp4","video/mp4",".m3u8","application/vnd.apple.mpegurl"],k=[".png",".jpeg",".jpg",".gif",".ktx2","image/png","image/jpeg","image/gif","image/ktx2"],I=[".glb",".gltf","model/gltf-binary","model/gltf+json",".fbx",".usdz",".vrm"],L=[".manifest"],v=[".tsx",".ts",".js",".jsx"],S=[".bin"],g=[...D,...U,...k,...I,...L,...v,...S];g.join(",");t.MP3,t.MP4,t.PNG,t.JPEG,t.KTX2,t.GLB,t.GLTF,t.VRM,t.VRM;t.MP3+"",t.MP4+"",t.PNG+"",t.JPEG+"",t.KTX2+"",t.GLB+"",t.GLTF+"";t.GLTF,t.GLB,t.USDZ,t.FBX,t.VRM,t.TGA,t.KTX2,t.DDS,t.PNG,t.JPEG,t.JPEG,t.MP3,t.AAC,t.OGG,t.M4A,t.MP4,t.MKV,t.M3U8,t.MAT;const V=E.child({component:"editor:useUpload"});function B(o={}){const{t:r}=b(),l=!!o.multiple,a=o.accepts||g,m=async e=>{if(e.isDirectory){let s=e.createReader();const p=await x(s);for(let n=0;n<p.length;n++)await m(p[n])}if(e.isFile){let s=!1;for(const p of a)if(e.name.toLowerCase().endsWith(p)){s=!0;break}if(!s)throw new Error(r("editor:asset.useUpload.mineTypeError",{name:e.name,types:a.join(", ")}))}};return F.useCallback(async e=>{try{if(!l&&e.length>1)throw new Error(r("editor:asset.useUpload.multipleFileError"));if(a)for(let i=0;i<e.length;i++)await m(e[i]);const{projectName:s}=j(M),p=await P(s,e);return(await Promise.all(p.promises)).flat()}catch(s){return V.error(s,"Error on upload"),null}},[l,a])}function C({onRelease:o,value:r,acceptFileTypes:l,acceptDropItems:a,...m}){const e=B({multiple:!1,accepts:l});r&&!(r!=null&&r.includes(G.client.fileServer))&&r.includes("blob:https://");const[{canDrop:s,isOver:p},n]=w({accept:[...a,A.File],async drop(i,y){if(a.find(d=>d===i.type))o==null||o(i.url);else{const d=y.getItem(),T=Array.from(d.items).map(c=>c.webkitGetAsEntry());e(T).then(c=>{c&&(o==null||o(c[0]))})}},collect:i=>({canDrop:i.canDrop(),isOver:i.isOver()})});return f.createElement(f.Fragment,null,f.createElement(h,{ref:n,value:r,onRelease:o,...m}))}C.defaultProps={acceptFileTypes:g,acceptDropItems:g};export{g as A,C as F,k as I,I as M,U as V,D as a};
