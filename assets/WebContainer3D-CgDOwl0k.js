var Ga=Object.defineProperty;var Xa=(t,e,r)=>e in t?Ga(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var S=(t,e,r)=>(Xa(t,typeof e!="symbol"?e+"":e,r),r);import{k as Yr,V as Qr,O as Tr,g as Ls,i as Ms,v as Ya,t as Cs,ac as Qa,ar as Si,as as Za,a2 as xt,p as Ja,ad as eo,ae as to,S as ro,aa as Bs,ao as no}from"./three.module-D2RMN07C.js";import{i as Is}from"./ActionFunctions-CxzuxLxN.js";import"./index-CBqU2yxZ.js";var Ps={},so=function(t,e,r,n,s){var i=new Worker(Ps[e]||(Ps[e]=URL.createObjectURL(new Blob([t+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return i.onmessage=function(a){var o=a.data,u=o.$e$;if(u){var l=new Error(u[0]);l.code=u[1],l.stack=u[2],s(l,null)}else s(null,o)},i.postMessage(r,n),i},le=Uint8Array,me=Uint16Array,Lt=Uint32Array,Mt=new le([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ct=new le([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Gt=new le([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ri=function(t,e){for(var r=new me(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var s=new Lt(r[30]),n=1;n<30;++n)for(var i=r[n];i<r[n+1];++i)s[i]=i-r[n]<<5|n;return[r,s]},ki=Ri(Mt,2),ns=ki[0],Nr=ki[1];ns[28]=258,Nr[258]=28;var Oi=Ri(Ct,0),Ai=Oi[0],bn=Oi[1],Xt=new me(32768);for(var te=0;te<32768;++te){var Ve=(te&43690)>>>1|(te&21845)<<1;Ve=(Ve&52428)>>>2|(Ve&13107)<<2,Ve=(Ve&61680)>>>4|(Ve&3855)<<4,Xt[te]=((Ve&65280)>>>8|(Ve&255)<<8)>>>1}var ke=function(t,e,r){for(var n=t.length,s=0,i=new me(e);s<n;++s)t[s]&&++i[t[s]-1];var a=new me(e);for(s=0;s<e;++s)a[s]=a[s-1]+i[s-1]<<1;var o;if(r){o=new me(1<<e);var u=15-e;for(s=0;s<n;++s)if(t[s])for(var l=s<<4|t[s],c=e-t[s],h=a[t[s]-1]++<<c,f=h|(1<<c)-1;h<=f;++h)o[Xt[h]>>>u]=l}else for(o=new me(n),s=0;s<n;++s)t[s]&&(o[s]=Xt[a[t[s]-1]++]>>>15-t[s]);return o},$e=new le(288);for(var te=0;te<144;++te)$e[te]=8;for(var te=144;te<256;++te)$e[te]=9;for(var te=256;te<280;++te)$e[te]=7;for(var te=280;te<288;++te)$e[te]=8;var kt=new le(32);for(var te=0;te<32;++te)kt[te]=5;var Li=ke($e,9,0),Mi=ke($e,9,1),Ci=ke(kt,5,0),Bi=ke(kt,5,1),Sr=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},Te=function(t,e,r){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(e&7)&r},Rr=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(e&7)},sr=function(t){return(t+7)/8|0},Bt=function(t,e,r){(e==null||e<0)&&(e=0),(r==null||r>t.length)&&(r=t.length);var n=new(t.BYTES_PER_ELEMENT==2?me:t.BYTES_PER_ELEMENT==4?Lt:le)(r-e);return n.set(t.subarray(e,r)),n},Ii=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ue=function(t,e,r){var n=new Error(e||Ii[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,ue),!r)throw n;return n},Zr=function(t,e,r){var n=t.length;if(!n||r&&r.f&&!r.l)return e||new le(0);var s=!e||r,i=!r||r.i;r||(r={}),e||(e=new le(n*3));var a=function(cr){var Nt=e.length;if(cr>Nt){var pt=new le(Math.max(Nt*2,cr));pt.set(e),e=pt}},o=r.f||0,u=r.p||0,l=r.b||0,c=r.l,h=r.d,f=r.m,d=r.n,x=n*8;do{if(!c){o=Te(t,u,1);var g=Te(t,u+1,3);if(u+=3,g)if(g==1)c=Mi,h=Bi,f=9,d=5;else if(g==2){var L=Te(t,u,31)+257,T=Te(t,u+10,15)+4,I=L+Te(t,u+5,31)+1;u+=14;for(var R=new le(I),A=new le(19),C=0;C<T;++C)A[Gt[C]]=Te(t,u+C*3,7);u+=T*3;for(var B=Sr(A),$=(1<<B)-1,V=ke(A,B,1),C=0;C<I;){var H=V[Te(t,u,$)];u+=H&15;var _=H>>>4;if(_<16)R[C++]=_;else{var y=0,k=0;for(_==16?(k=3+Te(t,u,3),u+=2,y=R[C-1]):_==17?(k=3+Te(t,u,7),u+=3):_==18&&(k=11+Te(t,u,127),u+=7);k--;)R[C++]=y}}var M=R.subarray(0,L),E=R.subarray(L);f=Sr(M),d=Sr(E),c=ke(M,f,1),h=ke(E,d,1)}else ue(1);else{var _=sr(u)+4,b=t[_-4]|t[_-3]<<8,v=_+b;if(v>n){i&&ue(0);break}s&&a(l+b),e.set(t.subarray(_,v),l),r.b=l+=b,r.p=u=v*8,r.f=o;continue}if(u>x){i&&ue(0);break}}s&&a(l+131072);for(var O=(1<<f)-1,D=(1<<d)-1,K=u;;K=u){var y=c[Rr(t,u)&O],U=y>>>4;if(u+=y&15,u>x){i&&ue(0);break}if(y||ue(2),U<256)e[l++]=U;else if(U==256){K=u,c=null;break}else{var W=U-254;if(U>264){var C=U-257,G=Mt[C];W=Te(t,u,(1<<G)-1)+ns[C],u+=G}var ae=h[Rr(t,u)&D],ne=ae>>>4;ae||ue(3),u+=ae&15;var E=Ai[ne];if(ne>3){var G=Ct[ne];E+=Rr(t,u)&(1<<G)-1,u+=G}if(u>x){i&&ue(0);break}s&&a(l+131072);for(var ie=l+W;l<ie;l+=4)e[l]=e[l-E],e[l+1]=e[l+1-E],e[l+2]=e[l+2-E],e[l+3]=e[l+3-E];l=ie}}r.l=c,r.p=K,r.b=l,r.f=o,c&&(o=1,r.m=f,r.d=h,r.n=d)}while(!o);return l==e.length?e:Bt(e,0,l)},Me=function(t,e,r){r<<=e&7;var n=e/8|0;t[n]|=r,t[n+1]|=r>>>8},vt=function(t,e,r){r<<=e&7;var n=e/8|0;t[n]|=r,t[n+1]|=r>>>8,t[n+2]|=r>>>16},kr=function(t,e){for(var r=[],n=0;n<t.length;++n)t[n]&&r.push({s:n,f:t[n]});var s=r.length,i=r.slice();if(!s)return[Jr,0];if(s==1){var a=new le(r[0].s+1);return a[r[0].s]=1,[a,1]}r.sort(function(I,R){return I.f-R.f}),r.push({s:-1,f:25001});var o=r[0],u=r[1],l=0,c=1,h=2;for(r[0]={s:-1,f:o.f+u.f,l:o,r:u};c!=s-1;)o=r[r[l].f<r[h].f?l++:h++],u=r[l!=c&&r[l].f<r[h].f?l++:h++],r[c++]={s:-1,f:o.f+u.f,l:o,r:u};for(var f=i[0].s,n=1;n<s;++n)i[n].s>f&&(f=i[n].s);var d=new me(f+1),x=Ur(r[c-1],d,0);if(x>e){var n=0,g=0,_=x-e,b=1<<_;for(i.sort(function(R,A){return d[A.s]-d[R.s]||R.f-A.f});n<s;++n){var v=i[n].s;if(d[v]>e)g+=b-(1<<x-d[v]),d[v]=e;else break}for(g>>>=_;g>0;){var L=i[n].s;d[L]<e?g-=1<<e-d[L]++-1:++n}for(;n>=0&&g;--n){var T=i[n].s;d[T]==e&&(--d[T],++g)}x=e}return[new le(d),x]},Ur=function(t,e,r){return t.s==-1?Math.max(Ur(t.l,e,r+1),Ur(t.r,e,r+1)):e[t.s]=r},wn=function(t){for(var e=t.length;e&&!t[--e];);for(var r=new me(++e),n=0,s=t[0],i=1,a=function(u){r[n++]=u},o=1;o<=e;++o)if(t[o]==s&&o!=e)++i;else{if(!s&&i>2){for(;i>138;i-=138)a(32754);i>2&&(a(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(a(s),--i;i>6;i-=6)a(8304);i>2&&(a(i-3<<5|8208),i=0)}for(;i--;)a(s);i=1,s=t[o]}return[r.subarray(0,n),e]},bt=function(t,e){for(var r=0,n=0;n<e.length;++n)r+=t[n]*e[n];return r},zr=function(t,e,r){var n=r.length,s=sr(e+2);t[s]=n&255,t[s+1]=n>>>8,t[s+2]=t[s]^255,t[s+3]=t[s+1]^255;for(var i=0;i<n;++i)t[s+i+4]=r[i];return(s+4+n)*8},xn=function(t,e,r,n,s,i,a,o,u,l,c){Me(e,c++,r),++s[256];for(var h=kr(s,15),f=h[0],d=h[1],x=kr(i,15),g=x[0],_=x[1],b=wn(f),v=b[0],L=b[1],T=wn(g),I=T[0],R=T[1],A=new me(19),C=0;C<v.length;++C)A[v[C]&31]++;for(var C=0;C<I.length;++C)A[I[C]&31]++;for(var B=kr(A,7),$=B[0],V=B[1],H=19;H>4&&!$[Gt[H-1]];--H);var y=l+5<<3,k=bt(s,$e)+bt(i,kt)+a,M=bt(s,f)+bt(i,g)+a+14+3*H+bt(A,$)+(2*A[16]+3*A[17]+7*A[18]);if(y<=k&&y<=M)return zr(e,c,t.subarray(u,u+l));var E,O,D,K;if(Me(e,c,1+(M<k)),c+=2,M<k){E=ke(f,d,0),O=f,D=ke(g,_,0),K=g;var U=ke($,V,0);Me(e,c,L-257),Me(e,c+5,R-1),Me(e,c+10,H-4),c+=14;for(var C=0;C<H;++C)Me(e,c+3*C,$[Gt[C]]);c+=3*H;for(var W=[v,I],G=0;G<2;++G)for(var ae=W[G],C=0;C<ae.length;++C){var ne=ae[C]&31;Me(e,c,U[ne]),c+=$[ne],ne>15&&(Me(e,c,ae[C]>>>5&127),c+=ae[C]>>>12)}}else E=Li,O=$e,D=Ci,K=kt;for(var C=0;C<o;++C)if(n[C]>255){var ne=n[C]>>>18&31;vt(e,c,E[ne+257]),c+=O[ne+257],ne>7&&(Me(e,c,n[C]>>>23&31),c+=Mt[ne]);var ie=n[C]&31;vt(e,c,D[ie]),c+=K[ie],ie>3&&(vt(e,c,n[C]>>>5&8191),c+=Ct[ie])}else vt(e,c,E[n[C]]),c+=O[n[C]];return vt(e,c,E[256]),c+O[256]},Pi=new Lt([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Jr=new le(0),Di=function(t,e,r,n,s,i){var a=t.length,o=new le(n+a+5*(1+Math.ceil(a/7e3))+s),u=o.subarray(n,o.length-s),l=0;if(!e||a<8)for(var c=0;c<=a;c+=65535){var h=c+65535;h>=a&&(u[l>>3]=i),l=zr(u,l+1,t.subarray(c,h))}else{for(var f=Pi[e-1],d=f>>>13,x=f&8191,g=(1<<r)-1,_=new me(32768),b=new me(g+1),v=Math.ceil(r/3),L=2*v,T=function(an){return(t[an]^t[an+1]<<v^t[an+2]<<L)&g},I=new Lt(25e3),R=new me(288),A=new me(32),C=0,B=0,c=0,$=0,V=0,H=0;c<a;++c){var y=T(c),k=c&32767,M=b[y];if(_[k]=M,b[y]=k,V<=c){var E=a-c;if((C>7e3||$>24576)&&E>423){l=xn(t,u,0,I,R,A,B,$,H,c-H,l),$=C=B=0,H=c;for(var O=0;O<286;++O)R[O]=0;for(var O=0;O<30;++O)A[O]=0}var D=2,K=0,U=x,W=k-M&32767;if(E>2&&y==T(c-W))for(var G=Math.min(d,E)-1,ae=Math.min(32767,c),ne=Math.min(258,E);W<=ae&&--U&&k!=M;){if(t[c+D]==t[c+D-W]){for(var ie=0;ie<ne&&t[c+ie]==t[c+ie-W];++ie);if(ie>D){if(D=ie,K=W,ie>G)break;for(var cr=Math.min(W,ie-2),Nt=0,O=0;O<cr;++O){var pt=c-W+O+32768&32767,Wa=_[pt],ks=pt-Wa+32768&32767;ks>Nt&&(Nt=ks,M=pt)}}}k=M,M=_[k],W+=k-M+32768&32767}if(K){I[$++]=268435456|Nr[D]<<18|bn[K];var Os=Nr[D]&31,As=bn[K]&31;B+=Mt[Os]+Ct[As],++R[257+Os],++A[As],V=c+D,++C}else I[$++]=t[c],++R[t[c]]}}l=xn(t,u,i,I,R,A,B,$,H,c-H,l),!i&&l&7&&(l=zr(u,l+1,Jr))}return Bt(o,0,n+sr(l)+s)},Ni=function(){for(var t=new Int32Array(256),e=0;e<256;++e){for(var r=e,n=9;--n;)r=(r&1&&-306674912)^r>>>1;t[e]=r}return t}(),Ui=function(){var t=-1;return{p:function(e){for(var r=t,n=0;n<e.length;++n)r=Ni[r&255^e[n]]^r>>>8;t=r},d:function(){return~t}}},ss=function(t,e,r,n,s){return Di(t,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):12+e.mem,r,n,!s)},io=function(t,e){var r={};for(var n in t)r[n]=t[n];for(var n in e)r[n]=e[n];return r},Ds=function(t,e,r){for(var n=t(),s=t.toString(),i=s.slice(s.indexOf("[")+1,s.lastIndexOf("]")).replace(/\s+/g,"").split(","),a=0;a<n.length;++a){var o=n[a],u=i[a];if(typeof o=="function"){e+=";"+u+"=";var l=o.toString();if(o.prototype)if(l.indexOf("[native code]")!=-1){var c=l.indexOf(" ",8)+1;e+=l.slice(c,l.indexOf("(",c))}else{e+=l;for(var h in o.prototype)e+=";"+u+".prototype."+h+"="+o.prototype[h].toString()}else e+=l}else r[u]=o}return[e,r]},hr=[],ao=function(t){var e=[];for(var r in t)t[r].buffer&&e.push((t[r]=new t[r].constructor(t[r])).buffer);return e},oo=function(t,e,r,n){var s;if(!hr[r]){for(var i="",a={},o=t.length-1,u=0;u<o;++u)s=Ds(t[u],i,a),i=s[0],a=s[1];hr[r]=Ds(t[o],i,a)}var l=io({},hr[r][1]);return so(hr[r][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",r,l,ao(l),n)},is=function(){return[le,me,Lt,Mt,Ct,Gt,ns,Ai,Mi,Bi,Xt,Ii,ke,Sr,Te,Rr,sr,Bt,ue,Zr,os,It,as]},uo=function(){return[le,me,Lt,Mt,Ct,Gt,Nr,bn,Li,$e,Ci,kt,Xt,Pi,Jr,ke,Me,vt,kr,Ur,wn,bt,zr,xn,sr,Bt,Di,ss,fo,It]},lo=function(){return[zi,ji,Kr,Ui,Ni]},co=function(){return[Ki,Fi]},ho=function(){return[$i]},It=function(t){return postMessage(t,[t.buffer])},as=function(t){return t&&t.size&&new le(t.size)},en=function(t,e,r,n,s,i){var a=oo(r,n,s,function(o,u){a.terminate(),i(o,u)});return a.postMessage([t,e],e.consume?[t.buffer]:[]),function(){a.terminate()}},Be=function(t,e){return t[e]|t[e+1]<<8},Oe=function(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0},on=function(t,e){return Oe(t,e)+Oe(t,e+4)*4294967296},Kr=function(t,e,r){for(;r;++e)t[e]=r,r>>>=8},zi=function(t,e){var r=e.filename;if(t[0]=31,t[1]=139,t[2]=8,t[8]=e.level<2?4:e.level==9?2:0,t[9]=3,e.mtime!=0&&Kr(t,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),r){t[3]=8;for(var n=0;n<=r.length;++n)t[n+10]=r.charCodeAt(n)}},Ki=function(t){(t[0]!=31||t[1]!=139||t[2]!=8)&&ue(6,"invalid gzip data");var e=t[3],r=10;e&4&&(r+=t[10]|(t[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!t[r++]);return r+(e&2)},Fi=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},ji=function(t){return 10+(t.filename&&t.filename.length+1||0)},$i=function(t){((t[0]&15)!=8||t[0]>>>4>7||(t[0]<<8|t[1])%31)&&ue(6,"invalid zlib data"),t[1]&32&&ue(6,"invalid zlib data: preset dictionaries not supported")};function fo(t,e){return ss(t,e||{},0,0)}function po(t,e,r){return r||(r=e,e={}),typeof r!="function"&&ue(7),en(t,e,[is],function(n){return It(os(n.data[0],as(n.data[1])))},1,r)}function os(t,e){return Zr(t,e)}function Ns(t,e,r){return r||(r=e,e={}),typeof r!="function"&&ue(7),en(t,e,[uo,lo,function(){return[Us]}],function(n){return It(Us(n.data[0],n.data[1]))},2,r)}function Us(t,e){e||(e={});var r=Ui(),n=t.length;r.p(t);var s=ss(t,e,ji(e),8),i=s.length;return zi(s,e),Kr(s,i-8,r.d()),Kr(s,i-4,n),s}function mo(t,e,r){return r||(r=e,e={}),typeof r!="function"&&ue(7),en(t,e,[is,co,function(){return[zs]}],function(n){return It(zs(n.data[0]))},3,r)}function zs(t,e){return Zr(t.subarray(Ki(t),-8),e||new le(Fi(t)))}function yo(t,e,r){return r||(r=e,e={}),typeof r!="function"&&ue(7),en(t,e,[is,ho,function(){return[Ks]}],function(n){return It(Ks(n.data[0],as(n.data[1])))},5,r)}function Ks(t,e){return Zr(($i(t),t.subarray(2,-4)),e)}function Fs(t,e,r){return r||(r=e,e={}),typeof r!="function"&&ue(7),t[0]==31&&t[1]==139&&t[2]==8?mo(t,e,r):(t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31?po(t,e,r):yo(t,e,r)}var _n=typeof TextDecoder<"u"&&new TextDecoder,go=0;try{_n.decode(Jr,{stream:!0}),go=1}catch{}var vo=function(t){for(var e="",r=0;;){var n=t[r++],s=(n>127)+(n>223)+(n>239);if(r+s>t.length)return[e,Bt(t,r-1)];s?s==3?(n=((n&15)<<18|(t[r++]&63)<<12|(t[r++]&63)<<6|t[r++]&63)-65536,e+=String.fromCharCode(55296|n>>10,56320|n&1023)):s&1?e+=String.fromCharCode((n&31)<<6|t[r++]&63):e+=String.fromCharCode((n&15)<<12|(t[r++]&63)<<6|t[r++]&63):e+=String.fromCharCode(n)}};function bo(t,e){if(e){for(var r="",n=0;n<t.length;n+=16384)r+=String.fromCharCode.apply(null,t.subarray(n,n+16384));return r}else{if(_n)return _n.decode(t);var s=vo(t),i=s[0],a=s[1];return a.length&&ue(8),i}}var wo=function(t,e){return e+30+Be(t,e+26)+Be(t,e+28)},xo=function(t,e,r){var n=Be(t,e+28),s=bo(t.subarray(e+46,e+46+n),!(Be(t,e+8)&2048)),i=e+46+n,a=Oe(t,e+20),o=r&&a==4294967295?_o(t,i):[a,Oe(t,e+24),Oe(t,e+42)],u=o[0],l=o[1],c=o[2];return[Be(t,e+10),u,l,s,i+Be(t,e+30)+Be(t,e+32),c]},_o=function(t,e){for(;Be(t,e)!=1;e+=4+Be(t,e+2));return[on(t,e+12),on(t,e+4),on(t,e+20)]};function Nl(t,e){for(var r={},n=t.length-22;Oe(t,n)!=101010256;--n)(!n||t.length-n>65558)&&ue(13);var s=Be(t,n+8);if(!s)return{};var i=Oe(t,n+16),a=i==4294967295||s==65535;if(a){var o=Oe(t,n-12);a=Oe(t,o)==101075792,a&&(s=Oe(t,o+32),i=Oe(t,o+48))}for(var u=0;u<s;++u){var l=xo(t,i,a),c=l[0],h=l[1],f=l[2],d=l[3],x=l[4],g=l[5],_=wo(t,g);i=x,c?c==8?r[d]=os(t.subarray(_,_+h),new le(f)):ue(14,"unknown compression type "+c):r[d]=Bt(t,_,_+h)}return r}function Fr(t,e,r,n=0){var s;n++,t=t.shadowRoot||t;for(let i=t.firstElementChild;i;i=i.nextElementSibling){if(i.assignedSlot)continue;const a=(s=i.assignedElements)==null?void 0:s.call(i,{flatten:!0});if(a)for(const o of a)e.call(r,o,n)&&Fr(i,e,r,n);e.call(r,i,n)&&Fr(i,e,r,n)}}class ir{constructor(){S(this,"left",0);S(this,"top",0);S(this,"width",0);S(this,"height",0)}copy(e){return this.top=e.top,this.left=e.left,this.width=e.width,this.height=e.height,this}}class it{constructor(){S(this,"left",0);S(this,"top",0);S(this,"right",0);S(this,"bottom",0)}copy(e){return this.top=e.top,this.left=e.left,this.right=e.right,this.bottom=e.bottom,this}}function us(t,e=new ir,r){const n=t.ownerDocument,s=n.documentElement,i=n.body;if(t===s)return Ro(n,e);if(r===t){e.left=0,e.top=0,e.width=t.offsetWidth,e.height=t.offsetHeight;return}const a=t.ownerDocument.defaultView;let o=t,u,l=o.offsetParent,c=a.getComputedStyle(o,null),h=o.offsetTop,f=o.offsetLeft;for(l&&r&&(l.contains(r)||l.contains(r.getRootNode().host))&&l!==r&&(us(r,e,l),f-=e.left,h-=e.top);(o=o.parentElement)&&o!==i&&o!==s&&o!==r&&c.position!=="fixed";)u=a.getComputedStyle(o,null),h-=o.scrollTop,f-=o.scrollLeft,o===l&&(h+=o.offsetTop,f+=o.offsetLeft,h+=parseFloat(u.borderTopWidth)||0,f+=parseFloat(u.borderLeftWidth)||0,l=o.offsetParent),c=u;return c.position==="fixed"&&(h+=Math.max(s.scrollTop,i.scrollTop),f+=Math.max(s.scrollLeft,i.scrollLeft)),e.left=f,e.top=h,e.width=t.offsetWidth,e.height=t.offsetHeight,e}function Eo(t,e){if(t.offsetParent===null){e.left=e.right=e.top=e.bottom=0;return}let r=getComputedStyle(t);e.left=parseFloat(r.marginLeft)||0,e.right=parseFloat(r.marginRight)||0,e.top=parseFloat(r.marginTop)||0,e.bottom=parseFloat(r.marginBottom)||0}function To(t,e){let r=getComputedStyle(t);e.left=parseFloat(r.borderLeftWidth)||0,e.right=parseFloat(r.borderRightWidth)||0,e.top=parseFloat(r.borderTopWidth)||0,e.bottom=parseFloat(r.borderBottomWidth)||0}function So(t,e){let r=getComputedStyle(t);e.left=parseFloat(r.paddingLeft)||0,e.right=parseFloat(r.paddingRight)||0,e.top=parseFloat(r.paddingTop)||0,e.bottom=parseFloat(r.paddingBottom)||0}let Ee;function Ul(t){return Ee||(Ee=document.createElement("div"),Ee.id="VIEWPORT",Ee.style.position="fixed",Ee.style.width="100vw",Ee.style.height="100vh",Ee.style.visibility="hidden",Ee.style.pointerEvents="none"),Ee.parentNode||document.documentElement.append(Ee),t.left=pageXOffset,t.top=pageYOffset,t.width=Ee.offsetWidth,t.height=Ee.offsetHeight,t}function Ro(t,e){const r=t.documentElement,n=t.body,s=getComputedStyle(r),i=getComputedStyle(n);return e.top=n.offsetTop+parseFloat(s.marginTop)||0+parseFloat(i.marginTop)||0,e.left=n.offsetLeft+parseFloat(s.marginLeft)||0+parseFloat(i.marginLeft)||0,e.width=Math.max(Math.max(n.scrollWidth,r.scrollWidth),Math.max(n.offsetWidth,r.offsetWidth),Math.max(n.clientWidth,r.clientWidth)),e.height=Math.max(Math.max(n.scrollHeight,r.scrollHeight),Math.max(n.offsetHeight,r.offsetHeight),Math.max(n.clientHeight,r.clientHeight)),e}function ko(t){const e=document.createElement("div");e.innerHTML=t;const r=e.firstElementChild;return e.removeChild(r),r}const qi=function(t,e){const r=document.createElement("a");r.download=e,r.href=window.URL.createObjectURL(t),r.dataset.downloadurl=["application/octet-stream",r.download,r.href].join(":"),r.click()},Oo=new Yr,Ao=new Yr;function Lo(t,e,r,n,s=new Yr){const i=t.transform,a=t.transformOrigin;if(i.indexOf("matrix(")==0){s.identity();const d=i.substring(7,i.length-1).split(", ").map(parseFloat);s.elements[0]=d[0],s.elements[1]=d[1],s.elements[4]=d[2],s.elements[5]=d[3],s.elements[12]=d[4],s.elements[13]=d[5]}else if(i.indexOf("matrix3d(")==0){const d=i.substring(9,i.length-1).split(", ").map(parseFloat);s.fromArray(d)}else return null;s.elements[0]===0&&(s.elements[0]=1e-15),s.elements[5]===0&&(s.elements[5]=1e-15),s.elements[10]===0&&(s.elements[10]=1e-15),s.elements[12]*=n,s.elements[13]*=n*-1;const o=a.split(" ").map(parseFloat),u=(o[0]-e/2)*n,l=(o[1]-r/2)*n*-1,c=o[2]||0,h=Oo.identity().makeTranslation(-u,-l,-c),f=Ao.identity().makeTranslation(u,l,c);for(const d of s.elements)if(isNaN(d))return null;return s.premultiply(f).multiply(h)}var at=[],Mo=function(){return at.some(function(t){return t.activeTargets.length>0})},Co=function(){return at.some(function(t){return t.skippedTargets.length>0})},js="ResizeObserver loop completed with undelivered notifications.",Bo=function(){var t;typeof ErrorEvent=="function"?t=new ErrorEvent("error",{message:js}):(t=document.createEvent("Event"),t.initEvent("error",!1,!1),t.message=js),window.dispatchEvent(t)},Yt;(function(t){t.BORDER_BOX="border-box",t.CONTENT_BOX="content-box",t.DEVICE_PIXEL_CONTENT_BOX="device-pixel-content-box"})(Yt||(Yt={}));var ot=function(t){return Object.freeze(t)},Io=function(){function t(e,r){this.inlineSize=e,this.blockSize=r,ot(this)}return t}(),Vi=function(){function t(e,r,n,s){return this.x=e,this.y=r,this.width=n,this.height=s,this.top=this.y,this.left=this.x,this.bottom=this.top+this.height,this.right=this.left+this.width,ot(this)}return t.prototype.toJSON=function(){var e=this,r=e.x,n=e.y,s=e.top,i=e.right,a=e.bottom,o=e.left,u=e.width,l=e.height;return{x:r,y:n,top:s,right:i,bottom:a,left:o,width:u,height:l}},t.fromRect=function(e){return new t(e.x,e.y,e.width,e.height)},t}(),ls=function(t){return t instanceof SVGElement&&"getBBox"in t},Hi=function(t){if(ls(t)){var e=t.getBBox(),r=e.width,n=e.height;return!r&&!n}var s=t,i=s.offsetWidth,a=s.offsetHeight;return!(i||a||t.getClientRects().length)},$s=function(t){var e;if(t instanceof Element)return!0;var r=(e=t==null?void 0:t.ownerDocument)===null||e===void 0?void 0:e.defaultView;return!!(r&&t instanceof r.Element)},Po=function(t){switch(t.tagName){case"INPUT":if(t.type!=="image")break;case"VIDEO":case"AUDIO":case"EMBED":case"OBJECT":case"CANVAS":case"IFRAME":case"IMG":return!0}return!1},jt=typeof window<"u"?window:{},fr=new WeakMap,qs=/auto|scroll/,Do=/^tb|vertical/,No=/msie|trident/i.test(jt.navigator&&jt.navigator.userAgent),Le=function(t){return parseFloat(t||"0")},_t=function(t,e,r){return t===void 0&&(t=0),e===void 0&&(e=0),r===void 0&&(r=!1),new Io((r?e:t)||0,(r?t:e)||0)},Vs=ot({devicePixelContentBoxSize:_t(),borderBoxSize:_t(),contentBoxSize:_t(),contentRect:new Vi(0,0,0,0)}),Wi=function(t,e){if(e===void 0&&(e=!1),fr.has(t)&&!e)return fr.get(t);if(Hi(t))return fr.set(t,Vs),Vs;var r=getComputedStyle(t),n=ls(t)&&t.ownerSVGElement&&t.getBBox(),s=!No&&r.boxSizing==="border-box",i=Do.test(r.writingMode||""),a=!n&&qs.test(r.overflowY||""),o=!n&&qs.test(r.overflowX||""),u=n?0:Le(r.paddingTop),l=n?0:Le(r.paddingRight),c=n?0:Le(r.paddingBottom),h=n?0:Le(r.paddingLeft),f=n?0:Le(r.borderTopWidth),d=n?0:Le(r.borderRightWidth),x=n?0:Le(r.borderBottomWidth),g=n?0:Le(r.borderLeftWidth),_=h+l,b=u+c,v=g+d,L=f+x,T=o?t.offsetHeight-L-t.clientHeight:0,I=a?t.offsetWidth-v-t.clientWidth:0,R=s?_+v:0,A=s?b+L:0,C=n?n.width:Le(r.width)-R-I,B=n?n.height:Le(r.height)-A-T,$=C+_+I+v,V=B+b+T+L,H=ot({devicePixelContentBoxSize:_t(Math.round(C*devicePixelRatio),Math.round(B*devicePixelRatio),i),borderBoxSize:_t($,V,i),contentBoxSize:_t(C,B,i),contentRect:new Vi(h,u,C,B)});return fr.set(t,H),H},Gi=function(t,e,r){var n=Wi(t,r),s=n.borderBoxSize,i=n.contentBoxSize,a=n.devicePixelContentBoxSize;switch(e){case Yt.DEVICE_PIXEL_CONTENT_BOX:return a;case Yt.BORDER_BOX:return s;default:return i}},Uo=function(){function t(e){var r=Wi(e);this.target=e,this.contentRect=r.contentRect,this.borderBoxSize=ot([r.borderBoxSize]),this.contentBoxSize=ot([r.contentBoxSize]),this.devicePixelContentBoxSize=ot([r.devicePixelContentBoxSize])}return t}(),Xi=function(t){if(Hi(t))return 1/0;for(var e=0,r=t.parentNode;r;)e+=1,r=r.parentNode;return e},zo=function(){var t=1/0,e=[];at.forEach(function(a){if(a.activeTargets.length!==0){var o=[];a.activeTargets.forEach(function(l){var c=new Uo(l.target),h=Xi(l.target);o.push(c),l.lastReportedSize=Gi(l.target,l.observedBox),h<t&&(t=h)}),e.push(function(){a.callback.call(a.observer,o,a.observer)}),a.activeTargets.splice(0,a.activeTargets.length)}});for(var r=0,n=e;r<n.length;r++){var s=n[r];s()}return t},Hs=function(t){at.forEach(function(r){r.activeTargets.splice(0,r.activeTargets.length),r.skippedTargets.splice(0,r.skippedTargets.length),r.observationTargets.forEach(function(s){s.isActive()&&(Xi(s.target)>t?r.activeTargets.push(s):r.skippedTargets.push(s))})})},Ko=function(){var t=0;for(Hs(t);Mo();)t=zo(),Hs(t);return Co()&&Bo(),t>0},un,Yi=[],Fo=function(){return Yi.splice(0).forEach(function(t){return t()})},jo=function(t){if(!un){var e=0,r=document.createTextNode(""),n={characterData:!0};new MutationObserver(function(){return Fo()}).observe(r,n),un=function(){r.textContent="".concat(e?e--:e++)}}Yi.push(t),un()},$o=function(t){jo(function(){requestAnimationFrame(t)})},Or=0,qo=function(){return!!Or},Vo=250,Ho={attributes:!0,characterData:!0,childList:!0,subtree:!0},Ws=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus"],Gs=function(t){return t===void 0&&(t=0),Date.now()+t},ln=!1,Wo=function(){function t(){var e=this;this.stopped=!0,this.listener=function(){return e.schedule()}}return t.prototype.run=function(e){var r=this;if(e===void 0&&(e=Vo),!ln){ln=!0;var n=Gs(e);$o(function(){var s=!1;try{s=Ko()}finally{if(ln=!1,e=n-Gs(),!qo())return;s?r.run(1e3):e>0?r.run(e):r.start()}})}},t.prototype.schedule=function(){this.stop(),this.run()},t.prototype.observe=function(){var e=this,r=function(){return e.observer&&e.observer.observe(document.body,Ho)};document.body?r():jt.addEventListener("DOMContentLoaded",r)},t.prototype.start=function(){var e=this;this.stopped&&(this.stopped=!1,this.observer=new MutationObserver(this.listener),this.observe(),Ws.forEach(function(r){return jt.addEventListener(r,e.listener,!0)}))},t.prototype.stop=function(){var e=this;this.stopped||(this.observer&&this.observer.disconnect(),Ws.forEach(function(r){return jt.removeEventListener(r,e.listener,!0)}),this.stopped=!0)},t}(),En=new Wo,Xs=function(t){!Or&&t>0&&En.start(),Or+=t,!Or&&En.stop()},Go=function(t){return!ls(t)&&!Po(t)&&getComputedStyle(t).display==="inline"},Xo=function(){function t(e,r){this.target=e,this.observedBox=r||Yt.CONTENT_BOX,this.lastReportedSize={inlineSize:0,blockSize:0}}return t.prototype.isActive=function(){var e=Gi(this.target,this.observedBox,!0);return Go(this.target)&&(this.lastReportedSize=e),this.lastReportedSize.inlineSize!==e.inlineSize||this.lastReportedSize.blockSize!==e.blockSize},t}(),Yo=function(){function t(e,r){this.activeTargets=[],this.skippedTargets=[],this.observationTargets=[],this.observer=e,this.callback=r}return t}(),dr=new WeakMap,Ys=function(t,e){for(var r=0;r<t.length;r+=1)if(t[r].target===e)return r;return-1},pr=function(){function t(){}return t.connect=function(e,r){var n=new Yo(e,r);dr.set(e,n)},t.observe=function(e,r,n){var s=dr.get(e),i=s.observationTargets.length===0;Ys(s.observationTargets,r)<0&&(i&&at.push(s),s.observationTargets.push(new Xo(r,n&&n.box)),Xs(1),En.schedule())},t.unobserve=function(e,r){var n=dr.get(e),s=Ys(n.observationTargets,r),i=n.observationTargets.length===1;s>=0&&(i&&at.splice(at.indexOf(n),1),n.observationTargets.splice(s,1),Xs(-1))},t.disconnect=function(e){var r=this,n=dr.get(e);n.observationTargets.slice().forEach(function(s){return r.unobserve(e,s.target)}),n.activeTargets.splice(0,n.activeTargets.length)},t}(),Qo=function(){function t(e){if(arguments.length===0)throw new TypeError("Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.");if(typeof e!="function")throw new TypeError("Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function.");pr.connect(this,e)}return t.prototype.observe=function(e,r){if(arguments.length===0)throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!$s(e))throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': parameter 1 is not of type 'Element");pr.observe(this,e,r)},t.prototype.unobserve=function(e){if(arguments.length===0)throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!$s(e))throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': parameter 1 is not of type 'Element");pr.unobserve(this,e)},t.prototype.disconnect=function(){pr.disconnect(this)},t.toString=function(){return"function ResizeObserver () { [polyfill code] }"},t}();class cs{constructor(e,r,n){S(this,"isMediaElement",!1);S(this,"isVideoElement",!1);S(this,"isCanvasElement",!1);S(this,"desiredPseudoState",{hover:!1,active:!1,focus:!1,target:!1});S(this,"needsRefresh",!0);S(this,"needsRemoval",!1);S(this,"parentLayer");S(this,"childLayers",[]);S(this,"allStateHashes",new Set);S(this,"previousDOMStateKey");S(this,"desiredDOMStateKey");S(this,"currentDOMStateKey");S(this,"lastSVGUrl");S(this,"domMetrics",{bounds:new ir,padding:new it,margin:new it,border:new it});if(this.manager=e,this.element=r,this.eventCallback=n,!e)throw new Error("WebLayerManager must be initialized");j.layers.set(r,this),r.setAttribute(j.LAYER_ATTRIBUTE,""),this.parentLayer=j.getClosestLayer(this.element,!1),this.isVideoElement=r.nodeName==="VIDEO",this.isMediaElement=this.isVideoElement||r.nodeName==="IMG"||r.nodeName==="CANVAS",this.eventCallback("layercreated",{target:r})}setNeedsRefresh(e=!1){if(this.needsRefresh=!0,e)for(const r of this.childLayers)r.setNeedsRefresh(e)}set pixelRatio(e){typeof e=="number"?this.element.setAttribute(j.PIXEL_RATIO_ATTRIBUTE,e.toString()):this.element.removeAttribute(j.PIXEL_RATIO_ATTRIBUTE)}get pixelRatio(){const e=this.element.getAttribute(j.PIXEL_RATIO_ATTRIBUTE);return e?parseFloat(e):null}get computedPixelRatio(){var e;return this.pixelRatio??((e=this.parentLayer)==null?void 0:e.computedPixelRatio)??1.5}get previousDOMState(){return this.previousDOMStateKey?this.manager.getLayerState(this.previousDOMStateKey):void 0}get desiredDOMState(){return this.desiredDOMStateKey?this.manager.getLayerState(this.desiredDOMStateKey):void 0}get currentDOMState(){return this.currentDOMStateKey?this.manager.getLayerState(this.currentDOMStateKey):void 0}get depth(){let e=0,r=this;for(;r.parentLayer;)r=r.parentLayer,e++;return e}get rootLayer(){let e=this;for(;e.parentLayer;)e=e.parentLayer;return e}traverseParentLayers(e){const r=this.parentLayer;r&&(r.traverseParentLayers(e),e(r))}traverseLayers(e){e(this),this.traverseChildLayers(e)}traverseChildLayers(e){for(const r of this.childLayers)r.traverseLayers(e)}update(){var n,s,i,a,o,u,l,c,h,f;if(this.desiredDOMStateKey!==this.currentDOMStateKey){const d=this.desiredDOMState;d&&(this.isMediaElement||(n=d.texture)!=null&&n.ktx2Url||(s=d.texture)!=null&&s.canvas||d.fullWidth*d.fullHeight===0)&&(this.currentDOMStateKey=this.desiredDOMStateKey)}const e=((a=(i=this.previousDOMState)==null?void 0:i.texture)==null?void 0:a.ktx2Url)??((u=(o=this.previousDOMState)==null?void 0:o.texture)==null?void 0:u.canvas),r=((c=(l=this.currentDOMState)==null?void 0:l.texture)==null?void 0:c.ktx2Url)??((f=(h=this.previousDOMState)==null?void 0:h.texture)==null?void 0:f.canvas);r&&e!==r&&this.eventCallback("layerpainted",{target:this.element}),this.previousDOMStateKey=this.currentDOMStateKey}async refresh(){this.needsRefresh=!1,this._updateParentAndChildLayers();const e=await this.manager.addToSerializeQueue(this);e.needsRasterize&&typeof e.stateKey=="string"&&e.svgUrl&&await this.manager.addToRasterizeQueue(e.stateKey,e.svgUrl)}_updateParentAndChildLayers(){const e=this.element,r=this.childLayers,n=r.slice(),s=this.parentLayer;this.parentLayer=j.getClosestLayer(this.element,!1),s!==this.parentLayer&&(this.parentLayer&&this.parentLayer.childLayers.push(this),this.eventCallback("layermoved",{target:e})),r.length=0,Fr(e,this._tryConvertElementToWebLayer,this);for(const i of n)j.getClosestLayer(i.element,!1)||(i.needsRemoval=!0,r.push(i))}_tryConvertElementToWebLayer(e){if(this.needsRemoval)return!1;const r=e,n=getComputedStyle(r);if(r.hasAttribute(j.LAYER_ATTRIBUTE)||r.nodeName==="VIDEO"||n.transform!=="none"){let i=j.layers.get(r);return i||(i=new cs(this.manager,r,this.eventCallback)),this.childLayers.push(i),!1}return!0}}const Zo=self.ResizeObserver||Qo;function Jo(t,e){if(document.contains(t))return t;const r=document.createElement("div");return r.id=t.id?"container-"+t.id:"",r.setAttribute(j.RENDERING_CONTAINER_ATTRIBUTE,""),r.style.visibility="hidden",r.style.pointerEvents="none",r.style.touchAction="none",r.attachShadow({mode:"open"}).appendChild(t),document.documentElement.appendChild(r),r}const F=class F{static get HOVER_ATTRIBUTE(){return this.ATTRIBUTE_PREFIX+"-hover"}static get ACTIVE_ATTRIBUTE(){return this.ATTRIBUTE_PREFIX+"-active"}static get FOCUS_ATTRIBUTE(){return this.ATTRIBUTE_PREFIX+"-focus"}static get TARGET_ATTRIBUTE(){return this.ATTRIBUTE_PREFIX+"-target"}static get LAYER_ATTRIBUTE(){return this.ATTRIBUTE_PREFIX+"-layer"}static get PIXEL_RATIO_ATTRIBUTE(){return this.ATTRIBUTE_PREFIX+"-pixel-ratio"}static get RENDERING_ATTRIBUTE(){return this.ATTRIBUTE_PREFIX+"-rendering"}static get RENDERING_PARENT_ATTRIBUTE(){return this.ATTRIBUTE_PREFIX+"-rendering-parent"}static get RENDERING_CONTAINER_ATTRIBUTE(){return this.ATTRIBUTE_PREFIX+"-rendering-container"}static get RENDERING_INLINE_ATTRIBUTE(){return this.ATTRIBUTE_PREFIX+"-rendering-inline"}static get RENDERING_DOCUMENT_ATTRIBUTE(){return this.ATTRIBUTE_PREFIX+"-rendering-document"}static getPsuedoAttributes(e){return`${e.hover?`${this.HOVER_ATTRIBUTE}="" `:" "}${e.focus?`${this.FOCUS_ATTRIBUTE}="" `:" "}${e.active?`${this.ACTIVE_ATTRIBUTE}="" `:" "}${e.target?`${this.TARGET_ATTRIBUTE}="" `:" "}`}static initRootNodeObservation(e){const r=e.ownerDocument,n=e.getRootNode(),s="head"in n?n.head:n;if(this.rootNodeObservers.get(n))return;if(!this.containerStyleElement){const h=this.containerStyleElement=r.createElement("style");r.head.appendChild(h),h.innerHTML=`
        [${F.RENDERING_CONTAINER_ATTRIBUTE}] {
          all: initial;
          position: fixed;
          width: 100%;
          height: 100%;
          top: 0px;
        }
      `}const i=`
    a {
      color: blue;
      text-decoration: underline;
    }

    :host > [${F.LAYER_ATTRIBUTE}] {
      display: flow-root;
    }

    [${F.RENDERING_DOCUMENT_ATTRIBUTE}] * {
      transform: none !important;
    }

    [${F.RENDERING_ATTRIBUTE}], [${F.RENDERING_ATTRIBUTE}] * {
      visibility: visible !important;
      /* the following is a hack for Safari; 
      without some kind of css filter active, 
      any box-shadow effect will fail to rasterize properly */
      filter: opacity(1);
    }
    
    [${F.RENDERING_ATTRIBUTE}] [${F.LAYER_ATTRIBUTE}], [${F.RENDERING_ATTRIBUTE}] [${F.LAYER_ATTRIBUTE}] * {
      visibility: hidden !important;
    }

    [${F.RENDERING_ATTRIBUTE}] {
      position: relative !important;
      top: 0 !important;
      left: 0 !important;
      float: left !important; /* prevent margin-collapse in SVG foreign-element for Webkit */
      box-sizing:border-box;
      min-width:var(--x-width);
      min-height:var(--x-height);
    }

    [${F.RENDERING_PARENT_ATTRIBUTE}] {
      transform: none !important;
      left: 0 !important;
      top: 0 !important;
      margin: 0 !important;
      border:0 !important;
      border-radius:0 !important;
      width: 100% !important;
      height:100% !important;
      padding:0 !important;
      visibility:hidden !important;
      filter:none !important;
    }
    
    [${F.RENDERING_PARENT_ATTRIBUTE}]::before, [${F.RENDERING_PARENT_ATTRIBUTE}]::after {
      content:none !important;
      box-shadow:none !important;
    }
    `,a=r.createElement("style");if(a.textContent=i,s.append(a),n===r){let h="";const f=()=>{if(h!=window.location.hash&&window.location.hash)try{this.targetElement=n.querySelector(window.location.hash)}catch{}h=window.location.hash};window.addEventListener("hashchange",f,!1),f(),window.addEventListener("focusin",d=>{this.focusElement=d.target},!1),window.addEventListener("focusout",d=>{this.focusElement=null},!1),window.addEventListener("load",d=>{o()})}const o=()=>{for(const[h,f]of this.layers)f.needsRefresh=!0},u=h=>{const f=h.nodeName.toUpperCase();l.indexOf(f)!==-1&&h.addEventListener("load",o)},l=["STYLE","LINK"],c=new MutationObserver(h=>{for(const f of h){l.indexOf(f.target.nodeName.toUpperCase())!==-1&&(o(),this.embeddedStyles.delete(f.target));for(const d of f.addedNodes)u(d)}});c.observe(r,{childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!0,characterDataOldValue:!0}),this.rootNodeObservers.set(n,c)}static setLayerNeedsRefresh(e){e.needsRefresh=!0}static createLayerTree(e,r,n){if(F.getClosestLayer(e))throw new Error("A root WebLayer for the given element already exists");const s=Jo(e);F.initRootNodeObservation(e);const i=new MutationObserver(F._handleMutations);this.mutationObservers.set(e,i),this.startMutationObserver(e);const a=new Zo(u=>{for(const l of u){const c=this.getClosestLayer(l.target);c.traverseLayers(F.setLayerNeedsRefresh),c.traverseParentLayers(F.setLayerNeedsRefresh)}});a.observe(e),this.resizeObservers.set(e,a),e.addEventListener("input",this._triggerRefresh,{capture:!0}),e.addEventListener("keydown",this._triggerRefresh,{capture:!0}),e.addEventListener("submit",this._triggerRefresh,{capture:!0}),e.addEventListener("change",this._triggerRefresh,{capture:!0}),e.addEventListener("focus",this._triggerRefresh,{capture:!0}),e.addEventListener("blur",this._triggerRefresh,{capture:!0}),e.addEventListener("transitionend",this._triggerRefresh,{capture:!0});const o=new cs(r.manager,e,n);return this.rootLayers.set(e,o),s}static disposeLayer(e){this.rootLayers.has(e.element)&&(this.rootLayers.delete(e.element),this.mutationObservers.get(e.element).disconnect(),this.mutationObservers.delete(e.element),this.resizeObservers.get(e.element).disconnect(),this.resizeObservers.delete(e.element),e.element.removeEventListener("input",this._triggerRefresh,{capture:!0}),e.element.removeEventListener("keydown",this._triggerRefresh,{capture:!0}),e.element.removeEventListener("submit",this._triggerRefresh,{capture:!0}),e.element.removeEventListener("change",this._triggerRefresh,{capture:!0}),e.element.removeEventListener("focus",this._triggerRefresh,{capture:!0}),e.element.removeEventListener("blur",this._triggerRefresh,{capture:!0}),e.element.removeEventListener("transitionend",this._triggerRefresh,{capture:!0}))}static getClosestLayer(e,r=!0){const n=r?e:e.parentElement,s=n==null?void 0:n.closest(`[${F.LAYER_ATTRIBUTE}]`);if(!s){const i=(e==null?void 0:e.getRootNode()).host;if(i)return this.getClosestLayer(i,r)}return this.layers.get(s)}static pauseMutationObservers(){const e=F.mutationObservers.values();for(const r of e)F._handleMutations(r.takeRecords()),r.disconnect()}static resumeMutationObservers(){for(const[e]of F.mutationObservers)this.startMutationObserver(e)}static startMutationObserver(e){F.mutationObservers.get(e).observe(e,{attributes:!0,childList:!0,subtree:!0,characterData:!0,characterDataOldValue:!0,attributeOldValue:!0})}static arrayBufferToBase64(e){let r="";const n=e.byteLength;for(let s=0;s<n;s++)r+=String.fromCharCode(e[s]);return window.btoa(r)}static attributeCSS(e,r){return r?`[${e}]=${r}`:`[${e}]`}static attributeHTML(e,r){return r?`${e}="${r}"`:`${e}=""`}static updateInputAttributes(e){e.matches("input")&&this._updateInputAttribute(e);for(const r of e.getElementsByTagName("input"))this._updateInputAttribute(r)}static _updateInputAttribute(e){e.hasAttribute("checked")?e.checked||e.removeAttribute("checked"):e.checked&&e.setAttribute("checked",""),e.getAttribute("value")!==e.value&&e.setAttribute("value",e.value)}static isBlankImage(e){return!new Uint32Array(e.buffer).some(n=>n!==0)}};S(F,"ATTRIBUTE_PREFIX","xr"),S(F,"serializer",Is?new XMLSerializer:null),S(F,"textEncoder",Is?new TextEncoder:null),S(F,"rootLayers",new Map),S(F,"layers",new Map),S(F,"focusElement",null),S(F,"activeElement",null),S(F,"targetElement",null),S(F,"mutationObservers",new Map),S(F,"resizeObservers",new Map),S(F,"rootNodeObservers",new Map),S(F,"containerStyleElement"),S(F,"dataURLMap",new Map),S(F,"embeddedCSSMap",new Map),S(F,"embeddedStyles",new Map),S(F,"fontStyles",new Map),S(F,"_handleMutations",e=>{var r;for(const n of e){if(n.type==="attributes"&&n.target.getAttribute(n.attributeName)===n.oldValue)continue;if(n.type==="characterData"){const a=n.target;if(a.data===n.oldValue)continue;if(((r=a.parentElement)==null?void 0:r.tagName.toLowerCase())==="style"){const o=a.parentElement;o.getRootNode(),F.embeddedStyles.delete(o)}}const s=n.target.nodeType===Node.ELEMENT_NODE?n.target:n.target.parentElement;if(!s)continue;const i=F.getClosestLayer(s);if(i){if(n.type==="attributes"&&n.attributeName==="class"){const a=n.oldValue?n.oldValue:"",o=n.target.className;if(a===o)continue}i.parentLayer?i.parentLayer.traverseChildLayers(F.setLayerNeedsRefresh):i.traverseLayers(F.setLayerNeedsRefresh)}}}),S(F,"_triggerRefresh",async e=>{const r=F.getClosestLayer(e.target);r&&(r.parentLayer?r.parentLayer.traverseChildLayers(F.setLayerNeedsRefresh):r.traverseLayers(F.setLayerNeedsRefresh))});let j=F;const Tn=Symbol("ON_BEFORE_UPDATE"),cn=new Qr;function eu(t){const e=t.attributes.uv;for(let r=0;r<e.count;r++)e.setY(r,1-e.getY(r));return t}const nt=class nt extends Tr{constructor(r,n){super();S(this,"_camera");S(this,"_webLayer");S(this,"_localZ",0);S(this,"_viewZ",0);S(this,"_renderZ",0);S(this,"_mediaSrc");S(this,"_mediaTexture");S(this,"textures",new Set);S(this,"_previousTexture");S(this,"_textureMap",new Map);S(this,"contentMesh");S(this,"_boundsMesh");S(this,"cursor",new Tr);S(this,"depthMaterial",new eo({depthPacking:to,alphaTest:.001}));S(this,"domLayout",new Tr);S(this,"domSize",new Qr(1,1,1));S(this,"bounds",new ir);S(this,"margin",new it);S(this,"childWebLayers",[]);S(this,"shouldApplyDOMLayout","auto");this.element=r,this.container=n,this.name=r.id,this._webLayer=j.getClosestLayer(r),r.layer=this;const s=this.element.getAttribute("xr-apply-dom-layout");s&&(this.shouldApplyDOMLayout=s);const i=this._webLayer.isMediaElement?nt.GEOMETRY:nt.FLIPPED_GEOMETRY;this.contentMesh=new Ls(i,new Ms({side:Ya,depthWrite:!1,transparent:!0,alphaTest:.001,opacity:1,toneMapped:!1})),this._boundsMesh=new Ls(i,new Ms({visible:!1,opacity:0})),this.add(this.contentMesh),this.add(this._boundsMesh),this.cursor.visible=!1,this.matrixAutoUpdate=!0,this.contentMesh.matrixAutoUpdate=!0,this.contentMesh.visible=!1,this.contentMesh.customDepthMaterial=this.depthMaterial,this.contentMesh.onBeforeRender=(a,o,u)=>{this._camera=u},this._boundsMesh.matrixAutoUpdate=!0,this.container.options.manager.layersByElement.set(this.element,this),this.container.options.manager.layersByMesh.set(this.contentMesh,this)}static shouldApplyDOMLayout(r){const n=r.shouldApplyDOMLayout;if(n==="always"||n===!0)return!0;if(n==="never"||n===!1)return!1;if(n==="auto"&&r.parentWebLayer&&r.parent===r.parentWebLayer)return!0;if(n==="once")return r.shouldApplyDOMLayout=!1,!0}get allStateHashes(){return this._webLayer.allStateHashes}get domState(){return this._webLayer.currentDOMState}get texture(){var i,a,o;const r=this.container.manager,n=this._webLayer;if(n.isMediaElement){const u=this.element;let l=this._mediaTexture;return(!l||l.image&&u.src!==l.image.src)&&(l&&l.dispose(),l=n.isVideoElement?new Qa(u):n.isCanvasElement?new Si(u):new Za().load(u.src),l.wrapS=xt,l.wrapT=xt,l.minFilter=Ja,r.textureEncoding&&(l.colorSpace=r.textureEncoding),this._mediaTexture=l),l}const s=(a=(i=this._webLayer.currentDOMState)==null?void 0:i.texture)==null?void 0:a.hash;if(s){this._textureMap.has(s)||this._textureMap.set(s,{});const u=r.getTexture(s),l=this._textureMap.get(s);return u.compressedTexture&&!l.compressedTexture&&((o=l.canvasTexture)==null||o.dispose(),l.canvasTexture=void 0,l.compressedTexture=u.compressedTexture.clone(),l.compressedTexture.needsUpdate=!0),u.canvasTexture&&!l.canvasTexture&&(l.canvasTexture=u.canvasTexture.clone(),l.canvasTexture.needsUpdate=!0),l.compressedTexture??l.canvasTexture}}get desiredPseudoStates(){return this._webLayer.desiredPseudoState}get pseudoStates(){var r;return(r=this._webLayer.currentDOMState)==null?void 0:r.pseudo}get depth(){return this._webLayer.depth}get index(){return this.parentWebLayer?this.parentWebLayer.childWebLayers.indexOf(this):0}get needsRefresh(){return this._webLayer.needsRefresh}setNeedsRefresh(r=!0){this._webLayer.setNeedsRefresh(r)}get needsRemoval(){return this._webLayer.needsRemoval}get parentWebLayer(){return this._webLayer.parentLayer&&this.container.manager.layersByElement.get(this._webLayer.parentLayer.element)}async refresh(r=!1){var s;const n=[];n.push(this._webLayer.refresh()),this.childWebLayers.length=0;for(const i of this._webLayer.childLayers){const a=this.container.manager.layersByElement.get((s=j.getClosestLayer(i.element))==null?void 0:s.element);a&&(this.childWebLayers.push(a),r&&n.push(a.refresh(r)))}return Promise.all(n).then(()=>{})}updateLayout(){if(this._updateDOMLayout(),this._camera){this._localZ=Math.abs(cn.setFromMatrixPosition(this.matrix).z+cn.setFromMatrixPosition(this.contentMesh.matrix).z),this._viewZ=Math.abs(this.contentMesh.getWorldPosition(cn).applyMatrix4(this._camera.matrixWorldInverse).z);let r=this.parentWebLayer?this.parentWebLayer._renderZ:this._viewZ;this._localZ<.001?this._renderZ=r:this._renderZ=this._viewZ,this.contentMesh.renderOrder=(this.container.options.renderOrderOffset||0)+(1-Math.log(this._renderZ+1)/Math.log(this._camera.far+1))+(this.depth+this.index*.001)*1e-7}}updateContent(){if(this.parentWebLayer&&!this.parentWebLayer.domLayout)return;const r=this.contentMesh,n=this.texture,s=r.material;if(n&&s.map!==n){const o=this.contentMesh.scale,u=Math.abs(o.x*this.scale.x/o.y*this.scale.y),l=this.domSize.x/this.domSize.y;Math.abs(l-u)<1e3&&(s.map=n,this.depthMaterial.map=n,s.needsUpdate=!0,this.depthMaterial.needsUpdate=!0)}const i=r.material,a=i.opacity<.005;a?r.visible=!1:i.map&&(r.visible=!0),this.needsRemoval&&a&&(this.parent&&this.parent.remove(this),this.dispose()),this._refreshMediaBounds()}[Tn](){}onBeforeApplyLayout(){}_doUpdate(){var r,n;this[Tn](),this.updateContent(),this.updateLayout(),this.onBeforeApplyLayout(),nt.shouldApplyDOMLayout(this)&&(this.position.copy(this.domLayout.position),this.quaternion.copy(this.domLayout.quaternion),this.scale.copy(this.domLayout.scale)),this.contentMesh.position.set(0,0,0),this.contentMesh.scale.copy(this.domSize),this.contentMesh.quaternion.set(0,0,0,1),this._boundsMesh.position.set(0,0,0),this._boundsMesh.scale.copy(this.domSize),this._boundsMesh.quaternion.set(0,0,0,1),this.needsRefresh&&this.container.options.autoRefresh!==!1&&this.refresh(),this._previousTexture!==this.texture&&(this.texture&&this.container.manager.renderer.initTexture(this.texture),this._previousTexture=this.texture,(n=(r=this.container.options).onLayerPaint)==null||n.call(r,this)),this._webLayer.update(),this.container.manager.scheduleTasksIfNeeded()}get pixelRatio(){return this._webLayer.pixelRatio}set pixelRatio(r){this._webLayer.pixelRatio=r}get computedPixelRatio(){return this._webLayer.computedPixelRatio}update(r=!1){r?this.traverseLayersPreOrder(this._doUpdate):this._doUpdate()}querySelector(r){var s;const n=this.element.querySelector(r)||((s=this.element.shadowRoot)==null?void 0:s.querySelector(r));if(n)return this.container.manager.layersByElement.get(n)}querySelectorAll(r){var s;const n=this.element.querySelectorAll(r)||((s=this.element.shadowRoot)==null?void 0:s.querySelectorAll(r));return Array.from(n).map(i=>this.container.manager.layersByElement.get(i)).filter(i=>i)}traverseLayerAncestors(r){const n=this.parentWebLayer;n&&(n.traverseLayerAncestors(r),r.call(this,n))}traverseLayersPreOrder(r){if(r.call(this,this)===!1)return!1;for(const n of this.childWebLayers)if(n.traverseLayersPreOrder(r)===!1)return!1;return!0}traverseLayersPostOrder(r){for(const n of this.childWebLayers)if(n.traverseLayersPostOrder(r)===!1)return!1;return r.call(this,this)||!0}dispose(){j.disposeLayer(this._webLayer);for(const r of this.textures)r.dispose();for(const r of this.childWebLayers)r.dispose()}_refreshMediaBounds(){if(this._webLayer.isMediaElement){const r=this._webLayer.isVideoElement,n=this.domState;if(!n)return;const s=this.element,i=this.texture,a=getComputedStyle(this.element),{objectFit:o}=a,{width:u,height:l}=this.bounds.copy(n.bounds),c=r?s.videoWidth:s.naturalWidth,h=r?s.videoHeight:s.naturalHeight,f=c/h,d=u/l;switch(i.center.set(.5,.5),o){case"none":i.repeat.set(u/c,l/h).clampScalar(0,1);break;case"contain":case"scale-down":if(i.repeat.set(1,1),d>f){const x=this.bounds.height*f||0;this.bounds.left+=(this.bounds.width-x)/2,this.bounds.width=x}else{const x=this.bounds.width/f||0;this.bounds.top+=(this.bounds.height-x)/2,this.bounds.height=x}break;case"cover":if(i.repeat.set(u/c,l/h),d<f){const x=this.bounds.height*f||0;this.bounds.left+=(this.bounds.width-x)/2,this.bounds.width=x}else{const x=this.bounds.width/f||0;this.bounds.top+=(this.bounds.height-x)/2,this.bounds.height=x}break;default:case"fill":i.repeat.set(1,1);break}n.bounds.copy(this.bounds)}}_updateDOMLayout(){if(this.needsRemoval)return;const r=this._webLayer.currentDOMState;if(!r)return;const{bounds:n,margin:s,cssTransform:i}=r,a=this._webLayer.isMediaElement;this.domLayout.position.set(0,0,0),this.domLayout.scale.set(1,1,1),this.domLayout.quaternion.set(0,0,0,1);const o=this.bounds.copy(n),u=this.margin.copy(s),l=o.width,c=o.height,h=a?0:u.left,f=a?0:u.right,d=a?0:u.top,x=a?0:u.bottom,g=l+h+f,_=c+d+x,b=1/this.container.manager.pixelsPerMeter;this.domSize.set(Math.max(b*g,1e-5),Math.max(b*_,1e-5),1);const v=this.parentWebLayer;if(!v)return;const L=v.bounds,T=v.margin,I=L.width+T.left+T.right,R=L.height+T.bottom+T.top,A=-I/2+T.left,C=R/2-T.top;this.domLayout.position.set(b*(A+g/2+o.left-h),b*(C-_/2-o.top+d),0),i&&(this.domLayout.updateMatrix(),this.domLayout.matrix.multiply(i),this.domLayout.matrix.decompose(this.domLayout.position,this.domLayout.quaternion,this.domLayout.scale))}};S(nt,"GEOMETRY",new Cs(1,1,2,2)),S(nt,"FLIPPED_GEOMETRY",eu(new Cs(1,1,2,2)));let Sn=nt;const ee=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,ce=Object.keys,ye=Array.isArray;function be(t,e){return typeof e!="object"||ce(e).forEach(function(r){t[r]=e[r]}),t}typeof Promise>"u"||ee.Promise||(ee.Promise=Promise);const Qt=Object.getPrototypeOf,tu={}.hasOwnProperty;function _e(t,e){return tu.call(t,e)}function Ot(t,e){typeof e=="function"&&(e=e(Qt(t))),(typeof Reflect>"u"?ce:Reflect.ownKeys)(e).forEach(r=>{Ke(t,r,e[r])})}const Qi=Object.defineProperty;function Ke(t,e,r,n){Qi(t,e,be(r&&_e(r,"get")&&typeof r.get=="function"?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},n))}function Et(t){return{from:function(e){return t.prototype=Object.create(e.prototype),Ke(t.prototype,"constructor",t),{extend:Ot.bind(null,t.prototype)}}}}const ru=Object.getOwnPropertyDescriptor;function hs(t,e){let r;return ru(t,e)||(r=Qt(t))&&hs(r,e)}const nu=[].slice;function jr(t,e,r){return nu.call(t,e,r)}function Zi(t,e){return e(t)}function Kt(t){if(!t)throw new Error("Assertion Failed")}function Ji(t){ee.setImmediate?setImmediate(t):setTimeout(t,0)}function ea(t,e){return t.reduce((r,n,s)=>{var i=e(n,s);return i&&(r[i[0]]=i[1]),r},{})}function Fe(t,e){if(typeof e=="string"&&_e(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var r=[],n=0,s=e.length;n<s;++n){var i=Fe(t,e[n]);r.push(i)}return r}var a=e.indexOf(".");if(a!==-1){var o=t[e.substr(0,a)];return o==null?void 0:Fe(o,e.substr(a+1))}}function Ae(t,e,r){if(t&&e!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){Kt(typeof r!="string"&&"length"in r);for(var n=0,s=e.length;n<s;++n)Ae(t,e[n],r[n])}else{var i=e.indexOf(".");if(i!==-1){var a=e.substr(0,i),o=e.substr(i+1);if(o==="")r===void 0?ye(t)&&!isNaN(parseInt(a))?t.splice(a,1):delete t[a]:t[a]=r;else{var u=t[a];u&&_e(t,a)||(u=t[a]={}),Ae(u,o,r)}}else r===void 0?ye(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=r}}function ta(t){var e={};for(var r in t)_e(t,r)&&(e[r]=t[r]);return e}const su=[].concat;function ra(t){return su.apply([],t)}const na="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ra([8,16,32,64].map(t=>["Int","Uint","Float"].map(e=>e+t+"Array")))).filter(t=>ee[t]),iu=na.map(t=>ee[t]);ea(na,t=>[t,!0]);let We=null;function ar(t){We=typeof WeakMap<"u"&&new WeakMap;const e=Rn(t);return We=null,e}function Rn(t){if(!t||typeof t!="object")return t;let e=We&&We.get(t);if(e)return e;if(ye(t)){e=[],We&&We.set(t,e);for(var r=0,n=t.length;r<n;++r)e.push(Rn(t[r]))}else if(iu.indexOf(t.constructor)>=0)e=t;else{const i=Qt(t);for(var s in e=i===Object.prototype?{}:Object.create(i),We&&We.set(t,e),t)_e(t,s)&&(e[s]=Rn(t[s]))}return e}const{toString:au}={};function kn(t){return au.call(t).slice(8,-1)}const On=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ou=typeof On=="symbol"?function(t){var e;return t!=null&&(e=t[On])&&e.apply(t)}:function(){return null},wt={};function Ue(t){var e,r,n,s;if(arguments.length===1){if(ye(t))return t.slice();if(this===wt&&typeof t=="string")return[t];if(s=ou(t)){for(r=[];!(n=s.next()).done;)r.push(n.value);return r}if(t==null)return[t];if(typeof(e=t.length)=="number"){for(r=new Array(e);e--;)r[e]=t[e];return r}return[t]}for(e=arguments.length,r=new Array(e);e--;)r[e]=arguments[e];return r}const fs=typeof Symbol<"u"?t=>t[Symbol.toStringTag]==="AsyncFunction":()=>!1;var Pe=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function sa(t,e){Pe=t,ia=e}var ia=()=>!0;const uu=!new Error("").stack;function dt(){if(uu)try{throw dt.arguments,new Error}catch(t){return t}return new Error}function An(t,e){var r=t.stack;return r?(e=e||0,r.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),r.split(`
`).slice(e).filter(ia).map(n=>`
`+n).join("")):""}var aa=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],ds=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(aa),lu={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Tt(t,e){this._e=dt(),this.name=t,this.message=e}function oa(t,e){return t+". Errors: "+Object.keys(e).map(r=>e[r].toString()).filter((r,n,s)=>s.indexOf(r)===n).join(`
`)}function $r(t,e,r,n){this._e=dt(),this.failures=e,this.failedKeys=n,this.successCount=r,this.message=oa(t,e)}function $t(t,e){this._e=dt(),this.name="BulkError",this.failures=Object.keys(e).map(r=>e[r]),this.failuresByPos=e,this.message=oa(t,e)}Et(Tt).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+An(this._e,2))}},toString:function(){return this.name+": "+this.message}}),Et($r).from(Tt),Et($t).from(Tt);var ps=ds.reduce((t,e)=>(t[e]=e+"Error",t),{});const cu=Tt;var q=ds.reduce((t,e)=>{var r=e+"Error";function n(s,i){this._e=dt(),this.name=r,s?typeof s=="string"?(this.message=`${s}${i?`
 `+i:""}`,this.inner=i||null):typeof s=="object"&&(this.message=`${s.name} ${s.message}`,this.inner=s):(this.message=lu[e]||r,this.inner=null)}return Et(n).from(cu),t[e]=n,t},{});q.Syntax=SyntaxError,q.Type=TypeError,q.Range=RangeError;var Qs=aa.reduce((t,e)=>(t[e+"Error"]=q[e],t),{}),Ar=ds.reduce((t,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=q[e]),t),{});function Q(){}function Zt(t){return t}function hu(t,e){return t==null||t===Zt?e:function(r){return e(t(r))}}function ht(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function fu(t,e){return t===Q?e:function(){var r=t.apply(this,arguments);r!==void 0&&(arguments[0]=r);var n=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var i=e.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?ht(n,this.onsuccess):n),s&&(this.onerror=this.onerror?ht(s,this.onerror):s),i!==void 0?i:r}}function du(t,e){return t===Q?e:function(){t.apply(this,arguments);var r=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?ht(r,this.onsuccess):r),n&&(this.onerror=this.onerror?ht(n,this.onerror):n)}}function pu(t,e){return t===Q?e:function(r){var n=t.apply(this,arguments);be(r,n);var s=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var a=e.apply(this,arguments);return s&&(this.onsuccess=this.onsuccess?ht(s,this.onsuccess):s),i&&(this.onerror=this.onerror?ht(i,this.onerror):i),n===void 0?a===void 0?void 0:a:be(n,a)}}function mu(t,e){return t===Q?e:function(){return e.apply(this,arguments)!==!1&&t.apply(this,arguments)}}function ms(t,e){return t===Q?e:function(){var r=t.apply(this,arguments);if(r&&typeof r.then=="function"){for(var n=this,s=arguments.length,i=new Array(s);s--;)i[s]=arguments[s];return r.then(function(){return e.apply(n,i)})}return e.apply(this,arguments)}}Ar.ModifyError=$r,Ar.DexieError=Tt,Ar.BulkError=$t;var Jt={};const ua=100,[Ln,qr,Mn]=typeof Promise>"u"?[]:(()=>{let t=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[t,Qt(t),t];const e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,Qt(e),t]})(),la=qr&&qr.then,Lr=Ln&&Ln.constructor,ys=!!Mn;var Cn=!1,yu=Mn?()=>{Mn.then(mr)}:ee.setImmediate?setImmediate.bind(null,mr):ee.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver(()=>{mr(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(mr,0)},qt=function(t,e){Ft.push([t,e]),Vr&&(yu(),Vr=!1)},Bn=!0,Vr=!0,ut=[],Mr=[],In=null,Pn=Zt,St={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ei,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(t=>{try{ei(t[0],t[1])}catch{}})}},z=St,Ft=[],lt=0,Cr=[];function N(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=Q,this._lib=!1;var e=this._PSD=z;if(Pe&&(this._stackHolder=dt(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==Jt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Nn(this,this._value))}this._state=null,this._value=null,++e.ref,ha(this,t)}const Dn={get:function(){var t=z,e=Hr;function r(n,s){var i=!t.global&&(t!==z||e!==Hr);const a=i&&!qe();var o=new N((u,l)=>{gs(this,new ca(Wr(n,t,i,a),Wr(s,t,i,a),u,l,t))});return Pe&&pa(o,this),o}return r.prototype=Jt,r},set:function(t){Ke(this,"then",t&&t.prototype===Jt?Dn:{get:function(){return t},set:Dn.set})}};function ca(t,e,r,n,s){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=r,this.reject=n,this.psd=s}function ha(t,e){try{e(r=>{if(t._state===null){if(r===t)throw new TypeError("A promise cannot be resolved with itself.");var n=t._lib&&or();r&&typeof r.then=="function"?ha(t,(s,i)=>{r instanceof N?r._then(s,i):r.then(s,i)}):(t._state=!0,t._value=r,fa(t)),n&&ur()}},Nn.bind(null,t))}catch(r){Nn(t,r)}}function Nn(t,e){if(Mr.push(e),t._state===null){var r=t._lib&&or();e=Pn(e),t._state=!1,t._value=e,Pe&&e!==null&&typeof e=="object"&&!e._promise&&function(n,s,i){try{n.apply(null,i)}catch{}}(()=>{var n=hs(e,"stack");e._promise=t,Ke(e,"stack",{get:()=>Cn?n&&(n.get?n.get.apply(e):n.value):t.stack})}),function(n){ut.some(s=>s._value===n._value)||ut.push(n)}(t),fa(t),r&&ur()}}function fa(t){var e=t._listeners;t._listeners=[];for(var r=0,n=e.length;r<n;++r)gs(t,e[r]);var s=t._PSD;--s.ref||s.finalize(),lt===0&&(++lt,qt(()=>{--lt==0&&vs()},[]))}function gs(t,e){if(t._state!==null){var r=t._state?e.onFulfilled:e.onRejected;if(r===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++lt,qt(gu,[r,t,e])}else t._listeners.push(e)}function gu(t,e,r){try{In=e;var n,s=e._value;e._state?n=t(s):(Mr.length&&(Mr=[]),n=t(s),Mr.indexOf(s)===-1&&function(i){for(var a=ut.length;a;)if(ut[--a]._value===i._value)return void ut.splice(a,1)}(e)),r.resolve(n)}catch(i){r.reject(i)}finally{In=null,--lt==0&&vs(),--r.psd.ref||r.psd.finalize()}}function da(t,e,r){if(e.length===r)return e;var n="";if(t._state===!1){var s,i,a=t._value;a!=null?(s=a.name||"Error",i=a.message||a,n=An(a,0)):(s=a,i=""),e.push(s+(i?": "+i:"")+n)}return Pe&&((n=An(t._stackHolder,2))&&e.indexOf(n)===-1&&e.push(n),t._prev&&da(t._prev,e,r)),e}function pa(t,e){var r=e?e._numPrev+1:0;r<100&&(t._prev=e,t._numPrev=r)}function mr(){or()&&ur()}function or(){var t=Bn;return Bn=!1,Vr=!1,t}function ur(){var t,e,r;do for(;Ft.length>0;)for(t=Ft,Ft=[],r=t.length,e=0;e<r;++e){var n=t[e];n[0].apply(null,n[1])}while(Ft.length>0);Bn=!0,Vr=!0}function vs(){var t=ut;ut=[],t.forEach(n=>{n._PSD.onunhandled.call(null,n._value,n)});for(var e=Cr.slice(0),r=e.length;r;)e[--r]()}function yr(t){return new N(Jt,!1,t)}function re(t,e){var r=z;return function(){var n=or(),s=z;try{return Je(r,!0),t.apply(this,arguments)}catch(i){e&&e(i)}finally{Je(s,!1),n&&ur()}}}Ot(N.prototype,{then:Dn,_then:function(t,e){gs(this,new ca(null,null,t,e,z))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],r=arguments[1];return typeof e=="function"?this.then(null,n=>n instanceof e?r(n):yr(n)):this.then(null,n=>n&&n.name===e?r(n):yr(n))},finally:function(t){return this.then(e=>(t(),e),e=>(t(),yr(e)))},stack:{get:function(){if(this._stack)return this._stack;try{Cn=!0;var t=da(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=t),t}finally{Cn=!1}}},timeout:function(t,e){return t<1/0?new N((r,n)=>{var s=setTimeout(()=>n(new q.Timeout(e)),t);this.then(r,n).finally(clearTimeout.bind(null,s))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&Ke(N.prototype,Symbol.toStringTag,"Dexie.Promise"),St.env=ma(),Ot(N,{all:function(){var t=Ue.apply(null,arguments).map(gr);return new N(function(e,r){t.length===0&&e([]);var n=t.length;t.forEach((s,i)=>N.resolve(s).then(a=>{t[i]=a,--n||e(t)},r))})},resolve:t=>{if(t instanceof N)return t;if(t&&typeof t.then=="function")return new N((r,n)=>{t.then(r,n)});var e=new N(Jt,!0,t);return pa(e,In),e},reject:yr,race:function(){var t=Ue.apply(null,arguments).map(gr);return new N((e,r)=>{t.map(n=>N.resolve(n).then(e,r))})},PSD:{get:()=>z,set:t=>z=t},totalEchoes:{get:()=>Hr},newPSD:Ze,usePSD:Dt,scheduler:{get:()=>qt,set:t=>{qt=t}},rejectionMapper:{get:()=>Pn,set:t=>{Pn=t}},follow:(t,e)=>new N((r,n)=>Ze((s,i)=>{var a=z;a.unhandleds=[],a.onunhandled=i,a.finalize=ht(function(){(function(o){function u(){o(),Cr.splice(Cr.indexOf(u),1)}Cr.push(u),++lt,qt(()=>{--lt==0&&vs()},[])})(()=>{this.unhandleds.length===0?s():i(this.unhandleds[0])})},a.finalize),t()},e,r,n))}),Lr&&(Lr.allSettled&&Ke(N,"allSettled",function(){const t=Ue.apply(null,arguments).map(gr);return new N(e=>{t.length===0&&e([]);let r=t.length;const n=new Array(r);t.forEach((s,i)=>N.resolve(s).then(a=>n[i]={status:"fulfilled",value:a},a=>n[i]={status:"rejected",reason:a}).then(()=>--r||e(n)))})}),Lr.any&&typeof AggregateError<"u"&&Ke(N,"any",function(){const t=Ue.apply(null,arguments).map(gr);return new N((e,r)=>{t.length===0&&r(new AggregateError([]));let n=t.length;const s=new Array(n);t.forEach((i,a)=>N.resolve(i).then(o=>e(o),o=>{s[a]=o,--n||r(new AggregateError(s))}))})}));const pe={awaits:0,echoes:0,id:0};var vu=0,Br=[],hn=0,Hr=0,bu=0;function Ze(t,e,r,n){var s=z,i=Object.create(s);i.parent=s,i.ref=0,i.global=!1,i.id=++bu;var a=St.env;i.env=ys?{Promise:N,PromiseProp:{value:N,configurable:!0,writable:!0},all:N.all,race:N.race,allSettled:N.allSettled,any:N.any,resolve:N.resolve,reject:N.reject,nthen:Zs(a.nthen,i),gthen:Zs(a.gthen,i)}:{},e&&be(i,e),++s.ref,i.finalize=function(){--this.parent.ref||this.parent.finalize()};var o=Dt(i,t,r,n);return i.ref===0&&i.finalize(),o}function Pt(){return pe.id||(pe.id=++vu),++pe.awaits,pe.echoes+=ua,pe.id}function qe(){return!!pe.awaits&&(--pe.awaits==0&&(pe.id=0),pe.echoes=pe.awaits*ua,!0)}function gr(t){return pe.echoes&&t&&t.constructor===Lr?(Pt(),t.then(e=>(qe(),e),e=>(qe(),he(e)))):t}function wu(t){++Hr,pe.echoes&&--pe.echoes!=0||(pe.echoes=pe.id=0),Br.push(z),Je(t,!0)}function xu(){var t=Br[Br.length-1];Br.pop(),Je(t,!1)}function Je(t,e){var r=z;if((e?!pe.echoes||hn++&&t===z:!hn||--hn&&t===z)||ya(e?wu.bind(null,t):xu),t!==z&&(z=t,r===St&&(St.env=ma()),ys)){var n=St.env.Promise,s=t.env;qr.then=s.nthen,n.prototype.then=s.gthen,(r.global||t.global)&&(Object.defineProperty(ee,"Promise",s.PromiseProp),n.all=s.all,n.race=s.race,n.resolve=s.resolve,n.reject=s.reject,s.allSettled&&(n.allSettled=s.allSettled),s.any&&(n.any=s.any))}}function ma(){var t=ee.Promise;return ys?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(ee,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:qr.then,gthen:t.prototype.then}:{}}function Dt(t,e,r,n,s){var i=z;try{return Je(t,!0),e(r,n,s)}finally{Je(i,!1)}}function ya(t){la.call(Ln,t)}function Wr(t,e,r,n){return typeof t!="function"?t:function(){var s=z;r&&Pt(),Je(e,!0);try{return t.apply(this,arguments)}finally{Je(s,!1),n&&ya(qe)}}}function Zs(t,e){return function(r,n){return t.call(this,Wr(r,e),Wr(n,e))}}(""+la).indexOf("[native code]")===-1&&(Pt=qe=Q);const Js="unhandledrejection";function ei(t,e){var r;try{r=e.onuncatched(t)}catch{}if(r!==!1)try{var n,s={promise:e,reason:t};if(ee.document&&document.createEvent?((n=document.createEvent("Event")).initEvent(Js,!0,!0),be(n,s)):ee.CustomEvent&&be(n=new CustomEvent(Js,{detail:s}),s),n&&ee.dispatchEvent&&(dispatchEvent(n),!ee.PromiseRejectionEvent&&ee.onunhandledrejection))try{ee.onunhandledrejection(n)}catch{}Pe&&n&&!n.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch{}}var he=N.reject;function Un(t,e,r,n){if(t.idbdb&&(t._state.openComplete||z.letThrough||t._vip)){var s=t._createTransaction(e,r,t._dbSchema);try{s.create(),t._state.PR1398_maxLoop=3}catch(i){return i.name===ps.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>Un(t,e,r,n))):he(i)}return s._promise(e,(i,a)=>Ze(()=>(z.trans=s,n(i,a,s)))).then(i=>s._completion.then(()=>i))}if(t._state.openComplete)return he(new q.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return he(new q.DatabaseClosed);t.open().catch(Q)}return t._state.dbReadyPromise.then(()=>Un(t,e,r,n))}const ti="3.2.7",st="￿",zn=-1/0,De="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",ga="String expected.",Vt=[],tn=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),_u=tn,Eu=tn,va=t=>!/(dexie\.js|dexie\.min\.js)/.test(t),rn="__dbnames",fn="readonly",dn="readwrite";function ft(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}const ba={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function vr(t){return typeof t!="string"||/\./.test(t)?e=>e:e=>(e[t]===void 0&&t in e&&delete(e=ar(e))[t],e)}class Tu{_trans(e,r,n){const s=this._tx||z.trans,i=this.name;function a(u,l,c){if(!c.schema[i])throw new q.NotFound("Table "+i+" not part of transaction");return r(c.idbtrans,c)}const o=or();try{return s&&s.db===this.db?s===z.trans?s._promise(e,a,n):Ze(()=>s._promise(e,a,n),{trans:s,transless:z.transless||z}):Un(this.db,e,[this.name],a)}finally{o&&ur()}}get(e,r){return e&&e.constructor===Object?this.where(e).first(r):this._trans("readonly",n=>this.core.get({trans:n,key:e}).then(s=>this.hook.reading.fire(s))).then(r)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(ye(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const r=ce(e);if(r.length===1)return this.where(r[0]).equals(e[r[0]]);const n=this.schema.indexes.concat(this.schema.primKey).filter(l=>{if(l.compound&&r.every(c=>l.keyPath.indexOf(c)>=0)){for(let c=0;c<r.length;++c)if(r.indexOf(l.keyPath[c])===-1)return!1;return!0}return!1}).sort((l,c)=>l.keyPath.length-c.keyPath.length)[0];if(n&&this.db._maxKey!==st){const l=n.keyPath.slice(0,r.length);return this.where(l).equals(l.map(c=>e[c]))}!n&&Pe&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${r.join("+")}]`);const{idxByName:s}=this.schema,i=this.db._deps.indexedDB;function a(l,c){try{return i.cmp(l,c)===0}catch{return!1}}const[o,u]=r.reduce(([l,c],h)=>{const f=s[h],d=e[h];return[l||f,l||!f?ft(c,f&&f.multi?x=>{const g=Fe(x,h);return ye(g)&&g.some(_=>a(d,_))}:x=>a(d,Fe(x,h))):c]},[null,null]);return o?this.where(o.name).equals(e[o.keyPath]).filter(u):n?this.filter(u):this.where(r).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,ye(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const r=n=>{if(!n)return n;const s=Object.create(e.prototype);for(var i in n)if(_e(n,i))try{s[i]=n[i]}catch{}return s};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=r,this.hook("reading",r),e}defineClass(){return this.mapToClass(function(e){be(this,e)})}add(e,r){const{auto:n,keyPath:s}=this.schema.primKey;let i=e;return s&&n&&(i=vr(s)(e)),this._trans("readwrite",a=>this.core.mutate({trans:a,type:"add",keys:r!=null?[r]:null,values:[i]})).then(a=>a.numFailures?N.reject(a.failures[0]):a.lastResult).then(a=>{if(s)try{Ae(e,s,a)}catch{}return a})}update(e,r){if(typeof e!="object"||ye(e))return this.where(":id").equals(e).modify(r);{const n=Fe(e,this.schema.primKey.keyPath);if(n===void 0)return he(new q.InvalidArgument("Given object does not contain its primary key"));try{typeof r!="function"?ce(r).forEach(s=>{Ae(e,s,r[s])}):r(e,{value:e,primKey:n})}catch{}return this.where(":id").equals(n).modify(r)}}put(e,r){const{auto:n,keyPath:s}=this.schema.primKey;let i=e;return s&&n&&(i=vr(s)(e)),this._trans("readwrite",a=>this.core.mutate({trans:a,type:"put",values:[i],keys:r!=null?[r]:null})).then(a=>a.numFailures?N.reject(a.failures[0]):a.lastResult).then(a=>{if(s)try{Ae(e,s,a)}catch{}return a})}delete(e){return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:[e]})).then(r=>r.numFailures?N.reject(r.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:ba})).then(e=>e.numFailures?N.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",r=>this.core.getMany({keys:e,trans:r}).then(n=>n.map(s=>this.hook.reading.fire(s))))}bulkAdd(e,r,n){const s=Array.isArray(r)?r:void 0,i=(n=n||(s?void 0:r))?n.allKeys:void 0;return this._trans("readwrite",a=>{const{auto:o,keyPath:u}=this.schema.primKey;if(u&&s)throw new q.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new q.InvalidArgument("Arguments objects and keys must have the same length");const l=e.length;let c=u&&o?e.map(vr(u)):e;return this.core.mutate({trans:a,type:"add",keys:s,values:c,wantResults:i}).then(({numFailures:h,results:f,lastResult:d,failures:x})=>{if(h===0)return i?f:d;throw new $t(`${this.name}.bulkAdd(): ${h} of ${l} operations failed`,x)})})}bulkPut(e,r,n){const s=Array.isArray(r)?r:void 0,i=(n=n||(s?void 0:r))?n.allKeys:void 0;return this._trans("readwrite",a=>{const{auto:o,keyPath:u}=this.schema.primKey;if(u&&s)throw new q.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new q.InvalidArgument("Arguments objects and keys must have the same length");const l=e.length;let c=u&&o?e.map(vr(u)):e;return this.core.mutate({trans:a,type:"put",keys:s,values:c,wantResults:i}).then(({numFailures:h,results:f,lastResult:d,failures:x})=>{if(h===0)return i?f:d;throw new $t(`${this.name}.bulkPut(): ${h} of ${l} operations failed`,x)})})}bulkDelete(e){const r=e.length;return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:e})).then(({numFailures:n,lastResult:s,failures:i})=>{if(n===0)return s;throw new $t(`${this.name}.bulkDelete(): ${n} of ${r} operations failed`,i)})}}function Ht(t){var e={},r=function(a,o){if(o){for(var u=arguments.length,l=new Array(u-1);--u;)l[u-1]=arguments[u];return e[a].subscribe.apply(null,l),t}if(typeof a=="string")return e[a]};r.addEventType=i;for(var n=1,s=arguments.length;n<s;++n)i(arguments[n]);return r;function i(a,o,u){if(typeof a!="object"){var l;o||(o=mu),u||(u=Q);var c={subscribers:[],fire:u,subscribe:function(h){c.subscribers.indexOf(h)===-1&&(c.subscribers.push(h),c.fire=o(c.fire,h))},unsubscribe:function(h){c.subscribers=c.subscribers.filter(function(f){return f!==h}),c.fire=c.subscribers.reduce(o,u)}};return e[a]=r[a]=c,c}ce(l=a).forEach(function(h){var f=l[h];if(ye(f))i(h,l[h][0],l[h][1]);else{if(f!=="asap")throw new q.InvalidArgument("Invalid event config");var d=i(h,Zt,function(){for(var x=arguments.length,g=new Array(x);x--;)g[x]=arguments[x];d.subscribers.forEach(function(_){Ji(function(){_.apply(null,g)})})})}})}}function Ut(t,e){return Et(e).from({prototype:t}),e}function mt(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function pn(t,e){t.filter=ft(t.filter,e)}function mn(t,e,r){var n=t.replayFilter;t.replayFilter=n?()=>ft(n(),e()):e,t.justLimit=r&&!n}function Ir(t,e){if(t.isPrimKey)return e.primaryKey;const r=e.getIndexByKeyPath(t.index);if(!r)throw new q.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return r}function ri(t,e,r){const n=Ir(t,e.schema);return e.openCursor({trans:r,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:n,range:t.range}})}function br(t,e,r,n){const s=t.replayFilter?ft(t.filter,t.replayFilter()):t.filter;if(t.or){const i={},a=(o,u,l)=>{if(!s||s(u,l,f=>u.stop(f),f=>u.fail(f))){var c=u.primaryKey,h=""+c;h==="[object ArrayBuffer]"&&(h=""+new Uint8Array(c)),_e(i,h)||(i[h]=!0,e(o,u,l))}};return Promise.all([t.or._iterate(a,r),ni(ri(t,n,r),t.algorithm,a,!t.keysOnly&&t.valueMapper)])}return ni(ri(t,n,r),ft(t.algorithm,s),e,!t.keysOnly&&t.valueMapper)}function ni(t,e,r,n){var s=re(n?(i,a,o)=>r(n(i),a,o):r);return t.then(i=>{if(i)return i.start(()=>{var a=()=>i.continue();e&&!e(i,o=>a=o,o=>{i.stop(o),a=Q},o=>{i.fail(o),a=Q})||s(i.value,i,o=>a=o),a()})})}function ve(t,e){try{const r=si(t),n=si(e);if(r!==n)return r==="Array"?1:n==="Array"?-1:r==="binary"?1:n==="binary"?-1:r==="string"?1:n==="string"?-1:r==="Date"?1:n!=="Date"?NaN:-1;switch(r){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return function(s,i){const a=s.length,o=i.length,u=a<o?a:o;for(let l=0;l<u;++l)if(s[l]!==i[l])return s[l]<i[l]?-1:1;return a===o?0:a<o?-1:1}(ii(t),ii(e));case"Array":return function(s,i){const a=s.length,o=i.length,u=a<o?a:o;for(let l=0;l<u;++l){const c=ve(s[l],i[l]);if(c!==0)return c}return a===o?0:a<o?-1:1}(t,e)}}catch{}return NaN}function si(t){const e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";const r=kn(t);return r==="ArrayBuffer"?"binary":r}function ii(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}class Su{_read(e,r){var n=this._ctx;return n.error?n.table._trans(null,he.bind(null,n.error)):n.table._trans("readonly",e).then(r)}_write(e){var r=this._ctx;return r.error?r.table._trans(null,he.bind(null,r.error)):r.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var r=this._ctx;r.algorithm=ft(r.algorithm,e)}_iterate(e,r){return br(this._ctx,e,r,this._ctx.table.core)}clone(e){var r=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&be(n,e),r._ctx=n,r}raw(){return this._ctx.valueMapper=null,this}each(e){var r=this._ctx;return this._read(n=>br(r,e,n,r.table.core))}count(e){return this._read(r=>{const n=this._ctx,s=n.table.core;if(mt(n,!0))return s.count({trans:r,query:{index:Ir(n,s.schema),range:n.range}}).then(a=>Math.min(a,n.limit));var i=0;return br(n,()=>(++i,!1),r,s).then(()=>i)}).then(e)}sortBy(e,r){const n=e.split(".").reverse(),s=n[0],i=n.length-1;function a(l,c){return c?a(l[n[c]],c-1):l[s]}var o=this._ctx.dir==="next"?1:-1;function u(l,c){var h=a(l,i),f=a(c,i);return h<f?-o:h>f?o:0}return this.toArray(function(l){return l.sort(u)}).then(r)}toArray(e){return this._read(r=>{var n=this._ctx;if(n.dir==="next"&&mt(n,!0)&&n.limit>0){const{valueMapper:s}=n,i=Ir(n,n.table.core.schema);return n.table.core.query({trans:r,limit:n.limit,values:!0,query:{index:i,range:n.range}}).then(({result:a})=>s?a.map(s):a)}{const s=[];return br(n,i=>s.push(i),r,n.table.core).then(()=>s)}},e)}offset(e){var r=this._ctx;return e<=0||(r.offset+=e,mt(r)?mn(r,()=>{var n=e;return(s,i)=>n===0||(n===1?(--n,!1):(i(()=>{s.advance(n),n=0}),!1))}):mn(r,()=>{var n=e;return()=>--n<0})),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),mn(this._ctx,()=>{var r=e;return function(n,s,i){return--r<=0&&s(i),r>=0}},!0),this}until(e,r){return pn(this._ctx,function(n,s,i){return!e(n.value)||(s(i),r)}),this}first(e){return this.limit(1).toArray(function(r){return r[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){var r,n;return pn(this._ctx,function(s){return e(s.value)}),r=this._ctx,n=e,r.isMatch=ft(r.isMatch,n),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,s){e(s.key,s)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,s){e(s.primaryKey,s)})}keys(e){var r=this._ctx;r.keysOnly=!r.isMatch;var n=[];return this.each(function(s,i){n.push(i.key)}).then(function(){return n}).then(e)}primaryKeys(e){var r=this._ctx;if(r.dir==="next"&&mt(r,!0)&&r.limit>0)return this._read(s=>{var i=Ir(r,r.table.core.schema);return r.table.core.query({trans:s,values:!1,limit:r.limit,query:{index:i,range:r.range}})}).then(({result:s})=>s).then(e);r.keysOnly=!r.isMatch;var n=[];return this.each(function(s,i){n.push(i.primaryKey)}).then(function(){return n}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(r){return r[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,r=e.index&&e.table.schema.idxByName[e.index];if(!r||!r.multi)return this;var n={};return pn(this._ctx,function(s){var i=s.primaryKey.toString(),a=_e(n,i);return n[i]=!0,!a}),this}modify(e){var r=this._ctx;return this._write(n=>{var s;if(typeof e=="function")s=e;else{var i=ce(e),a=i.length;s=function(g){for(var _=!1,b=0;b<a;++b){var v=i[b],L=e[v];Fe(g,v)!==L&&(Ae(g,v,L),_=!0)}return _}}const o=r.table.core,{outbound:u,extractKey:l}=o.schema.primaryKey,c=this.db._options.modifyChunkSize||200,h=[];let f=0;const d=[],x=(g,_)=>{const{failures:b,numFailures:v}=_;f+=g-v;for(let L of ce(b))h.push(b[L])};return this.clone().primaryKeys().then(g=>{const _=b=>{const v=Math.min(c,g.length-b);return o.getMany({trans:n,keys:g.slice(b,b+v),cache:"immutable"}).then(L=>{const T=[],I=[],R=u?[]:null,A=[];for(let B=0;B<v;++B){const $=L[B],V={value:ar($),primKey:g[b+B]};s.call(V,V.value,V)!==!1&&(V.value==null?A.push(g[b+B]):u||ve(l($),l(V.value))===0?(I.push(V.value),u&&R.push(g[b+B])):(A.push(g[b+B]),T.push(V.value)))}const C=mt(r)&&r.limit===1/0&&(typeof e!="function"||e===yn)&&{index:r.index,range:r.range};return Promise.resolve(T.length>0&&o.mutate({trans:n,type:"add",values:T}).then(B=>{for(let $ in B.failures)A.splice(parseInt($),1);x(T.length,B)})).then(()=>(I.length>0||C&&typeof e=="object")&&o.mutate({trans:n,type:"put",keys:R,values:I,criteria:C,changeSpec:typeof e!="function"&&e}).then(B=>x(I.length,B))).then(()=>(A.length>0||C&&e===yn)&&o.mutate({trans:n,type:"delete",keys:A,criteria:C}).then(B=>x(A.length,B))).then(()=>g.length>b+v&&_(b+c))})};return _(0).then(()=>{if(h.length>0)throw new $r("Error modifying one or more objects",h,f,d);return g.length})})})}delete(){var e=this._ctx,r=e.range;return mt(e)&&(e.isPrimKey&&!Eu||r.type===3)?this._write(n=>{const{primaryKey:s}=e.table.core.schema,i=r;return e.table.core.count({trans:n,query:{index:s,range:i}}).then(a=>e.table.core.mutate({trans:n,type:"deleteRange",range:i}).then(({failures:o,lastResult:u,results:l,numFailures:c})=>{if(c)throw new $r("Could not delete some values",Object.keys(o).map(h=>o[h]),a-c);return a-c}))}):this.modify(yn)}}const yn=(t,e)=>e.value=null;function Ru(t,e){return t<e?-1:t===e?0:1}function ku(t,e){return t>e?-1:t===e?0:1}function xe(t,e,r){var n=t instanceof xa?new t.Collection(t):t;return n._ctx.error=r?new r(e):new TypeError(e),n}function yt(t){return new t.Collection(t,()=>wa("")).limit(0)}function Ou(t,e,r,n,s,i){for(var a=Math.min(t.length,n.length),o=-1,u=0;u<a;++u){var l=e[u];if(l!==n[u])return s(t[u],r[u])<0?t.substr(0,u)+r[u]+r.substr(u+1):s(t[u],n[u])<0?t.substr(0,u)+n[u]+r.substr(u+1):o>=0?t.substr(0,o)+e[o]+r.substr(o+1):null;s(t[u],l)<0&&(o=u)}return a<n.length&&i==="next"?t+r.substr(t.length):a<t.length&&i==="prev"?t.substr(0,r.length):o<0?null:t.substr(0,o)+n[o]+r.substr(o+1)}function wr(t,e,r,n){var s,i,a,o,u,l,c,h=r.length;if(!r.every(g=>typeof g=="string"))return xe(t,ga);function f(g){s=function(b){return b==="next"?v=>v.toUpperCase():v=>v.toLowerCase()}(g),i=function(b){return b==="next"?v=>v.toLowerCase():v=>v.toUpperCase()}(g),a=g==="next"?Ru:ku;var _=r.map(function(b){return{lower:i(b),upper:s(b)}}).sort(function(b,v){return a(b.lower,v.lower)});o=_.map(function(b){return b.upper}),u=_.map(function(b){return b.lower}),l=g,c=g==="next"?"":n}f("next");var d=new t.Collection(t,()=>He(o[0],u[h-1]+n));d._ondirectionchange=function(g){f(g)};var x=0;return d._addAlgorithm(function(g,_,b){var v=g.key;if(typeof v!="string")return!1;var L=i(v);if(e(L,u,x))return!0;for(var T=null,I=x;I<h;++I){var R=Ou(v,L,o[I],u[I],a,l);R===null&&T===null?x=I+1:(T===null||a(T,R)>0)&&(T=R)}return _(T!==null?function(){g.continue(T+c)}:b),!1}),d}function He(t,e,r,n){return{type:2,lower:t,upper:e,lowerOpen:r,upperOpen:n}}function wa(t){return{type:1,lower:t,upper:t}}class xa{get Collection(){return this._ctx.table.db.Collection}between(e,r,n,s){n=n!==!1,s=s===!0;try{return this._cmp(e,r)>0||this._cmp(e,r)===0&&(n||s)&&(!n||!s)?yt(this):new this.Collection(this,()=>He(e,r,!n,!s))}catch{return xe(this,De)}}equals(e){return e==null?xe(this,De):new this.Collection(this,()=>wa(e))}above(e){return e==null?xe(this,De):new this.Collection(this,()=>He(e,void 0,!0))}aboveOrEqual(e){return e==null?xe(this,De):new this.Collection(this,()=>He(e,void 0,!1))}below(e){return e==null?xe(this,De):new this.Collection(this,()=>He(void 0,e,!1,!0))}belowOrEqual(e){return e==null?xe(this,De):new this.Collection(this,()=>He(void 0,e))}startsWith(e){return typeof e!="string"?xe(this,ga):this.between(e,e+st,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):wr(this,(r,n)=>r.indexOf(n[0])===0,[e],st)}equalsIgnoreCase(e){return wr(this,(r,n)=>r===n[0],[e],"")}anyOfIgnoreCase(){var e=Ue.apply(wt,arguments);return e.length===0?yt(this):wr(this,(r,n)=>n.indexOf(r)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=Ue.apply(wt,arguments);return e.length===0?yt(this):wr(this,(r,n)=>n.some(s=>r.indexOf(s)===0),e,st)}anyOf(){const e=Ue.apply(wt,arguments);let r=this._cmp;try{e.sort(r)}catch{return xe(this,De)}if(e.length===0)return yt(this);const n=new this.Collection(this,()=>He(e[0],e[e.length-1]));n._ondirectionchange=i=>{r=i==="next"?this._ascending:this._descending,e.sort(r)};let s=0;return n._addAlgorithm((i,a,o)=>{const u=i.key;for(;r(u,e[s])>0;)if(++s,s===e.length)return a(o),!1;return r(u,e[s])===0||(a(()=>{i.continue(e[s])}),!1)}),n}notEqual(e){return this.inAnyRange([[zn,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=Ue.apply(wt,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return xe(this,De)}const r=e.reduce((n,s)=>n?n.concat([[n[n.length-1][1],s]]):[[zn,s]],null);return r.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(r,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,r){const n=this._cmp,s=this._ascending,i=this._descending,a=this._min,o=this._max;if(e.length===0)return yt(this);if(!e.every(v=>v[0]!==void 0&&v[1]!==void 0&&s(v[0],v[1])<=0))return xe(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",q.InvalidArgument);const u=!r||r.includeLowers!==!1,l=r&&r.includeUppers===!0;let c,h=s;function f(v,L){return h(v[0],L[0])}try{c=e.reduce(function(v,L){let T=0,I=v.length;for(;T<I;++T){const R=v[T];if(n(L[0],R[1])<0&&n(L[1],R[0])>0){R[0]=a(R[0],L[0]),R[1]=o(R[1],L[1]);break}}return T===I&&v.push(L),v},[]),c.sort(f)}catch{return xe(this,De)}let d=0;const x=l?v=>s(v,c[d][1])>0:v=>s(v,c[d][1])>=0,g=u?v=>i(v,c[d][0])>0:v=>i(v,c[d][0])>=0;let _=x;const b=new this.Collection(this,()=>He(c[0][0],c[c.length-1][1],!u,!l));return b._ondirectionchange=v=>{v==="next"?(_=x,h=s):(_=g,h=i),c.sort(f)},b._addAlgorithm((v,L,T)=>{for(var I=v.key;_(I);)if(++d,d===c.length)return L(T),!1;return!!function(R){return!x(R)&&!g(R)}(I)||(this._cmp(I,c[d][1])===0||this._cmp(I,c[d][0])===0||L(()=>{h===s?v.continue(c[d][0]):v.continue(c[d][1])}),!1)}),b}startsWithAnyOf(){const e=Ue.apply(wt,arguments);return e.every(r=>typeof r=="string")?e.length===0?yt(this):this.inAnyRange(e.map(r=>[r,r+st])):xe(this,"startsWithAnyOf() only works with strings")}}function Ce(t){return re(function(e){return er(e),t(e.target.error),!1})}function er(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}const tr="storagemutated",Xe="x-storagemutated-1",et=Ht(null,tr);class Au{_lock(){return Kt(!z.global),++this._reculock,this._reculock!==1||z.global||(z.lockOwnerFor=this),this}_unlock(){if(Kt(!z.global),--this._reculock==0)for(z.global||(z.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{Dt(e[1],e[0])}catch{}}return this}_locked(){return this._reculock&&z.lockOwnerFor!==this}create(e){if(!this.mode)return this;const r=this.db.idbdb,n=this.db._state.dbOpenError;if(Kt(!this.idbtrans),!e&&!r)switch(n&&n.name){case"DatabaseClosedError":throw new q.DatabaseClosed(n);case"MissingAPIError":throw new q.MissingAPI(n.message,n);default:throw new q.OpenFailed(n)}if(!this.active)throw new q.TransactionInactive;return Kt(this._completion._state===null),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=re(s=>{er(s),this._reject(e.error)}),e.onabort=re(s=>{er(s),this.active&&this._reject(new q.Abort(e.error)),this.active=!1,this.on("abort").fire(s)}),e.oncomplete=re(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&et.storagemutated.fire(e.mutatedParts)}),this}_promise(e,r,n){if(e==="readwrite"&&this.mode!=="readwrite")return he(new q.ReadOnly("Transaction is readonly"));if(!this.active)return he(new q.TransactionInactive);if(this._locked())return new N((i,a)=>{this._blockedFuncs.push([()=>{this._promise(e,r,n).then(i,a)},z])});if(n)return Ze(()=>{var i=new N((a,o)=>{this._lock();const u=r(a,o,this);u&&u.then&&u.then(a,o)});return i.finally(()=>this._unlock()),i._lib=!0,i});var s=new N((i,a)=>{var o=r(i,a,this);o&&o.then&&o.then(i,a)});return s._lib=!0,s}_root(){return this.parent?this.parent._root():this}waitFor(e){var r=this._root();const n=N.resolve(e);if(r._waitingFor)r._waitingFor=r._waitingFor.then(()=>n);else{r._waitingFor=n,r._waitingQueue=[];var s=r.idbtrans.objectStore(r.storeNames[0]);(function a(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(s.get(-1/0).onsuccess=a)})()}var i=r._waitingFor;return new N((a,o)=>{n.then(u=>r._waitingQueue.push(re(a.bind(null,u))),u=>r._waitingQueue.push(re(o.bind(null,u)))).finally(()=>{r._waitingFor===i&&(r._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new q.Abort))}table(e){const r=this._memoizedTables||(this._memoizedTables={});if(_e(r,e))return r[e];const n=this.schema[e];if(!n)throw new q.NotFound("Table "+e+" not part of transaction");const s=new this.db.Table(e,n,this);return s.core=this.db.core.table(e),r[e]=s,s}}function Kn(t,e,r,n,s,i,a){return{name:t,keyPath:e,unique:r,multi:n,auto:s,compound:i,src:(r&&!a?"&":"")+(n?"*":"")+(s?"++":"")+_a(e)}}function _a(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function Ea(t,e,r){return{name:t,primKey:e,indexes:r,mappedClass:null,idxByName:ea(r,n=>[n.name,n])}}let rr=t=>{try{return t.only([[]]),rr=()=>[[]],[[]]}catch{return rr=()=>st,st}};function Fn(t){return t==null?()=>{}:typeof t=="string"?function(e){return e.split(".").length===1?n=>n[e]:n=>Fe(n,e)}(t):e=>Fe(e,t)}function ai(t){return[].slice.call(t)}let Lu=0;function Wt(t){return t==null?":id":typeof t=="string"?t:`[${t.join("+")}]`}function Mu(t,e,r){function n(u){if(u.type===3)return null;if(u.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:l,upper:c,lowerOpen:h,upperOpen:f}=u;return l===void 0?c===void 0?null:e.upperBound(c,!!f):c===void 0?e.lowerBound(l,!!h):e.bound(l,c,!!h,!!f)}const{schema:s,hasGetAll:i}=function(u,l){const c=ai(u.objectStoreNames);return{schema:{name:u.name,tables:c.map(h=>l.objectStore(h)).map(h=>{const{keyPath:f,autoIncrement:d}=h,x=ye(f),g=f==null,_={},b={name:h.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:g,compound:x,keyPath:f,autoIncrement:d,unique:!0,extractKey:Fn(f)},indexes:ai(h.indexNames).map(v=>h.index(v)).map(v=>{const{name:L,unique:T,multiEntry:I,keyPath:R}=v,A={name:L,compound:ye(R),keyPath:R,unique:T,multiEntry:I,extractKey:Fn(R)};return _[Wt(R)]=A,A}),getIndexByKeyPath:v=>_[Wt(v)]};return _[":id"]=b.primaryKey,f!=null&&(_[Wt(f)]=b.primaryKey),b})},hasGetAll:c.length>0&&"getAll"in l.objectStore(c[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(t,r),a=s.tables.map(u=>function(l){const c=l.name;return{name:c,schema:l,mutate:function({trans:h,type:f,keys:d,values:x,range:g}){return new Promise((_,b)=>{_=re(_);const v=h.objectStore(c),L=v.keyPath==null,T=f==="put"||f==="add";if(!T&&f!=="delete"&&f!=="deleteRange")throw new Error("Invalid operation type: "+f);const{length:I}=d||x||{length:1};if(d&&x&&d.length!==x.length)throw new Error("Given keys array must have same length as given values array.");if(I===0)return _({numFailures:0,failures:{},results:[],lastResult:void 0});let R;const A=[],C=[];let B=0;const $=H=>{++B,er(H)};if(f==="deleteRange"){if(g.type===4)return _({numFailures:B,failures:C,results:[],lastResult:void 0});g.type===3?A.push(R=v.clear()):A.push(R=v.delete(n(g)))}else{const[H,y]=T?L?[x,d]:[x,null]:[d,null];if(T)for(let k=0;k<I;++k)A.push(R=y&&y[k]!==void 0?v[f](H[k],y[k]):v[f](H[k])),R.onerror=$;else for(let k=0;k<I;++k)A.push(R=v[f](H[k])),R.onerror=$}const V=H=>{const y=H.target.result;A.forEach((k,M)=>k.error!=null&&(C[M]=k.error)),_({numFailures:B,failures:C,results:f==="delete"?d:A.map(k=>k.result),lastResult:y})};R.onerror=H=>{$(H),V(H)},R.onsuccess=V})},getMany:({trans:h,keys:f})=>new Promise((d,x)=>{d=re(d);const g=h.objectStore(c),_=f.length,b=new Array(_);let v,L=0,T=0;const I=A=>{const C=A.target;b[C._pos]=C.result,++T===L&&d(b)},R=Ce(x);for(let A=0;A<_;++A)f[A]!=null&&(v=g.get(f[A]),v._pos=A,v.onsuccess=I,v.onerror=R,++L);L===0&&d(b)}),get:({trans:h,key:f})=>new Promise((d,x)=>{d=re(d);const g=h.objectStore(c).get(f);g.onsuccess=_=>d(_.target.result),g.onerror=Ce(x)}),query:function(h){return f=>new Promise((d,x)=>{d=re(d);const{trans:g,values:_,limit:b,query:v}=f,L=b===1/0?void 0:b,{index:T,range:I}=v,R=g.objectStore(c),A=T.isPrimaryKey?R:R.index(T.name),C=n(I);if(b===0)return d({result:[]});if(h){const B=_?A.getAll(C,L):A.getAllKeys(C,L);B.onsuccess=$=>d({result:$.target.result}),B.onerror=Ce(x)}else{let B=0;const $=_||!("openKeyCursor"in A)?A.openCursor(C):A.openKeyCursor(C),V=[];$.onsuccess=H=>{const y=$.result;return y?(V.push(_?y.value:y.primaryKey),++B===b?d({result:V}):void y.continue()):d({result:V})},$.onerror=Ce(x)}})}(i),openCursor:function({trans:h,values:f,query:d,reverse:x,unique:g}){return new Promise((_,b)=>{_=re(_);const{index:v,range:L}=d,T=h.objectStore(c),I=v.isPrimaryKey?T:T.index(v.name),R=x?g?"prevunique":"prev":g?"nextunique":"next",A=f||!("openKeyCursor"in I)?I.openCursor(n(L),R):I.openKeyCursor(n(L),R);A.onerror=Ce(b),A.onsuccess=re(C=>{const B=A.result;if(!B)return void _(null);B.___id=++Lu,B.done=!1;const $=B.continue.bind(B);let V=B.continuePrimaryKey;V&&(V=V.bind(B));const H=B.advance.bind(B),y=()=>{throw new Error("Cursor not stopped")};B.trans=h,B.stop=B.continue=B.continuePrimaryKey=B.advance=()=>{throw new Error("Cursor not started")},B.fail=re(b),B.next=function(){let k=1;return this.start(()=>k--?this.continue():this.stop()).then(()=>this)},B.start=k=>{const M=new Promise((O,D)=>{O=re(O),A.onerror=Ce(D),B.fail=D,B.stop=K=>{B.stop=B.continue=B.continuePrimaryKey=B.advance=y,O(K)}}),E=()=>{if(A.result)try{k()}catch(O){B.fail(O)}else B.done=!0,B.start=()=>{throw new Error("Cursor behind last entry")},B.stop()};return A.onsuccess=re(O=>{A.onsuccess=E,E()}),B.continue=$,B.continuePrimaryKey=V,B.advance=H,E(),M},_(B)},b)})},count({query:h,trans:f}){const{index:d,range:x}=h;return new Promise((g,_)=>{const b=f.objectStore(c),v=d.isPrimaryKey?b:b.index(d.name),L=n(x),T=L?v.count(L):v.count();T.onsuccess=re(I=>g(I.target.result)),T.onerror=Ce(_)})}}}(u)),o={};return a.forEach(u=>o[u.name]=u),{stack:"dbcore",transaction:t.transaction.bind(t),table(u){if(!o[u])throw new Error(`Table '${u}' not found`);return o[u]},MIN_KEY:-1/0,MAX_KEY:rr(e),schema:s}}function jn({_novip:t},e){const r=e.db,n=function(s,i,{IDBKeyRange:a,indexedDB:o},u){return{dbcore:function(c,h){return h.reduce((f,{create:d})=>({...f,...d(f)}),c)}(Mu(i,a,u),s.dbcore)}}(t._middlewares,r,t._deps,e);t.core=n.dbcore,t.tables.forEach(s=>{const i=s.name;t.core.schema.tables.some(a=>a.name===i)&&(s.core=t.core.table(i),t[i]instanceof t.Table&&(t[i].core=s.core))})}function Gr({_novip:t},e,r,n){r.forEach(s=>{const i=n[s];e.forEach(a=>{const o=hs(a,s);(!o||"value"in o&&o.value===void 0)&&(a===t.Transaction.prototype||a instanceof t.Transaction?Ke(a,s,{get(){return this.table(s)},set(u){Qi(this,s,{value:u,writable:!0,configurable:!0,enumerable:!0})}}):a[s]=new t.Table(s,i))})})}function $n({_novip:t},e){e.forEach(r=>{for(let n in r)r[n]instanceof t.Table&&delete r[n]})}function Cu(t,e){return t._cfg.version-e._cfg.version}function Bu(t,e,r,n){const s=t._dbSchema,i=t._createTransaction("readwrite",t._storeNames,s);i.create(r),i._completion.catch(n);const a=i._reject.bind(i),o=z.transless||z;Ze(()=>{z.trans=i,z.transless=o,e===0?(ce(s).forEach(u=>{gn(r,u,s[u].primKey,s[u].indexes)}),jn(t,r),N.follow(()=>t.on.populate.fire(i)).catch(a)):function({_novip:u},l,c,h){const f=[],d=u._versions;let x=u._dbSchema=Vn(u,u.idbdb,h),g=!1;const _=d.filter(v=>v._cfg.version>=l);function b(){return f.length?N.resolve(f.shift()(c.idbtrans)).then(b):N.resolve()}return _.forEach(v=>{f.push(()=>{const L=x,T=v._cfg.dbschema;Hn(u,L,h),Hn(u,T,h),x=u._dbSchema=T;const I=Ta(L,T);I.add.forEach(A=>{gn(h,A[0],A[1].primKey,A[1].indexes)}),I.change.forEach(A=>{if(A.recreate)throw new q.Upgrade("Not yet support for changing primary key");{const C=h.objectStore(A.name);A.add.forEach(B=>qn(C,B)),A.change.forEach(B=>{C.deleteIndex(B.name),qn(C,B)}),A.del.forEach(B=>C.deleteIndex(B))}});const R=v._cfg.contentUpgrade;if(R&&v._cfg.version>l){jn(u,h),c._memoizedTables={},g=!0;let A=ta(T);I.del.forEach(V=>{A[V]=L[V]}),$n(u,[u.Transaction.prototype]),Gr(u,[u.Transaction.prototype],ce(A),A),c.schema=A;const C=fs(R);let B;C&&Pt();const $=N.follow(()=>{if(B=R(c),B&&C){var V=qe.bind(null,null);B.then(V,V)}});return B&&typeof B.then=="function"?N.resolve(B):$.then(()=>B)}}),f.push(L=>{(!g||!_u)&&function(T,I){[].slice.call(I.db.objectStoreNames).forEach(R=>T[R]==null&&I.db.deleteObjectStore(R))}(v._cfg.dbschema,L),$n(u,[u.Transaction.prototype]),Gr(u,[u.Transaction.prototype],u._storeNames,u._dbSchema),c.schema=u._dbSchema})}),b().then(()=>{var v,L;L=h,ce(v=x).forEach(T=>{L.db.objectStoreNames.contains(T)||gn(L,T,v[T].primKey,v[T].indexes)})})}(t,e,i,r).catch(a)})}function Ta(t,e){const r={del:[],add:[],change:[]};let n;for(n in t)e[n]||r.del.push(n);for(n in e){const s=t[n],i=e[n];if(s){const a={name:n,def:i,recreate:!1,del:[],add:[],change:[]};if(""+(s.primKey.keyPath||"")!=""+(i.primKey.keyPath||"")||s.primKey.auto!==i.primKey.auto&&!tn)a.recreate=!0,r.change.push(a);else{const o=s.idxByName,u=i.idxByName;let l;for(l in o)u[l]||a.del.push(l);for(l in u){const c=o[l],h=u[l];c?c.src!==h.src&&a.change.push(h):a.add.push(h)}(a.del.length>0||a.add.length>0||a.change.length>0)&&r.change.push(a)}}else r.add.push([n,i])}return r}function gn(t,e,r,n){const s=t.db.createObjectStore(e,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return n.forEach(i=>qn(s,i)),s}function qn(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function Vn(t,e,r){const n={};return jr(e.objectStoreNames,0).forEach(s=>{const i=r.objectStore(s);let a=i.keyPath;const o=Kn(_a(a),a||"",!1,!1,!!i.autoIncrement,a&&typeof a!="string",!0),u=[];for(let c=0;c<i.indexNames.length;++c){const h=i.index(i.indexNames[c]);a=h.keyPath;var l=Kn(h.name,a,!!h.unique,!!h.multiEntry,!1,a&&typeof a!="string",!1);u.push(l)}n[s]=Ea(s,o,u)}),n}function Hn({_novip:t},e,r){const n=r.db.objectStoreNames;for(let s=0;s<n.length;++s){const i=n[s],a=r.objectStore(i);t._hasGetAll="getAll"in a;for(let o=0;o<a.indexNames.length;++o){const u=a.indexNames[o],l=a.index(u).keyPath,c=typeof l=="string"?l:"["+jr(l).join("+")+"]";if(e[i]){const h=e[i].idxByName[c];h&&(h.name=u,delete e[i].idxByName[c],e[i].idxByName[u]=h)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&ee.WorkerGlobalScope&&ee instanceof ee.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}class Iu{_parseStoresSpec(e,r){ce(e).forEach(n=>{if(e[n]!==null){var s=e[n].split(",").map((a,o)=>{const u=(a=a.trim()).replace(/([&*]|\+\+)/g,""),l=/^\[/.test(u)?u.match(/^\[(.*)\]$/)[1].split("+"):u;return Kn(u,l||null,/\&/.test(a),/\*/.test(a),/\+\+/.test(a),ye(l),o===0)}),i=s.shift();if(i.multi)throw new q.Schema("Primary key cannot be multi-valued");s.forEach(a=>{if(a.auto)throw new q.Schema("Only primary key can be marked as autoIncrement (++)");if(!a.keyPath)throw new q.Schema("Index must have a name and cannot be an empty string")}),r[n]=Ea(n,i,s)}})}stores(e){const r=this.db;this._cfg.storesSource=this._cfg.storesSource?be(this._cfg.storesSource,e):e;const n=r._versions,s={};let i={};return n.forEach(a=>{be(s,a._cfg.storesSource),i=a._cfg.dbschema={},a._parseStoresSpec(s,i)}),r._dbSchema=i,$n(r,[r._allTables,r,r.Transaction.prototype]),Gr(r,[r._allTables,r,r.Transaction.prototype,this._cfg.tables],ce(i),i),r._storeNames=ce(i),this}upgrade(e){return this._cfg.contentUpgrade=ms(this._cfg.contentUpgrade||Q,e),this}}function bs(t,e){let r=t._dbNamesDB;return r||(r=t._dbNamesDB=new ct(rn,{addons:[],indexedDB:t,IDBKeyRange:e}),r.version(1).stores({dbnames:"name"})),r.table("dbnames")}function ws(t){return t&&typeof t.databases=="function"}function Wn(t){return Ze(function(){return z.letThrough=!0,t()})}function Pu(){var t;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){var r=function(){return indexedDB.databases().finally(e)};t=setInterval(r,100),r()}).finally(function(){return clearInterval(t)}):Promise.resolve()}function Du(t){const e=t._state,{indexedDB:r}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?he(e.dbOpenError):t);Pe&&(e.openCanceller._stackHolder=dt()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;const n=e.openCanceller;function s(){if(e.openCanceller!==n)throw new q.DatabaseClosed("db.open() was cancelled")}let i=e.dbReadyResolve,a=null,o=!1;const u=()=>new N((l,c)=>{if(s(),!r)throw new q.MissingAPI;const h=t.name,f=e.autoSchema?r.open(h):r.open(h,Math.round(10*t.verno));if(!f)throw new q.MissingAPI;f.onerror=Ce(c),f.onblocked=re(t._fireOnBlocked),f.onupgradeneeded=re(d=>{if(a=f.transaction,e.autoSchema&&!t._options.allowEmptyDB){f.onerror=er,a.abort(),f.result.close();const g=r.deleteDatabase(h);g.onsuccess=g.onerror=re(()=>{c(new q.NoSuchDatabase(`Database ${h} doesnt exist`))})}else{a.onerror=Ce(c);var x=d.oldVersion>Math.pow(2,62)?0:d.oldVersion;o=x<1,t._novip.idbdb=f.result,Bu(t,x/10,a,c)}},c),f.onsuccess=re(()=>{a=null;const d=t._novip.idbdb=f.result,x=jr(d.objectStoreNames);if(x.length>0)try{const _=d.transaction((g=x).length===1?g[0]:g,"readonly");e.autoSchema?function({_novip:b},v,L){b.verno=v.version/10;const T=b._dbSchema=Vn(0,v,L);b._storeNames=jr(v.objectStoreNames,0),Gr(b,[b._allTables],ce(T),T)}(t,d,_):(Hn(t,t._dbSchema,_),function(b,v){const L=Ta(Vn(0,b.idbdb,v),b._dbSchema);return!(L.add.length||L.change.some(T=>T.add.length||T.change.length))}(t,_)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),jn(t,_)}catch{}var g;Vt.push(t),d.onversionchange=re(_=>{e.vcFired=!0,t.on("versionchange").fire(_)}),d.onclose=re(_=>{t.on("close").fire(_)}),o&&function({indexedDB:_,IDBKeyRange:b},v){!ws(_)&&v!==rn&&bs(_,b).put({name:v}).catch(Q)}(t._deps,h),l()},c)}).catch(l=>l&&l.name==="UnknownError"&&e.PR1398_maxLoop>0?(e.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),u()):N.reject(l));return N.race([n,(typeof navigator>"u"?N.resolve():Pu()).then(u)]).then(()=>(s(),e.onReadyBeingFired=[],N.resolve(Wn(()=>t.on.ready.fire(t.vip))).then(function l(){if(e.onReadyBeingFired.length>0){let c=e.onReadyBeingFired.reduce(ms,Q);return e.onReadyBeingFired=[],N.resolve(Wn(()=>c(t.vip))).then(l)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>t).catch(l=>{e.dbOpenError=l;try{a&&a.abort()}catch{}return n===e.openCanceller&&t._close(),he(l)}).finally(()=>{e.openComplete=!0,i()})}function Gn(t){var e=i=>t.next(i),r=s(e),n=s(i=>t.throw(i));function s(i){return a=>{var o=i(a),u=o.value;return o.done?u:u&&typeof u.then=="function"?u.then(r,n):ye(u)?Promise.all(u).then(r,n):r(u)}}return s(e)()}function Nu(t,e,r){var n=arguments.length;if(n<2)throw new q.InvalidArgument("Too few arguments");for(var s=new Array(n-1);--n;)s[n-1]=arguments[n];return r=s.pop(),[t,ra(s),r]}function Sa(t,e,r,n,s){return N.resolve().then(()=>{const i=z.transless||z,a=t._createTransaction(e,r,t._dbSchema,n),o={trans:a,transless:i};if(n)a.idbtrans=n.idbtrans;else try{a.create(),t._state.PR1398_maxLoop=3}catch(h){return h.name===ps.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>Sa(t,e,r,null,s))):he(h)}const u=fs(s);let l;u&&Pt();const c=N.follow(()=>{if(l=s.call(a,a),l)if(u){var h=qe.bind(null,null);l.then(h,h)}else typeof l.next=="function"&&typeof l.throw=="function"&&(l=Gn(l))},o);return(l&&typeof l.then=="function"?N.resolve(l).then(h=>a.active?h:he(new q.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):c.then(()=>l)).then(h=>(n&&a._resolve(),a._completion.then(()=>h))).catch(h=>(a._reject(h),he(h)))})}function xr(t,e,r){const n=ye(t)?t.slice():[t];for(let s=0;s<r;++s)n.push(e);return n}const Uu={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return{...t,table(e){const r=t.table(e),{schema:n}=r,s={},i=[];function a(c,h,f){const d=Wt(c),x=s[d]=s[d]||[],g=c==null?0:typeof c=="string"?1:c.length,_=h>0,b={...f,isVirtual:_,keyTail:h,keyLength:g,extractKey:Fn(c),unique:!_&&f.unique};return x.push(b),b.isPrimaryKey||i.push(b),g>1&&a(g===2?c[0]:c.slice(0,g-1),h+1,f),x.sort((v,L)=>v.keyTail-L.keyTail),b}const o=a(n.primaryKey.keyPath,0,n.primaryKey);s[":id"]=[o];for(const c of n.indexes)a(c.keyPath,0,c);function u(c){const h=c.query.index;return h.isVirtual?{...c,query:{index:h,range:(f=c.query.range,d=h.keyTail,{type:f.type===1?2:f.type,lower:xr(f.lower,f.lowerOpen?t.MAX_KEY:t.MIN_KEY,d),lowerOpen:!0,upper:xr(f.upper,f.upperOpen?t.MIN_KEY:t.MAX_KEY,d),upperOpen:!0})}}:c;var f,d}return{...r,schema:{...n,primaryKey:o,indexes:i,getIndexByKeyPath:function(c){const h=s[Wt(c)];return h&&h[0]}},count:c=>r.count(u(c)),query:c=>r.query(u(c)),openCursor(c){const{keyTail:h,isVirtual:f,keyLength:d}=c.query.index;return f?r.openCursor(u(c)).then(x=>x&&function(g){return Object.create(g,{continue:{value:function(b){b!=null?g.continue(xr(b,c.reverse?t.MAX_KEY:t.MIN_KEY,h)):c.unique?g.continue(g.key.slice(0,d).concat(c.reverse?t.MIN_KEY:t.MAX_KEY,h)):g.continue()}},continuePrimaryKey:{value(b,v){g.continuePrimaryKey(xr(b,t.MAX_KEY,h),v)}},primaryKey:{get:()=>g.primaryKey},key:{get(){const b=g.key;return d===1?b[0]:b.slice(0,d)}},value:{get:()=>g.value}})}(x)):r.openCursor(c)}}}}}};function xs(t,e,r,n){return r=r||{},n=n||"",ce(t).forEach(s=>{if(_e(e,s)){var i=t[s],a=e[s];if(typeof i=="object"&&typeof a=="object"&&i&&a){const o=kn(i);o!==kn(a)?r[n+s]=e[s]:o==="Object"?xs(i,a,r,n+s+"."):i!==a&&(r[n+s]=e[s])}else i!==a&&(r[n+s]=e[s])}else r[n+s]=void 0}),ce(e).forEach(s=>{_e(t,s)||(r[n+s]=e[s])}),r}const zu={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>({...t,table(e){const r=t.table(e),{primaryKey:n}=r.schema;return{...r,mutate(i){const a=z.trans,{deleting:o,creating:u,updating:l}=a.table(e).hook;switch(i.type){case"add":if(u.fire===Q)break;return a._promise("readwrite",()=>c(i),!0);case"put":if(u.fire===Q&&l.fire===Q)break;return a._promise("readwrite",()=>c(i),!0);case"delete":if(o.fire===Q)break;return a._promise("readwrite",()=>c(i),!0);case"deleteRange":if(o.fire===Q)break;return a._promise("readwrite",()=>function(f){return h(f.trans,f.range,1e4)}(i),!0)}return r.mutate(i);function c(f){const d=z.trans,x=f.keys||function(g,_){return _.type==="delete"?_.keys:_.keys||_.values.map(g.extractKey)}(n,f);if(!x)throw new Error("Keys missing");return(f=f.type==="add"||f.type==="put"?{...f,keys:x}:{...f}).type!=="delete"&&(f.values=[...f.values]),f.keys&&(f.keys=[...f.keys]),function(g,_,b){return _.type==="add"?Promise.resolve([]):g.getMany({trans:_.trans,keys:b,cache:"immutable"})}(r,f,x).then(g=>{const _=x.map((b,v)=>{const L=g[v],T={onerror:null,onsuccess:null};if(f.type==="delete")o.fire.call(T,b,L,d);else if(f.type==="add"||L===void 0){const I=u.fire.call(T,b,f.values[v],d);b==null&&I!=null&&(b=I,f.keys[v]=b,n.outbound||Ae(f.values[v],n.keyPath,b))}else{const I=xs(L,f.values[v]),R=l.fire.call(T,I,b,L,d);if(R){const A=f.values[v];Object.keys(R).forEach(C=>{_e(A,C)?A[C]=R[C]:Ae(A,C,R[C])})}}return T});return r.mutate(f).then(({failures:b,results:v,numFailures:L,lastResult:T})=>{for(let I=0;I<x.length;++I){const R=v?v[I]:x[I],A=_[I];R==null?A.onerror&&A.onerror(b[I]):A.onsuccess&&A.onsuccess(f.type==="put"&&g[I]?f.values[I]:R)}return{failures:b,results:v,numFailures:L,lastResult:T}}).catch(b=>(_.forEach(v=>v.onerror&&v.onerror(b)),Promise.reject(b)))})}function h(f,d,x){return r.query({trans:f,values:!1,query:{index:n,range:d},limit:x}).then(({result:g})=>c({type:"delete",keys:g,trans:f}).then(_=>_.numFailures>0?Promise.reject(_.failures[0]):g.length<x?{failures:[],numFailures:0,lastResult:void 0}:h(f,{...d,lower:g[g.length-1],lowerOpen:!0},x)))}}}}})};function Ra(t,e,r){try{if(!e||e.keys.length<t.length)return null;const n=[];for(let s=0,i=0;s<e.keys.length&&i<t.length;++s)ve(e.keys[s],t[i])===0&&(n.push(r?ar(e.values[s]):e.values[s]),++i);return n.length===t.length?n:null}catch{return null}}const Ku={stack:"dbcore",level:-1,create:t=>({table:e=>{const r=t.table(e);return{...r,getMany:n=>{if(!n.cache)return r.getMany(n);const s=Ra(n.keys,n.trans._cache,n.cache==="clone");return s?N.resolve(s):r.getMany(n).then(i=>(n.trans._cache={keys:n.keys,values:n.cache==="clone"?ar(i):i},i))},mutate:n=>(n.type!=="add"&&(n.trans._cache=null),r.mutate(n))}}})};function _s(t){return!("from"in t)}const Ne=function(t,e){if(!this){const r=new Ne;return t&&"d"in t&&be(r,t),r}be(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0})};function nr(t,e,r){const n=ve(e,r);if(isNaN(n))return;if(n>0)throw RangeError();if(_s(t))return be(t,{from:e,to:r,d:1});const s=t.l,i=t.r;if(ve(r,t.from)<0)return s?nr(s,e,r):t.l={from:e,to:r,d:1,l:null,r:null},oi(t);if(ve(e,t.to)>0)return i?nr(i,e,r):t.r={from:e,to:r,d:1,l:null,r:null},oi(t);ve(e,t.from)<0&&(t.from=e,t.l=null,t.d=i?i.d+1:1),ve(r,t.to)>0&&(t.to=r,t.r=null,t.d=t.l?t.l.d+1:1);const a=!t.r;s&&!t.l&&Xr(t,s),i&&a&&Xr(t,i)}function Xr(t,e){_s(e)||function r(n,{from:s,to:i,l:a,r:o}){nr(n,s,i),a&&r(n,a),o&&r(n,o)}(t,e)}function Fu(t,e){const r=Xn(e);let n=r.next();if(n.done)return!1;let s=n.value;const i=Xn(t);let a=i.next(s.from),o=a.value;for(;!n.done&&!a.done;){if(ve(o.from,s.to)<=0&&ve(o.to,s.from)>=0)return!0;ve(s.from,o.from)<0?s=(n=r.next(o.from)).value:o=(a=i.next(s.from)).value}return!1}function Xn(t){let e=_s(t)?null:{s:0,n:t};return{next(r){const n=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,n)for(;e.n.l&&ve(r,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!n||ve(r,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function oi(t){var e,r;const n=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((r=t.l)===null||r===void 0?void 0:r.d)||0),s=n>1?"r":n<-1?"l":"";if(s){const i=s==="r"?"l":"r",a={...t},o=t[s];t.from=o.from,t.to=o.to,t[s]=o[s],a[s]=o[i],t[i]=a,a.d=ui(a)}t.d=ui(t)}function ui({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}Ot(Ne.prototype,{add(t){return Xr(this,t),this},addKey(t){return nr(this,t,t),this},addKeys(t){return t.forEach(e=>nr(this,e,e)),this},[On](){return Xn(this)}});const ju={stack:"dbcore",level:0,create:t=>{const e=t.schema.name,r=new Ne(t.MIN_KEY,t.MAX_KEY);return{...t,table:n=>{const s=t.table(n),{schema:i}=s,{primaryKey:a}=i,{extractKey:o,outbound:u}=a,l={...s,mutate:f=>{const d=f.trans,x=d.mutatedParts||(d.mutatedParts={}),g=R=>{const A=`idb://${e}/${n}/${R}`;return x[A]||(x[A]=new Ne)},_=g(""),b=g(":dels"),{type:v}=f;let[L,T]=f.type==="deleteRange"?[f.range]:f.type==="delete"?[f.keys]:f.values.length<50?[[],f.values]:[];const I=f.trans._cache;return s.mutate(f).then(R=>{if(ye(L)){v!=="delete"&&(L=R.results),_.addKeys(L);const A=Ra(L,I);A||v==="add"||b.addKeys(L),(A||T)&&function(C,B,$,V){function H(y){const k=C(y.name||"");function M(O){return O!=null?y.extractKey(O):null}const E=O=>y.multiEntry&&ye(O)?O.forEach(D=>k.addKey(D)):k.addKey(O);($||V).forEach((O,D)=>{const K=$&&M($[D]),U=V&&M(V[D]);ve(K,U)!==0&&(K!=null&&E(K),U!=null&&E(U))})}B.indexes.forEach(H)}(g,i,A,T)}else if(L){const A={from:L.lower,to:L.upper};b.add(A),_.add(A)}else _.add(r),b.add(r),i.indexes.forEach(A=>g(A.name).add(r));return R})}},c=({query:{index:f,range:d}})=>{var x,g;return[f,new Ne((x=d.lower)!==null&&x!==void 0?x:t.MIN_KEY,(g=d.upper)!==null&&g!==void 0?g:t.MAX_KEY)]},h={get:f=>[a,new Ne(f.key)],getMany:f=>[a,new Ne().addKeys(f.keys)],count:c,query:c,openCursor:c};return ce(h).forEach(f=>{l[f]=function(d){const{subscr:x}=z;if(x){const g=T=>{const I=`idb://${e}/${n}/${T}`;return x[I]||(x[I]=new Ne)},_=g(""),b=g(":dels"),[v,L]=h[f](d);if(g(v.name||"").add(L),!v.isPrimaryKey){if(f!=="count"){const T=f==="query"&&u&&d.values&&s.query({...d,values:!1});return s[f].apply(this,arguments).then(I=>{if(f==="query"){if(u&&d.values)return T.then(({result:A})=>(_.addKeys(A),I));const R=d.values?I.result.map(o):I.result;d.values?_.addKeys(R):b.addKeys(R)}else if(f==="openCursor"){const R=I,A=d.values;return R&&Object.create(R,{key:{get:()=>(b.addKey(R.primaryKey),R.key)},primaryKey:{get(){const C=R.primaryKey;return b.addKey(C),C}},value:{get:()=>(A&&_.addKey(R.primaryKey),R.value)}})}return I})}b.add(r)}}return s[f].apply(this,arguments)}}),l}}}};class ct{constructor(e,r){this._middlewares={},this.verno=0;const n=ct.dependencies;this._options=r={addons:ct.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange,...r},this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange};const{addons:s}=r;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const i={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Q,dbReadyPromise:null,cancelOpen:Q,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var a;i.dbReadyPromise=new N(o=>{i.dbReadyResolve=o}),i.openCanceller=new N((o,u)=>{i.cancelOpen=u}),this._state=i,this.name=e,this.on=Ht(this,"populate","blocked","versionchange","close",{ready:[ms,Q]}),this.on.ready.subscribe=Zi(this.on.ready.subscribe,o=>(u,l)=>{ct.vip(()=>{const c=this._state;if(c.openComplete)c.dbOpenError||N.resolve().then(u),l&&o(u);else if(c.onReadyBeingFired)c.onReadyBeingFired.push(u),l&&o(u);else{o(u);const h=this;l||o(function f(){h.on.ready.unsubscribe(u),h.on.ready.unsubscribe(f)})}})}),this.Collection=(a=this,Ut(Su.prototype,function(o,u){this.db=a;let l=ba,c=null;if(u)try{l=u()}catch(x){c=x}const h=o._ctx,f=h.table,d=f.hook.reading.fire;this._ctx={table:f,index:h.index,isPrimKey:!h.index||f.schema.primKey.keyPath&&h.index===f.schema.primKey.name,range:l,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:c,or:h.or,valueMapper:d!==Zt?d:null}})),this.Table=function(o){return Ut(Tu.prototype,function(u,l,c){this.db=o,this._tx=c,this.name=u,this.schema=l,this.hook=o._allTables[u]?o._allTables[u].hook:Ht(null,{creating:[fu,Q],reading:[hu,Zt],updating:[pu,Q],deleting:[du,Q]})})}(this),this.Transaction=function(o){return Ut(Au.prototype,function(u,l,c,h,f){this.db=o,this.mode=u,this.storeNames=l,this.schema=c,this.chromeTransactionDurability=h,this.idbtrans=null,this.on=Ht(this,"complete","error","abort"),this.parent=f||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new N((d,x)=>{this._resolve=d,this._reject=x}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},d=>{var x=this.active;return this.active=!1,this.on.error.fire(d),this.parent?this.parent._reject(d):x&&this.idbtrans&&this.idbtrans.abort(),he(d)})})}(this),this.Version=function(o){return Ut(Iu.prototype,function(u){this.db=o,this._cfg={version:u,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(o){return Ut(xa.prototype,function(u,l,c){this.db=o,this._ctx={table:u,index:l===":id"?null:l,or:c};const h=o._deps.indexedDB;if(!h)throw new q.MissingAPI;this._cmp=this._ascending=h.cmp.bind(h),this._descending=(f,d)=>h.cmp(d,f),this._max=(f,d)=>h.cmp(f,d)>0?f:d,this._min=(f,d)=>h.cmp(f,d)<0?f:d,this._IDBKeyRange=o._deps.IDBKeyRange})}(this),this.on("versionchange",o=>{o.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",o=>{!o.newVersion||o.newVersion<o.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${o.oldVersion/10}`)}),this._maxKey=rr(r.IDBKeyRange),this._createTransaction=(o,u,l,c)=>new this.Transaction(o,u,l,this._options.chromeTransactionDurability,c),this._fireOnBlocked=o=>{this.on("blocked").fire(o),Vt.filter(u=>u.name===this.name&&u!==this&&!u._state.vcFired).map(u=>u.on("versionchange").fire(o))},this.use(Uu),this.use(zu),this.use(ju),this.use(Ku),this.vip=Object.create(this,{_vip:{value:!0}}),s.forEach(o=>o(this))}version(e){if(isNaN(e)||e<.1)throw new q.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new q.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const r=this._versions;var n=r.filter(s=>s._cfg.version===e)[0];return n||(n=new this.Version(e),r.push(n),r.sort(Cu),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(e){return this.idbdb&&(this._state.openComplete||z.letThrough||this._vip)?e():new N((r,n)=>{if(this._state.openComplete)return n(new q.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void n(new q.DatabaseClosed);this.open().catch(Q)}this._state.dbReadyPromise.then(r,n)}).then(e)}use({stack:e,create:r,level:n,name:s}){s&&this.unuse({stack:e,name:s});const i=this._middlewares[e]||(this._middlewares[e]=[]);return i.push({stack:e,create:r,level:n??10,name:s}),i.sort((a,o)=>a.level-o.level),this}unuse({stack:e,name:r,create:n}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(s=>n?s.create!==n:!!r&&s.name!==r)),this}open(){return Du(this)}_close(){const e=this._state,r=Vt.indexOf(this);if(r>=0&&Vt.splice(r,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new N(n=>{e.dbReadyResolve=n}),e.openCanceller=new N((n,s)=>{e.cancelOpen=s})}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new q.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,r=this._state;return new N((n,s)=>{const i=()=>{this.close();var a=this._deps.indexedDB.deleteDatabase(this.name);a.onsuccess=re(()=>{(function({indexedDB:o,IDBKeyRange:u},l){!ws(o)&&l!==rn&&bs(o,u).delete(l).catch(Q)})(this._deps,this.name),n()}),a.onerror=Ce(s),a.onblocked=this._fireOnBlocked};if(e)throw new q.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(i):i()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return ce(this._allTables).map(e=>this._allTables[e])}transaction(){const e=Nu.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,r,n){let s=z.trans;s&&s.db===this&&e.indexOf("!")===-1||(s=null);const i=e.indexOf("?")!==-1;let a,o;e=e.replace("!","").replace("?","");try{if(o=r.map(l=>{var c=l instanceof this.Table?l.name:l;if(typeof c!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return c}),e=="r"||e===fn)a=fn;else{if(e!="rw"&&e!=dn)throw new q.InvalidArgument("Invalid transaction mode: "+e);a=dn}if(s){if(s.mode===fn&&a===dn){if(!i)throw new q.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");s=null}s&&o.forEach(l=>{if(s&&s.storeNames.indexOf(l)===-1){if(!i)throw new q.SubTransaction("Table "+l+" not included in parent transaction.");s=null}}),i&&s&&!s.active&&(s=null)}}catch(l){return s?s._promise(null,(c,h)=>{h(l)}):he(l)}const u=Sa.bind(null,this,a,o,s,n);return s?s._promise(a,u,"lock"):z.trans?Dt(z.transless,()=>this._whenReady(u)):this._whenReady(u)}table(e){if(!_e(this._allTables,e))throw new q.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const $u=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class qu{constructor(e){this._subscribe=e}subscribe(e,r,n){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:r,complete:n})}[$u](){return this}}function ka(t,e){return ce(e).forEach(r=>{Xr(t[r]||(t[r]=new Ne),e[r])}),t}function Vu(t){let e,r=!1;const n=new qu(s=>{const i=fs(t);let a=!1,o={},u={};const l={get closed(){return a},unsubscribe:()=>{a=!0,et.storagemutated.unsubscribe(d)}};s.start&&s.start(l);let c=!1,h=!1;function f(){return ce(u).some(g=>o[g]&&Fu(o[g],u[g]))}const d=g=>{ka(o,g),f()&&x()},x=()=>{if(c||a)return;o={};const g={},_=function(b){i&&Pt();const v=()=>Ze(t,{subscr:b,trans:null}),L=z.trans?Dt(z.transless,v):v();return i&&L.then(qe,qe),L}(g);h||(et(tr,d),h=!0),c=!0,Promise.resolve(_).then(b=>{r=!0,e=b,c=!1,a||(f()?x():(o={},u=g,s.next&&s.next(b)))},b=>{c=!1,r=!1,s.error&&s.error(b),l.unsubscribe()})};return x(),l});return n.hasValue=()=>r,n.getValue=()=>e,n}let Yn;try{Yn={indexedDB:ee.indexedDB||ee.mozIndexedDB||ee.webkitIndexedDB||ee.msIndexedDB,IDBKeyRange:ee.IDBKeyRange||ee.webkitIDBKeyRange}}catch{Yn={indexedDB:null,IDBKeyRange:null}}const tt=ct;function Pr(t){let e=ze;try{ze=!0,et.storagemutated.fire(t)}finally{ze=e}}Ot(tt,{...Ar,delete:t=>new tt(t,{addons:[]}).delete(),exists:t=>new tt(t,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(t){try{return function({indexedDB:e,IDBKeyRange:r}){return ws(e)?Promise.resolve(e.databases()).then(n=>n.map(s=>s.name).filter(s=>s!==rn)):bs(e,r).toCollection().primaryKeys()}(tt.dependencies).then(t)}catch{return he(new q.MissingAPI)}},defineClass:()=>function(t){be(this,t)},ignoreTransaction:t=>z.trans?Dt(z.transless,t):t(),vip:Wn,async:function(t){return function(){try{var e=Gn(t.apply(this,arguments));return e&&typeof e.then=="function"?e:N.resolve(e)}catch(r){return he(r)}}},spawn:function(t,e,r){try{var n=Gn(t.apply(r,e||[]));return n&&typeof n.then=="function"?n:N.resolve(n)}catch(s){return he(s)}},currentTransaction:{get:()=>z.trans||null},waitFor:function(t,e){const r=N.resolve(typeof t=="function"?tt.ignoreTransaction(t):t).timeout(e||6e4);return z.trans?z.trans.waitFor(r):r},Promise:N,debug:{get:()=>Pe,set:t=>{sa(t,t==="dexie"?()=>!0:va)}},derive:Et,extend:be,props:Ot,override:Zi,Events:Ht,on:et,liveQuery:Vu,extendObservabilitySet:ka,getByKeyPath:Fe,setByKeyPath:Ae,delByKeyPath:function(t,e){typeof e=="string"?Ae(t,e,void 0):"length"in e&&[].map.call(e,function(r){Ae(t,r,void 0)})},shallowClone:ta,deepClone:ar,getObjectDiff:xs,cmp:ve,asap:Ji,minKey:zn,addons:[],connections:Vt,errnames:ps,dependencies:Yn,semVer:ti,version:ti.split(".").map(t=>parseInt(t)).reduce((t,e,r)=>t+e/Math.pow(10,2*r))}),tt.maxKey=rr(tt.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(et(tr,t=>{if(!ze){let e;tn?(e=document.createEvent("CustomEvent"),e.initCustomEvent(Xe,!0,!0,t)):e=new CustomEvent(Xe,{detail:t}),ze=!0,dispatchEvent(e),ze=!1}}),addEventListener(Xe,({detail:t})=>{ze||Pr(t)}));let ze=!1;if(typeof BroadcastChannel<"u"){const t=new BroadcastChannel(Xe);typeof t.unref=="function"&&t.unref(),et(tr,e=>{ze||t.postMessage(e)}),t.onmessage=e=>{e.data&&Pr(e.data)}}else if(typeof self<"u"&&typeof navigator<"u"){et(tr,e=>{try{ze||(typeof localStorage<"u"&&localStorage.setItem(Xe,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(r=>r.postMessage({type:Xe,changedParts:e})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",e=>{if(e.key===Xe){const r=JSON.parse(e.newValue);r&&Pr(r.changedParts)}});const t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",function({data:e}){e&&e.type===Xe&&Pr(e.changedParts)})}N.rejectionMapper=function(t,e){if(!t||t instanceof Tt||t instanceof TypeError||t instanceof SyntaxError||!t.name||!Qs[t.name])return t;var r=new Qs[t.name](e||t.message,t);return"stack"in t&&Ke(r,"stack",{get:function(){return this.inner.stack}}),r},sa(Pe,va);var Qn;try{Qn=new TextDecoder}catch{}var P,Re,p=0,J={},Y,Ye,Se=0,Ie=0,de,je,we=[],X,li={useRecords:!1,mapsAsObjects:!0};class Oa{}const Aa=new Oa;Aa.name="MessagePack 0xC1";var Qe=!1,La=2,ci;try{new Function("")}catch{La=1/0}class At{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,r){if(P)return Da(()=>(Jn(),this?this.unpack(e,r):At.prototype.unpack.call(li,e,r)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof Buffer<"u"?Buffer.from(e):new Uint8Array(e)),typeof r=="object"?(Re=r.end||e.length,p=r.start||0):(p=0,Re=r>-1?r:e.length),Ie=0,Ye=null,de=null,P=e;try{X=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(n){throw P=null,e instanceof Uint8Array?n:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof At){if(J=this,this.structures)return Y=this.structures,_r(r);(!Y||Y.length>0)&&(Y=[])}else J=li,(!Y||Y.length>0)&&(Y=[]);return _r(r)}unpackMultiple(e,r){let n,s=0;try{Qe=!0;let i=e.length,a=this?this.unpack(e,i):nn.unpack(e,i);if(r){if(r(a,s,p)===!1)return;for(;p<i;)if(s=p,r(_r(),s,p)===!1)return}else{for(n=[a];p<i;)s=p,n.push(_r());return n}}catch(i){throw i.lastPosition=s,i.values=n,i}finally{Qe=!1,Jn()}}_mergeStructures(e,r){e=e||[],Object.isFrozen(e)&&(e=e.map(n=>n.slice(0)));for(let n=0,s=e.length;n<s;n++){let i=e[n];i&&(i.isShared=!0,n>=32&&(i.highByte=n-32>>5))}e.sharedLength=e.length;for(let n in r||[])if(n>=0){let s=e[n],i=r[n];i&&(s&&((e.restoreStructures||(e.restoreStructures=[]))[n]=s),e[n]=i)}return this.structures=e}decode(e,r){return this.unpack(e,r)}}function _r(t){try{if(!J.trusted&&!Qe){let r=Y.sharedLength||0;r<Y.length&&(Y.length=r)}let e;if(J.randomAccessStructure&&P[p]<64&&P[p]>=32&&ci?(e=ci(P,p,Re,J),P=null,!(t&&t.lazy)&&e&&(e=e.toJSON()),p=Re):e=oe(),de&&(p=de.postBundlePosition,de=null),Qe&&(Y.restoreStructures=null),p==Re)Y&&Y.restoreStructures&&hi(),Y=null,P=null,je&&(je=null);else{if(p>Re)throw new Error("Unexpected end of MessagePack data");if(!Qe){let r;try{r=JSON.stringify(e,(n,s)=>typeof s=="bigint"?`${s}n`:s).slice(0,100)}catch(n){r="(JSON view not available "+n+")"}throw new Error("Data read, but end of buffer not reached "+r)}}return e}catch(e){throw Y&&Y.restoreStructures&&hi(),Jn(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||p>Re)&&(e.incomplete=!0),e}}function hi(){for(let t in Y.restoreStructures)Y[t]=Y.restoreStructures[t];Y.restoreStructures=null}function oe(){let t=P[p++];if(t<160)if(t<128){if(t<64)return t;{let e=Y[t&63]||J.getStructures&&Ma()[t&63];return e?(e.read||(e.read=Es(e,t&63)),e.read()):t}}else if(t<144)if(t-=128,J.mapsAsObjects){let e={};for(let r=0;r<t;r++){let n=Ba();n==="__proto__"&&(n="__proto_"),e[n]=oe()}return e}else{let e=new Map;for(let r=0;r<t;r++)e.set(oe(),oe());return e}else{t-=144;let e=new Array(t);for(let r=0;r<t;r++)e[r]=oe();return J.freezeData?Object.freeze(e):e}else if(t<192){let e=t-160;if(Ie>=p)return Ye.slice(p-Se,(p+=e)-Se);if(Ie==0&&Re<140){let r=e<16?Ts(e):Ca(e);if(r!=null)return r}return Zn(e)}else{let e;switch(t){case 192:return null;case 193:return de?(e=oe(),e>0?de[1].slice(de.position1,de.position1+=e):de[0].slice(de.position0,de.position0-=e)):Aa;case 194:return!1;case 195:return!0;case 196:if(e=P[p++],e===void 0)throw new Error("Unexpected end of buffer");return vn(e);case 197:return e=X.getUint16(p),p+=2,vn(e);case 198:return e=X.getUint32(p),p+=4,vn(e);case 199:return rt(P[p++]);case 200:return e=X.getUint16(p),p+=2,rt(e);case 201:return e=X.getUint32(p),p+=4,rt(e);case 202:if(e=X.getFloat32(p),J.useFloat32>2){let r=Ss[(P[p]&127)<<1|P[p+1]>>7];return p+=4,(r*e+(e>0?.5:-.5)>>0)/r}return p+=4,e;case 203:return e=X.getFloat64(p),p+=8,e;case 204:return P[p++];case 205:return e=X.getUint16(p),p+=2,e;case 206:return e=X.getUint32(p),p+=4,e;case 207:return J.int64AsType==="number"?(e=X.getUint32(p)*4294967296,e+=X.getUint32(p+4)):J.int64AsType==="string"?e=X.getBigUint64(p).toString():J.int64AsType==="auto"?(e=X.getBigUint64(p),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=X.getBigUint64(p),p+=8,e;case 208:return X.getInt8(p++);case 209:return e=X.getInt16(p),p+=2,e;case 210:return e=X.getInt32(p),p+=4,e;case 211:return J.int64AsType==="number"?(e=X.getInt32(p)*4294967296,e+=X.getUint32(p+4)):J.int64AsType==="string"?e=X.getBigInt64(p).toString():J.int64AsType==="auto"?(e=X.getBigInt64(p),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=X.getBigInt64(p),p+=8,e;case 212:if(e=P[p++],e==114)return gi(P[p++]&63);{let r=we[e];if(r)return r.read?(p++,r.read(oe())):r.noBuffer?(p++,r()):r(P.subarray(p,++p));throw new Error("Unknown extension "+e)}case 213:return e=P[p],e==114?(p++,gi(P[p++]&63,P[p++])):rt(2);case 214:return rt(4);case 215:return rt(8);case 216:return rt(16);case 217:return e=P[p++],Ie>=p?Ye.slice(p-Se,(p+=e)-Se):Wu(e);case 218:return e=X.getUint16(p),p+=2,Ie>=p?Ye.slice(p-Se,(p+=e)-Se):Gu(e);case 219:return e=X.getUint32(p),p+=4,Ie>=p?Ye.slice(p-Se,(p+=e)-Se):Xu(e);case 220:return e=X.getUint16(p),p+=2,di(e);case 221:return e=X.getUint32(p),p+=4,di(e);case 222:return e=X.getUint16(p),p+=2,pi(e);case 223:return e=X.getUint32(p),p+=4,pi(e);default:if(t>=224)return t-256;if(t===void 0){let r=new Error("Unexpected end of MessagePack data");throw r.incomplete=!0,r}throw new Error("Unknown MessagePack token "+t)}}}const Hu=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Es(t,e){function r(){if(r.count++>La){let s=t.read=new Function("r","return function(){return "+(J.freezeData?"Object.freeze":"")+"({"+t.map(i=>i==="__proto__"?"__proto_:r()":Hu.test(i)?i+":r()":"["+JSON.stringify(i)+"]:r()").join(",")+"})}")(oe);return t.highByte===0&&(t.read=fi(e,t.read)),s()}let n={};for(let s=0,i=t.length;s<i;s++){let a=t[s];a==="__proto__"&&(a="__proto_"),n[a]=oe()}return J.freezeData?Object.freeze(n):n}return r.count=0,t.highByte===0?fi(e,r):r}const fi=(t,e)=>function(){let r=P[p++];if(r===0)return e();let n=t<32?-(t+(r<<5)):t+(r<<5),s=Y[n]||Ma()[n];if(!s)throw new Error("Record id is not defined for "+n);return s.read||(s.read=Es(s,t)),s.read()};function Ma(){let t=Da(()=>(P=null,J.getStructures()));return Y=J._mergeStructures(t,Y)}var Zn=lr,Wu=lr,Gu=lr,Xu=lr;function lr(t){let e;if(t<16&&(e=Ts(t)))return e;if(t>64&&Qn)return Qn.decode(P.subarray(p,p+=t));const r=p+t,n=[];for(e="";p<r;){const s=P[p++];if(!(s&128))n.push(s);else if((s&224)===192){const i=P[p++]&63;n.push((s&31)<<6|i)}else if((s&240)===224){const i=P[p++]&63,a=P[p++]&63;n.push((s&31)<<12|i<<6|a)}else if((s&248)===240){const i=P[p++]&63,a=P[p++]&63,o=P[p++]&63;let u=(s&7)<<18|i<<12|a<<6|o;u>65535&&(u-=65536,n.push(u>>>10&1023|55296),u=56320|u&1023),n.push(u)}else n.push(s);n.length>=4096&&(e+=fe.apply(String,n),n.length=0)}return n.length>0&&(e+=fe.apply(String,n)),e}function di(t){let e=new Array(t);for(let r=0;r<t;r++)e[r]=oe();return J.freezeData?Object.freeze(e):e}function pi(t){if(J.mapsAsObjects){let e={};for(let r=0;r<t;r++){let n=Ba();n==="__proto__"&&(n="__proto_"),e[n]=oe()}return e}else{let e=new Map;for(let r=0;r<t;r++)e.set(oe(),oe());return e}}var fe=String.fromCharCode;function Ca(t){let e=p,r=new Array(t);for(let n=0;n<t;n++){const s=P[p++];if((s&128)>0){p=e;return}r[n]=s}return fe.apply(String,r)}function Ts(t){if(t<4)if(t<2){if(t===0)return"";{let e=P[p++];if((e&128)>1){p-=1;return}return fe(e)}}else{let e=P[p++],r=P[p++];if((e&128)>0||(r&128)>0){p-=2;return}if(t<3)return fe(e,r);let n=P[p++];if((n&128)>0){p-=3;return}return fe(e,r,n)}else{let e=P[p++],r=P[p++],n=P[p++],s=P[p++];if((e&128)>0||(r&128)>0||(n&128)>0||(s&128)>0){p-=4;return}if(t<6){if(t===4)return fe(e,r,n,s);{let i=P[p++];if((i&128)>0){p-=5;return}return fe(e,r,n,s,i)}}else if(t<8){let i=P[p++],a=P[p++];if((i&128)>0||(a&128)>0){p-=6;return}if(t<7)return fe(e,r,n,s,i,a);let o=P[p++];if((o&128)>0){p-=7;return}return fe(e,r,n,s,i,a,o)}else{let i=P[p++],a=P[p++],o=P[p++],u=P[p++];if((i&128)>0||(a&128)>0||(o&128)>0||(u&128)>0){p-=8;return}if(t<10){if(t===8)return fe(e,r,n,s,i,a,o,u);{let l=P[p++];if((l&128)>0){p-=9;return}return fe(e,r,n,s,i,a,o,u,l)}}else if(t<12){let l=P[p++],c=P[p++];if((l&128)>0||(c&128)>0){p-=10;return}if(t<11)return fe(e,r,n,s,i,a,o,u,l,c);let h=P[p++];if((h&128)>0){p-=11;return}return fe(e,r,n,s,i,a,o,u,l,c,h)}else{let l=P[p++],c=P[p++],h=P[p++],f=P[p++];if((l&128)>0||(c&128)>0||(h&128)>0||(f&128)>0){p-=12;return}if(t<14){if(t===12)return fe(e,r,n,s,i,a,o,u,l,c,h,f);{let d=P[p++];if((d&128)>0){p-=13;return}return fe(e,r,n,s,i,a,o,u,l,c,h,f,d)}}else{let d=P[p++],x=P[p++];if((d&128)>0||(x&128)>0){p-=14;return}if(t<15)return fe(e,r,n,s,i,a,o,u,l,c,h,f,d,x);let g=P[p++];if((g&128)>0){p-=15;return}return fe(e,r,n,s,i,a,o,u,l,c,h,f,d,x,g)}}}}}function mi(){let t=P[p++],e;if(t<192)e=t-160;else switch(t){case 217:e=P[p++];break;case 218:e=X.getUint16(p),p+=2;break;case 219:e=X.getUint32(p),p+=4;break;default:throw new Error("Expected string")}return lr(e)}function vn(t){return J.copyBuffers?Uint8Array.prototype.slice.call(P,p,p+=t):P.subarray(p,p+=t)}function rt(t){let e=P[p++];if(we[e]){let r;return we[e](P.subarray(p,r=p+=t),n=>{p=n;try{return oe()}finally{p=r}})}else throw new Error("Unknown extension type "+e)}var yi=new Array(4096);function Ba(){let t=P[p++];if(t>=160&&t<192){if(t=t-160,Ie>=p)return Ye.slice(p-Se,(p+=t)-Se);if(!(Ie==0&&Re<180))return Zn(t)}else return p--,Ia(oe());let e=(t<<5^(t>1?X.getUint16(p):t>0?P[p]:0))&4095,r=yi[e],n=p,s=p+t-3,i,a=0;if(r&&r.bytes==t){for(;n<s;){if(i=X.getUint32(n),i!=r[a++]){n=1879048192;break}n+=4}for(s+=3;n<s;)if(i=P[n++],i!=r[a++]){n=1879048192;break}if(n===s)return p=n,r.string;s-=3,n=p}for(r=[],yi[e]=r,r.bytes=t;n<s;)i=X.getUint32(n),r.push(i),n+=4;for(s+=3;n<s;)i=P[n++],r.push(i);let o=t<16?Ts(t):Ca(t);return o!=null?r.string=o:r.string=Zn(t)}function Ia(t){if(typeof t=="string")return t;if(typeof t=="number"||typeof t=="boolean"||typeof t=="bigint")return t.toString();if(t==null)return t+"";throw new Error("Invalid property type for record",typeof t)}const gi=(t,e)=>{let r=oe().map(Ia),n=t;e!==void 0&&(t=t<32?-((e<<5)+t):(e<<5)+t,r.highByte=e);let s=Y[t];return s&&(s.isShared||Qe)&&((Y.restoreStructures||(Y.restoreStructures=[]))[t]=s),Y[t]=r,r.read=Es(r,n),r.read()};we[0]=()=>{};we[0].noBuffer=!0;we[66]=t=>{let e=t.length,r=BigInt(t[0]&128?t[0]-256:t[0]);for(let n=1;n<e;n++)r<<=8n,r+=BigInt(t[n]);return r};let Yu={Error,TypeError,ReferenceError};we[101]=()=>{let t=oe();return(Yu[t[0]]||Error)(t[1],{cause:t[2]})};we[105]=t=>{if(J.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=X.getUint32(p-4);je||(je=new Map);let r=P[p],n;r>=144&&r<160||r==220||r==221?n=[]:n={};let s={target:n};je.set(e,s);let i=oe();return s.used?Object.assign(n,i):(s.target=i,i)};we[112]=t=>{if(J.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=X.getUint32(p-4),r=je.get(e);return r.used=!0,r.target};we[115]=()=>new Set(oe());const Pa=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(t=>t+"Array");let Qu=typeof globalThis=="object"?globalThis:window;we[116]=t=>{let e=t[0],r=Pa[e];if(!r){if(e===16){let n=new ArrayBuffer(t.length-1);return new Uint8Array(n).set(t.subarray(1)),n}throw new Error("Could not find typed array for code "+e)}return new Qu[r](Uint8Array.prototype.slice.call(t,1).buffer)};we[120]=()=>{let t=oe();return new RegExp(t[0],t[1])};const Zu=[];we[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],r=p;return p+=e-t.length,de=Zu,de=[mi(),mi()],de.position0=0,de.position1=0,de.postBundlePosition=p,p=r,oe()};we[255]=t=>t.length==4?new Date((t[0]*16777216+(t[1]<<16)+(t[2]<<8)+t[3])*1e3):t.length==8?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+((t[3]&3)*4294967296+t[4]*16777216+(t[5]<<16)+(t[6]<<8)+t[7])*1e3):t.length==12?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+((t[4]&128?-281474976710656:0)+t[6]*1099511627776+t[7]*4294967296+t[8]*16777216+(t[9]<<16)+(t[10]<<8)+t[11])*1e3):new Date("invalid");function Da(t){let e=Re,r=p,n=Se,s=Ie,i=Ye,a=je,o=de,u=new Uint8Array(P.slice(0,Re)),l=Y,c=Y.slice(0,Y.length),h=J,f=Qe,d=t();return Re=e,p=r,Se=n,Ie=s,Ye=i,je=a,de=o,P=u,Qe=f,Y=l,Y.splice(0,Y.length,...c),J=h,X=new DataView(P.buffer,P.byteOffset,P.byteLength),d}function Jn(){P=null,je=null,Y=null}const Ss=new Array(147);for(let t=0;t<256;t++)Ss[t]=+("1e"+Math.floor(45.15-t*.30103));var nn=new At({useRecords:!1});nn.unpack;nn.unpackMultiple;const zl=nn.unpack;let Ju=new Float32Array(1);new Uint8Array(Ju.buffer,0,4);let Dr;try{Dr=new TextEncoder}catch{}let es,Na;const sn=typeof Buffer<"u",Er=sn?function(t){return Buffer.allocUnsafeSlow(t)}:Uint8Array,Ua=sn?Buffer:Uint8Array,vi=sn?4294967296:2144337920;let w,zt,Z,m=0,ge,se=null,el;const tl=21760,rl=/[\u0080-\uFFFF]/,gt=Symbol("record-id");class za extends At{constructor(e){super(e),this.offset=0;let r,n,s,i,a=Ua.prototype.utf8Write?function(y,k){return w.utf8Write(y,k,4294967295)}:Dr&&Dr.encodeInto?function(y,k){return Dr.encodeInto(y,w.subarray(k)).written}:!1,o=this;e||(e={});let u=e&&e.sequential,l=e.structures||e.saveStructures,c=e.maxSharedStructures;if(c==null&&(c=l?32:0),c>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let h=e.maxOwnStructures;h==null&&(h=l?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let f=c>32||h+c>64,d=c+64,x=c+h+64;if(x>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let g=[],_=0,b=0;this.pack=this.encode=function(y,k){if(w||(w=new Er(8192),Z=w.dataView||(w.dataView=new DataView(w.buffer,0,8192)),m=0),ge=w.length-10,ge-m<2048?(w=new Er(w.length),Z=w.dataView||(w.dataView=new DataView(w.buffer,0,w.length)),ge=w.length-10,m=0):m=m+7&2147483640,r=m,k&ul&&(m+=k&255),i=o.structuredClone?new Map:null,o.bundleStrings&&typeof y!="string"?(se=[],se.size=1/0):se=null,s=o.structures,s){s.uninitialized&&(s=o._mergeStructures(o.getStructures()));let E=s.sharedLength||0;if(E>c)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+s.sharedLength);if(!s.transitions){s.transitions=Object.create(null);for(let O=0;O<E;O++){let D=s[O];if(!D)continue;let K,U=s.transitions;for(let W=0,G=D.length;W<G;W++){let ae=D[W];K=U[ae],K||(K=U[ae]=Object.create(null)),U=K}U[gt]=O+64}this.lastNamedStructuresLength=E}u||(s.nextId=E+64)}n&&(n=!1);let M;try{o.randomAccessStructure&&y&&y.constructor&&y.constructor===Object?H(y):T(y);let E=se;if(se&&xi(r,T,0),i&&i.idsToInsert){let O=i.idsToInsert.sort((W,G)=>W.offset>G.offset?1:-1),D=O.length,K=-1;for(;E&&D>0;){let W=O[--D].offset+r;W<E.stringsPosition+r&&K===-1&&(K=0),W>E.position+r?K>=0&&(K+=6):(K>=0&&(Z.setUint32(E.position+r,Z.getUint32(E.position+r)+K),K=-1),E=E.previous,D++)}K>=0&&E&&Z.setUint32(E.position+r,Z.getUint32(E.position+r)+K),m+=O.length*6,m>ge&&B(m),o.offset=m;let U=sl(w.subarray(r,m),O);return i=null,U}return o.offset=m,k&al?(w.start=r,w.end=m,w):w.subarray(r,m)}catch(E){throw M=E,E}finally{if(s&&(v(),n&&o.saveStructures)){let E=s.sharedLength||0,O=w.subarray(r,m),D=il(s,o);if(!M)return o.saveStructures(D,D.isCompatible)===!1?o.pack(y,k):(o.lastNamedStructuresLength=E,w.length>1073741824&&(w=null),O)}w.length>1073741824&&(w=null),k&ol&&(m=r)}};const v=()=>{b<10&&b++;let y=s.sharedLength||0;if(s.length>y&&!u&&(s.length=y),_>1e4)s.transitions=null,b=0,_=0,g.length>0&&(g=[]);else if(g.length>0&&!u){for(let k=0,M=g.length;k<M;k++)g[k][gt]=0;g=[]}},L=y=>{var k=y.length;k<16?w[m++]=144|k:k<65536?(w[m++]=220,w[m++]=k>>8,w[m++]=k&255):(w[m++]=221,Z.setUint32(m,k),m+=4);for(let M=0;M<k;M++)T(y[M])},T=y=>{m>ge&&(w=B(m));var k=typeof y,M;if(k==="string"){let E=y.length;if(se&&E>=4&&E<4096){if((se.size+=E)>tl){let U,W=(se[0]?se[0].length*3+se[1].length:0)+10;m+W>ge&&(w=B(m+W));let G;se.position?(G=se,w[m]=200,m+=3,w[m++]=98,U=m-r,m+=4,xi(r,T,0),Z.setUint16(U+r-3,m-r-U)):(w[m++]=214,w[m++]=98,U=m-r,m+=4),se=["",""],se.previous=G,se.size=0,se.position=U}let K=rl.test(y);se[K?0:1]+=y,w[m++]=193,T(K?-E:E);return}let O;E<32?O=1:E<256?O=2:E<65536?O=3:O=5;let D=E*3;if(m+D>ge&&(w=B(m+D)),E<64||!a){let K,U,W,G=m+O;for(K=0;K<E;K++)U=y.charCodeAt(K),U<128?w[G++]=U:U<2048?(w[G++]=U>>6|192,w[G++]=U&63|128):(U&64512)===55296&&((W=y.charCodeAt(K+1))&64512)===56320?(U=65536+((U&1023)<<10)+(W&1023),K++,w[G++]=U>>18|240,w[G++]=U>>12&63|128,w[G++]=U>>6&63|128,w[G++]=U&63|128):(w[G++]=U>>12|224,w[G++]=U>>6&63|128,w[G++]=U&63|128);M=G-m-O}else M=a(y,m+O);M<32?w[m++]=160|M:M<256?(O<2&&w.copyWithin(m+2,m+1,m+1+M),w[m++]=217,w[m++]=M):M<65536?(O<3&&w.copyWithin(m+3,m+2,m+2+M),w[m++]=218,w[m++]=M>>8,w[m++]=M&255):(O<5&&w.copyWithin(m+5,m+3,m+3+M),w[m++]=219,Z.setUint32(m,M),m+=4),m+=M}else if(k==="number")if(y>>>0===y)y<32||y<128&&this.useRecords===!1||y<64&&!this.randomAccessStructure?w[m++]=y:y<256?(w[m++]=204,w[m++]=y):y<65536?(w[m++]=205,w[m++]=y>>8,w[m++]=y&255):(w[m++]=206,Z.setUint32(m,y),m+=4);else if(y>>0===y)y>=-32?w[m++]=256+y:y>=-128?(w[m++]=208,w[m++]=y+256):y>=-32768?(w[m++]=209,Z.setInt16(m,y),m+=2):(w[m++]=210,Z.setInt32(m,y),m+=4);else{let E;if((E=this.useFloat32)>0&&y<4294967296&&y>=-2147483648){w[m++]=202,Z.setFloat32(m,y);let O;if(E<4||(O=y*Ss[(w[m]&127)<<1|w[m+1]>>7])>>0===O){m+=4;return}else m--}w[m++]=203,Z.setFloat64(m,y),m+=8}else if(k==="object"||k==="function")if(!y)w[m++]=192;else{if(i){let O=i.get(y);if(O){if(!O.id){let D=i.idsToInsert||(i.idsToInsert=[]);O.id=D.push(O)}w[m++]=214,w[m++]=112,Z.setUint32(m,O.id),m+=4;return}else i.set(y,{offset:m-r})}let E=y.constructor;if(E===Object)C(y);else if(E===Array)L(y);else if(E===Map)if(this.mapAsEmptyObject)w[m++]=128;else{M=y.size,M<16?w[m++]=128|M:M<65536?(w[m++]=222,w[m++]=M>>8,w[m++]=M&255):(w[m++]=223,Z.setUint32(m,M),m+=4);for(let[O,D]of y)T(O),T(D)}else{for(let O=0,D=es.length;O<D;O++){let K=Na[O];if(y instanceof K){let U=es[O];if(U.write){U.type&&(w[m++]=212,w[m++]=U.type,w[m++]=0);let ie=U.write.call(this,y);ie===y?Array.isArray(y)?L(y):C(y):T(ie);return}let W=w,G=Z,ae=m;w=null;let ne;try{ne=U.pack.call(this,y,ie=>(w=W,W=null,m+=ie,m>ge&&B(m),{target:w,targetView:Z,position:m-ie}),T)}finally{W&&(w=W,Z=G,m=ae,ge=w.length-10)}ne&&(ne.length+m>ge&&B(ne.length+m),m=nl(ne,w,m,U.type));return}}if(Array.isArray(y))L(y);else{if(y.toJSON){const O=y.toJSON();if(O!==y)return T(O)}if(k==="function")return T(this.writeFunction&&this.writeFunction(y));C(y)}}}else if(k==="boolean")w[m++]=y?195:194;else if(k==="bigint"){if(y<BigInt(1)<<BigInt(63)&&y>=-(BigInt(1)<<BigInt(63)))w[m++]=211,Z.setBigInt64(m,y);else if(y<BigInt(1)<<BigInt(64)&&y>0)w[m++]=207,Z.setBigUint64(m,y);else if(this.largeBigIntToFloat)w[m++]=203,Z.setFloat64(m,Number(y));else if(this.useBigIntExtension&&y<2n**1023n&&y>-(2n**1023n)){w[m++]=199,m++,w[m++]=66;let E=[],O;do{let D=y&0xffn;O=(D&0x80n)===(y<0n?0x80n:0n),E.push(D),y>>=8n}while(!((y===0n||y===-1n)&&O));w[m-2]=E.length;for(let D=E.length;D>0;)w[m++]=Number(E[--D]);return}else throw new RangeError(y+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension or set largeBigIntToFloat to convert to float-64");m+=8}else if(k==="undefined")this.encodeUndefinedAsNil?w[m++]=192:(w[m++]=212,w[m++]=0,w[m++]=0);else throw new Error("Unknown type: "+k)},I=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?y=>{let k;if(this.skipValues){k=[];for(let O in y)(typeof y.hasOwnProperty!="function"||y.hasOwnProperty(O))&&!this.skipValues.includes(y[O])&&k.push(O)}else k=Object.keys(y);let M=k.length;M<16?w[m++]=128|M:M<65536?(w[m++]=222,w[m++]=M>>8,w[m++]=M&255):(w[m++]=223,Z.setUint32(m,M),m+=4);let E;if(this.coercibleKeyAsNumber)for(let O=0;O<M;O++){E=k[O];let D=Number(E);T(isNaN(D)?E:D),T(y[E])}else for(let O=0;O<M;O++)T(E=k[O]),T(y[E])}:y=>{w[m++]=222;let k=m-r;m+=2;let M=0;for(let E in y)(typeof y.hasOwnProperty!="function"||y.hasOwnProperty(E))&&(T(E),T(y[E]),M++);w[k+++r]=M>>8,w[k+r]=M&255},R=this.useRecords===!1?I:e.progressiveRecords&&!f?y=>{let k,M=s.transitions||(s.transitions=Object.create(null)),E=m++-r,O;for(let D in y)if(typeof y.hasOwnProperty!="function"||y.hasOwnProperty(D)){if(k=M[D],k)M=k;else{let K=Object.keys(y),U=M;M=s.transitions;let W=0;for(let G=0,ae=K.length;G<ae;G++){let ne=K[G];k=M[ne],k||(k=M[ne]=Object.create(null),W++),M=k}E+r+1==m?(m--,$(M,K,W)):V(M,K,E,W),O=!0,M=U[D]}T(y[D])}if(!O){let D=M[gt];D?w[E+r]=D:V(M,Object.keys(y),E,0)}}:y=>{let k,M=s.transitions||(s.transitions=Object.create(null)),E=0;for(let D in y)(typeof y.hasOwnProperty!="function"||y.hasOwnProperty(D))&&(k=M[D],k||(k=M[D]=Object.create(null),E++),M=k);let O=M[gt];O?O>=96&&f?(w[m++]=((O-=96)&31)+96,w[m++]=O>>5):w[m++]=O:$(M,M.__keys__||Object.keys(y),E);for(let D in y)(typeof y.hasOwnProperty!="function"||y.hasOwnProperty(D))&&T(y[D])},A=typeof this.useRecords=="function"&&this.useRecords,C=A?y=>{A(y)?R(y):I(y)}:R,B=y=>{let k;if(y>16777216){if(y-r>vi)throw new Error("Packed buffer would be larger than maximum buffer size");k=Math.min(vi,Math.round(Math.max((y-r)*(y>67108864?1.25:2),4194304)/4096)*4096)}else k=(Math.max(y-r<<2,w.length-1)>>12)+1<<12;let M=new Er(k);return Z=M.dataView||(M.dataView=new DataView(M.buffer,0,k)),y=Math.min(y,w.length),w.copy?w.copy(M,0,r,y):M.set(w.slice(r,y)),m-=r,r=0,ge=M.length-10,w=M},$=(y,k,M)=>{let E=s.nextId;E||(E=64),E<d&&this.shouldShareStructure&&!this.shouldShareStructure(k)?(E=s.nextOwnId,E<x||(E=d),s.nextOwnId=E+1):(E>=x&&(E=d),s.nextId=E+1);let O=k.highByte=E>=96&&f?E-96>>5:-1;y[gt]=E,y.__keys__=k,s[E-64]=k,E<d?(k.isShared=!0,s.sharedLength=E-63,n=!0,O>=0?(w[m++]=(E&31)+96,w[m++]=O):w[m++]=E):(O>=0?(w[m++]=213,w[m++]=114,w[m++]=(E&31)+96,w[m++]=O):(w[m++]=212,w[m++]=114,w[m++]=E),M&&(_+=b*M),g.length>=h&&(g.shift()[gt]=0),g.push(y),T(k))},V=(y,k,M,E)=>{let O=w,D=m,K=ge,U=r;w=zt,m=0,r=0,w||(zt=w=new Er(8192)),ge=w.length-10,$(y,k,E),zt=w;let W=m;if(w=O,m=D,ge=K,r=U,W>1){let G=m+W-1;G>ge&&B(G);let ae=M+r;w.copyWithin(ae+W,ae+1,m),w.set(zt.slice(0,W),ae),m=G}else w[M+r]=zt[0]},H=y=>{let k=el(y,w,r,m,s,B,(M,E,O)=>{if(O)return n=!0;m=E;let D=w;return T(M),v(),D!==w?{position:m,targetView:Z,target:w}:m},this);if(k===0)return C(y);m=k}}useBuffer(e){w=e,w.dataView||(w.dataView=new DataView(w.buffer,w.byteOffset,w.byteLength)),m=0}set position(e){m=e}get position(){return m}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}Na=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,Oa];es=[{pack(t,e,r){let n=t.getTime()/1e3;if((this.useTimestamp32||t.getMilliseconds()===0)&&n>=0&&n<4294967296){let{target:s,targetView:i,position:a}=e(6);s[a++]=214,s[a++]=255,i.setUint32(a,n)}else if(n>0&&n<4294967296){let{target:s,targetView:i,position:a}=e(10);s[a++]=215,s[a++]=255,i.setUint32(a,t.getMilliseconds()*4e6+(n/1e3/4294967296>>0)),i.setUint32(a+4,n)}else if(isNaN(n)){if(this.onInvalidDate)return e(0),r(this.onInvalidDate());let{target:s,targetView:i,position:a}=e(3);s[a++]=212,s[a++]=255,s[a++]=255}else{let{target:s,targetView:i,position:a}=e(15);s[a++]=199,s[a++]=12,s[a++]=255,i.setUint32(a,t.getMilliseconds()*1e6),i.setBigInt64(a+4,BigInt(Math.floor(n)))}}},{pack(t,e,r){if(this.setAsEmptyObject)return e(0),r({});let n=Array.from(t),{target:s,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(s[i++]=212,s[i++]=115,s[i++]=0),r(n)}},{pack(t,e,r){let{target:n,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(n[s++]=212,n[s++]=101,n[s++]=0),r([t.name,t.message,t.cause])}},{pack(t,e,r){let{target:n,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(n[s++]=212,n[s++]=120,n[s++]=0),r([t.source,t.flags])}},{pack(t,e){this.moreTypes?bi(t,16,e):wi(sn?Buffer.from(t):new Uint8Array(t),e)}},{pack(t,e){let r=t.constructor;r!==Ua&&this.moreTypes?bi(t,Pa.indexOf(r.name),e):wi(t,e)}},{pack(t,e){let{target:r,position:n}=e(1);r[n]=193}}];function bi(t,e,r,n){let s=t.byteLength;if(s+1<256){var{target:i,position:a}=r(4+s);i[a++]=199,i[a++]=s+1}else if(s+1<65536){var{target:i,position:a}=r(5+s);i[a++]=200,i[a++]=s+1>>8,i[a++]=s+1&255}else{var{target:i,position:a,targetView:o}=r(7+s);i[a++]=201,o.setUint32(a,s+1),a+=4}i[a++]=116,i[a++]=e,t.buffer||(t=new Uint8Array(t)),i.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),a)}function wi(t,e){let r=t.byteLength;var n,s;if(r<256){var{target:n,position:s}=e(r+2);n[s++]=196,n[s++]=r}else if(r<65536){var{target:n,position:s}=e(r+3);n[s++]=197,n[s++]=r>>8,n[s++]=r&255}else{var{target:n,position:s,targetView:i}=e(r+5);n[s++]=198,i.setUint32(s,r),s+=4}n.set(t,s)}function nl(t,e,r,n){let s=t.length;switch(s){case 1:e[r++]=212;break;case 2:e[r++]=213;break;case 4:e[r++]=214;break;case 8:e[r++]=215;break;case 16:e[r++]=216;break;default:s<256?(e[r++]=199,e[r++]=s):s<65536?(e[r++]=200,e[r++]=s>>8,e[r++]=s&255):(e[r++]=201,e[r++]=s>>24,e[r++]=s>>16&255,e[r++]=s>>8&255,e[r++]=s&255)}return e[r++]=n,e.set(t,r),r+=s,r}function sl(t,e){let r,n=e.length*6,s=t.length-n;for(;r=e.pop();){let i=r.offset,a=r.id;t.copyWithin(i+n,i,s),n-=6;let o=i+n;t[o++]=214,t[o++]=105,t[o++]=a>>24,t[o++]=a>>16&255,t[o++]=a>>8&255,t[o++]=a&255,s=i}return t}function xi(t,e,r){if(se.length>0){Z.setUint32(se.position+t,m+r-se.position-t),se.stringsPosition=m-t;let n=se;se=null,e(n[0]),e(n[1])}}function il(t,e){return t.isCompatible=r=>{let n=!r||(e.lastNamedStructuresLength||0)===r.length;return n||e._mergeStructures(r),n},t}let Ka=new za({useRecords:!1});Ka.pack;const Kl=Ka.pack,al=512,ol=1024,ul=2048,Fa=new Array(255);for(let t=0;t<=255;++t){const e=t.toString(16).padStart(2,"0");Fa[t]=e}function ll(t){const e=t.length;let r="";for(let n=0;n<e;++n)r+=Fa[t[n]];return r}function ts(t){return ll(new Uint8Array(t))}const cl=/(@import\s+["']([^"']+)["']|url\((?!['"]?(?:data):)['"]?([^'"\)]+)['"]?\))/gi;async function hl(t){if(j.embeddedCSSMap.has(t))return j.embeddedCSSMap.get(t);const e=await fetch(t,{mode:"no-cors",headers:{accept:"text/css"}}),r=await Rs(t,await e.text());return j.embeddedCSSMap.set(t,r),j.embeddedCSSMap.get(t)}async function Rs(t,e){const r=[];e=e.replaceAll(":hover",j.attributeCSS(j.HOVER_ATTRIBUTE)),e=e.replaceAll(":active",j.attributeCSS(j.ACTIVE_ATTRIBUTE)),e=e.replaceAll(":focus",j.attributeCSS(j.FOCUS_ATTRIBUTE)),e=e.replaceAll(":target",j.attributeCSS(j.TARGET_ATTRIBUTE));const n=e.matchAll(cl);for(const s of n){const a=!!s[2]?"type/css":void 0,o=s[2]||s[3];r.push(ja(new URL(o,t).href,a).then(u=>{e=e.replace(o,u)}))}return await Promise.all(r),e}async function ja(t,e){if(t.startsWith("data"))return t;if(j.dataURLMap.has(t))return j.dataURLMap.get(t);const r=new Promise(async n=>{const s=await fetch(t,e?{headers:{accept:e}}:void 0),i=s.headers.get("content-type");if(i=="text/css"){const a=await Rs(t,await s.text());j.embeddedCSSMap.set(t,a),n("data:"+i+";base64,"+window.btoa(a))}else{const a=new Uint8Array(await s.arrayBuffer());n("data:"+i+";base64,"+j.arrayBufferToBase64(a))}});return j.dataURLMap.set(t,r),r}function fl(t){return t.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F]/g,"")}function $a(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function dl(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Rt(t,e){return" "+t+'="'+$a(e)+'"'}function pl(t,e){return!t.hasAttribute("xmlns")&&(e||t.namespaceURI!==t.parentElement.namespaceURI)?' xmlns="'+t.namespaceURI+'"':""}async function qa(t,e){let r=[];for(const n of t.childNodes)r.push(Va(n,e));return Promise.all(r).then(n=>n.join(""))}async function ml(t,e){const r=t.tagName.toLowerCase();let n="<"+r;n+=pl(t,e.depth===0);const s=qa(t,e);for(const i of t.attributes)i.name==="src"?t.nodeName==="IMG"?n+=Rt(i.name,await ja(i.value)):n+=Rt("data-src",i.value):n+=Rt(i.name,i.value);return t.childNodes.length>0?(e.depth++,n+=">",n+=await s,n+="</"+r+">",e.depth--):n+="/>",n}function yl(t){const e=t.nodeValue||"";return dl(e)}function gl(t){return"<![CDATA["+t.nodeValue+"]]>"}async function Va(t,e){var n;const r=(n=e.replacer)==null?void 0:n.call(e,e.target,t);if(typeof r=="string")return r;if(t.nodeName==="#document"||t.nodeName==="#document-fragment")return qa(t,e);if(t.tagName)return ml(t,e);if(t.nodeName==="#text")return yl(t);if(t.nodeName!=="#comment"){if(t.nodeName==="#cdata-section")return gl(t)}return""}async function vl(t,e=bl){return fl(await Va(t,{depth:0,target:t,replacer:e}))}const bl=(t,e)=>{var o;if(t===e||e.nodeType!==Node.ELEMENT_NODE)return;const r=e,n=(o=r.tagName)==null?void 0:o.toLowerCase(),s=getComputedStyle(r),i=s.display==="inline"||s.display==="inline-block";if(n==="style"||n==="link")return"";if(i)return;const a=j.layers.get(r);if(a){a.manager.updateDOMMetrics(a);const u=a.domMetrics.bounds;let l="";const c=`box-sizing:border-box;max-width:${u.width}px;max-height:${u.height}px;min-width:${u.width}px;min-height:${u.height}px;visibility:hidden`;let h=!1;for(const d of a.element.attributes)d.name!=="src"&&(d.name=="style"?(l+=Rt(d.name,d.value+";"+c),h=!0):l+=Rt(d.name,d.value));h||(l+=Rt("style",c));const f=r.tagName.toLowerCase();return`<${f} ${l}></${f}>`}};function wl(t,e,r,n,s){const i=[],a=[];t.manager.updateDOMMetrics(t);const o=t.domMetrics;let u=t.element.parentElement;u||(u=document.documentElement);do{let l=u.tagName.toLowerCase(),c=" ",h="";for(const x of u.attributes){const g=$a(x.value);if(x.name==="style"){h=g;continue}c+=`${x.name}="${g}" `}const f="<"+l+(l==="html"?` ${j.RENDERING_DOCUMENT_ATTRIBUTE}="" xmlns="http://www.w3.org/1999/xhtml"
                    style="${xl(n/e,s/r)} --x-width:${o.bounds.width}px; --x-height:${o.bounds.height}px; ${h} width:${e}px; height:${r}px;" `:` style="${h}" ${j.RENDERING_PARENT_ATTRIBUTE}="" `)+c+" >";i.unshift(f);const d="</"+l+">";if(a.push(d),l=="html")break}while(u=u!==document.documentElement?u.parentElement||document.documentElement:null);return[i.join(""),a.join("")]}function xl(t,e){if(_l.test(navigator.userAgent)){const n=Math.max(t,e);return`zoom:${n}; transform: scale(${t/n},${e/n}); transform-origin: top left; `}return`transform: scale(${t},${e}); transform-origin: top left; `}const _l=/^((?!chrome|android).)*safari/i;async function El(t){const e=t.getRootNode(),r=j.embeddedStyles,n=Array.from(e.querySelectorAll("style, link[type='text/css'], link[rel='stylesheet']")),s=t.getRootNode()instanceof ShadowRoot,i=[];for(const a of n)r.has(a)||r.set(a,new Promise(o=>{a.tagName.toLowerCase()==="style"?o(Rs(window.location.href,a.textContent||"")):o(hl(a.href))}).then(async o=>{const u=RegExp(/@font-face[^{]*{([^{}]|{[^{}]*})*}/gi),l=o.match(u);if(s&&l)for(const h of l){if(j.fontStyles.has(h))continue;const f=document.createElement("style");f.innerHTML=h,document.head.appendChild(f),j.fontStyles.set(h,f),r.set(f,Promise.resolve({serialized:"",hash:""}))}const c=await crypto.subtle.digest("SHA-1",j.textEncoder.encode(o));return{serialized:o,hash:ts(c)}})),i.push(r.get(a));return Promise.all(i)}const Tl=(t,e=!0,r={})=>{const n=`globalThis.process = ${JSON.stringify(process)};
`.concat(e?`import '${t}';`:`importScripts('${t}')`),s=new Blob([n],{type:"text/javascript"}),i=URL.createObjectURL(s);return new Worker(i,{type:e?"module":"classic",...r})};class Sl{constructor(e=4){S(this,"limit");S(this,"queue",[]);S(this,"workers",[]);S(this,"workersResolve",[]);S(this,"workerStatus",0);S(this,"workerCreator");this.limit=e}_initWorker(e){if(!this.workers[e]){const r=this.workerCreator();r.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=r}}_getIdleWorker(){for(let e=0;e<this.limit;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,r){const n=this.workersResolve[e];if(n&&n(r),this.queue.length){const{resolve:s,msg:i,transfer:a}=this.queue.shift();this.workersResolve[e]=s,this.workers[e].postMessage(i,a)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.limit=e}postMessage(e,r){return new Promise(n=>{const s=this._getIdleWorker();s!==-1?(this._initWorker(s),this.workerStatus|=1<<s,this.workersResolve[s]=n,this.workers[s].postMessage(e,r)):this.queue.push({resolve:n,msg:e,transfer:r})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const Rl=new URL(""+new URL("KTX2Worker.bundle-DzNm2plw.js",import.meta.url).href,import.meta.url).href;var Ha=(t=>(t[t.UASTCLevelFastest=0]="UASTCLevelFastest",t[t.UASTCLevelFaster=1]="UASTCLevelFaster",t[t.UASTCLevelDefault=2]="UASTCLevelDefault",t[t.UASTCLevelSlower=3]="UASTCLevelSlower",t[t.UASTCLevelVerySlow=4]="UASTCLevelVerySlow",t[t.UASTCLevelMask=15]="UASTCLevelMask",t[t.UASTCFavorUASTCError=8]="UASTCFavorUASTCError",t[t.UASTCFavorBC7Error=16]="UASTCFavorBC7Error",t[t.UASTCETC1FasterHints=64]="UASTCETC1FasterHints",t[t.UASTCETC1FastestHints=128]="UASTCETC1FastestHints",t[t.UASTCETC1DisableFlipAndIndividual=256]="UASTCETC1DisableFlipAndIndividual",t[t.UASTCFavorSimplerModes=512]="UASTCFavorSimplerModes",t))(Ha||{});class kl{constructor(){S(this,"pool",new Sl(1));this.pool.setWorkerCreator(()=>Tl(Rl,!1,{name:"KTX2 Encoder"}))}setWorkerLimit(e){this.pool.setWorkerLimit(e)}async encode(e,r){const n=await this.pool.postMessage({image:e,options:r},[e.data.buffer]);if(n.data.error)throw new Error(n.data.error);if(!n.data.texture||n.data.texture.byteLength===0)throw new Error("Encoding failed");return n.data.texture}}const Ol=new Yr;class Al extends ct{constructor(r){super(r);S(this,"states");S(this,"textures");this.version(3).stores({states:"&hash",textures:"&hash, timestamp"})}}function Ll(t){return 1<<31-Math.clz32(t)}function _i(t){return Ll((t-1)*2)}class Ml{constructor(e="ethereal-web-store"){S(this,"MINIMUM_RENDER_ATTEMPTS",3);S(this,"MAX_SERIALIZE_TASK_COUNT",10);S(this,"MAX_RASTERIZE_TASK_COUNT",5);S(this,"tasksPending",!1);S(this,"serializePendingCount",0);S(this,"rasterizePendingCount",0);S(this,"WebRenderer",j);S(this,"autosave",!0);S(this,"autosaveDelay",10*1e3);S(this,"_autosaveTimer");S(this,"pixelsPerMeter",1e3);S(this,"store");S(this,"serializeQueue",[]);S(this,"rasterizeQueue",[]);S(this,"optimizeQueue",[]);S(this,"ktx2Encoder",new kl);S(this,"_unsavedTextureData",new Map);S(this,"_stateData",new Map);S(this,"_textureData",new Map);S(this,"_imagePool",[]);S(this,"_packr",new za({structuredClone:!0}));S(this,"_unpackr",new At({structuredClone:!0}));S(this,"_statesRequestedFromStore",new Set);S(this,"_texturesRequestedFromStore",new Set);S(this,"_runTasks",()=>{const e=this.serializeQueue,r=this.rasterizeQueue;for(;e.length>0&&this.serializePendingCount<this.MAX_SERIALIZE_TASK_COUNT;){this.serializePendingCount++;const{layer:n,resolve:s}=e.shift();this.serialize(n).then(i=>{this.serializePendingCount--,s(i)})}for(;r.length>0&&this.rasterizePendingCount<this.MAX_RASTERIZE_TASK_COUNT;){this.rasterizePendingCount++;const{hash:n,svgUrl:s,resolve:i}=r.shift();this.rasterize(n,s).finally(()=>{this.rasterizePendingCount--,i(void 0),this._autosaveTimer&&clearTimeout(this._autosaveTimer),this.autosave&&this._unsavedTextureData.size&&(this._autosaveTimer=setTimeout(()=>{this.saveStore()},this.autosaveDelay/this._unsavedTextureData.size))})}this.tasksPending=!1});S(this,"prerasterized",!1);this.store=new Al(e)}get pixelPerUnit(){return this.pixelsPerMeter}saveStore(){const e=Array.from(this._stateData.entries()).filter(([n,s])=>typeof n=="string").map(([n,s])=>{var i;return{hash:n,textureHash:(i=s.texture)==null?void 0:i.hash}}),r=Array.from(this._unsavedTextureData.values());return this._unsavedTextureData.clear(),this.loadIntoStore({stateData:e,textureData:r})}async importCache(e){try{const n=await(await fetch(e)).arrayBuffer(),s=await new Promise((a,o)=>{Fs(new Uint8Array(n),{consume:!0},(u,l)=>{if(u)return o(u);a(l)})}),i=this._unpackr.unpack(s);return i.textureData=i.textureData.filter(a=>a&&a.hash&&a.texture),console.log(`Importing weblayer cache data from ${e} with `+i.stateData.length+" states and "+i.textureData.length+" textures"),console.log(i),this.loadIntoStore(i)}catch(r){console.warn("Failed to import cache",r)}}getActiveStateHashes(){return Array.from(this._stateData.keys()).filter(e=>typeof e=="string")}async exportCache(e=this.getActiveStateHashes()){const r=await this.store.states.bulkGet(e);let n=await this.store.textures.bulkGet(r.map(a=>a.textureHash).filter(a=>typeof a=="string"));n=n.filter(a=>a&&typeof a.hash=="string"&&a.texture);const s={stateData:r,textureData:n},i=this._packr.pack(s);return new Promise((a,o)=>{Ns(i,{consume:!0},(u,l)=>{if(u)return o(u);a(new Blob([l.buffer]))})})}async downloadCache(){await this.saveStore();const e=await this.exportCache(),r=location.pathname.split("/").filter(n=>n);qi(e,"web."+location.host+"."+(r[r.length-1]??"")+".cache")}async loadIntoStore(e){for(const r of e.textureData){const n=this._textureData.get(r.hash)||{hash:r.hash,canvas:void 0,ktx2Url:void 0};!n.ktx2Url&&r.texture&&(n.ktx2Url=URL.createObjectURL(new Blob([r.texture],{type:"image/ktx2"})))}for(const r of e.stateData){const n=this.getLayerState(r.hash);if(!n.texture&&r.textureHash){const s=this._textureData.get(r.textureHash);n.texture=s}}return Promise.all([this.store.states.bulkPut(e.stateData),this.store.textures.bulkPut(e.textureData)])}getLayerState(e){let r=this._stateData.get(e);return r||(r={cssTransform:void 0,bounds:new ir,margin:new it,padding:new it,border:new it,fullWidth:0,fullHeight:0,renderAttempts:0,textureWidth:32,textureHeight:32,pixelRatio:1,texture:void 0,pseudo:{hover:!1,active:!1,focus:!1,target:!1}},this._stateData.set(e,r)),r}getTextureState(e){let r=this._textureData.get(e);return r||(r={hash:e,canvas:void 0,ktx2Url:void 0},this._textureData.set(e,r)),r}async requestStoredData(e){const r=this.getLayerState(e);if(typeof e!="string")return r;if(!this._statesRequestedFromStore.has(e)){this._statesRequestedFromStore.add(e);const s=await this.store.states.get(e);s!=null&&s.textureHash&&(r.texture=this.getTextureState(s.textureHash))}const n=r.texture;if(n&&n.hash&&!n.canvas&&!n.ktx2Url&&!this._texturesRequestedFromStore.has(n==null?void 0:n.hash)){this._texturesRequestedFromStore.add(n.hash);const s=await this.store.textures.get(n.hash);if(s!=null&&s.texture&&!n.canvas){const i=await new Promise((a,o)=>{Fs(s.texture,{consume:!0},(u,l)=>{if(u)return o(u);a(l)})});n.canvas||(n.ktx2Url=URL.createObjectURL(new Blob([i.buffer],{type:"image/ktx2"})))}}return r}async compressTexture(e){const r=this._textureData.get(e),n=r==null?void 0:r.canvas;if(!n)throw new Error("Missing texture canvas");if(this.ktx2Encoder.pool.limit===0)return;const s=this.getImageData(n);let i;try{i=await this.ktx2Encoder.encode(s,{srgb:!0,uastc:!0,uastcFlags:Ha.UASTCLevelFastest})}catch(u){console.error(`KTX2 encoding failed for image (${n.width}, ${n.height}) `,u),this.ktx2Encoder.pool.dispose();return}const a=this._unsavedTextureData.get(e)||{hash:e,timestamp:Date.now(),texture:void 0};r.ktx2Url=URL.createObjectURL(new Blob([i],{type:"image/ktx2"}));const o=await new Promise((u,l)=>{Ns(new Uint8Array(i),{consume:!0},(c,h)=>{if(c)return l(c);u(h)})});a.texture=o,this._unsavedTextureData.set(e,a)}scheduleTasksIfNeeded(){this.tasksPending||this.serializeQueue.length===0&&this.rasterizeQueue.length===0||(this.tasksPending=!0,setTimeout(this._runTasks,1))}addToSerializeQueue(e){const r=this.serializeQueue.find(i=>i.layer===e);if(r)return r.promise;let n;const s=new Promise(i=>{n=i});return this.serializeQueue.push({layer:e,resolve:n,promise:s}),s}updateDOMMetrics(e){var n;const r=e.domMetrics;us(e.element,r.bounds,(n=e.parentLayer)==null?void 0:n.element),Eo(e.element,r.margin),So(e.element,r.padding),To(e.element,r.border)}async serialize(e){var A;this.updateDOMMetrics(e);const r=e.element,n=e.domMetrics,{top:s,left:i,width:a,height:o}=n.bounds,{top:u,left:l,bottom:c,right:h}=n.margin,f=a+Math.max(l,0)+Math.max(h,0),d=o+Math.max(u,0)+Math.max(c,0),x=e.computedPixelRatio,g=Math.max(_i(f*x),32),_=Math.max(_i(d*x),32),b={};let v;const L=getComputedStyle(r),T=L.transform;let I=null;if(T&&T!=="none"){const C=1/this.pixelsPerMeter;I=Lo(L,a,o,C,Ol)}if(e.isMediaElement)b.stateKey=r;else{const C=j.attributeHTML(j.LAYER_ATTRIBUTE,""),B=L.display==="inline";j.updateInputAttributes(r);const $=wl(e,f,d,g,_),V=await El(r);let H=await vl(r);H=H.replace(C,`${C} ${j.RENDERING_ATTRIBUTE}="" ${B?`${j.RENDERING_INLINE_ATTRIBUTE}="" `:" "} `+j.getPsuedoAttributes(e.desiredPseudoState));const y=[...V.map(E=>E.hash),$[0],H,$[1]].join(`
`),k=await crypto.subtle.digest("SHA-1",j.textEncoder.encode(y)),M=ts(k)+"?w="+f+";h="+d+";tw="+g+";th="+_;b.stateKey=M,v='<svg width="'+g+'" height="'+_+`" xmlns="http://www.w3.org/2000/svg"><defs><style type="text/css"><![CDATA[
`+V.map(E=>E.serialized).join(`
`)+']]></style></defs><foreignObject x="0" y="0" width="'+g+'" height="'+_+'">'+$[0]+H+$[1]+"</foreignObject></svg>"}const R=await this.requestStoredData(b.stateKey);return R.cssTransform=I==null?void 0:I.clone(),R.bounds.left=i,R.bounds.top=s,R.bounds.width=a,R.bounds.height=o,R.margin.left=l,R.margin.top=u,R.margin.right=h,R.margin.bottom=c,R.fullWidth=f,R.fullHeight=d,R.pixelRatio=x,R.textureWidth=g,R.textureHeight=_,e.desiredDOMStateKey=b.stateKey,typeof b.stateKey=="string"&&e.allStateHashes.add(b.stateKey),b.needsRasterize=!e.isMediaElement&&f*d>0&&!((A=R.texture)!=null&&A.hash),b.svgUrl=b.needsRasterize&&v?"data:image/svg+xml;utf8,"+encodeURIComponent(v):void 0,e.lastSVGUrl=b.svgUrl,b}async rasterize(e,r){var v;const n=this.getLayerState(e),s=this._imagePool.pop()||new Image,{fullWidth:i,fullHeight:a,textureWidth:o,textureHeight:u,pixelRatio:l}=n;if(await new Promise((L,T)=>{s.onload=()=>{L()},s.onerror=I=>{T(I)},s.width=o,s.height=u,s.src=r}),!s.complete||s.currentSrc!==r)throw new Error("Rasterization Failed");await s.decode();const c=i*l,h=a*l,f=await this.rasterizeToCanvas(s,c,h,30,30),d=this.getImageData(f),x=await crypto.subtle.digest("SHA-1",d.data),g=ts(x)+"?w="+o+";h="+u;((v=n.texture)==null?void 0:v.hash)!==g&&(n.renderAttempts=0),n.renderAttempts++,n.texture=this.getTextureState(g);const b=n.texture.canvas||n.texture.ktx2Url;if(!(n.renderAttempts>this.MINIMUM_RENDER_ATTEMPTS&&b)&&(setTimeout(()=>this.addToRasterizeQueue(e,r),(500+.1*1e3)*2^n.renderAttempts),!n.texture.canvas)){n.texture.canvas=await this.rasterizeToCanvas(s,c,h,o,u);try{await this.compressTexture(g)}finally{this._imagePool.push(s)}}}async rasterizeToCanvas(e,r,n,s,i,a){a=a||document.createElement("canvas"),a.width=s,a.height=i;const o=a.getContext("2d");return o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high",o.drawImage(e,0,0,s,i),a}getImageData(e){return e.getContext("2d").getImageData(0,0,e.width,e.height)}addToRasterizeQueue(e,r){const n=this.rasterizeQueue.find(a=>a.hash===e);if(n)return n.promise;let s;const i=new Promise(a=>{s=a});return this.rasterizeQueue.push({hash:e,svgUrl:r,resolve:s,promise:i}),i}optimizeImageData(e){}addToOptimizeQueue(e){}}const Ge=class Ge extends Ml{constructor(){super(...arguments);S(this,"renderer");S(this,"textureEncoding",ro);S(this,"ktx2Loader");S(this,"texturesByHash",new Map);S(this,"layersByElement",new WeakMap);S(this,"layersByMesh",new WeakMap);S(this,"_compressedTexturePromise",new Map);S(this,"_canvasTexturePromise",new Map)}static initialize(r,n){Ge.instance=new Ge,Ge.instance.renderer=r,Ge.instance.ktx2Loader=n,Ge.instance.ktx2Encoder.setWorkerLimit(1)}getTexture(r){const n=this.getTextureState(r);return this.texturesByHash.has(r)||this.texturesByHash.set(r,{}),this._loadCompressedTextureIfNecessary(n),this._loadCanvasTextureIfNecessary(n),this.texturesByHash.get(r)}_loadCompressedTextureIfNecessary(r){const n=r.ktx2Url;n&&(this._compressedTexturePromise.has(r.hash)||new Promise(s=>{this._compressedTexturePromise.set(r.hash,s),this.ktx2Loader.load(n,i=>{i.wrapS=xt,i.wrapT=xt,i.minFilter=Bs,i.colorSpace=this.textureEncoding,this.texturesByHash.get(r.hash).compressedTexture=i,s(void 0)},()=>{},s)}))}_loadCanvasTextureIfNecessary(r){var i;const n=this.texturesByHash.get(r.hash);if(n.compressedTexture){(i=n.canvasTexture)==null||i.dispose(),n.canvasTexture=void 0;return}const s=r.canvas;if(s&&!n.canvasTexture&&!n.compressedTexture){const a=new Si(s);a.wrapS=xt,a.wrapT=xt,a.minFilter=Bs,a.colorSpace=this.textureEncoding,a.flipY=!1,n.canvasTexture=a}}};S(Ge,"instance");let rs=Ge;const Ei=new Qr,Ti=new Qr,Cl=new ir;class Fl extends Tr{constructor(r,n={}){super();S(this,"containerElement");S(this,"options");S(this,"rootLayer");S(this,"raycaster",new no);S(this,"_interactionRays",[]);S(this,"_hitIntersections",[]);S(this,"_previousHoverLayers",new Set);S(this,"_contentMeshes",[]);S(this,"_prepareHitTest",r=>{r.desiredPseudoStates.hover&&this._previousHoverLayers.add(r),r.cursor.visible=!1,r.desiredPseudoStates.hover=!1,r.contentMesh.visible&&this._contentMeshes.push(r.contentMesh)});n.manager||(n.manager=rs.instance),this.options=n;const s=typeof r=="string"?ko(r):r;this.containerElement=j.createLayerTree(s,n,(i,{target:a})=>{var o,u,l,c;if(i==="layercreated"){const h=a.layer||new Sn(a,this);a===s?(h[Tn]=()=>this._updateInteractions(),this.rootLayer=h,this.add(h)):(o=h.parentWebLayer)==null||o.add(h),(l=(u=this.options).onLayerCreate)==null||l.call(u,h)}else if(i==="layermoved"){const h=this.options.manager.layersByElement.get(a);(c=h.parentWebLayer)==null||c.add(h)}}),this.containerElement.container=this,this.refresh(),this.update()}get manager(){return this.options.manager}get interactionRays(){return this._interactionRays}set interactionRays(r){this._interactionRays=r}async updateUntilReady(){const r=setInterval(()=>{this.update()},20);this.rootLayer.setNeedsRefresh(!0),await this.rootLayer.refresh(!0),clearInterval(r)}update(){this.rootLayer.update(!0)}refresh(){this.rootLayer.refresh(!0)}querySelector(r){return this.rootLayer.querySelector(r)}get contentMesh(){return this.rootLayer.contentMesh}_intersectionSort(r,n){const s=r.object.parent,i=n.object.parent;return s.depth!==i.depth?i.depth-s.depth:i.index-s.index}_updateInteractions(){const r=this._previousHoverLayers;r.clear(),this._contentMeshes.length=0,this.rootLayer.traverseLayersPreOrder(this._prepareHitTest);for(const n of this._interactionRays){"isObject3D"in n&&n.isObject3D?this.raycaster.ray.set(n.getWorldPosition(Ei),n.getWorldDirection(Ti).negate()):this.raycaster.ray.copy(n),this._hitIntersections.length=0;const s=this.raycaster.intersectObjects(this._contentMeshes,!1,this._hitIntersections);s.sort(this._intersectionSort);const i=s[0];if(i){const a=i.object.parent;a.cursor.position.copy(i.point),a.cursor.visible=!0,a.desiredPseudoStates.hover=!0,r.has(a)||a.setNeedsRefresh()}}for(const n of r)n.desiredPseudoStates.hover||n.setNeedsRefresh()}hitTest(r){const n=this.raycaster,s=this._hitIntersections,i=this.options.manager.layersByMesh;"isObject3D"in r&&r.isObject3D?this.raycaster.ray.set(r.getWorldPosition(Ei),r.getWorldDirection(Ti).negate()):this.raycaster.ray.copy(r),s.length=0,n.intersectObject(this,!0,s),s.sort(this._intersectionSort);for(const a of s){const o=i.get(a.object);if(!o)continue;const u=o.bounds,l=o.margin,c=u.width+l.left+l.right,h=u.height+l.top+l.bottom;if(c*h===0)continue;let f=o.element;const d=a.uv.x*c-l.left,x=a.uv.y*h-l.top;return Fr(o.element,g=>{if(!f.contains(g))return!1;const _=us(g,Cl,o.element),{left:b,top:v,width:L,height:T}=_,I=b+L,R=v+T;return d>b&&d<I&&x>v&&x<R?(f=g,!0):!1}),{layer:o,intersection:a,target:f}}}destroy(){this.containerElement.remove(),this.removeFromParent(),this.rootLayer.dispose()}async downloadCache(r){await this.manager.saveStore();const n=new Set;this.rootLayer.traverseLayersPreOrder(i=>{if(!(r&&!r(i)))for(const a of i.allStateHashes)n.add(a)});const s=await this.manager.exportCache(Array.from(n));qi(s,"web."+this.rootLayer.element.id+".cache")}}export{ir as B,kl as K,Ha as U,Sl as W,Ul as a,Nl as b,rs as c,zl as d,Kl as e,Fl as f,us as g,bo as s,Ks as u};
