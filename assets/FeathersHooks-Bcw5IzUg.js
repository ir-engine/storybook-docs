import{r as h,R as k}from"./index-DPzuYzxM.js";import{u as P,N as f,g as y,d as E,f as M,e as F,a as b}from"./WebRTCTransportFunctions-mB_FREj1.js";import{j as I}from"./UUIDComponent-GqVY2Xw8.js";const K="login-token",U="user-api-key",X="generate-token",Y="identity-provider",z="avatar",B="magic-link",G="user-avatar",V="login",W="user",Z="accept-invite",Q="invite-code-lookup",N="invite",tt="recording",et="static-resource",st="feature-flag-setting",at="logs-api",rt="upload-asset",nt="engine-setting",q={instance:null},g=E({name:"ee.engine.FeathersState",initial:()=>({}),reactor:()=>{const e=F(g);return k.createElement(k.Fragment,null,e.keys.map(t=>k.createElement(L,{key:t,serviceName:t})))}}),L=e=>{const t=()=>{const s=b(g);for(const r in s[e.serviceName])s[e.serviceName][r].refs>0&&s[e.serviceName][r].fetch()};return j(e.serviceName,t),null},O=(e,t,...s)=>{const r=h.useRef();r.current=()=>{var S;const c=y(g)[e][n];if(c.merge({status:"pending",requestTime:Date.now(),error:""}),M){const d={stack:""};(S=Error.captureStackTrace)==null||S.call(Error,d,a);const A=d.stack.split(`
`);A.shift(),c.merge({$stack:A})}return q.instance.service(e)[t](...s).then(d=>{c.merge({response:d,status:"success",error:"",resolvedTime:Date.now()})}).catch(d=>{console.error(`Error in service: ${e}, method: ${t}, args: ${JSON.stringify(s)}`,d),c.merge({status:"error",error:d.message,resolvedTime:Date.now()})})};const a=h.useCallback(()=>{var c;(c=r.current)==null||c.call(r)},[r]),i={serviceName:e,method:t,args:s},n=`${t.substring(0,1)}:${D(i)}`,o=y(g);o.get(f)[e]||o[e].set({}),o.get(f)[e][n]||(o[e].merge({[n]:{fetch:a,query:i,refs:0,response:null,status:"pending",requestTime:0,resolvedTime:null,error:""}}),a()),I(()=>{const c=y(g)[e][n];return c.get(f).error&&(c.merge({fetch:a,query:i,response:null,status:"pending",error:""}),a()),c.refs.set(c.refs.value+1),()=>{c.refs.set(c.refs.value-1)}},[n]);const l=P(y(g)[e][n]).get(f),p=l.response,m=l.error,u=l.status;return h.useMemo(()=>({data:p,status:u,error:m,refetch:a}),[p,u,m,a])},ot=(e,t={})=>{var o,l;const s=_(t.query);let r;((o=t.query)==null?void 0:o.paginate)===!1||((l=t.query)==null?void 0:l.$paginate)===!1?r={...t,query:{...t.query}}:r={...t,query:{...t.query,...s.query}};const a=O(e,"find",r),i=a!=null&&a.data?Array.isArray(a.data)?a.data:a.data.data?a.data.data:a.data:[],n=a!=null&&a.data&&!Array.isArray(a.data)?a.data.total:0;return{...a,total:n,setSort:s.setSort,setLimit:s.setLimit,setPage:s.setPage,search:s.search,page:s.page,skip:s.query.$skip,limit:s.query.$limit,sort:s.query.$sort,data:i}},$=e=>{const t=b(g);if(t[e])for(const s in t[e])t[e][s].fetch()},R=({serviceName:e,item:t})=>{$(e)},C=({serviceName:e,item:t})=>{$(e)},w=({serviceName:e,item:t})=>{$(e)};function it(e,t=!0){const s=P({status:"idle",data:null,error:null}),r=v("create",t?R:void 0,e,s),a=v("update",t?C:void 0,e,s),i=v("patch",t?C:void 0,e,s),n=v("remove",t?w:void 0,e,s);return h.useMemo(()=>({create:r,update:a,patch:i,remove:n,data:s.data.value,status:s.status.value,error:s.value.error}),[r,a,i,n,s])}function v(e,t,s,r){return h.useCallback((...a)=>{const i=q.instance.service(s);return r.merge({status:"loading",loading:!0,data:null,error:null}),i[e](...a).then(n=>(t&&t({serviceName:s,item:n}),r.merge({status:"success",loading:!1,data:n}),n)).catch(n=>{throw r.merge({status:"error",loading:!1,error:n}),n})},[s,e,t])}function D(e){let t=0;const s=JSON.stringify(e);for(let r=0;r<s.length;r++){const a=s.charCodeAt(r);t=(t<<5)-t+a,t=t&t}return t}function j(e,t){h.useLayoutEffect(()=>{const s=q.instance.service(e),r=o=>t(o,"created"),a=o=>t(o,"updated"),i=o=>t(o,"patched"),n=o=>t(o,"removed");return s.on("created",r),s.on("updated",a),s.on("patched",i),s.on("removed",n),()=>{s.off("created",r),s.off("updated",a),s.off("patched",i),s.off("removed",n)}},[e])}function T(e){return{$skip:e.$skip??0,$limit:e.$limit??10,$sort:e.$sort??{}}}function _(e={}){const t=P(T(e)),s=t.get(f),r=P({stored:!1,query:s}),a=u=>{t.$sort.set(u)},i=u=>{t.$limit.set(u)},n=u=>{t.$skip.set(u*t.$limit.value)},o=()=>{t.set(T(e))},l=()=>{r.stored.value||(r.set({stored:!0,query:structuredClone(s)}),o())},p=()=>{r.stored.value&&(t.set(structuredClone(r.get(f).query)),r.merge({stored:!1}))},m=u=>{u?(l(),t.merge(u)):p()};return{query:s,page:Math.floor(t.$skip.value/t.$limit.value),setSort:a,setLimit:i,setPage:n,search:m}}export{q as A,N as a,Z as b,Q as c,W as d,G as e,st as f,K as g,U as h,Y as i,V as j,X as k,at as l,B as m,z as n,rt as o,it as p,nt as q,tt as r,et as s,ot as u};
