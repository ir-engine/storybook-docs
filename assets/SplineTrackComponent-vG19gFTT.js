import{r as b}from"./index-CBqU2yxZ.js";import{E as k,V as q,k as B,Q as _}from"./three.module-D2RMN07C.js";import{c as w,S as n,e as F,f as P,n as Q,U as h,o as m,E as z,b as f}from"./index-_wFD3GG2.js";import{g as x}from"./ActionFunctions-CxzuxLxN.js";import{x as M,y as N,z as y,p as V}from"./EditorServices-BJKHmurs.js";import{S as C}from"./SplineComponent-B7IoO90d.js";const r=new k,S=new _,I=new q,j=w({name:"SplineTrackComponent",jsonID:"EE_spline_track",schema:n.Object({alpha:n.Number(0),splineEntityUUID:n.Nullable(n.EntityUUID()),velocity:n.Number(1),enableRotation:n.Bool(!1),lockToXZPlane:n.Bool(!0),loop:n.Bool(!0)}),reactor:function(R){const p=F(),e=P(p,j);return Q(()=>{const{isEditor:s}=x(N),{deltaSeconds:i}=x(z);if(s||!e.splineEntityUUID.value)return;const c=h.getEntityByUUID(e.splineEntityUUID.value);if(!c)return;const l=m(c,C);if(!l)return;const t=m(p,y);if(!t)return;const a=l.elements;if(a.length<1)return;if(Math.floor(e.alpha.value)>a.length-1){if(!e.loop.value)return;e.alpha.set(0)}e.alpha.set(T=>T+i*e.velocity.value/l.curve.getLength());const u=e.alpha.value,o=Math.floor(e.alpha.value),E=o+1>a.length-1?0:o+1;if(!e.loop.value&&o>E)return;const d=f(c,y);l.curve.getPointAt(u-o,I),t.position.copy(I);const v=a[o].quaternion,U=a[E].quaternion;e.enableRotation.value&&(e.lockToXZPlane.value?(r.setFromQuaternion(v),r.z=0,t.rotation.setFromEuler(r),r.setFromQuaternion(U),r.z=0,S.setFromEuler(r),t.rotation.fastSlerp(S,u-o)):t.rotation.copy(v).fastSlerp(U,u-o)),t.matrix.compose(t.position,t.rotation,t.scale),t.matrix.premultiply(d.matrix),t.matrix.decompose(t.position,t.rotation,t.scale);const g=f(p,V).parentEntity;if(!g)return;const D=f(g,y);t.matrix.premultiply(O.copy(D.matrixWorld).invert()).decompose(t.position,t.rotation,t.scale)},{before:M}),b.useEffect(()=>{if(!e.splineEntityUUID.value)return;const s=h.getEntityByUUID(e.splineEntityUUID.value);if(!s)return;const i=m(s,C);i&&(i.curve.closed=e.loop.value)},[e.loop]),null}}),O=new B;export{j as S};
