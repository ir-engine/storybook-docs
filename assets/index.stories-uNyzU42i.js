var gt=Object.defineProperty;var ht=(n,e,t)=>e in n?gt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var _e=(n,e,t)=>(ht(n,typeof e!="symbol"?e+"":e,t),t);import{r as z,R as E}from"./index-CBqU2yxZ.js";import{k as U,n as vt,V as i,o as Ze,B as xt,Q as A,an as St,F as re,ak as Et,G as Ne,ao as wt,E as Ct}from"./three.module-D2RMN07C.js";import{c as Xe,S as N,e as Ye,f as me,i as Oe,s as h,j as Mt,b as f,k as b,r as ue,h as V,U as G,l as et,o as D,t as Ot,D as Pt,F as kt,d as Pe,a as tt,p as je,N as Bt,G as nt}from"./index-_wFD3GG2.js";import{S as H}from"./SceneDynamicLoadTagComponent-DABH_32v.js";import{c as Q,b as M,a as ot,g as S,N as zt,e as st,u as Ae}from"./ActionFunctions-CxzuxLxN.js";import{g as _t}from"./index-DWVs1sLR.js";import{u as Nt,c as jt}from"./Util-CG5_y5Pm.js";import{ae as At,f as Dt,aZ as De,y as at,a_ as Tt,p as L,z as y,H as Ce,a as W,M as ce,aj as Te,N as it,q as It,a9 as J,n as Lt,a$ as Ft,b0 as Gt,b1 as Wt,b2 as rt,b3 as q,b4 as Rt,b5 as Ht,b6 as Ut,s as Vt,b7 as bt,b8 as Qt,b9 as Kt,O as le,Q as qt,E as Me,aD as Jt,aH as Ie,av as Le,ba as $t,bb as Zt,a5 as Xt,bc as Yt,aW as en,bd as tn,a7 as ct,a8 as lt,be as nn,aI as on,bf as sn,aF as an}from"./EditorServices-BJKHmurs.js";import{b as rn}from"./MathLerpFunctions-CYXVD2J2.js";import{a as pe,P as ke,S as B,E as I,T as cn}from"./EditorControlFunctions-DO7c3hDV.js";import{N as ln}from"./NotificationService-BtHCxsFA.js";import{F as mn,a as Fe}from"./AssetType-LSGL9ANY.js";import{B as un}from"./index-CCAuFDbE.js";import{E as pn}from"./index-Ci1UbFw0.js";import{I as ne}from"./index-DZ02_pf3.js";import{N as fn}from"./index-Cb0NQbVM.js";import{a as Ge}from"./index-fFxXVS77.js";import{P as dn}from"./index-BqFAen_F.js";import{u as yn}from"./useTranslation-C8TD7CCW.js";import"./_commonjsHelpers-BosuxZz1.js";import"./v4-Dz_GI0CC.js";import"./index-DaaykCGs.js";import"./iconBase-vdkxwKJc.js";import"./WebContainer3D-CgDOwl0k.js";import"./lodash-BYTxXjAY.js";import"./XRState-BS8ja_cl.js";import"./client-DMi1NERe.js";import"./index-DfU-XIjm.js";import"./index-DJX7trsF.js";import"./index-DCS5Ru-F.js";import"./index-vJCBmx79.js";import"./index-CqRG3f1I.js";import"./tw-merge-Ds6tgvmq.js";import"./index-6-YOBPgK.js";/* empty css                */import"./miscUtils-D11F-TOL.js";import"./index-ChWBCYBM.js";import"./index-CGhkeU3i.js";import"./index-DGVNGK2X.js";import"./nonIterableRest-Y-KoC6Zs.js";function We(n,e,t){const o=[],s=new i;e.getSize(s);const r=e.min.z,a=e.max.z;for(let u=0;u<=t;u++){const v=u/t,d=e.min.x+v*s.x,g=e.min.y+v*s.y;o.push(new i(d,e.min.y,r),new i(d,e.max.y,r)),o.push(new i(d,e.min.y,a),new i(d,e.max.y,a)),o.push(new i(e.min.x,g,r),new i(e.max.x,g,r)),o.push(new i(e.min.x,g,a),new i(e.max.x,g,a))}const c=e.max.y,m=e.min.y;for(let u=0;u<=t;u++){const v=u/t,d=e.min.x+v*s.x,g=e.min.z+v*s.z;o.push(new i(d,c,e.min.z),new i(d,c,e.max.z)),o.push(new i(d,m,e.min.z),new i(d,m,e.max.z)),o.push(new i(e.min.x,c,g),new i(e.max.x,c,g)),o.push(new i(e.min.x,m,g),new i(e.max.x,m,g))}const l=e.min.x,p=e.max.x;for(let u=0;u<=t;u++){const v=u/t,d=e.min.y+v*s.y,g=e.min.z+v*s.z;o.push(new i(l,d,e.min.z),new i(l,d,e.max.z)),o.push(new i(p,d,e.min.z),new i(p,d,e.max.z)),o.push(new i(l,e.min.y,g),new i(l,e.max.y,g)),o.push(new i(p,e.min.y,g),new i(p,e.max.y,g))}for(let u=0;u<o.length;u++)o[u].applyMatrix4(n);return new xt().setFromPoints(o)}const R=Xe({name:"BoundingBoxHelperComponent",schema:N.Object({name:N.String("bounding-box-helper"),bbox:N.Required(N.Type()),density:N.Number(2),color:N.Color(16711680),layerMask:N.Number(At.NodeHelper),entity:N.Entity()}),reactor:function(){const n=Ye(),e=me(n,R),t=Dt(n,e),o=Oe(t,De);return z.useEffect(()=>{const s=e.bbox.value,r=e.density.value;h(t,De,{name:"bbox-line-segment-"+n,geometry:We(new U().identity(),s,r),material:new vt({color:e.color.value}),layerMask:e.layerMask.value})},[]),Mt(()=>{if(!o)return;const s=e.bbox.value,r=e.density.value;o.geometry.set(We(new U().identity(),s,r))},[e.bbox]),z.useEffect(()=>{o&&o.color.set(e.color.value)},[e.color,o]),z.useEffect(()=>{o&&o.layerMask.set(e.layerMask.value)},[e.layerMask,o]),null}}),gn=new i(.5,.5,.5),Re=new i,He=new A,Ue=new i,k=Xe({name:"ObjectGridSnapComponent",schema:N.Object({bbox:N.Class(()=>new Ze)}),reactor:()=>{const n=Ye(),e=Q(M(at)),t=me(n,k),o=me(n,W),s=Tt(n,[ce]);return z.useEffect(()=>{if(!o.scene.value)return;const r=f(n,L).parentEntity,a=f(n,y);a.matrix.decompose(Re,He,Ue),h(n,L,{parentEntity:b}),a.matrixWorld.identity(),y.updateFromWorldMatrix(n);const c=[];Ce(n,l=>{V(l,y)&&(Te(l),V(l,ce)&&c.push(f(l,ce)))});const m=t.bbox.value.makeEmpty();if(c.length>0)for(let l=0;l<c.length;l++)m.expandByObject(c[l]);else m.set(rn,gn);h(n,L,{parentEntity:r}),h(n,y,{position:Re,rotation:He,scale:Ue}),Ce(n,Te,l=>V(l,y)),t.bbox.set(m)},[o.scene,s]),z.useEffect(()=>{if(!e.isEditing.value)return;const r=t.bbox.value;return h(n,R,{bbox:r}),()=>{ue(n,R)}},[t.bbox,e.isEditing]),null}});function mt(n,e){const t={name:n.name,extensions:{[G.jsonID]:e}};if(n.components)for(const o of n.components)if(o.name===y.jsonID){const s=o.props,r=new U().compose(s.position,s.rotation,s.scale);t.matrix=r.toArray()}else t.extensions[o.name]=o.props;return t}const hn=(n,e=b)=>{const t=et();h(t,it,n),h(t,It),h(t,y),e!==b&&h(t,L,{parentEntity:e});const o=D(e,J);o!=null&&h(t,J,o),h(t,G,Ot());const s=new St;return s.entity=t,Lt(t,s),Ft(s),h(t,Gt,s),t},ut=n=>{const e=D(n,Wt),t=[],o=Pt(n);for(const s of o){const r=s.jsonID;if(r&&!(e!=null&&e.includes(s.name))){const a=kt(n,s);a&&t.push({name:r,props:a})}}return t},pt=n=>{var s;const t={components:ut(n),name:D(n,it)??""},o=(s=D(n,L))==null?void 0:s.parentEntity;return o&&V(o,G)&&(t.parent=f(o,G)),t};globalThis.serializeEntity=ut;const vn={...rt,speed:{...q,default:.1},scanlineSize:{...q,default:15},hologramColor:{...Rt,default:new re(1,1,1)},time:q,useBlink:Ht,mix_intensity:{...q,default:1},hologramBrightness:{...q,default:.5},hologramOpacity:{...q,default:.5}};class xn extends Et{constructor(t){const o=Object.fromEntries(Object.keys(t??{}).filter(a=>Object.hasOwn(rt,a)).map(a=>[a,t[a]]));super(o);_e(this,"_uniforms");const s=a=>new Ne((t==null?void 0:t[a])??vn[a].default);this._uniforms=Object.fromEntries(["speed","time","useBlink","mix_intensity","hologramColor","hologramBrightness","scanlineSize","hologramOpacity"].map(a=>[a,s(a)])),Ut(this,(a,c)=>{Object.entries(this._uniforms).map(([p,u])=>a.uniforms[p]=u),a.vertexShader=`
          varying vec4 vPos;  
          varying vec2 myuv;
          varying vec3 vPositionNormal; 
          varying vec3 v_Normal; 
          `+a.vertexShader,a.vertexShader=a.vertexShader.replace("void main() {",` 

          void main() {
            //vec3 transformed = vec3(position);
            vPos = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
            myuv = uv;
            vPositionNormal = normalize(( modelViewMatrix * vec4(position, 1.0) ).xyz);
            v_Normal = normalize( normalMatrix * normal ); 
          `),a.fragmentShader=a.fragmentShader.replace("void main() {",`
              uniform float speed;
              varying vec3 vPositionNormal; 
              varying vec3 v_Normal; 
              uniform float time; 
              uniform float mix_intensity; 
              uniform bool useBlink;
              uniform vec3 hologramColor;
              uniform float hologramBrightness;
              uniform float scanlineSize;
              uniform float hologramOpacity;
              varying vec4 vPos;
              varying vec2 myuv;
              float flicker( float amt, float time ) {return clamp( fract( cos( time ) * 4358.5453123 ), amt, 1.0 );}
              float random(in float a, in float b) { return fract((cos(dot(vec2(a,b) ,vec2(12.9898,78.233))) * 43758.5453)); }
        
      

          void main() {     

           
         `);const m=`
        #include <color_fragment>  
        vec2 vCoords = vPos.xy;
        vCoords /= vPos.w;
        vCoords = vCoords * 0.5 + 0.5;
        vec2 myUV = fract( vCoords );

        // // Defines hologram main color
        vec4 hologramColor = vec4(hologramColor, mix(hologramBrightness, myuv.y, 0.5));

        // // Add scanlines
        float scanlines = 10.;
        scanlines += 20. * sin(time *speed * 20.8 - myUV.y * 60. * scanlineSize);
        scanlines *= smoothstep(1.3 * cos(time *speed + myUV.y * scanlineSize), 0.78, 0.9);
        scanlines *= max(0.25, sin(time *speed) * 1.0);        
        
        // // Scanlines offsets
        float r = random(myuv.x, myuv.y);
        float g = random(myuv.y * 20.2, 	myuv.y * .2);
        float b = random(myuv.y * .9, 	myuv.y * .2);

        // // Scanline composition
        hologramColor += vec4(r*scanlines, b*scanlines, r, 1.0) / 84.;
        vec4 scanlineMix = mix(vec4(0.0), hologramColor, hologramColor.a);

        // // Calculates fresnel
        float fresnel=pow( (1. + -1. * abs(dot(v_Normal, vPositionNormal)))*2.2, 2.0 );

        // // Blinkin effect
        float blinkValue = 1.0 - speed;
        float blink = flicker(blinkValue, time * speed * .002);
    

        vec4 initial_diffuse=diffuseColor;
        if(useBlink){
            diffuseColor = mix( initial_diffuse,vec4( scanlineMix.rgb+fresnel*blink, 1.0),mix_intensity);}
        else{
            diffuseColor = mix( initial_diffuse,vec4( scanlineMix.rgb+fresnel, 1.0),mix_intensity);
        }
        `;a.fragmentShader=a.fragmentShader.replace("#include <color_fragment>",m);const l=`
        #include <alphamap_fragment>   
    

        diffuseColor.a = hologramOpacity;
      
        `;a.fragmentShader=a.fragmentShader.replace("#include <alphamap_fragment>",l)}),this.needsUpdate=!0,this.userData.type="HolographicMaterial";const r=et();Vt(r,bt,a=>{this._uniforms.time.value+=a}),h(r,Qt,!0)}get speed(){return this._uniforms.speed.value}set speed(t){this._uniforms.speed.value=t}get time(){return this._uniforms.time.value}set time(t){this._uniforms.time.value=t}get hologramColor(){return this._uniforms.hologramColor.value}set hologramColor(t){this._uniforms.hologramColor.value=t}get hologramBrightness(){return this._uniforms.hologramBrightness.value}set hologramBrightness(t){this._uniforms.hologramBrightness.value=t}get hologramOpacity(){return this._uniforms.hologramOpacity.value}set hologramOpacity(t){this._uniforms.hologramOpacity.value=t}get scanlineSize(){return this._uniforms.scanlineSize.value}set scanlineSize(t){this._uniforms.scanlineSize.value=t}get mix_intensity(){return this._uniforms.mix_intensity.value}set mix_intensity(t){this._uniforms.mix_intensity.value=t}get useBlink(){return this._uniforms.useBlink.value}set useBlink(t){this._uniforms.useBlink.value=t}clone(){const t=super.clone();return t._uniforms=Object.fromEntries(Object.keys(this._uniforms).map(o=>[o,new Ne(this._uniforms[o].value)])),t}}let ft=0;const x=ot({name:"ClickPlacementState",initial:{placementEntity:b,selectedAsset:"",yawOffset:0,pitchOffset:0,rollOffset:0,maxDistance:25,materialCache:[]},setSelectedAsset:n=>{const e=mn(n);e&&(e===Fe.GLTF||e===Fe.GLB)?M(x).selectedAsset.set(n):S(pe).placementMode===ke.CLICK?x.assetError():x.resetSelectedAsset()},resetSelectedAsset:()=>{M(x).selectedAsset.set("")},assetError:()=>{ln.dispatchNotify("Selected asset is not valid for click placement",{variant:"warning"}),x.resetSelectedAsset()}}),Sn=n=>{const{parentEntity:e}=n,t=Q(M(x)),o=Q(M(pe)),s=Xt.useSceneLoaded(e),r=Yt.useComponentErrors(t.placementEntity.value,W);return z.useEffect(()=>{if(s)if(o.placementMode.value===ke.CLICK){if(B.updateSelection([]),t.placementEntity.value)return;t.placementEntity.set(dt(e))}else{if(!t.placementEntity.value)return;const a=S(B).selectedEntities.filter(c=>c!==f(t.placementEntity.value,G));I.removeObject([t.placementEntity.value]),t.placementEntity.set(b),B.updateSelection(a)}},[o.placementMode,s]),z.useEffect(()=>{var m;if(!t.placementEntity.value)return;const a=t.selectedAsset.get(zt),c=t.placementEntity.value;((m=f(c,W))==null?void 0:m.src)!==a&&Mn(c)},[t.selectedAsset,t.placementEntity]),z.useEffect(()=>{!r||!r.value||x.assetError()},[r]),E.createElement(En,{key:t.placementEntity.value,placementEntity:t.placementEntity.value})},En=n=>{const e=Q(M(x)),t=Q(M(en)),o=Oe(n.placementEntity,W);return z.useEffect(()=>{if(!o)return;const s=tn(n.placementEntity);t.scenes[s]&&Ce(n.placementEntity,r=>{const a=D(r,ce);if(!a)return;const c=a.material;e.materialCache.set(m=>[...m,[a,c]]),a.material=new xn({})})},[o==null?void 0:o.scene,t.scenes.keys]),null},wn=Pe([Kt[le.Scene]]),Cn=()=>S(Me).rootEntity,Mn=n=>{S(x).selectedAsset?h(n,W,{src:S(x).selectedAsset}):ue(n,W);const t=f(n,J),o=ct.cloneCurrentSnapshot(t),s=f(n,G),r=o.data.nodes.findIndex(m=>m.extensions&&m.extensions[G.jsonID]===s),a=pt(n),c=mt(a,s);delete c.matrix,o.data.nodes[r]=c,st(lt.createSnapshot(o))},On=n=>{h(n,W,{src:S(x).selectedAsset});const e=f(n,J),t=ct.cloneCurrentSnapshot(e),o=f(n,G),s=pt(n),r=mt(s,o);delete r.matrix;const a=t.data.nodes.length;t.data.nodes.push(r),t.data.scenes[0].nodes.push(a),st(lt.createSnapshot(t))},dt=n=>{const e=hn("Placement-"+ft,n),t=f(n,J);return h(e,J,t),h(e,L,{parentEntity:n}),On(e),e},Pn=()=>{const n=M(x);if(!n.selectedAsset.value)return;const e=Cn();if(!e)return;const t=n.placementEntity.value;if(t){S(F).enabled?F.apply():(y.updateFromWorldMatrix(t),I.commitTransformSave([t])),ft+=1,n.placementEntity.set(dt(e));for(const[o,s]of n.materialCache.value)o.material=s;n.materialCache.set([])}};tt({uuid:"ee.studio.ClickPlacementSystem",insert:{after:qt},reactor:()=>{const n=Q(M(Me)).rootEntity;return n.value?E.createElement(Sn,{key:n.value,parentEntity:n.value}):null},execute:()=>{var X,T,te,O,K,w;if(S(pe).placementMode!==ke.CLICK)return;const e=M(x),t=e.placementEntity;if(!t)return;const o=S(Me).rootEntity,s=Jt.getWorld(o);if(!s)return;const r=[],a=wn();for(const C of a){const P=(X=f(C,nn))==null?void 0:X[0];P&&r.push(P)}const c=f(je.instance.cameraEntity,on),m=new wt;let l=null;const p=je.instance.viewerEntity,u=Ie.getPointersForCamera(p)[0];if(!u)return;const v=Le.getMergedButtons(p),g=Le.getMergedAxes(p)[$t.VerticalScroll];if((T=v.SecondaryClick)!=null&&T.pressed&&e.maxDistance.set(e.maxDistance.value-g),(te=v.KeyE)!=null&&te.up&&e.yawOffset.set(e.yawOffset.value+Math.PI/4),(O=v.KeyQ)!=null&&O.up&&e.yawOffset.set(e.yawOffset.value-Math.PI/4),(K=v.PrimaryClick)!=null&&K.up&&(Pn(),t!==e.placementEntity))return;const ee=f(u,Ie).position;m.setFromCamera(ee,c);const j=m.ray.origin,$=m.ray.direction,_=s.castRayAndGetNormal(new Zt(j,$),1e3,!1);if(_&&_.toi<e.maxDistance.value){const C=j.clone().add($.clone().multiplyScalar(_.toi));_.collider.parent().userData.entity;const P=new i(_.normal.x,_.normal.y,_.normal.z);l={point:C,normal:P}}const fe=m.intersectObjects(r,!1);for(let C=0;C<fe.length;C++){const P=fe[C];if(!(P.distance>e.maxDistance.value)&&!kn(P.object.entity)){l={point:P.point,normal:((w=P.face)==null?void 0:w.normal)??new i(0,1,0)};break}}l||(l={point:j.clone().add($.clone().multiplyScalar(e.maxDistance.value)),normal:new i(0,1,0)});const de=l.point;let Z=new A().setFromUnitVectors(new i,l.normal??new i(0,1,0));Z=new A().setFromEuler(new Ct(e.pitchOffset.value,e.yawOffset.value,e.rollOffset.value)).multiply(Z),h(t.value,y,{position:de,rotation:Z})}});const kn=n=>{var o;const e=S(x).placementEntity;if(!e)return!1;let t=n;for(;t;){if(t===e)return!0;t=((o=f(t,L))==null?void 0:o.parentEntity)??null}return!1};function Bn(n){var r;let e=n;const o=S(x).placementEntity,s=B.getSelectedEntities();for(;e;){if(o===e||s.includes(e))return e;e=((r=D(e,L))==null?void 0:r.parentEntity)??null}return!1}const oe=new i,se=new i;function zn(n,e,t,o){t.decompose(new i,new A,oe),o.decompose(new i,new A,se);const s=Math.max(Math.abs(oe.x),Math.abs(oe.y),Math.abs(oe.z)),r=Math.max(Math.abs(se.x),Math.abs(se.y),Math.abs(se.z)),a=n.getCenter(new i),c=e.getCenter(new i),m=a.clone().applyMatrix4(t),l=c.clone().applyMatrix4(o),p=n.getSize(new i).length()*s/2,u=e.getSize(new i).length()*r/2;return m.distanceTo(l)-p-u}function ge(n,e){let t=1/0,o=new i;for(const s of e){const r=n.angleTo(s);r<t&&(t=r,o=s)}return o}function Ve(n,e){const t=be(n),o=be(e),s=t[0],r=t[1],a=t[2],c=ge(s,o);o.splice(o.indexOf(c),1);const m=o.filter(d=>Math.abs(d.dot(c))<Number.EPSILON),l=ge(r,m);o.splice(o.indexOf(l),1);const p=o.filter(d=>Math.abs(d.dot(c))<Number.EPSILON&&Math.abs(d.dot(l))<Number.EPSILON),u=ge(a,p),v=new U;return v.makeBasis(u,l,c),v}function be(n){const e=new A().setFromRotationMatrix(n),t=new i(0,0,1).applyQuaternion(e),o=new i(0,1,0).applyQuaternion(e),s=new i(1,0,0).applyQuaternion(e),r=o.clone().negate(),a=s.clone().negate(),c=t.clone().negate();return[t,o,s,r,a,c]}function Qe(n,e,t,o){const s=Ke(n,t),r=Ke(e,o);return _n(s,r)}function Ke(n,e){return[new i(n.min.x,n.min.y,n.min.z),new i(n.min.x,n.min.y,n.max.z),new i(n.min.x,n.max.y,n.min.z),new i(n.min.x,n.max.y,n.max.z),new i(n.max.x,n.min.y,n.min.z),new i(n.max.x,n.min.y,n.max.z),new i(n.max.x,n.max.y,n.min.z),new i(n.max.x,n.max.y,n.max.z)].reduce((o,s)=>(s.applyMatrix4(e),o.expandByPoint(s),o),new Ze)}function _n(n,e){const t=new i;for(const o of["x","y","z"])if(n.max[o]<e.min[o])t[o]=e.min[o]-n.max[o];else if(n.min[o]>e.max[o])t[o]=e.max[o]-n.min[o];else{const s=[n.min[o],(n.min[o]+n.max[o])/2,n.max[o]],r=[e.min[o],(e.min[o]+e.max[o])/2,e.max[o]];let a=1/0,c=0,m=0;for(const l of s){for(const p of r){const u=Math.abs(l-p);if(u<a&&(a=u,c=l,m=p,u===0))break}if(a===0)break}t[o]=m-c}return t}function he(n,e){const t=nt(n,R);if(t){const o=1<<e;t.layerMask.set(o)}}function ve(n,e){const t=nt(n,R);t&&t.color.set(e)}function xe(n){var t;const e=(t=D(n,R))==null?void 0:t.entity;e&&h(e,y,{position:new i,rotation:new A().identity(),scale:new i(1,1,1)})}const F=ot({name:"ObjectGridSnapState",initial:{enabled:!1,selectedEntities:[],selectedParents:[]},apply:()=>{var s;const n=S(F),e=n.selectedEntities,t=n.selectedParents,o=[];for(let r=0;r<e.length;r++){const a=e[r],c=t[r],m=(s=D(a,R))==null?void 0:s.entity;if(!m){console.warn(`ObjectGridSnapSystem:apply No Helper entity found for selected entity: ${a}`);continue}const l=f(m,y).matrixWorld,p=f(c,y).matrixWorld,u=p.clone().invert().multiply(l);p.multiply(u),y.updateFromWorldMatrix(c),o.push(c)}I.commitTransformSave(o)}}),Nn=Pe([k]),ae=Pe([W,Bt(an)]);tt({uuid:"ee.engine.scene.ObjectGridSnapSystem",insert:{after:sn},reactor:()=>{const n=Ae(F),e=Ae(B);return z.useEffect(()=>{if(n.enabled.value){for(const t of ae())h(t,k);return()=>{for(const t of ae())ue(t,k)}}},[n.enabled]),z.useEffect(()=>{const t=B.getSelectedEntities();return()=>{const o=B.getSelectedEntities();for(const s of t)o.includes(s)||V(s,k)&&xe(s)}},[e.selectedEntities]),null},execute:()=>{var a;if(!S(at).isEditing||!S(F).enabled)return;for(const c of ae.enter())h(c,k);for(const c of ae.exit())ue(c,k);const t=Nn(),o=[],s=[],r=[];for(const c of t){const m=Bn(c);m?(o.push(c),s.push(m),he(c,le.Scene),ve(c,new re(1,1,1))):(r.push(c),xe(c),he(c,le.NodeHelper),ve(c,new re(1,0,0)))}if(M(F).merge({selectedEntities:o,selectedParents:s}),o.length!==0)for(let c=0;c<o.length;c++){const m=o[c],l=s[c],p=f(m,k).bbox,u=f(m,y).matrixWorld,v=[],d=1;for(const O of r){const K=f(O,k).bbox,w=f(O,y).matrixWorld;zn(p,K,u,w)<=d&&(v.push(O),he(O,le.Scene))}const g=(a=D(m,R))==null?void 0:a.entity,Y=()=>{xe(m)};if(v.length===0){Y();continue}if(!g){Y();continue}let ee=1/0,j=b;for(const O of v){const K=f(O,k).bbox,w=u.clone(),C=f(O,y).matrixWorld.clone(),P=Ve(w,C),yt=new i(w.elements[12],w.elements[13],w.elements[14]);w.extractRotation(P),w.setPosition(yt);const ze=Qe(p,K,new U().identity(),w.clone().invert().multiply(C)).length();ze<ee&&(ee=ze,j=O)}if(j===b){Y();continue}ve(j,new re(0,1,0));const $=f(j,k).bbox,_=f(j,y).matrixWorld,de=f(l,y).matrixWorld.clone(),Z=Ve(u,_),ye=new i,X=new i;de.decompose(ye,new A,X);const T=f(g,y).matrixWorld;T.extractRotation(Z),T.scale(X),T.setPosition(ye),y.updateFromWorldMatrix(g);const te=Qe(p,$,new U().identity(),T.clone().invert().multiply(_));T.multiply(new U().makeTranslation(te)),y.updateFromWorldMatrix(g)}}});const Se=new i,Ee=new A,we=new i,Be=n=>{const{t:e}=yn();Oe(n.entity,H);const t=me(n.entity,y),o=Q(M(pe).transformSpace);Se.copy(t.position.value),Ee.copy(t.rotation.value),we.copy(t.scale.value),o.value===cn.world&&t.matrixWorld.value.decompose(Se,Ee,we);const s=()=>{S(F).enabled?F.apply():I.commitTransformSave([n.entity])},r=l=>{const p=B.getSelectedEntities();I.addOrRemoveComponent(p,H,l)},a=l=>{const p=B.getSelectedEntities();I.positionObject(p,[l])},c=l=>{const p=B.getSelectedEntities();I.rotateObject(p,[l])},m=l=>{const p=B.getSelectedEntities();I.scaleObject(p,[l],!0)};return E.createElement(dn,{name:e("editor:properties.transform.title"),description:e("editor:properties.transform.description"),icon:E.createElement(Be.iconComponent,null)},E.createElement(ne,{name:"Dynamically Load Children",label:e("editor:properties.lbl-dynamicLoad"),labelClassName:"font-normal text-[#6B6D78]",className:"flex w-auto flex-row-reverse flex-nowrap items-center gap-1",containerClassName:"mb-4"},E.createElement(un,{value:V(n.entity,H),onChange:r,className:"mr-2"}),V(n.entity,H)&&E.createElement(fn,{min:1,max:100,value:f(n.entity,H).distance,onChange:Nt(H,"distance"),onRelease:jt(H,"distance")})),E.createElement(ne,{name:"Position",label:e("editor:properties.transform.lbl-position"),className:"w-auto"},E.createElement(Ge,{smallStep:.01,mediumStep:.1,largeStep:1,value:Se,onChange:a,onRelease:s})),E.createElement(ne,{name:"Rotation",label:e("editor:properties.transform.lbl-rotation"),className:"w-auto"},E.createElement(pn,{quaternion:Ee,onChange:c,unit:"°",onRelease:s})),E.createElement(ne,{name:"Scale",label:e("editor:properties.transform.lbl-scale"),className:"w-auto"},E.createElement(Ge,{uniformScaling:!0,smallStep:.01,mediumStep:.1,largeStep:1,value:we,onChange:m,onRelease:s})))};Be.iconComponent=_t;const jn={},wo={title:"Editor/Properties/Transform",component:Be,parameters:{componentSubtitle:"TransformNodeEditor",jest:"transformNodeEditor.test.tsx",design:{type:"figma",url:""}},argTypes:jn},ie={args:{}};var qe,Je,$e;ie.parameters={...ie.parameters,docs:{...(qe=ie.parameters)==null?void 0:qe.docs,source:{originalSource:`{
  args: {}
}`,...($e=(Je=ie.parameters)==null?void 0:Je.docs)==null?void 0:$e.source}}};const Co=["Default"];export{ie as Default,Co as __namedExportsOrder,wo as default};
