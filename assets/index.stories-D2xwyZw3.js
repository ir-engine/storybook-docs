var ps=Object.defineProperty;var gs=(r,e,t)=>e in r?ps(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Ht=(r,e,t)=>gs(r,typeof e!="symbol"?e+"":e,t);import{r as O,R as Y}from"./index-DPzuYzxM.js";import{d as dt,S as h,g as xe,u as Bt,a as ke,q as Ot,x as ve,s as Oe,r as We,k as Vo,l as wt,B as gr,h as we,G as qo,M as ri,y as oi,n as ar,cv as vs}from"./UUIDComponent-GqVY2Xw8.js";import{a as ee,g as ni,N as be,i as ys,x as ir,n as hs}from"./WebRTCTransportFunctions-mB_FREj1.js";import{aY as bs,aG as Ie,ar as ai,O as pn,q as vr,aZ as ii,M as yr,a_ as Mt,a$ as si,d as ui,b0 as ko,e as pe,b1 as Ts}from"./resourceLoaderHooks-CRL4d032.js";import{M as fe,A as ft,P as me,a as hr,c as fi,g as gn}from"./MediaComponent-3aVL33k0.js";import{S as br}from"./ShadowComponent-DnhO6zHH.js";import{B as It,c as vn,U as Tr,aa as _e,r as Wo,t as $t,T as Xo,m as lt,z as Sr,i as li,P as Ss,h as Er,k as Es,a as ws,V as $e,a5 as ci,_ as mi,n as Is,ab as xs,p as Rs}from"./three.module-BizNiMhn.js";import{b as Ps,i as kt,c as As}from"./index-DNUDjAZy.js";import{A as Ms}from"./AssetType-CNZ47EUo.js";import{c as Kt,u as yn}from"./Util-D6kE0IP9.js";import"./index-Dls6AtJn.js";import{C as hn}from"./index-PchlGXp2.js";import"./index-B8Egbi3s.js";import"./index-C53TPVpl.js";import"./index-CvvRAf94.js";import"./ZoomOutSm-BKYTao-C.js";import"./index-BmZLy_Eh.js";import{l as $s}from"./index-CO8llcWC.js";import{N as ks}from"./NodeEditor-SBboXx3y.js";import{S as bn}from"./index-D9Z-cq-f.js";import"./index-DSz74nmS.js";import"./index-C0G57g00.js";import{c as se}from"./_commonjsHelpers-C4iS2aBk.js";import{r as Cs}from"./___vite-browser-external_commonjs-proxy-BqV5D26a.js";import{A as Bs}from"./index-Ba7kxoL8.js";import{I as qe}from"./index-dk6FhMkf.js";import{S as Yt}from"./index-CYqQ2WW8.js";import{u as di}from"./useTranslation-CW9c4UDM.js";import"./v4-BOvFkHkt.js";import"./index-DYLXRpC5.js";import"./lodash-AQPfkADg.js";import"./iframe-DiWilCzr.js";import"./tw-merge-Ds6tgvmq.js";import"./useFeatureFlags-Dn9l-n2t.js";import"./FeathersHooks-Bcw5IzUg.js";import"./EditorServices-5l66pnva.js";import"./AuthService-CgpOViw1.js";import"./index-Dp9Z83cc.js";import"./index-C0GIA9vz.js";import"./iconBase-qHBVS_PM.js";import"./utils-C_TihLnJ.js";import"./index-D9X8Um7J.js";import"./index-YWE9xQ_z.js";import"./useDrop-GcAn0hgk.js";import"./index-TG03Y8s6.js";import"./DndProvider-1KW6pMBo.js";import"./jsx-runtime-DoNvqZ76.js";import"./index-CkoKGIuM.js";import"./index-Bs5DOUC-.js";import"./index-DFnjDgZz.js";import"./fuse-Ch1WBRTM.js";import"./index-K3LPJkAj.js";const Os=(r,e)=>{O.useEffect(()=>{var i,s;if(!r)return;let t=-1;const o=((i=r.requestVideoFrameCallback)==null?void 0:i.bind(r))??requestAnimationFrame,n=((s=r.cancelVideoFrameCallback)==null?void 0:s.bind(r))??cancelAnimationFrame,a=(u,c)=>{const d=(c==null?void 0:c.mediaTime)??r.currentTime;e(d,c),t=o(a)};return t=o(a),console.log({frameId:t}),()=>n(t)},[r])};class pi{constructor(){this.decoderPath="",this.decoderPending=null,this.worker=null,this.lastRequest=0,this.callbacks={},this.defaultAttributes=[{name:"position",numComponents:"3"},{name:"normal",numComponents:"3"},{name:"color",numComponents:"4"},{name:"uv",numComponents:"2"}]}setDecoderPath(e){return this.decoderPath=e,this}load(e,t,o,n){this.decoderPending||this.preload(),this.decoderPending.then(()=>{const a=this.lastRequest++;this.worker.postMessage({request:a,url:e,byteStart:t,byteEnd:o}),this.callbacks[a]={onLoad:n}})}preload(){if(this.decoderPending)return this.decoderPending;let e=this,t=this.callbacks,o="corto.js";return this.decoderPending=this._loadLibrary(o,"text").then(n=>{n=URL.createObjectURL(new Blob([n])),this.worker=new Worker(n),this.worker.onmessage=function(a){var i=a.data;if(!t[i.request])return;const s=t[i.request],u=e._createGeometry(i.geometry);s.onLoad(u),delete t[i.request]}}),this.decoderPending}dispose(){return this.worker&&(this.worker.terminate(),this.worker=null),this}_createGeometry(e){if(!e)return null;var t=new It;e.index&&t.setIndex(new vn(e.index,1));for(let o=0;o<this.defaultAttributes.length;o++){let n=this.defaultAttributes[o];if(!e[n.name])continue;let a=e[n.name];t.setAttribute(n.name,new vn(a,n.numComponents))}return t}_loadLibrary(e,t){var o=new bs(this.manager);return o.setPath(this.decoderPath),o.setResponseType(t),new Promise((n,a)=>{o.load(e,n,void 0,a)})}}const Se=dt({name:"UVOLDissolveComponent",schema:h.Object({currentTime:h.Number(),duration:h.Number({default:2})}),createDissolveMaterial(r,e="#include <clipping_planes_pars_vertex>",t="#include <fog_vertex>",o="#include <clipping_planes_pars_fragment>",n="#include <opaque_fragment>"){const a=r.material,i="isShaderMaterial"in a,s=i?a.uniforms.map.value:a.map;r.geometry.boundingBox||r.geometry.computeBoundingBox();const u=r.geometry.boundingBox.min.y,d=r.geometry.boundingBox.max.y-u;let p={progress:{value:0},loadedHeight:{value:0},jitterWidth:{value:.1*d},repeat:{value:s.repeat},offset:{value:s.offset},origin_texture:{value:s}},l="",f="";if(i)l=a.vertexShader,f=a.fragmentShader,p=Tr.merge([a.uniforms,p]);else{const A=_e.basic;l=A.vertexShader,f=A.fragmentShader,Object.keys(A.uniforms).forEach(E=>{a[E]&&(p[E]=A.uniforms[E])})}p=Tr.merge([Wo.lights,p]);let m=`
varying vec2 vUv;
varying float positionY;`;typeof e=="string"&&(m=e+m);let v=`
vUv = uv;
positionY = position.y;`;typeof t=="string"&&(v=t+v);let b=`
varying vec2 vUv;
varying float positionY;
uniform float loadedHeight;
uniform vec2 repeat;
uniform vec2 offset;
uniform sampler2D origin_texture;
uniform float jitterWidth;
uniform float progress;

vec4 sRGBToLinear( in vec4 value ) {
  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}`;typeof o=="string"&&(b=o+b);let S=`
float offset2 = positionY - loadedHeight;

vec2 transformedUV = vUv*repeat + offset;
vec4 textureColor = texture2D(origin_texture, transformedUV);

float jitterDelta = (rand(gl_FragCoord.xy) - 0.5) * 200.0; // [-100, 100]
float localJitter = jitterWidth * (100.0 + jitterDelta) / 100.0;

float lowerOffset = loadedHeight - localJitter;
float upperOffset = loadedHeight + localJitter;

float randomR = (sin(progress) * 0.5) + 0.5;
float randomG = .5;
float randomB = (cos(progress) * 0.5) + 0.5;

if (positionY < lowerOffset) {
  ${"isVideoTexture"in s?"gl_FragColor = sRGBToLinear(textureColor);":"gl_FragColor = textureColor;"}
} else if (positionY > upperOffset) {
  discard;
} else {
  gl_FragColor.r = randomR;
  gl_FragColor.g = randomG;
  gl_FragColor.b = randomB;
}`;typeof n=="string"&&(S=n+S),l=l.replace(e,m),l=l.replace(t,v),f=f.replace(o,b),f=f.replace(n,S);const P=new $t({uniforms:p,vertexShader:l,fragmentShader:f,lights:!0,fog:!1,transparent:a.transparent});return P.needsUpdate=!0,P.visible=a.visible,P},updateDissolveEffect(r,e,t){const o=xe(r,Se);if(!o||!e.material.uniforms.progress)return!0;o.currentTime+=t,e.geometry.boundingBox||e.geometry.computeBoundingBox();const n=e.geometry.boundingBox.min.y,a=e.geometry.boundingBox.max.y,i=o.duration,s=Math.min(a,Math.max(n,n+(a-n)*(o.currentTime/i)));return e.material.uniforms.loadedHeight.value=s,e.material.uniforms.progress.value=o.currentTime/i,o.currentTime>=i}}),_s=(r,e,t)=>new Promise((o,n)=>{ee(Ie).cortoLoader.load(r,e,t,a=>{o(a)})}),xt=dt({name:"UVOL1Component",schema:h.Object({manifestPath:h.String({default:""}),data:h.Object({maxVertices:h.Number(),maxTriangles:h.Number(),frameData:h.Array(h.Object({frameNumber:h.Number(),keyframeNumber:h.Number(),startBytePosition:h.Number(),vertices:h.Number(),faces:h.Number(),meshLength:h.Number()})),frameRate:h.Number()},{}),firstGeometryFrameLoaded:h.Bool({default:!1}),loadingEffectStarted:h.Bool({default:!1}),loadingEffectEnded:h.Bool({default:!1})}),reactor:Ls});function Ls(){const r=Bt(),e=ke(r,ce),t=ke(r,xt),o=Ot(r,br),n=ve(r,fe).value,a=ee(ft).audioContext,i=n.element,s=O.useMemo(()=>new Map,[]),u=Ps?10:90,c=O.useMemo(()=>{const b=n.element,g=new Xo(b);return g.generateMipmaps=!1,g.minFilter=lt,g.magFilter=lt,g.isVideoTexture=!0,g.update=()=>{},g.colorSpace=Sr,g},[]),d=O.useMemo(()=>{const b=new li({color:16777215});return b.map=c,b},[]),p=O.useMemo(()=>new Ss(.001,.001),[]),l=O.useMemo(()=>new Er(p,d),[]),f=O.useRef(0),m=O.useRef(0);O.useEffect(()=>{if(!ee(Ie).cortoLoader){const b=new pi;b.setDecoderPath(ee(ai).publicDomain+"/loader_decoders/"),b.preload(),ni(Ie).cortoLoader.set(b)}return e.useLoadingEffect.value&&Oe(r,Se),i.src=t.manifestPath.value.replace(".manifest",".mp4"),i.load(),i.addEventListener("ended",function b(){e.ended.set(!0),i.removeEventListener("ended",b)}),e.currentTrackInfo.duration.set(t.data.frameData.length/t.data.frameRate.value),()=>{We(r,pn),c.dispose();const b=t.data.value.frameData.length;v(b),s.clear(),i.src=""}},[]),O.useEffect(()=>{o&&(o.cast.set(!0),o.receive.set(!0))},[o]),O.useEffect(()=>{t.loadingEffectStarted.value&&!t.loadingEffectEnded.value||e.autoplay.value&&e.initialBuffersLoaded.value&&wr(a,i,e)},[e.autoplay,e.initialBuffersLoaded,t.loadingEffectEnded]),O.useEffect(()=>{if(e.paused.value||!e.initialBuffersLoaded.value){i.pause();return}l.material!==d&&(l.material=d,l.material.needsUpdate=!0),wr(a,i,e)},[e.paused]),O.useEffect(()=>{if(!t.firstGeometryFrameLoaded.value)return;let b=-1;const g=()=>{if(i.buffered.length===0){clearTimeout(b),b=window.setTimeout(g,200);return}l.geometry=s.get(0),l.geometry.attributes.position.needsUpdate=!0,c.needsUpdate=!0,xe(gr.instance.viewerEntity,vr).renderer.initTexture(c),e.useLoadingEffect.value&&(l.material=Se.createDissolveMaterial(l),l.material.needsUpdate=!0,t.loadingEffectStarted.set(!0)),Oe(r,pn,l)};g()},[t.firstGeometryFrameLoaded]),Os(i,(b,g)=>{if(!g)return;const S=A=>{if(l.material instanceof $t&&!we(r,Se)){const E=l.material;l.material=d,l.material.needsUpdate=!0,E.dispose()}e.currentTrackInfo.currentTime.set(A/t.data.frameRate.value),s.has(A)&&(l.geometry=s.get(A),l.geometry.attributes.position.needsUpdate=!0,c.needsUpdate=!0,xe(gr.instance.viewerEntity,vr).renderer.initTexture(c)),v(A)},P=Math.round(g.mediaTime*t.data.value.frameRate);S(P)}),O.useEffect(()=>{i.playbackRate=e.currentTrackInfo.playbackRate.value},[e.currentTrackInfo.playbackRate]),Vo(()=>{if(ee(Ie).cortoLoader===null)return;const b=ee(wt).deltaSeconds;if(t.loadingEffectStarted.value&&!t.loadingEffectEnded.value&&Se.updateDissolveEffect(r,l,b)){We(r,Se),l.material=d,l.material.needsUpdate=!0,t.loadingEffectEnded.set(!0);return}const g=t.data.value.frameData.length;if(m.current===g-1)return;const S=u*2,P=s.size>=Math.max(u*2,90),A=s.size>=S*5;if(f.current==0&&!A){const E=Math.min(m.current+u-1,g-1);for(let M=m.current;M<=E;M++){const R=t.manifestPath.value.replace(".manifest",".drcs"),_=t.data.value.frameData[M].startBytePosition,V=_+t.data.value.frameData[M].meshLength;f.current+=1,_s(R,_,V).then(z=>{if(!z)throw new Error("VDEBUG Entity ${entity} Invalid geometry frame: "+M.toString());z.boundingSphere=new Es().set(new ws,1/0),s.set(M,z),f.current-=1,M===0&&t.firstGeometryFrameLoaded.set(!0)}).catch(z=>{console.error("Error decoding corto frame: ",M,z),f.current-=1}),m.current=E}P&&!e.initialBuffersLoaded.value&&e.initialBuffersLoaded.set(!0)}},{with:qo});const v=b=>{for(const[g,S]of s.entries())g<b&&(S.dispose(),s.delete(g))};return null}var ot=(r=>(r[r.DRACO_WITH_COMPRESSED_TEXTURE=0]="DRACO_WITH_COMPRESSED_TEXTURE",r[r.GLB_WITH_COMPRESSED_TEXTURE=1]="GLB_WITH_COMPRESSED_TEXTURE",r[r.UNIFORM_SOLVE_WITH_COMPRESSED_TEXTURE=2]="UNIFORM_SOLVE_WITH_COMPRESSED_TEXTURE",r))(ot||{});const Ds={mp3:".mp3",wav:".wav",draco:".drc",glb:".glb","uniform-solve":".glb",ktx2:".ktx2","astc/ktx2":".ktx2",video:".mp4"},Br={mp3:".mp3",wav:".wav",draco:".drc","uniform-solve":".glb",ktx2:".ktx2","astc/ktx2":".ktx2"},F={Corto:0,Draco:1,Unify:2},Fs={draco:F.Draco,"uniform-solve":F.Unify},N=6e3,Ns={baseColor:"map",normal:"normalMap",metallicRoughness:"metallicRoughnessMap",emissive:"emissiveMap",occlusion:"aoMap"};class Co{constructor(){Ht(this,"bufferedRange");Ht(this,"pendingRange");Ht(this,"metrics");this.bufferedRange=[],this.pendingRange=[],this.metrics={totalFetchTime:0,totalPlayTime:0}}lowerBound(e,t,o="startTime"){const n=e.length;let a=0,i=n-1,s=-1;for(;a<=i;){const u=Math.floor((a+i)/2);e[u][o]<=t?(s=u,a=u+1):i=u-1}return s}upperBound(e,t,o="endTime"){const n=e.length;let a=0,i=n-1,s=-1;for(;a<=i;){const u=Math.floor((a+i)/2);e[u][o]>t?(s=u,i=u-1):a=u+1}return s}updateEndTime(e,t=!1){const o=t?this.pendingRange:this.bufferedRange,n=o.length;if(e<0||e>=n)return;let a=e+1;for(;a<n&&o[e].endTime>=o[a].startTime;)o[e].endTime=Math.max(o[e].endTime,o[a].endTime),t||(this.bufferedRange[e].fetchTime=this.bufferedRange[e].fetchTime+this.bufferedRange[a].fetchTime),a++;o.splice(e+1,a-1-e)}addBufferedRange(e,t,o){this.removePendingRange(e,t),this.addRange(e,t,o,!1)}addPendingRange(e,t){this.removeBufferedRange(e,t),this.addRange(e,t,0,!0)}addRange(e,t,o,n){const a=n?this.pendingRange:this.bufferedRange;if(e>=t)return;n||(this.metrics.totalFetchTime+=o,this.metrics.totalPlayTime+=t-e);const i=a.length,s=this.lowerBound(a,e);if(s===-1){a.unshift({startTime:e,endTime:t}),n||(a[0].fetchTime=o),this.updateEndTime(0);return}if(e>a[s].endTime){s===i-1?(a.push({startTime:e,endTime:t}),n||(a[i].fetchTime=o)):(a.splice(s+1,0,{startTime:e,endTime:t}),n||(a[s+1].fetchTime=o),this.updateEndTime(s+1));return}t<=a[s].endTime||(a[s].endTime=Math.max(a[s].endTime,t),n||(a[s].fetchTime+=o),this.updateEndTime(s))}removeBufferedRange(e,t){this.removeRange(e,t,!1)}removePendingRange(e,t){this.removeRange(e,t,!0)}removeRange(e,t,o){const n=o?this.pendingRange:this.bufferedRange;if(n.length===0||e>=t||t<=n[0].startTime||e>=n[n.length-1].endTime)return;e=Math.max(e,n[0].startTime),t=Math.min(t,n[n.length-1].endTime);let a=this.lowerBound(n,e,"startTime");if(a===-1)return;n[a].endTime<=e&&a++;let i=this.upperBound(n,t,"startTime");if(i===-1?i=n.length-1:i--,!(a>i))if(a<i){const s=n[i].endTime-n[i].startTime,u=o?0:n[i].fetchTime;t<n[i].endTime?(n[i].startTime=t,o||(n[i].fetchTime=u*(n[i].endTime-n[i].startTime)/s)):n.splice(i,1),n.splice(a+1,i-a-1);const c=n[a].endTime-n[a].startTime,d=o?0:n[a].fetchTime;n[a].startTime<e?(n[a].endTime=e,o||(n[a].fetchTime=d*(n[a].endTime-n[a].startTime)/c)):(n.splice(a,1),i--)}else{let s=a;const u=n[s].endTime-n[s].startTime,c=o?0:n[s].fetchTime,d=n[s].endTime;t<d&&(n.splice(s+1,0,{startTime:t,endTime:d}),o||(n[s+1].fetchTime=c*(n[s+1].endTime-n[s+1].startTime)/u)),n[s].startTime<e?(n[s].endTime=e,o||(n[s].fetchTime=c*(n[s].endTime-n[s].startTime)/u)):(n.splice(s,1),s--)}}getInterSectionDurationInternal(e,t,o){if(e.length===0||t>=o||o<=e[0].startTime||t>=e[e.length-1].endTime)return 0;t=Math.max(t,e[0].startTime),o=Math.min(o,e[e.length-1].endTime);const n=this.lowerBound(e,t,"startTime");let a=this.upperBound(e,o,"startTime");a===-1?a=e.length-1:a--;let i=0;for(let s=n;s<=a;s++)i+=Math.min(e[s].endTime,o)-Math.max(e[s].startTime,t);return i}getIntersectionDuration(e,t){const o=this.getInterSectionDurationInternal(this.bufferedRange,e,t),n=this.getInterSectionDurationInternal(this.pendingRange,e,t),a=t-e-o-n;return{bufferedDuration:o,pendingDuration:n,missingDuration:a}}getNextMissing(e){let t=e;if(this.bufferedRange.length===0&&this.pendingRange.length===0)return t;if(this.bufferedRange.length===0){const o=this.lowerBound(this.pendingRange,t,"startTime");return o===-1?t:this.pendingRange[o].endTime}else if(this.pendingRange.length===0){const o=this.lowerBound(this.bufferedRange,t,"startTime");return o===-1?t:this.bufferedRange[o].endTime}for(;;){const o=Math.max(this.bufferedRange.length>0?this.bufferedRange[this.bufferedRange.length-1].endTime:0,this.pendingRange.length>0?this.pendingRange[this.pendingRange.length-1].endTime:0);if(t>=o)return o;const n=this.lowerBound(this.bufferedRange,t,"startTime");if(n===-1)return t;const a=this.lowerBound(this.pendingRange,this.bufferedRange[n].endTime,"startTime");if(a===-1)return this.bufferedRange[n].endTime;if(this.pendingRange[a].endTime<=this.bufferedRange[n].endTime)return this.bufferedRange[n].endTime;t=this.pendingRange[a].endTime}}getBufferedUntil(e){const t=this.lowerBound(this.bufferedRange,e,"startTime");return t===-1?e:this.bufferedRange[t].endTime}getMetrics(){return this.metrics}resetMetrics(){this.metrics.totalFetchTime=0,this.metrics.totalPlayTime=0}}const Ho=r=>{const e=r.attributes;let t=0;for(const o in e){const n=e[o];t+=n.array.byteLength}return t},Us=r=>{let e=Ho(r.geometry);if(r.geometry.morphAttributes)for(const t in r.geometry.morphAttributes)r.geometry.morphAttributes[t].map(o=>{e+=o.array.byteLength});return e},Gs=r=>{let e=0;return r.image&&r.mipmaps.map(t=>{e+=t.data.byteLength}),e},sr=[];let zt=0;const js=6,gi=()=>{if(zt>=js||sr.length===0)return;const r=sr.shift();r&&(zt++,qs(r.url,r.byteStart,r.byteEnd).then(e=>{r.resolve(e)}).catch(e=>{r.reject(e)}).finally(()=>{zt--,zt===0&&sr.length>0&&gi()}))},Vs=(r,e,t)=>new Promise((o,n)=>{sr.push({url:r,byteStart:e,byteEnd:t,resolve:o,reject:n}),gi()}),qs=(r,e,t)=>{if(!ee(Ie).cortoLoader)throw new Error("loadCorto:CORTOLoader is not available");return new Promise((o,n)=>{ee(Ie).cortoLoader.load(r,e,t,a=>{a===null?n(`loadCorto:Failed to load Corto geometry frame from ${r} at bytes ${e} to ${t}`):o({geometry:a,memoryOccupied:Ho(a)})})})},Ws=r=>{const e=ee(Ie).dracoLoader;if(!e)throw new Error("loadDraco:DracoLoader is not available");return new Promise((t,o)=>{const n=performance.now();e.load(r,a=>{t({geometry:a,fetchTime:performance.now()-n,memoryOccupied:Ho(a)})},void 0,a=>{o(`loadDraco:Error loading draco geometry from ${r}: ${a.message}`)})})},Tn=r=>new Promise((e,t)=>{const o=performance.now();ii.loadAsync(r,!0).then(n=>{const[a]=ri(n,[yr]),i=xe(a,yr);e({mesh:i,fetchTime:performance.now()-o,memoryOccupied:Us(i)})}).catch(n=>{console.error("Error loading geometry: ",r,n),t(`loadGLTF:Error loading geometry from ${r}: ${n.message}`)})}),Xs=(r,e,t)=>{const o=ee(Ie).ktx2Loader;if(!o)throw new Error("loadKTX2:KTX2Loader is not available");const n=new $e(1,1),a=new $e(0,0);return new Promise((i,s)=>{const u=performance.now();o.load(r,c=>{c.repeat.copy(n),c.offset.copy(a),c.updateMatrix(),i({texture:c,fetchTime:performance.now()-u,memoryOccupied:Gs(c)})},void 0,c=>{s(`loadKTX2:Error loading KTX2 Texture from ${r}: ${c.message}`)})})},ur=(r,e)=>{let t=r;for(const o in e)t=t.replace(o,e[o]);return t},Hs=(r,e,t,o,n)=>{const a={baseColor:{USE_MAP:"",MAP_UV:"uv"},normal:{USE_NORMALMAP:"",NORMALMAP_UV:"uv"},metallicRoughness:{USE_METALNESSMAP:"",METALNESSMAP_UV:"uv",USE_ROUGHNESSMAP:"",ROUGHNESSMAP_UV:"uv"},emissive:{USE_EMISSIVEMAP:"",EMISSIVEMAP_UV:"uv"},occlusion:{USE_AOMAP:"",AOMAP_UV:"uv"}},s=((f,m)=>{const v={};return f.forEach(b=>{a[b]&&Object.assign(v,a[b])}),m&&(v.DECODE_VIDEO_TEXTURE=""),v})(o,e),u={mixRatio:{value:0}};if(n)for(const f in n){const m=n[f];typeof m=="number"||typeof m=="boolean"?u[f]={value:m}:typeof m=="object"&&(m.x!==void 0&&m.y!==void 0?u[f]={value:new $e(m.x,m.y)}:Array.isArray(m)&&m.length===2&&(u[f]={value:new $e(m[0],m[1])}))}const c=t?"physical":"basic";let d=_e[c].vertexShader;const p=Tr.merge([_e[c].uniforms,Wo.lights,u]);return r===F.Unify&&(d=ur(_e[c].vertexShader,{"#include <clipping_planes_pars_vertex>":`#include <clipping_planes_pars_vertex>
attribute vec3 keyframeAPosition;
attribute vec3 keyframeBPosition;
attribute vec3 keyframeANormal;
attribute vec3 keyframeBNormal;
uniform float mixRatio;
uniform vec2 repeat;
uniform vec2 offset;
out vec2 custom_vUv;`,"#include <begin_vertex>":`
      vec3 transformed = vec3(position);
      transformed.x += mix(keyframeAPosition.x, keyframeBPosition.x, mixRatio); 
      transformed.y += mix(keyframeAPosition.y, keyframeBPosition.y, mixRatio);
      transformed.z += mix(keyframeAPosition.z, keyframeBPosition.z, mixRatio);
      
      #ifdef USE_ALPHAHASH
      
        vPosition = vec3( transformed );
      
      #endif`,"#include <beginnormal_vertex>":`
      vec3 objectNormal = vec3( normal );
      objectNormal.x += mix(keyframeANormal.x, keyframeBNormal.x, mixRatio);
      objectNormal.y += mix(keyframeANormal.y, keyframeBNormal.y, mixRatio);
      objectNormal.z += mix(keyframeANormal.z, keyframeBNormal.z, mixRatio);

      #ifdef USE_TANGENT

        vec3 objectTangent = vec3( tangent.xyz );

      #endif`})),new $t({vertexShader:d,fragmentShader:_e[c].fragmentShader,uniforms:p,defines:s,lights:!0})},Ks=r=>{const e=[];for(const t in r)r[t].format==="astc/ktx2"?(kt||Mt)&&e.push(t):e.push(t);return e.sort((t,o)=>{const n=r[t],a=r[o],i=n.frameRate*n.settings.resolution.width*n.settings.resolution.height,s=a.frameRate*a.settings.resolution.width*a.settings.resolution.height;return i-s}),e},Or=(r,e)=>e.startsWith("https://")||e.startsWith("http://")?e:r.substring(0,r.lastIndexOf("/")+1)+e,Sn=r=>{let e=0;for(let t=0;t<r.length;t++)r[t]==="#"&&e++;return e},fr=r=>{if(r.type==="geometry")if(r.geometryType===F.Corto){if(r.manifestPath.endsWith(".manifest"))return r.manifestPath.replace(".manifest",".drcs");if(r.manifestPath.endsWith(".mp4"))return r.manifestPath.replace(".mp4",".drcs");throw new Error("getResourceURL:Invalid manifest path for Corto geometry")}else{const e=Or(r.manifestPath,r.path),t=Sn(e),o="["+"#".repeat(t)+"]",n=r.index.toString().padStart(t,"0");return ur(e,{"[ext]":Br[r.format],"[target]":r.target,[o]:n})}else if(r.type==="texture"){const e=Or(r.manifestPath,r.path),t=Sn(e),o="["+"#".repeat(t)+"]",n=r.index.toString().padStart(t,"0");return ur(e,{"[ext]":Br[r.format],"[target]":r.target,"[type]":r.textureType,[o]:n})}else if(r.type==="audio"){const e=Or(r.manifestPath,r.path);return ur(e,{"[ext]":Br[r.format]})}else throw new Error('getResourceURL:Invalid type. Must be either "geometry" or "texture"')},En=({geometryBuffer:r,currentTimeInMS:e,preferredTarget:t,geometryType:o,targets:n,...a})=>{const i=a.keyframeName;if(r.has(t)){const s=o===F.Corto?a.frameRate:a.targetData[t].frameRate;let u=e*s/1e3;o===F.Unify?u=i==="keyframeA"?Math.floor(u):Math.ceil(u):u=Math.round(u);const d=r.get(t)[u];if(d)return{geometry:d,target:t,index:u}}if(o===F.Corto)return!1;for(const s of n)if(r.has(s)){let u=e*a.targetData[s].frameRate/1e3;o===F.Unify?u=i==="keyframeA"?Math.floor(u):Math.ceil(u):u=Math.round(u);const d=r.get(s)[u];if(d)return{geometry:d,target:s,index:u}}return!1},Ys=({textureBuffer:r,currentTimeInMS:e,preferredTarget:t,targets:o,targetData:n})=>{if(r.has(t)){const a=Math.round(e*n[t].frameRate/1e3),s=r.get(t)[a];if(s)return{texture:s,target:t,index:a}}for(const a of o)if(r.has(a)){const i=Math.round(e*n[a].frameRate/1e3),u=r.get(a)[i];if(u)return{texture:u,target:a,index:i}}return!1},zs=({audioContext:r,media:e,paused:t})=>{const o=()=>{const n=xe(gr.instance.viewerEntity,vr).canvas,a=()=>{e.play(),r.resume(),t.set(!1),window.removeEventListener("pointerdown",a),window.removeEventListener("keypress",a),window.removeEventListener("touchstart",a),n.removeEventListener("pointerdown",a),n.removeEventListener("touchstart",a)};window.addEventListener("pointerdown",a),window.addEventListener("keypress",a),window.addEventListener("touchstart",a),n.addEventListener("pointerdown",a),n.addEventListener("touchstart",a)};e.play().catch(n=>{n.name==="NotAllowedError"&&(o(),console.log("Ready to play Sir!"))}).then(()=>{console.log("Media playback started by handleAutoplay"),t.set(!1)})},Ee={geometry:{[F.Corto]:{desktopMaxBufferDuration:36,mobileMaxBufferDuration:15,initialBufferDuration:7,minBufferDurationToPlay:4},[F.Draco]:{desktopMaxBufferDuration:4,mobileMaxBufferDuration:3,initialBufferDuration:3,minBufferDurationToPlay:2},[F.Unify]:{desktopMaxBufferDuration:10,mobileMaxBufferDuration:5,initialBufferDuration:3,minBufferDurationToPlay:.75}},texture:{ktx2:{desktopMaxBufferDuration:8,mobileMaxBufferDuration:3,initialBufferDuration:3,minBufferDurationToPlay:.75},"astc/ktx2":{desktopMaxBufferDuration:6,mobileMaxBufferDuration:3,initialBufferDuration:3,minBufferDurationToPlay:.75}}},Js=({currentTimeInMS:r,bufferData:e,target:t,manifest:o,geometryType:n,manifestPath:a,geometryBuffer:i,mesh:s,initialBufferLoaded:u,startTimeInMS:c,repeat:d,offset:p})=>{if(Object.keys(o).length===0)return;const l=r*(N/1e3),f=e.getNextMissing(l),m=n===F.Corto?o.frameRate:o.geometry.targets[t].frameRate,v=n===F.Corto?o.frameData.length:o.geometry.targets[t].frameCount,b=n===F.Corto?v/m:o.duration,g=Math.floor(f*m/N),S=Math.max(0,Math.min(kt||Mt?Ee.geometry[n].mobileMaxBufferDuration:Ee.geometry[n].desktopMaxBufferDuration,b-r/1e3));if(g>=v||f-l>=S*N)return;const P=Math.min(v-1,Math.floor((l+S*N)*m/N));if(P<g)return;i.has(t)||i.set(t,[]);const A=i.get(t);for(let E=g;E<=P;){const M=E;if(n===F.Corto){const R=M*N/m,_=(M+1)*N/m;if(e.getIntersectionDuration(R,_).missingDuration===0){E++;continue}e.addPendingRange(R,_);const z=fr({type:"geometry",geometryType:F.Corto,manifestPath:a}),Q=o.frameData[M].startBytePosition,q=Q+o.frameData[M].meshLength;Vs(z,Q,q).then(Z=>{const te=Z.geometry;if(A[M]=te,e.addBufferedRange(R,_,-1),!u.value){const J=c*N/1e3,de=J+Ee.geometry[n].initialBufferDuration*N,Ge=e.getIntersectionDuration(J,de);Ge.missingDuration===0&&Ge.pendingDuration===0&&u.set(!0)}}).catch(Z=>{console.warn("Error in loading corto frame: ",Z)}),E++}else if(n===F.Draco){const R=M*N/m,_=(M+1)*N/m;if(e.getIntersectionDuration(R,_).missingDuration===0){E++;continue}e.addPendingRange(R,_);const z=fr({type:"geometry",geometryType:n,manifestPath:a,target:t,index:E,path:o.geometry.path,format:o.geometry.targets[t].format});(n===F.Draco?Ws:Tn)(z).then(q=>{const Z=n===F.Draco?q.geometry:q.mesh;if(A[E]=Z,e.addBufferedRange(R,_,-1),!u.value){const te=c*N/1e3,J=te+Ee.geometry[n].initialBufferDuration*N,de=e.getIntersectionDuration(te,J);de.missingDuration===0&&de.pendingDuration===0&&u.set(!0)}}).catch(q=>{console.warn("Error in loading draco frame: ",q)}),E++}else if(n===F.Unify){const R=o.geometry.targets[t],_=R.segmentFrameCount,V=Math.floor(M/_),z=V*_,Q=V*R.settings.segmentSize*N,q=(V+1)*R.settings.segmentSize*N;if(e.getIntersectionDuration(Q,q).missingDuration===0){E+=_;continue}e.addPendingRange(Q,q);const te=fr({type:"geometry",geometryType:F.Unify,manifestPath:a,target:t,index:V,path:o.geometry.path,format:"uniform-solve"});Tn(te).then(J=>{const de=J.mesh.geometry.morphAttributes.position,Ge=J.mesh.geometry.morphAttributes.normal;if(de.map((Re,ae)=>{A[z+ae]={position:Re,normal:Ge?Ge[ae]:void 0}}),s.geometry.attributes.position.count!==J.mesh.geometry.attributes.position.count){if(J.mesh.material.map){const ae=J.mesh.material.map;ae&&(d.current.copy(ae.repeat),p.current.copy(ae.offset))}console.log("Initiailizing Unify Geometry");const Re=s.material;s.copy(J.mesh),s.material=Re,s.material.needsUpdate=!0;for(const ae in J.mesh.geometry.attributes)s.geometry.attributes[ae]=J.mesh.geometry.attributes[ae],s.geometry.attributes[ae].needsUpdate=!0;J.mesh.geometry.index&&(s.geometry.index=J.mesh.geometry.index,s.geometry.index.needsUpdate=!0),s.geometry.morphAttributes={},s.morphTargetDictionary=void 0,s.morphTargetInfluences=void 0}if(e.addBufferedRange(Q,q,J.fetchTime),!u.value){const Re=c*N/1e3,ae=Re+Ee.geometry[n].initialBufferDuration*N,qt=e.getIntersectionDuration(Re,ae);qt.missingDuration===0&&qt.pendingDuration===0&&u.set(!0)}}).catch(J=>{console.warn("Error in loading unify frame: ",J)}),E+=_}}},vi=({currentTimeInMS:r,bufferData:e,geometryType:t,geometryBuffer:o,targetData:n,frameRate:a,mesh:i,clearAll:s=!1})=>{if(t===F.Corto||t===F.Draco){let u=a||1;for(const[c,d]of o){if(!o.has(c)||!d||!n||!n[c])continue;t===F.Draco&&(u=n?n[c].frameRate:1);const p=[];d.every((l,f)=>{const m=f*1e3/u,v=(f+1)*1e3/u;return!s&&v>=r?!1:(l.dispose(),p.push(f),!s&&e&&e.removeBufferedRange(m*(N/1e3),v*(N/1e3)),!0)}),p.forEach(l=>{delete d[l]})}}else if(t===F.Unify){const u=i.geometry,c=i.geometry.index,d=new It;d.setIndex(c);for(const p in i.geometry.attributes)d.setAttribute(p,i.geometry.attributes[p]),u.deleteAttribute(p);d.boundingSphere=i.geometry.boundingSphere,d.boundingBox=i.geometry.boundingBox,i.geometry=d;for(const[p,l]of o){if(!o.has(p)||!l||!n||!n[p])continue;const f=[],m=n?n[p].frameRate:1;l.every((v,b)=>{const g=b*1e3/m,S=(b+1)*1e3/m;if(!s&&S>=r)return!1;const P=v;return u.setAttribute(`position_${b}`,P.position),P.normal&&u.setAttribute(`normal_${b}`,P.normal),f.push(b),!s&&e&&e.removeBufferedRange(g*(N/1e3),S*(N/1e3)),!0}),f.forEach(v=>{delete l[v]}),u.dispose()}}},Qs=({currentTimeInMS:r,bufferData:e,target:t,manifest:o,textureType:n,manifestPath:a,textureBuffer:i,textureFormat:s,initialBufferLoaded:u,startTimeInMS:c})=>{var S,P,A;const d=r*(N/1e3),p=e.getNextMissing(d),l=(S=o.texture[n])==null?void 0:S.targets[t].frameRate,f=(P=o.texture[n])==null?void 0:P.targets[t].frameCount,m=Math.floor(p*l/N),v=Math.max(0,Math.min(kt||Mt?Ee.texture[s].mobileMaxBufferDuration:Ee.texture[s].desktopMaxBufferDuration,o.duration-r/1e3));if(m>=f||p-d>=v*N)return;const b=Math.min(f-1,Math.floor((d+v*N)*l/N));if(b<m)return;i.has(t)||i.set(t,[]);const g=i.get(t);for(let E=m;E<=b;E++){const M=E,R=l>0?M*N/l:0,_=l>0?(M+1)*N/l:o.duration*N;if(e.getIntersectionDuration(R,_).missingDuration===0)continue;e.addPendingRange(R,_);const z=fr({type:"texture",textureType:n,format:(A=o.texture[n])==null?void 0:A.targets[t].format,index:M,target:t,path:o.texture.baseColor.path,manifestPath:a});Xs(z).then(Q=>{if(g[M]=Q.texture,e.addBufferedRange(R,_,Q.fetchTime),!u.value){const q=c*N/1e3,Z=q+Ee.texture[s].initialBufferDuration*N,te=e.getIntersectionDuration(q,Z);te.missingDuration===0&&te.pendingDuration===0&&u.set(!0)}}).catch(Q=>{console.warn("Error in loading ktx2 frame: ",Q)})}},yi=({currentTimeInMS:r,bufferData:e,textureBuffer:t,textureType:o,targetData:n,clearAll:a=!1})=>{for(const[i,s]of t){if(!s||!n||!n[i])continue;const u=n?n[i].frameRate:1;if(u===0)continue;const c=[];s.every((d,p)=>{const l=p*1e3/u,f=(p+1)*1e3/u;return u===0?(a&&(d.dispose(),c.push(p),e&&(e==null||e.removeBufferedRange(0,1/0))),!1):!a&&f>=r?!1:(d.dispose(),c.push(p),!a&&e&&e.removeBufferedRange(l*(N/1e3),f*(N/1e3)),!0)}),c.forEach(d=>{delete s[d]})}},at=dt({name:"PlaylistComponent",jsonID:"EE_playlist",schema:h.Object({tracks:h.Array(h.Object({uuid:h.String(),src:h.String()})),currentTrackUUID:h.String(),currentTrackIndex:h.Number({default:-1}),paused:h.Bool({default:!0}),playMode:h.Enum(me,{$comment:"A string enum, ie. one of the following values: 'single', 'random', 'loop', 'singleloop'",default:me.loop}),autoplay:h.Bool({default:!0})}),toJSON:r=>({tracks:r.tracks,playMode:r.playMode,autoplay:r.autoplay}),playNextTrack:(r,e=1)=>{const t=ve(r,at),o=t.tracks.value.length;if(o!==0){if(o===1||t.playMode.value===me.singleloop){const n=t.currentTrackUUID.value;t.currentTrackUUID.set(""),t.currentTrackUUID.set(n);return}if(t.playMode.value===me.loop){const n=(t.currentTrackIndex.value+e+o)%o;t.currentTrackUUID.set(t.tracks[n].uuid.value)}else if(t.playMode.value===me.random){let n=(Math.floor(Math.random()*o)+o)%o;for(;n===t.currentTrackIndex.value;)n=(Math.floor(Math.random()*o)+o)%o;t.currentTrackUUID.set(t.tracks[n].uuid.value)}}},reactor:()=>{const r=Bt(),e=ke(r,at),t=o=>{for(let n=0;n<e.tracks.length;n++)if(e.tracks[n].uuid.value===o)return{track:e.tracks[n].get(be),index:n};return{track:void 0,index:-1}};return O.useEffect(()=>{const o=t(e.currentTrackUUID.value).index;e.currentTrackIndex.set(o)},[e.currentTrackUUID,e.tracks]),O.useEffect(()=>{if(e.tracks.length===0){e.merge({currentTrackUUID:"",currentTrackIndex:-1});return}},[e.tracks]),O.useEffect(()=>{if(e.autoplay.value&&e.tracks.length>0){let o=-1;for(let n=0;n<e.tracks.length;n++)if(e.tracks[n].src.value!==""){o=n;break}if(o===-1)return;e.currentTrackUUID.value===""&&(e.merge({currentTrackUUID:e.tracks[o].uuid.value,currentTrackIndex:o}),e.paused.set(!1))}},[e.autoplay,e.tracks]),null}}),D={},Zs={useVideoTextureForBaseColor:!1,useLoadingEffect:!0,volume:1,checkForEnoughBuffers:!0,notEnoughBuffers:!0,time:{start:0,checkpointAbsolute:-1,checkpointRelative:0,currentTime:0,bufferedUntil:0,duration:0},geometry:{targets:[],initialBufferLoaded:!1,firstFrameLoaded:!1,currentTarget:0,userTarget:-1},geometryType:void 0,textureBuffer:void 0,setIntervalId:-1,texture:{},textureInfo:{textureTypes:[],initialBufferLoaded:{},firstFrameLoaded:{}},paused:!0,preTrackBufferingCallback:void 0},eu={useVideoTextureForBaseColor:!1,checkForEnoughBuffers:!0,notEnoughBuffers:!0,time:{start:0,checkpointAbsolute:-1,checkpointRelative:0,currentTime:0,bufferedUntil:0,duration:0},geometry:{targets:[],initialBufferLoaded:!1,firstFrameLoaded:!1,currentTarget:0,userTarget:-1},geometryType:void 0,textureBuffer:void 0,setIntervalId:-1,texture:{},textureInfo:{textureTypes:[],initialBufferLoaded:{},firstFrameLoaded:{}},paused:!0},St=h.LiteralUnion(["normal","metallicRoughness","emissive","occlusion","baseColor"]);h.Optional(h.Func([h.Type()],h.Void()));const H=dt({name:"VolumetricComponent",jsonID:"IR_volumetric",schema:h.Object({useVideoTextureForBaseColor:h.Bool({default:!1}),useLoadingEffect:h.Bool({default:!0}),volume:h.Number({default:1}),checkForEnoughBuffers:h.Bool({default:!0}),notEnoughBuffers:h.Bool({default:!0}),time:h.Object({start:h.Number({default:0}),checkpointAbsolute:h.Number({default:-1}),checkpointRelative:h.Number({default:0}),currentTime:h.Number({default:0}),bufferedUntil:h.Number({default:0}),duration:h.Number({default:0})}),geometry:h.Object({targets:h.Array(h.String()),initialBufferLoaded:h.Bool({default:!1}),firstFrameLoaded:h.Bool({default:!1}),currentTarget:h.Number({default:0}),userTarget:h.Number({default:-1})}),geometryType:h.Enum(F,{$comment:"A number enum, where: 0 represents 'Corto', 1 represents 'Draco', 2 represents 'Unify'",default:F.Corto}),textureBuffer:h.Type({default:()=>new Map}),setIntervalId:h.Number({default:-1}),texture:h.Record(St,h.Object({initialBufferLoaded:h.Bool(),firstFrameLoaded:h.Bool(),targets:h.Array(h.String()),currentTarget:h.Number(),userTarget:h.Number()})),textureInfo:h.Object({textureTypes:h.Array(St),initialBufferLoaded:h.Partial(h.Record(St,h.Bool())),firstFrameLoaded:h.Partial(h.Record(St,h.Bool()))}),paused:h.Bool({default:!0}),preTrackBufferingCallback:h.Optional(h.Func([h.Type()],h.Void()))}),toJSON:r=>({useLoadingEffect:r.useLoadingEffect,volume:r.volume}),errors:["INVALID_TRACK","GEOMETRY_ERROR","TEXTURE_ERROR","UNKNOWN_ERROR"],canPlayWithoutPause:r=>{const e=ve(r,H),t=D[r].manifest;if(Object.keys(t).length===0)return!1;const o=e.time.currentTime.value,n=D[r].geometryBufferData;let a=-1;const i=e.geometryType.value;if(i===F.Corto){const p=t.frameData.length,l=t.frameRate;a=p*1e3/l}else if(i===F.Unify||i===F.Draco)a=t.duration*1e3;else return console.error("Invalid geometry type"),!1;if(!e.geometry.initialBufferLoaded.value)return!1;const s=o*N/1e3,u=Math.min(a*N/1e3,s+Ee.geometry[i].minBufferDurationToPlay*N),c=n.getIntersectionDuration(s,u);if(c.missingDuration>0||c.pendingDuration>0)return H.adjustGeometryTarget(r,1),!1;if(e.useVideoTextureForBaseColor.value)return!0;const d=e.textureInfo.textureTypes.value;for(const p of d){const l=e.texture[p].get(be),f=D[r].texture[p];if(!l||!f||!e.textureInfo.initialBufferLoaded.value[p])return!1;const m=f.bufferData,v=l.targets[l.currentTarget],b=t.texture[p].targets[v].format,g=Math.min(a*N/1e3,s+Ee.texture[b].minBufferDurationToPlay*N),S=m.getIntersectionDuration(s,g);if(S.missingDuration>0||S.pendingDuration>0)return H.adjustTextureTarget(r,p,1),!1}return!0},adjustGeometryTarget:(r,e)=>{const t=ve(r,H);if(t.geometry.userTarget.value!==-1){t.geometry.currentTarget.value!==t.geometry.userTarget.value&&t.geometry.currentTarget.set(t.geometry.userTarget.value);return}const o=t.geometryType.value,n=D[r].geometryBufferData;if(o!==F.Corto){const{totalFetchTime:a,totalPlayTime:i}=n.getMetrics();if(e===void 0&&i<4*N)return;const s=e===void 0?a/i:e;s>=.5?t.geometry.currentTarget.value>0&&(console.log("Decreasing geometry target, from ",t.geometry.currentTarget.value),t.geometry.currentTarget.set(u=>u-1)):s<=.1&&t.geometry.currentTarget.value<t.geometry.targets.value.length-1&&(console.log("Increasing geometry target from ",t.geometry.currentTarget.value),t.geometry.currentTarget.set(u=>u+1)),e===void 0&&n.resetMetrics()}},adjustTextureTarget:(r,e,t)=>{const o=ve(r,H),n=o.texture[e].get(be),a=D[r].texture[e];if(n&&a){if(n.userTarget!==-1){n.currentTarget!==n.userTarget&&o.texture[e].merge({currentTarget:n.userTarget});return}const i=a.bufferData,{totalFetchTime:s,totalPlayTime:u}=i.getMetrics();if(t===void 0&&u<4*N)return;const c=t===void 0?s/u:t;c>=.5?n.currentTarget>0&&o.texture[e].merge({currentTarget:n.currentTarget-1}):c<=.1&&n.currentTarget<n.targets.length-1&&o.texture[e].merge({currentTarget:n.currentTarget+1}),t===void 0&&i.resetMetrics()}},cleanupTrack:r=>{const e=ve(r,H);console.log("Cleaning up track"),clearInterval(e.setIntervalId.value),console.log("Cleared buffer loop interval: ",e.setIntervalId.value);const t=D[r].mesh;t&&D[r].group&&D[r].group.remove(t),D[r].group&&si(r,D[r].group);const o=D[r].material,n=5*60*1e3,a=D[r].geometryBuffer;Object.keys(D[r].texture).forEach(c=>{const d=D[r].texture[c];if(d){const p=d.buffer;yi({currentTimeInMS:n,textureBuffer:p,textureType:c,clearAll:!0}),p.clear()}});const s=o!=null&&o.vertexShader.includes("keyframeANormal")?F.Unify:F.Corto;vi({currentTimeInMS:n,geometryBuffer:a,geometryType:s,mesh:t,clearAll:!0}),a.clear(),o&&o.dispose(),t&&t.geometry.dispose(),console.log("Setting track to initial state: ",Zs),e.merge(structuredClone(eu)),D[r].geometryBufferData=new Co;const u=oi(r,fe);if(u){const c=u.element.get(be);c.src=""}we(r,H)&&ui(r,H)},onRemove:r=>{H.cleanupTrack(r)},reactor:tu});function tu(){const r=Bt(),e=Ot(r,at),t=ke(r,H),o=O.useRef(-1),n=ee(ft).audioContext,a=ee(ft).gainNodeMixBuses,i=O.useRef(new $e(1,1)),s=O.useRef(new $e(0,0));O.useEffect(()=>{if(!t.geometry.initialBufferLoaded.value)return;if(t.useVideoTextureForBaseColor.value){ko(r,D[r].group);const v=xe(r,fe).element;zs({audioContext:n,media:v,paused:e.paused});return}const f=t.textureInfo.initialBufferLoaded.get(be),m=t.textureInfo.textureTypes.value;for(const v of m)if(!f[v])return;e!=null&&e.autoplay.value&&(e!=null&&e.paused.value)?e.paused.set(!1):e!=null&&e.autoplay.value&&!(e!=null&&e.paused.value)&&(t.time.checkpointAbsolute.set(Date.now()),t.paused.set(!1)),console.log("All initial buffers loaded"),ko(r,D[r].group)},[t.geometry.initialBufferLoaded,t.textureInfo.initialBufferLoaded]);const u=()=>{var S;if(!we(r,H)){clearInterval(o.current);return}const f=t.time.currentTime.value,m=t.geometry.targets[t.geometry.currentTarget.value].value,v=D[r].manifest,b=t.geometryType.value,g=(S=e==null?void 0:e.tracks.value.find(P=>P.uuid===e.currentTrackUUID.value))==null?void 0:S.src;g&&(Js({currentTimeInMS:f,bufferData:D[r].geometryBufferData,target:m,manifest:v,geometryType:b,manifestPath:g,geometryBuffer:D[r].geometryBuffer,mesh:D[r].mesh,startTimeInMS:t.time.start.value,initialBufferLoaded:t.geometry.initialBufferLoaded,repeat:i,offset:s}),t.useVideoTextureForBaseColor.value||t.textureInfo.textureTypes.value.forEach(P=>{const A=t.texture[P].get(be),E=D[r].texture[P];if(A&&E){const M=E.bufferData,R=E.buffer,_=A.targets[A.currentTarget],V=v.texture[P].targets[_].format;P in t.textureInfo.initialBufferLoaded.value||t.textureInfo.initialBufferLoaded.merge({[P]:!1});const z=t.textureInfo.initialBufferLoaded[P];Qs({currentTimeInMS:f,bufferData:M,target:_,manifest:v,textureType:P,manifestPath:g,textureBuffer:R,textureFormat:V,startTimeInMS:t.time.start.value,initialBufferLoaded:z})}}))};O.useEffect(()=>{we(r,fe)||Oe(r,fe,{element:document.createElement("video")}),D[r]={material:null,mesh:null,group:new ci,manifest:{},geometryBufferData:new Co,geometryBuffer:new Map,texture:{}};const m=xe(r,fe).element;if(!hr.get(m)){const v=n.createMediaElementSource(m);fi(m,v,a.soundEffects).gain.gain.setTargetAtTime(t.volume.value,n.currentTime,.1)}},[]),O.useEffect(()=>{const f=t.volume.value,m=ar(r,fe);if(m){const v=m.element,b=hr.get(v);b&&b.gain.gain.setTargetAtTime(f,n.currentTime,.1)}},[t.volume]);const c=f=>{try{if(!f)return pe(r,H,"INVALID_TRACK","Manifest is empty"),!1;if(f.frameData!==void 0&&f.frameRate!==void 0){if(t.useVideoTextureForBaseColor.set(!0),t.geometryType.set(F.Corto),t.textureInfo.textureTypes.set(["baseColor"]),t.time.duration.set(f.frameData.length/f.frameRate),t.texture.set({baseColor:{targets:[],initialBufferLoaded:!1,firstFrameLoaded:!1,currentTarget:0,userTarget:-1}}),t.geometry.targets.set(["corto"]),!ee(Ie).cortoLoader){const m=new pi;m.setDecoderPath(ee(ai).publicDomain+"/loader_decoders/"),m.preload(),ni(Ie).cortoLoader.set(m)}}else if(f.duration!==void 0){const m=f;if(m.duration<=0||m.duration>10800)return pe(r,H,"INVALID_TRACK",`Invalid duration: ${m.duration}`),!1;t.useVideoTextureForBaseColor.set(!1),t.time.duration.set(m.duration);const v=Object.keys(m.geometry.targets);if(v.length===0)return pe(r,H,"GEOMETRY_ERROR","No geometry targets found"),!1;v.sort((S,P)=>{const A=m.geometry.targets[S],E=m.geometry.targets[P],M=A.settings.simplificationRatio??1,R=E.settings.simplificationRatio??1,_=A.frameRate*M,V=E.frameRate*R;return _-V}),v.forEach((S,P)=>{m.geometry.targets[S].priority=P}),t.geometry.targets.set(v);const b=Fs[m.geometry.targets[v[0]].format];if(b===void 0)return pe(r,H,"GEOMETRY_ERROR","Invalid geometry format"),!1;t.geometryType.set(b);const g=Object.keys(m.texture);if(g.length===0)return pe(r,H,"TEXTURE_ERROR","No texture types found"),!1;if(!g.includes("baseColor"))return pe(r,H,"TEXTURE_ERROR","No baseColor texture found"),!1;t.textureInfo.textureTypes.set(g),g.forEach(S=>{var A;const P=(A=m.texture[S])==null?void 0:A.targets;if(P){if(Object.keys(P).length===0)return pe(r,H,"TEXTURE_ERROR",`No texture targets found for type: ${S}`),!1;const M=Ks(P);M.forEach((R,_)=>{P[R].priority=_}),t.texture.merge({[S]:{targets:M,initialBufferLoaded:!1,firstFrameLoaded:!1,currentTarget:0,userTarget:-1}}),D[r].texture[S]={bufferData:new Co,buffer:new Map}}else return pe(r,H,"TEXTURE_ERROR",`No texture targets found for type: ${S}`),!1})}}catch(m){return pe(r,H,"UNKNOWN_ERROR","Error in reading the manifest"),console.error("Error in reading the manifest: ",m),!1}return ui(r,H),console.log("Manifest read successfully"),f};O.useEffect(()=>{if(!(e!=null&&e.currentTrackUUID.value))return;H.cleanupTrack(r);const f=e.tracks.value.find(v=>v.uuid===e.currentTrackUUID.value);if(!f||!f.src){pe(r,H,"INVALID_TRACK","Track source is empty");return}let m=f.src;f.src.endsWith(".mp4")&&(m=f.src.replace(".mp4",".manifest")),fetch(m).then(v=>{if(!v.ok)throw new Error(`Unable to load the manifest: ${v.statusText}`);return v.json()}).then(v=>{const b=c(v);if(!b)return;D[r].manifest=b;const g=t.preTrackBufferingCallback.value;g&&g(t),t.time.currentTime.set(t.time.start.value);const S=t.geometryType.value!==F.Corto?t.geometry.targets[0].value:"",P=t.geometryType.value===F.Unify&&!b.geometry.targets[S].settings.excludeNormals,A=t.geometryType.value!==F.Corto?b.materialProperties:void 0;D[r].material=Hs(t.geometryType.value,t.useVideoTextureForBaseColor.value,P,t.textureInfo.textureTypes.value,A),D[r].mesh=new Er(new mi(.001,32,32),D[r].material),D[r].group.add(D[r].mesh),D[r].mesh.material=D[r].material,D[r].mesh.material.needsUpdate=!0;const E=setInterval(u,500);t.setIntervalId.set(E),o.current=E,console.log("Buffer loop started: ",E);const M=ve(r,fe);if(t.useVideoTextureForBaseColor.value){const R=M.element.get(be);if(t.useVideoTextureForBaseColor.value){R.playsInline=!0,R.preload="auto",R.crossOrigin="anonymous",R.src=f.src.replace(".manifest",".mp4"),R.currentTime=t.time.currentTime.value/1e3,R.load(),R.addEventListener("ended",()=>{e&&at.playNextTrack(r)});const _=()=>{if(!t.textureInfo.firstFrameLoaded.get(be).baseColor){const q=new Xo(R);q.generateMipmaps=!1,q.minFilter=lt,q.magFilter=lt,q.isVideoTexture=!0,q.update=()=>{},q.colorSpace=Sr,q.flipY=!0,D[r].mesh.material.uniforms.map.value=q,q.needsUpdate=!0,t.textureInfo.firstFrameLoaded.baseColor.set(!0),console.log("Video source set: ",R.src,R,q),R.removeEventListener("canplay",_)}};R.addEventListener("canplay",_);let V=-1;const z=(Q,q)=>{const Z=q.mediaTime*1e3;l(Z),t.time.currentTime.set(Z),H.canPlayWithoutPause(r)||R.paused||(R.pause(),V=setInterval(()=>{H.canPlayWithoutPause(r)&&V!==-1&&(clearInterval(V),V=-1,!(e!=null&&e.paused.value)&&t.geometry.initialBufferLoaded.value&&R.play())},500));const te=Math.round(q.mediaTime*b.frameRate),J=D[r].geometryBuffer.get("corto");J&&J[te]&&(d(Z),D[r].material.uniforms.map.value,D[r].material.uniforms.map.value&&(D[r].material.uniforms.map.value.needsUpdate=!0)),R.requestVideoFrameCallback(z)};R.requestVideoFrameCallback(z)}}}).catch(v=>{pe(r,H,"INVALID_TRACK","Error in loading the manifest"),console.error(`Error in loading the manifest: ${f.src}: `,v)})},[e==null?void 0:e.currentTrackUUID]),O.useEffect(()=>{console.log("Paused: ",t.paused.value);const f=Date.now(),m=ar(r,fe);if(!e||e!=null&&e.paused.value){t.paused.set(!0),t.useVideoTextureForBaseColor.value&&m&&!m.element.paused&&m.element.pause();const v=t.time.checkpointAbsolute.value,b=v!==-1?t.time.checkpointRelative.value+f-v:t.time.start.value,g=f;t.time.merge({checkpointAbsolute:g,checkpointRelative:b})}else{const v=f;t.time.checkpointAbsolute.set(v),t.useVideoTextureForBaseColor.value&&m&&m.element.paused&&m.element.src&&m.element.play(),t.paused.set(!1)}},[e==null?void 0:e.paused]);const d=f=>{const m=D[r].geometryBuffer,v=D[r].mesh,b=t.geometryType.value,g=t.geometryType.value!==F.Corto?D[r].manifest.geometry.targets:void 0,S=t.geometryType.value===F.Corto?D[r].manifest.frameRate:void 0;H.adjustGeometryTarget(r);const P=t.geometry.targets[t.geometry.currentTarget.value].value;vi({geometryBuffer:m,currentTimeInMS:f-500,geometryType:b,targetData:g,frameRate:S,mesh:v,bufferData:D[r].geometryBufferData});const A=En({geometryBuffer:m,currentTimeInMS:f,preferredTarget:P,geometryType:b,targets:t.geometry.targets.value,...b===F.Corto&&{frameRate:S},...b!==F.Corto&&{targetData:g},...b===F.Unify&&{keyframeName:"keyframeA"}});if(A){if(b===F.Corto||b===F.Draco){const E=A.geometry;v.geometry!==E&&(v.geometry=E,v.geometry.attributes.position.needsUpdate=!0)}}else if(b!==F.Unify){console.warn("Geometry frame not found at time: ",f/1e3);return}if(b===F.Unify){const E=A,M=En({geometryBuffer:m,currentTimeInMS:f,preferredTarget:P,geometryType:b,targets:t.geometry.targets.value,targetData:g,...b===F.Unify&&{keyframeName:"keyframeB"}});if(E&&(v.geometry.attributes.keyframeAPosition!==E.geometry.position&&(v.geometry.attributes.keyframeAPosition=E.geometry.position,v.geometry.attributes.keyframeAPosition.needsUpdate=!0),E.geometry.normal&&v.geometry.attributes.keyframeANormal!==E.geometry.normal&&(v.geometry.attributes.keyframeANormal=E.geometry.normal,v.geometry.attributes.keyframeANormal.needsUpdate=!0)),M&&(v.geometry.attributes.keyframeBPosition!==M.geometry.position&&(v.geometry.attributes.keyframeBPosition=M.geometry.position,v.geometry.attributes.keyframeBPosition.needsUpdate=!0),M.geometry.normal&&v.geometry.attributes.keyframeBNormal!==M.geometry.normal&&(v.geometry.attributes.keyframeBNormal=M.geometry.normal,v.geometry.attributes.keyframeBNormal.needsUpdate=!0)),!E&&!M)return;if(!E&&M)v.material.uniforms.mixRatio.value=1;else if(E&&!M)v.material.uniforms.mixRatio.value=0;else if(E&&M){const R=E.index*1e3/g[E.target].frameRate,_=M.index*1e3/g[M.target].frameRate,V=Math.abs(f-R),z=Math.abs(f-_),Q=V+z>0?V/(V+z):.5;v.material.uniforms.mixRatio.value=Q}}},p=f=>{const m=t.textureInfo.textureTypes.value,v=D[r].manifest,b=D[r].material;m.forEach(g=>{const S=t.texture[g].get(be),P=v.texture[g].targets,A=D[r].texture[g];if(S&&A){H.adjustTextureTarget(r,g),yi({textureBuffer:A.buffer,currentTimeInMS:f-500,bufferData:A.bufferData,textureType:g,targetData:P});const E=S.targets,M=S.targets[S.currentTarget],R=Ys({textureBuffer:A.buffer,currentTimeInMS:f,preferredTarget:M,targets:E,targetData:P});if(!R){console.warn(`Texture frame not found at time: ${f/1e3}`),console.log(A.buffer,S);return}const _=Ns[g],V=`${_}Transform`;b.uniforms[_].value!==R.texture&&(R.texture.repeat.set(i.current.x,i.current.y),R.texture.offset.set(s.current.x,s.current.y),R.texture.updateMatrix(),R.texture.matrixAutoUpdate=!1,_ in b.uniforms?b.uniforms[_].value=R.texture:b.uniforms[_]={value:R.texture},b.uniforms[_].value.needsUpdate=!0,V in b.uniforms?b.uniforms[V].value.copy(R.texture.matrix):b.uniforms[V]={value:R.texture.matrix})}})},l=f=>{let m=Number.MAX_VALUE;const v=D[r].geometryBufferData;if(m=Math.min(m,v.getBufferedUntil(f*N/1e3)),!t.useVideoTextureForBaseColor.value){const b=t.textureInfo.textureTypes.value;for(const g of b){const S=t.texture[g].get(be),P=D[r].texture[g];if(S&&P){const A=P.bufferData;m=Math.min(m,A.getBufferedUntil(f*N/1e3))}}}t.time.bufferedUntil.set(m*1e3/N)};return Vo(()=>{const f=ar(r,at);if(!f||t.geometryType.value===F.Corto&&t.useVideoTextureForBaseColor.value||f.paused||!f.currentTrackUUID)return;const m=Date.now(),v=t.paused.value||f.paused||t.notEnoughBuffers.value?t.time.checkpointRelative.value:t.time.checkpointRelative.value+m-t.time.checkpointAbsolute.value;if(v>t.time.duration.value*1e3){console.log("CurrentTime: ",v," Duration: ",t.time.duration.value*1e3),console.log("Track ended"),at.playNextTrack(r);return}if(l(v),t.checkForEnoughBuffers.value)if(H.canPlayWithoutPause(r)){if(t.notEnoughBuffers.value){t.notEnoughBuffers.set(!1);const g=m;t.time.checkpointAbsolute.set(g)}}else{if(t.notEnoughBuffers.value)return;{t.notEnoughBuffers.set(!0);const g=t.time.checkpointAbsolute.value,S=g!==-1?t.time.checkpointRelative.value+m-g:t.time.start.value,P=m;t.time.merge({checkpointAbsolute:P,checkpointRelative:S});return}}const b=v;t.time.currentTime.set(b),d(v),t.useVideoTextureForBaseColor.value||p(v)},{with:qo}),null}const ru=r=>{const e=Object.keys(r.geometry.targets);e.sort((a,i)=>{const s=r.geometry.targets[a],u=r.geometry.targets[i],c=s.settings.simplificationRatio??1,d=u.settings.simplificationRatio??1,p=s.frameRate*c,l=u.frameRate*d;return p-l}),e.forEach((a,i)=>{r.geometry.targets[a].priority=i});const t={baseColor:[],normal:[],metallicRoughness:[],emissive:[],occlusion:[]};let o=!1;const n=Object.keys(r.texture);for(let a=0;a<n.length;a++){const i=n[a],s=Object.keys(r.texture[i].targets),u=[],c=[];s.forEach(d=>{const p=r.texture[i].targets[d];kt||Mt?p.format==="astc/ktx2"&&u.push(d):p.format==="ktx2"&&u.push(d),p.format==="video"&&c.push(d)}),u.length===0&&u.push(...s),c.length>0&&ys&&!kt&&!Mt&&(u.length=0,o=!0,u.push(...c)),u.sort((d,p)=>{const l=r.texture[i].targets[d],f=r.texture[i].targets[p],m=l.frameRate*l.settings.resolution.width*l.settings.resolution.height,v=f.frameRate*f.settings.resolution.width*f.settings.resolution.height;return m-v}),u.forEach((d,p)=>{r.texture[i].targets[d].priority=p}),t[i]=u}return[r,e,t,o]},ou=r=>{const e={baseColor:{USE_MAP:"",MAP_UV:"uv"},normal:{USE_NORMALMAP:"",NORMALMAP_UV:"uv"},metallicRoughness:{USE_METALNESSMAP:"",METALNESSMAP_UV:"uv",USE_ROUGHNESSMAP:"",ROUGHNESSMAP_UV:"uv"},emissive:{USE_EMISSIVEMAP:"",EMISSIVEMAP_UV:"uv"},occlusion:{USE_AOMAP:"",AOMAP_UV:"uv"}};let t={};const o=Object.keys(r.texture);for(let n=0;n<o.length;n++){const a=o[n];t={...t,...e[a]}}return t},Xe=1/30,it=(r,e,t,o,n=Xe)=>{let a=0,i=-1;if(o||(r=r.filter(s=>s.fetchTime!==-1)),r.length===0||r[0].start>e||r[r.length-1].end<t)return!1;for(const s of r)if(s.start<=e){if(s.end>=t)return!0;i=s.end}else{if(a=s.start-i,a>n)return!1;i=s.end}return!0};function wn(r,e){const t=r.get(ir);if(t.length===0)return[];t.sort((a,i)=>a.start-i.start);const o=[];let n=t[0];for(let a=1;a<t.length;a++){const i=t[a];i.fetchTime>-1&&n.fetchTime>-1&&(i.start<=n.end||i.start-n.end<=e)?n.end=Math.max(n.end,i.end):(o.push(n),n=i)}o.push(n),r.set(o)}const nu=h.Object({start:h.Number(),end:h.Number(),fetchTime:h.Number()}),Qe=h.Object({targets:h.Array(h.String()),userTarget:h.Number({default:-1}),currentTarget:h.Number({default:0}),buffered:h.Array(nu)}),oe=dt({name:"UVOL2Component",schema:h.Object({canPlay:h.Bool({default:!1}),manifestPath:h.String({default:""}),data:h.Type({default:{}}),useVideoTexture:h.Bool({default:!0}),hasAudio:h.Bool({default:!1}),bufferedUntil:h.Number({default:0}),geometryInfo:Qe,textureInfo:h.Object({textureTypes:h.Array(St),baseColor:Qe,normal:Qe,metallicRoughness:Qe,emissive:Qe,occlusion:Qe}),initialGeometryBuffersLoaded:h.Bool({default:!1}),initialTextureBuffersLoaded:h.Bool({default:!1}),firstGeometryFrameLoaded:h.Bool({default:!1}),firstTextureFrameLoaded:h.Bool({default:!1}),loadingEffectStarted:h.Bool({default:!1}),loadingEffectEnded:h.Bool({default:!1})}),setStartAndPlaybackTime:(r,e,t)=>{ve(r,ce).currentTrackInfo.merge({playbackStartDate:t,mediaStartTime:e})},canPlayThrough:(r,e,t)=>{const o=ar(r,oe);if(!o||(t=Math.min(t,o.data.duration),!it(o.geometryInfo.buffered,e,t,!1,Xe)))return!1;if(!o.useVideoTexture){for(const n of o.textureInfo.textureTypes)if(!it(o.textureInfo[n].buffered,e,t,!1,Xe))return!1}return!0},reactor:fu}),au=r=>new Promise((e,t)=>{const o=performance.now();ii.loadAsync(r,!0).then(n=>{const[a]=ri(n,[yr]),i=xe(a,yr);e({mesh:i,fetchTime:performance.now()-o})}).catch(n=>{console.error("Error loading geometry: ",r,n),t(n)})}),iu=(r,e,t)=>new Promise((o,n)=>{const a=performance.now();Ts(Ms.KTX2).load(r,i=>{i.repeat.copy(e),i.offset.copy(t),i.updateMatrix(),o({texture:i,fetchTime:performance.now()-a})},void 0,i=>{console.error("Error loading texture: ",r,i),n(i)})}),su=r=>{let e=0;for(let t=0;t<r.length;t++)r[t]==="#"&&e++;return e},Jt=(r,e,t,o,n,a)=>{let i=r;if(i=r.replace("[ext]",Ds[t]),a&&(i=i.replace("[type]",a)),o!==void 0&&(i=i.replace("[target]",o)),n=n??0,n!==void 0){const s=su(i),u="["+"#".repeat(s)+"]",c=n.toString().padStart(s,"0");i=i.replace(u,c)}if(!i.startsWith("http")){const s=e.split("/");s.pop(),s.push(i),i=s.join("/")}return i},Et=7,uu=(r,e,t)=>{let o=r;return o+=e.toString().padStart(Et,"0"),o};function fu(){const r=Bt(),e=ke(r,ce),t=ke(r,oe),o=Ot(r,br),n=ee(wt),a=ve(r,fe).value,i=ee(ft).audioContext,s=a.element,u=O.useMemo(()=>{const y=new Xo(s);return y.generateMipmaps=!1,y.minFilter=lt,y.magFilter=lt,y.isVideoTexture=!0,y.update=()=>{},y.colorSpace=Sr,y.flipY=!1,y},[]),c=O.useMemo(()=>new Map,[]),d=O.useMemo(()=>new Map,[]);let p=14;const l=2,f=O.useMemo(()=>new $e(1,1),[]),m=O.useMemo(()=>new $e(0,0),[]);vs(e.currentTrackInfo.mediaStartTime);const v=O.useMemo(()=>{const y=t.data.value;let T=new li({color:16777215});if(y.type===ot.UNIFORM_SOLVE_WITH_COMPRESSED_TEXTURE){const w=Object.keys(y.geometry.targets)[0],I=!y.geometry.targets[w].settings.excludeNormals?"physical":"basic";let k=_e[I].vertexShader.replace("#include <clipping_planes_pars_vertex>",`#include <clipping_planes_pars_vertex>
attribute vec3 keyframeA;
attribute vec3 keyframeB;
attribute vec3 keyframeANormal;
attribute vec3 keyframeBNormal;
uniform float mixRatio;
uniform vec2 repeat;
uniform vec2 offset;
out vec2 custom_vUv;`);k=k.replace("#include <begin_vertex>",`
vec3 transformed = vec3(position);
transformed.x += mix(keyframeA.x, keyframeB.x, mixRatio);
transformed.y += mix(keyframeA.y, keyframeB.y, mixRatio);
transformed.z += mix(keyframeA.z, keyframeB.z, mixRatio);

#ifdef USE_ALPHAHASH

  vPosition = vec3( transformed );

#endif`),k=k.replace("#include <beginnormal_vertex>",`
      vec3 objectNormal = vec3( normal );
      objectNormal.x += mix(keyframeANormal.x, keyframeBNormal.x, mixRatio);
      objectNormal.y += mix(keyframeANormal.y, keyframeBNormal.y, mixRatio);
      objectNormal.z += mix(keyframeANormal.z, keyframeBNormal.z, mixRatio);

      #ifdef USE_TANGENT

        vec3 objectTangent = vec3( tangent.xyz );

      #endif`);const L=_e[I].fragmentShader,C={mixRatio:{value:0},map:{value:null},mapTransform:{value:new Is}},x=Tr.merge([_e.physical.uniforms,Wo.lights,C]),B=ou(y);if(y.materialProperties){const W=Object.keys(y.materialProperties);for(let G=0;G<W.length;G++){const X=W[G];X!=="normalScale"?x[X].value=y.materialProperties[X]:x[X].value=new $e(y.materialProperties[X][0],y.materialProperties[X][1])}}T=new $t({vertexShader:k,fragmentShader:L,uniforms:x,defines:B,lights:!0})}return T},[]),b=O.useMemo(()=>new mi(3,32,32),[]),g=O.useMemo(()=>new Er(b,v),[]),S=O.useMemo(()=>{const y=new ci;return y.add(g),y},[]);O.useEffect(()=>{e.useLoadingEffect.value&&Oe(r,Se);const[y,T,w,$]=ru(t.data.get({noproxy:!0}));t.data.set(y),t.geometryInfo.targets.set(T),t.useVideoTexture.set($),$?e.useLoadingEffect.set(!1):e.useLoadingEffect.set(!0);const I=Object.keys(y.texture);if(t.textureInfo.textureTypes.set(I),I.forEach(x=>{t.textureInfo[x].targets.set(w[x])}),t.data.geometry.targets[T[0]].totalSize){const x=t.data.geometry.targets[T[0]].totalSize.value/t.data.duration.value,B=I.reduce((G,X)=>{const K=w[X][0],ue=t.data.value.texture[X].targets[K];return G+ue.totalSize/t.data.duration.value},0),W=x+B;W<=5*1024*1024?p=15:W<=10*1024*1024&&(p=10),As&&(p=5)}const k=ve(r,br);y.type===ot.UNIFORM_SOLVE_WITH_COMPRESSED_TEXTURE?(k.cast.set(!1),k.receive.set(!1)):(k.cast.set(!0),k.receive.set(!0));const L=s;if(y.audio&&(t.hasAudio.set(!0),L.src=Jt(y.audio.path,t.manifestPath.value,y.audio.formats[0]),L.playbackRate=y.audio.playbackRate),$){const x=w.baseColor[0];L.src=Jt(t.data.texture.baseColor.value.path,t.manifestPath.value,"video",x,void 0,"baseColor"),L.preload="auto",s.addEventListener("loadeddata",()=>{t.firstTextureFrameLoaded.set(!0)}),s.addEventListener("canplaythrough",()=>{t.initialTextureBuffersLoaded.set(!0)}),v.uniforms.map.value=u,v.map=u,v.needsUpdate=!0}e.currentTrackInfo.currentTime.set(e.currentTrackInfo.mediaStartTime.value),e.currentTrackInfo.duration.set(y.duration);const C=setInterval(_,500);return _(),()=>{si(r),s.pause(),clearInterval(C);for(const x in d){const B=d.get(x);if(B)for(const W in B){const G=B.get(W);if(G)for(const X in G)G[X].dispose(),delete G[X]}}for(const x in c){const B=c.get(x);if(B)for(const W in B){const G=B[W];G instanceof Er?(G.geometry.dispose(),G.material.dispose()):G instanceof It?G.dispose():G instanceof xs&&g.geometry.setAttribute(G.name,G),delete B[W]}}g.geometry.dispose(),L.src=""}},[]),ee(wt),O.useEffect(()=>{(t.useVideoTexture.value||e.hasAudio.value)&&(s.playbackRate=e.currentTrackInfo.playbackRate.value)},[e.currentTrackInfo.playbackRate]),O.useEffect(()=>{o&&(t.data.value.type===ot.UNIFORM_SOLVE_WITH_COMPRESSED_TEXTURE?(o.cast.set(!1),o.receive.set(!1)):(o.cast.set(!0),o.receive.set(!0)))},[o]);const P=(y,T,w)=>{const $=t.data.value.geometry.targets[w],I=$.segmentFrameCount,k=Math.floor(y*$.frameRate/I),L=Math.floor(T*$.frameRate/I);for(let C=k;C<=L;C++){const x=Jt(t.data.value.geometry.path,t.manifestPath.value,$.format,w,C),B=C*$.segmentFrameCount,W=B/$.frameRate,G=W+$.settings.segmentSize;if(it(t.geometryInfo.buffered.value,W,G,!0,Xe))continue;const X={start:W,end:G,fetchTime:-1};t.geometryInfo.buffered.get(ir).push(X),au(x).then(({mesh:K,fetchTime:ue})=>{var ln,cn;if(!we(r,oe))return;c.has(w)||c.set(w,[]),X.fetchTime=ue;const Pe=c.get(w),Wt=K.geometry.morphAttributes.position,gt=K.geometry.morphAttributes.normal;if(Wt.forEach((je,Xt)=>{const mn=uu(w,B+Xt);if(je.name=mn,gt){const dn=gt[Xt];dn.name=mn,Pe[B+Xt]={position:je,normal:dn}}else Pe[B+Xt]={position:je}}),!g.geometry.attributes.position||!K.geometry.attributes.position||g.geometry.attributes.position.array.length!==K.geometry.attributes.position.array.length)for(const je of Object.keys(K.geometry.attributes))g.geometry.attributes[je]=K.geometry.attributes[je],g.geometry.attributes[je].needsUpdate=!0;K.geometry.morphAttributes={},t.firstGeometryFrameLoaded.value||(g.copy(K),f.copy(((ln=K.material.map)==null?void 0:ln.repeat)??f),m.copy(((cn=K.material.map)==null?void 0:cn.offset)??m),g.material=v,t.firstGeometryFrameLoaded.set(!0)),it(t.geometryInfo.buffered.value,y,y+l,!1)&&t.initialGeometryBuffersLoaded.set(!0),wn(t.geometryInfo.buffered,Xe),A()}).catch(()=>{const K=t.geometryInfo.buffered.get(ir).indexOf(X);K!==-1&&t.geometryInfo.buffered[K].set(hs)})}},A=()=>{const y=t.geometryInfo.userTarget.value;if(y!==-1){t.geometryInfo.currentTarget.set(y);return}const T=t.geometryInfo.buffered.value.reduce((L,C)=>L+C.fetchTime,0),w=t.geometryInfo.buffered.value.reduce((L,C)=>L+C.fetchTime>-1?C.end-C.start:0,0),$=T/w,I=t.geometryInfo.currentTarget.value,k=t.geometryInfo.targets.value.length;$>=.3?I>0&&t.geometryInfo.currentTarget.set(I-1):$<.2&&I<k-1&&t.geometryInfo.currentTarget.set(I+1)},E=y=>{const T=t.textureInfo[y].userTarget.value;if(T!==-1){t.textureInfo[y].currentTarget.set(T);return}const w=t.textureInfo[y].currentTarget.value,$=t.textureInfo[y].targets.value.length,I=t.textureInfo[y].buffered.value.reduce((C,x)=>C+x.fetchTime,0),k=t.textureInfo[y].buffered.value.reduce((C,x)=>C+(x.end-x.start),0),L=I/k;L>=.3?w>0&&t.textureInfo[y].currentTarget.set(w-1):L<.2&&w<$-1&&t.textureInfo[y].currentTarget.set(w+1)},M=()=>{const y=e.currentTrackInfo.currentTime.value,T=Math.min(y+p,t.data.duration.value),w=t.geometryInfo.targets.value[t.geometryInfo.currentTarget.value];t.data.value.geometry.targets[w].format==="uniform-solve"&&P(y,T,w)},R=y=>{var x;const T=e.currentTrackInfo.currentTime.value,w=Math.min(T+p,t.data.duration.value),$=t.textureInfo[y].currentTarget.value,I=t.textureInfo[y].targets[$].value,k=(x=t.data.texture[y].value)==null?void 0:x.targets[I];if(!k)return;const L=Math.floor(T*k.frameRate),C=Math.floor(w*k.frameRate);for(let B=L;B<=C;B++){const W=Jt(t.data.value.texture.baseColor.path,t.manifestPath.value,k.format,I,B,y);d.has(y)||d.set(y,new Map);const G=d.get(y);G.has(I)||G.set(I,[]);const X=G.get(I),K=B/k.frameRate,ue=(B+1)/k.frameRate,Pe=t.textureInfo[y].buffered;if(it(Pe.value,K,ue,!0,Xe))continue;const Wt={start:K,end:ue,fetchTime:-1};Pe.get(ir).push(Wt),iu(W,f,m).then(gt=>{we(r,oe)&&(X[B]=gt.texture,Wt.fetchTime=gt.fetchTime,wn(Pe,Xe),E(y),t.firstTextureFrameLoaded.value||t.firstTextureFrameLoaded.set(!0),it(Pe.value,T,T+l,!1)&&t.initialTextureBuffersLoaded.set(!0))}).catch(()=>{})}},_=()=>{if(M(),!t.useVideoTexture.value)for(let y=0;y<t.textureInfo.textureTypes.value.length;y++)R(t.textureInfo.textureTypes[y].value)};O.useEffect(()=>{!t.initialGeometryBuffersLoaded.value||!t.initialTextureBuffersLoaded.value||e.initialBuffersLoaded.set(!0)},[t.initialGeometryBuffersLoaded,t.initialTextureBuffersLoaded]),O.useEffect(()=>{!t.firstGeometryFrameLoaded.value||!t.firstTextureFrameLoaded.value||(Re(e.currentTrackInfo.currentTime.value),t.useVideoTexture.value||ae(e.currentTrackInfo.currentTime.value),e.useLoadingEffect.value&&t.loadingEffectStarted.set(!0),ko(r,S))},[t.firstGeometryFrameLoaded,t.firstTextureFrameLoaded]),O.useEffect(()=>{if(t.loadingEffectStarted.value&&!t.loadingEffectEnded.value){let y=/\/\/\sHEADER_REPLACE_START([\s\S]*?)\/\/\sHEADER_REPLACE_END/,T=/\/\/\sMAIN_REPLACE_START([\s\S]*?)\/\/\sMAIN_REPLACE_END/;t.data.value.type,ot.UNIFORM_SOLVE_WITH_COMPRESSED_TEXTURE,y=void 0,T=void 0,g.material=Se.createDissolveMaterial(g,y,T,y,T),g.material.needsUpdate=!0;return}e.autoplay.value&&e.initialBuffersLoaded.value&&(g.material=v,g.material.needsUpdate=!0,t.hasAudio.value||t.useVideoTexture.value?wr(i,s,e):e.paused.set(!1))},[e.autoplay,e.initialBuffersLoaded,t.loadingEffectStarted,t.loadingEffectEnded]),O.useEffect(()=>{if(e.paused.value){t.canPlay.set(!1),(t.hasAudio.value||t.useVideoTexture.value)&&s.pause();return}oe.setStartAndPlaybackTime(r,e.currentTrackInfo.currentTime.value,n.elapsedSeconds),g.material!==v&&(g.material=v,g.material.needsUpdate=!0),(t.hasAudio.value||t.useVideoTexture.value)&&wr(i,s,e),t.canPlay.set(!0)},[e.paused]);const V=(y,T,w=!0)=>{const $=y*T;return w?Math.round($):$},z=(y,T)=>{const w=t.geometryInfo.targets[t.geometryInfo.currentTarget.value].value;let $=V(T,t.data.value.geometry.targets[w].frameRate,!1);y==="keyframeA"?$=Math.floor($):$=Math.ceil($);const I=c.get(w);if(!I||!I[$]){const k=t.geometryInfo.targets.value;for(let L=0;L<k.length;L++){const C=k[L],x=t.data.value.geometry.targets[C];let B=V(T,x.frameRate,!1);y==="keyframeA"?B=Math.floor(B):B=Math.ceil(B);const W=c.get(C);if(W&&W[B])return W[B]}}else return I[$];return!1},Q=(y,T)=>{q(y,T.position),T.normal&&q(y+"Normal",T.normal)},q=(y,T)=>{var L;if(g.geometry.attributes[y]===T)return;if(y==="keyframeB"||y==="keyframeBNormal"){g.geometry.attributes[y]=T,g.geometry.attributes[y].needsUpdate=!0;return}else if((y==="keyframeA"||y==="keyframeANormal")&&t.data.deletePreviousBuffers.value===!1){g.geometry.attributes[y]=T,g.geometry.attributes[y].needsUpdate=!0;return}const w=g.geometry.index,$=new It;$.setIndex(w);for(const C in g.geometry.attributes)C!==y&&$.setAttribute(C,g.geometry.attributes[C]);$.setAttribute(y,T),$.boundingSphere=g.geometry.boundingSphere,$.boundingBox=g.geometry.boundingBox;const I=g.geometry;g.geometry=$,I.index=null;for(const C in I.attributes)C!==y&&I.deleteAttribute(C);I.dispose();const k=(L=I.attributes[y])==null?void 0:L.name;c.delete(k)},Z=(y,T)=>{const w=c.get(y),$=t.data.value.geometry.targets[y];if(!w||!w[T]){const I=$.frameRate,k=t.geometryInfo.targets.value;for(let L=0;L<k.length;L++){const C=k[L],x=t.data.value.geometry.targets[C].frameRate,B=Math.round(T*x/I),W=c.get(C);if(W&&W[B]){Z(C,B);return}}}else if($.format==="draco"){const I=w[T];if(g.geometry!==I){g.geometry=I,g.geometry.attributes.position.needsUpdate=!0;return}}else if($.format==="glb"){const I=w[T],k=I.geometry;g.geometry!==k&&(g.geometry=k,g.geometry.attributes.position.needsUpdate=!0),I.material instanceof Rs&&I.material.map&&(I.material.map.repeat&&f.copy(I.material.map.repeat),I.material.map.offset&&m.copy(I.material.map.offset));return}},te=(y,T)=>{var w,$,I,k,L,C;if((!T.repeat.equals(f)||!T.offset.equals(m))&&(T.repeat.copy(f),T.offset.copy(m),T.updateMatrix()),g.material instanceof $t){const x=g.material;y==="baseColor"&&x.uniforms.map.value!==T?((w=x.uniforms.map.value)==null||w.name,x.uniforms.map.value=T,x.uniforms.mapTransform.value.copy(T.matrix)):y==="emissive"&&x.uniforms.emissiveMap.value!==T?(($=x.uniforms.emissiveMap.value)==null||$.name,x.uniforms.emissiveMap.value=T,x.uniforms.emissiveMapTransform.value.copy(T.matrix)):y==="normal"&&x.uniforms.normalMap.value!==T?((I=x.uniforms.normalMap.value)==null||I.name,x.uniforms.normalMap.value=T,x.uniforms.normalMapTransform.value.copy(T.matrix)):y==="metallicRoughness"&&x.uniforms.roughnessMap.value!==T?((k=x.uniforms.roughnessMap.value)==null||k.name,x.uniforms.roughnessMap.value=T,x.uniforms.roughnessMapTransform.value.copy(T.matrix),x.uniforms.metalnessMap.value=T,x.uniforms.metalnessMapTransform.value.copy(T.matrix)):y==="occlusion"&&x.uniforms.aoMap.value!==T&&((L=x.uniforms.aoMap.value)==null||L.name,x.uniforms.aoMap.value=T,x.uniforms.aoMapTransform.value.copy(T.matrix))}else{const x=g.material;y==="baseColor"&&((C=x.map)==null||C.name,x.map=T,x.map.needsUpdate=!0)}},J=(y,T,w,$)=>{const I=d.get(y);if(!I){console.error("Texture frames not found for time: ",$);return}const k=I.get(T);if(!k||!k[w]){const L=t.textureInfo[y].targets.value;for(let C=0;C<L.length;C++){const x=t.data.value.texture[y].targets[L[C]].frameRate,B=V($,x),G=d.get(y).get(L[C]);if(G&&G[B]){J(y,L[C],B,$);return}}console.error("Texture frames not found for time: ",$)}else{const L=k[w];te(y,L)}},de=y=>{const T=z("keyframeA",y),w=z("keyframeB",y);if(!T&&!w){console.error("Geometry frames not found for time: ",y);return}else if(!T&&w){Q("keyframeB",w),g.material.uniforms.mixRatio.value=1;return}else if(T&&!w){Q("keyframeA",T),g.material.uniforms.mixRatio.value=0;return}else if(T&&w){const C=parseInt(T.position.name.slice(-Et)),x=T.position.name.slice(0,-Et),B=C/t.data.value.geometry.targets[x].frameRate,W=parseInt(w.position.name.slice(-Et)),G=w.position.name.slice(0,-Et),X=W/t.data.value.geometry.targets[G].frameRate,K=Math.abs(y-B),ue=Math.abs(y-X),Pe=K+ue>0?K/(K+ue):.5;Q("keyframeA",T),Q("keyframeB",w),g.material.uniforms.mixRatio.value=Pe}const $=g.geometry.index,I=new It,k=g.geometry;I.setIndex($);for(const C in g.geometry.attributes)I.setAttribute(C,g.geometry.attributes[C]),k.deleteAttribute(C);I.boundingSphere=g.geometry.boundingSphere,I.boundingBox=g.geometry.boundingBox;let L=-1;for(const C in t.data.value.geometry.targets){const x=c.get(C),B=t.data.value.geometry.targets[C].frameRate;if(x&&x.length>0)for(const W in x){const G=parseInt(W)/B;if(G<y-.5){const X=x[W];k.setAttribute(X.position.name+".position",X.position),X.normal&&k.setAttribute(X.normal.name+".normal",X.normal),delete x[W],L=t.geometryInfo.buffered.findIndex(K=>{if(K.start.value<=G&&K.end.value>=G&&K.fetchTime.value>-1)return!0}),L!==-1&&t.geometryInfo.buffered[L].start.set((parseInt(W)+1)/B)}else break}}g.geometry=I,k.dispose()},Ge=y=>{const T=t.geometryInfo.targets[t.geometryInfo.currentTarget.value].value,w=t.data.value.geometry.targets[T],$=Math.round(y*t.data.value.geometry.targets[T].frameRate);Z(T,$);for(const I in t.data.value.geometry.targets){const k=c.get(I),L=t.data.value.geometry.targets[I].frameRate;if(k&&k.length>0)for(const C in k)if(parseInt(C)/L<y-.5){if(w.format==="draco")k[C].dispose();else if(w.format==="glb"){const B=k[C];B.geometry.dispose(),B.material.map&&B.material.map.dispose(),B.material.dispose()}delete k[C]}else break}},Re=y=>{t.data.value.type===ot.UNIFORM_SOLVE_WITH_COMPRESSED_TEXTURE?de(y):Ge(y);for(const T in g.geometry.attributes)g.geometry.attributes[T].needsUpdate=!0},ae=y=>{t.textureInfo.textureTypes.value.forEach(T=>{qt(T,y)})},qt=(y,T)=>{var L,C;const w=t.textureInfo[y].targets[t.textureInfo[y].currentTarget.value].value,$=Math.round(T*t.data.value.texture[y].targets[w].frameRate);J(y,w,$,T);const I=d.get(y);if(!I){console.error("Texture frames not found for time: ",T);return}let k=-1;for(const x in(L=t.data.value.texture[y])==null?void 0:L.targets){const B=I.get(x);if(!B||B.length===0)continue;const W=(C=t.data.value.texture[y])==null?void 0:C.targets[x].frameRate;if(B&&B.length>0)for(const G in B){const X=parseInt(G)/W;if(X<T-.5)B[G].dispose(),delete B[G],k=t.textureInfo[y].buffered.findIndex(ue=>{if(ue.start.value<=X&&ue.end.value>=X&&ue.fetchTime.value>-1)return!0}),k!==-1&&t.textureInfo[y].buffered[k].start.set((parseInt(G)+1)/W);else break}}},Je=O.useRef(!1);return Vo(()=>{g.updateMatrixWorld(!0);const y=ee(wt).deltaSeconds;if(t.loadingEffectStarted.value&&!t.loadingEffectEnded.value&&Se.updateDissolveEffect(r,g,y)){We(r,Se),t.loadingEffectEnded.set(!0),g.material=v,g.material.needsUpdate=!0;return}if(!t.canPlay.value||!e.initialBuffersLoaded.value)return;if(e.autoPauseWhenBuffering.value){let w=!1;if(oe.canPlayThrough(r,e.currentTrackInfo.currentTime.value,e.currentTrackInfo.currentTime.value+l)||(w=!0),(t.useVideoTexture.value||e.hasAudio.value)&&s.readyState<3&&(w=!0),!(!Je.current&&!w)){if(!Je.current&&w){Je.current=!0;return}else if(Je.current&&!w)oe.setStartAndPlaybackTime(r,e.currentTrackInfo.currentTime.value,n.elapsedSeconds),Je.current=!1;else if(Je.current&&w)return}}let T=-1;if(t.data.value.audio||t.useVideoTexture.value?T=s.currentTime:(T=e.currentTrackInfo.mediaStartTime.value+(n.elapsedSeconds-e.currentTrackInfo.playbackStartDate.value),T*=e.currentTrackInfo.playbackRate.value),O.startTransition(()=>{e.currentTrackInfo.currentTime.set(T);let w=e.currentTrackInfo.duration.value,$=-1;$=t.geometryInfo.buffered.findIndex(I=>{if(I.start.value<=T&&I.end.value>=T)return!0}),$!==-1&&(w=Math.min(w,t.geometryInfo.buffered[$].end.value));for(const I of t.textureInfo.textureTypes.value)$=t.textureInfo[I].buffered.findIndex(k=>{if(k.start.value<=T&&k.end.value>=T)return!0}),$!==-1&&(w=Math.min(w,t.textureInfo[I].buffered[$].end.value));t.bufferedUntil.set(w)}),e.currentTrackInfo.currentTime.value>t.data.value.duration||s.ended)if(t.data.deletePreviousBuffers.value===!1&&e.playMode.value===me.loop)e.currentTrackInfo.currentTime.set(0),e.currentTrackInfo.playbackStartDate.set(n.elapsedSeconds);else{e.ended.set(!0);return}Re(e.currentTrackInfo.currentTime.value),t.useVideoTexture.value?(u.colorSpace=Sr,(!u.repeat.equals(f)||!u.offset.equals(m))&&(u.repeat.copy(f),u.offset.copy(m),u.updateMatrix(),g.material.uniforms.mapTransform.value.copy(u.matrix))):ae(e.currentTrackInfo.currentTime.value),u.needsUpdate=!0},{with:qo}),null}function wr(r,e,t){const o=()=>{const n=xe(gr.instance.viewerEntity,vr).canvas,a=()=>{e.play(),r.resume(),t.paused.set(!1),window.removeEventListener("pointerdown",a),window.removeEventListener("keypress",a),window.removeEventListener("touchstart",a),n.removeEventListener("pointerdown",a),n.removeEventListener("touchstart",a)};window.addEventListener("pointerdown",a),window.addEventListener("keypress",a),window.addEventListener("touchstart",a),n.addEventListener("pointerdown",a),n.addEventListener("touchstart",a)};e.play().catch(n=>{n.name==="NotAllowedError"&&o()}).then(()=>{t.paused.set(!1)})}const ce=dt({name:"Legacy Volumetric Component",jsonID:"IR_volumetric_legacy",schema:h.Object({paths:h.Array(h.String()),useLoadingEffect:h.Bool({default:!0}),autoPauseWhenBuffering:h.Bool({default:!0}),autoplay:h.Bool({default:!0}),paused:h.Bool({default:!0}),initialBuffersLoaded:h.Bool({default:!1}),hasAudio:h.Bool({default:!1}),ended:h.Bool({default:!0}),volume:h.Number({default:1}),playMode:h.Enum(me,{$comment:"A string enum, ie. one of the following values: 'single', 'random', 'loop', 'singleloop'",default:me.loop}),track:h.Number({default:-1}),forceChangeTrack:h.Bool({default:!1}),currentTrackInfo:h.Object({dontReset:h.Bool({default:!1}),mediaStartTime:h.Number({default:0}),playbackStartDate:h.Number({default:0}),playbackRate:h.Number({default:1}),currentTime:h.Number({default:0}),duration:h.Number({default:0})})}),toJSON:r=>({paths:r.paths,useLoadingEffect:r.useLoadingEffect,autoplay:r.autoplay,volume:r.volume,playMode:r.playMode}),reactor:lu});function lu(){const r=Bt(),e=ee(ft).audioContext,t=ee(ft).gainNodeMixBuses,o=ke(r,ce);O.useEffect(()=>{Oe(r,fe,{element:document.createElement("video")}),Oe(r,br);const i=ve(r,fe).element.value;if(i.playsInline=!0,i.preload="auto",i.crossOrigin="anonymous",!hr.get(i)){const s=e.createMediaElementSource(i);fi(i,s,t.soundEffects).gain.gain.setTargetAtTime(o.volume.value,e.currentTime,.1)}return()=>{We(r,xt),We(r,oe)}},[]),O.useEffect(()=>{var u;if(!o.ended.value)return;const a=o.paths.value.length;let i=gn(o.track.value,a,o.playMode.value);const s=["manifest","drcs","mp4","json"];for(let c=0;c<=a;c++){const d=o.paths.value[i],p=d?(u=d.split(".").pop())==null?void 0:u.split("?").shift():"";if(d&&p&&s.includes(p))break;if(i===o.track.value||(i=gn(i,a,o.playMode.value),i===-1))return}i===-1||!o.paths.value[i]||(o.currentTrackInfo.dontReset.value||n(),o.track.set(i),o.forceChangeTrack.set(!o.forceChangeTrack.value))},[o.paths,o.playMode,o.ended]);const n=()=>{We(r,xt),We(r,oe),o.initialBuffersLoaded.set(!1),o.paused.set(!0),o.currentTrackInfo.set({dontReset:!1,mediaStartTime:0,playbackStartDate:0,playbackRate:1,currentTime:0,duration:0})};return O.useEffect(()=>{if(o.track.value===-1)return;o.ended.set(!1);let a=o.paths.value[o.track.value];a.endsWith(".mp4")?a=a.replace(".mp4",".manifest"):a.endsWith(".drcs")&&(a=a.replace(".drcs",".manifest")),fetch(a).then(i=>i.json()).then(i=>{"type"in i?Oe(r,oe,{manifestPath:a,data:i}):Oe(r,xt,{manifestPath:a,data:i})})},[o.track,o.forceChangeTrack]),O.useEffect(()=>{const a=o.volume.value,i=xe(r,fe).element,s=hr.get(i);s&&s.gain.gain.setTargetAtTime(a,e.currentTime,.1)},[o.volume]),null}var Ko={},In=Object.prototype.toString,hi=function(e){var t=In.call(e),o=t==="[object Arguments]";return o||(o=t!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&In.call(e.callee)==="[object Function]"),o},_r,xn;function cu(){if(xn)return _r;xn=1;var r;if(!Object.keys){var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,o=hi,n=Object.prototype.propertyIsEnumerable,a=!n.call({toString:null},"toString"),i=n.call(function(){},"prototype"),s=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],u=function(l){var f=l.constructor;return f&&f.prototype===l},c={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},d=function(){if(typeof window>"u")return!1;for(var l in window)try{if(!c["$"+l]&&e.call(window,l)&&window[l]!==null&&typeof window[l]=="object")try{u(window[l])}catch{return!0}}catch{return!0}return!1}(),p=function(l){if(typeof window>"u"||!d)return u(l);try{return u(l)}catch{return!1}};r=function(f){var m=f!==null&&typeof f=="object",v=t.call(f)==="[object Function]",b=o(f),g=m&&t.call(f)==="[object String]",S=[];if(!m&&!v&&!b)throw new TypeError("Object.keys called on a non-object");var P=i&&v;if(g&&f.length>0&&!e.call(f,0))for(var A=0;A<f.length;++A)S.push(String(A));if(b&&f.length>0)for(var E=0;E<f.length;++E)S.push(String(E));else for(var M in f)!(P&&M==="prototype")&&e.call(f,M)&&S.push(String(M));if(a)for(var R=p(f),_=0;_<s.length;++_)!(R&&s[_]==="constructor")&&e.call(f,s[_])&&S.push(s[_]);return S}}return _r=r,_r}var mu=Array.prototype.slice,du=hi,Rn=Object.keys,lr=Rn?function(e){return Rn(e)}:cu(),Pn=Object.keys;lr.shim=function(){if(Object.keys){var e=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);e||(Object.keys=function(o){return du(o)?Pn(mu.call(o)):Pn(o)})}else Object.keys=lr;return Object.keys||lr};var pu=lr,cr=Object.defineProperty||!1;if(cr)try{cr({},"a",{value:1})}catch{cr=!1}var _t=cr,Fe=SyntaxError,U=TypeError,gu=Object.getOwnPropertyDescriptor,mr=gu;if(mr)try{mr([],"length")}catch{mr=null}var pt=mr,An=_t,vu=Fe,Ze=U,Mn=pt,bi=function(e,t,o){if(!e||typeof e!="object"&&typeof e!="function")throw new Ze("`obj` must be an object or a function`");if(typeof t!="string"&&typeof t!="symbol")throw new Ze("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new Ze("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new Ze("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new Ze("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new Ze("`loose`, if provided, must be a boolean");var n=arguments.length>3?arguments[3]:null,a=arguments.length>4?arguments[4]:null,i=arguments.length>5?arguments[5]:null,s=arguments.length>6?arguments[6]:!1,u=!!Mn&&Mn(e,t);if(An)An(e,t,{configurable:i===null&&u?u.configurable:!i,enumerable:n===null&&u?u.enumerable:!n,value:o,writable:a===null&&u?u.writable:!a});else if(s||!n&&!a&&!i)e[t]=o;else throw new vu("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Bo=_t,Ti=function(){return!!Bo};Ti.hasArrayLengthDefineBug=function(){if(!Bo)return null;try{return Bo([],"length",{value:1}).length!==1}catch{return!0}};var Yo=Ti,yu=pu,hu=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",bu=Object.prototype.toString,Tu=Array.prototype.concat,$n=bi,Su=function(r){return typeof r=="function"&&bu.call(r)==="[object Function]"},Si=Yo(),Eu=function(r,e,t,o){if(e in r){if(o===!0){if(r[e]===t)return}else if(!Su(o)||!o())return}Si?$n(r,e,t,!0):$n(r,e,t)},Ei=function(r,e){var t=arguments.length>2?arguments[2]:{},o=yu(e);hu&&(o=Tu.call(o,Object.getOwnPropertySymbols(e)));for(var n=0;n<o.length;n+=1)Eu(r,o[n],e[o[n]],t[o[n]])};Ei.supportsDescriptors=!!Si;var wi=Ei,Ii={exports:{}},xi=Object,wu=Error,Iu=EvalError,xu=RangeError,Ru=ReferenceError,Pu=URIError,Ri=Math.abs,Pi=Math.floor,Au=Math.max,Mu=Math.min,$u=Math.pow,ku=Math.round,Ar=Number.isNaN||function(e){return e!==e},Cu=Ar,Bu=function(e){return Cu(e)||e===0?e:e<0?-1:1},Lr,kn;function Ai(){return kn||(kn=1,Lr=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),o=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(o)!=="[object Symbol]")return!1;var n=42;e[t]=n;for(var a in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var i=Object.getOwnPropertySymbols(e);if(i.length!==1||i[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var s=Object.getOwnPropertyDescriptor(e,t);if(s.value!==n||s.enumerable!==!0)return!1}return!0}),Lr}var Dr,Cn;function Mr(){if(Cn)return Dr;Cn=1;var r=typeof Symbol<"u"&&Symbol,e=Ai();return Dr=function(){return typeof r!="function"||typeof Symbol!="function"||typeof r("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},Dr}var Fr,Bn;function Mi(){return Bn||(Bn=1,Fr=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),Fr}var Nr,On;function $i(){if(On)return Nr;On=1;var r=xi;return Nr=r.getPrototypeOf||null,Nr}var Ou="Function.prototype.bind called on incompatible ",_u=Object.prototype.toString,Lu=Math.max,Du="[object Function]",_n=function(e,t){for(var o=[],n=0;n<e.length;n+=1)o[n]=e[n];for(var a=0;a<t.length;a+=1)o[a+e.length]=t[a];return o},Fu=function(e,t){for(var o=[],n=t,a=0;n<e.length;n+=1,a+=1)o[a]=e[n];return o},Nu=function(r,e){for(var t="",o=0;o<r.length;o+=1)t+=r[o],o+1<r.length&&(t+=e);return t},Uu=function(e){var t=this;if(typeof t!="function"||_u.apply(t)!==Du)throw new TypeError(Ou+t);for(var o=Fu(arguments,1),n,a=function(){if(this instanceof n){var d=t.apply(this,_n(o,arguments));return Object(d)===d?d:this}return t.apply(e,_n(o,arguments))},i=Lu(0,t.length-o.length),s=[],u=0;u<i;u++)s[u]="$"+u;if(n=Function("binder","return function ("+Nu(s,",")+"){ return binder.apply(this,arguments); }")(a),t.prototype){var c=function(){};c.prototype=t.prototype,n.prototype=new c,c.prototype=null}return n},Gu=Uu,Lt=Function.prototype.bind||Gu,zo=Function.prototype.call,Jo=Function.prototype.apply,ju=typeof Reflect<"u"&&Reflect&&Reflect.apply,Vu=Lt,qu=Jo,Wu=zo,Xu=ju,ki=Xu||Vu.call(Wu,qu),Hu=Lt,Ku=U,Yu=zo,zu=ki,Qo=function(e){if(e.length<1||typeof e[0]!="function")throw new Ku("a function is required");return zu(Hu,Yu,e)},Ur,Ln;function Ju(){if(Ln)return Ur;Ln=1;var r=Qo,e=pt,t;try{t=[].__proto__===Array.prototype}catch(i){if(!i||typeof i!="object"||!("code"in i)||i.code!=="ERR_PROTO_ACCESS")throw i}var o=!!t&&e&&e(Object.prototype,"__proto__"),n=Object,a=n.getPrototypeOf;return Ur=o&&typeof o.get=="function"?r([o.get]):typeof a=="function"?function(s){return a(s==null?s:n(s))}:!1,Ur}var Gr,Dn;function Qu(){if(Dn)return Gr;Dn=1;var r=Mi(),e=$i(),t=Ju();return Gr=r?function(n){return r(n)}:e?function(n){if(!n||typeof n!="object"&&typeof n!="function")throw new TypeError("getProto: not an object");return e(n)}:t?function(n){return t(n)}:null,Gr}var jr,Fn;function Ne(){if(Fn)return jr;Fn=1;var r=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=Lt;return jr=t.call(r,e),jr}var j,Zu=xi,ef=wu,tf=Iu,rf=xu,of=Ru,ct=Fe,ut=U,nf=Pu,af=Ri,sf=Pi,uf=Au,ff=Mu,lf=$u,cf=ku,mf=Bu,Ci=Function,Vr=function(r){try{return Ci('"use strict"; return ('+r+").constructor;")()}catch{}},Ct=pt,df=_t,qr=function(){throw new ut},pf=Ct?function(){try{return arguments.callee,qr}catch{try{return Ct(arguments,"callee").get}catch{return qr}}}():qr,et=Mr()(),re=Qu(),gf=$i(),vf=Mi(),Bi=Jo,Dt=zo,nt={},yf=typeof Uint8Array>"u"||!re?j:re(Uint8Array),He={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?j:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?j:ArrayBuffer,"%ArrayIteratorPrototype%":et&&re?re([][Symbol.iterator]()):j,"%AsyncFromSyncIteratorPrototype%":j,"%AsyncFunction%":nt,"%AsyncGenerator%":nt,"%AsyncGeneratorFunction%":nt,"%AsyncIteratorPrototype%":nt,"%Atomics%":typeof Atomics>"u"?j:Atomics,"%BigInt%":typeof BigInt>"u"?j:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?j:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?j:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?j:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":ef,"%eval%":eval,"%EvalError%":tf,"%Float16Array%":typeof Float16Array>"u"?j:Float16Array,"%Float32Array%":typeof Float32Array>"u"?j:Float32Array,"%Float64Array%":typeof Float64Array>"u"?j:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?j:FinalizationRegistry,"%Function%":Ci,"%GeneratorFunction%":nt,"%Int8Array%":typeof Int8Array>"u"?j:Int8Array,"%Int16Array%":typeof Int16Array>"u"?j:Int16Array,"%Int32Array%":typeof Int32Array>"u"?j:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":et&&re?re(re([][Symbol.iterator]())):j,"%JSON%":typeof JSON=="object"?JSON:j,"%Map%":typeof Map>"u"?j:Map,"%MapIteratorPrototype%":typeof Map>"u"||!et||!re?j:re(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Zu,"%Object.getOwnPropertyDescriptor%":Ct,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?j:Promise,"%Proxy%":typeof Proxy>"u"?j:Proxy,"%RangeError%":rf,"%ReferenceError%":of,"%Reflect%":typeof Reflect>"u"?j:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?j:Set,"%SetIteratorPrototype%":typeof Set>"u"||!et||!re?j:re(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?j:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":et&&re?re(""[Symbol.iterator]()):j,"%Symbol%":et?Symbol:j,"%SyntaxError%":ct,"%ThrowTypeError%":pf,"%TypedArray%":yf,"%TypeError%":ut,"%Uint8Array%":typeof Uint8Array>"u"?j:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?j:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?j:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?j:Uint32Array,"%URIError%":nf,"%WeakMap%":typeof WeakMap>"u"?j:WeakMap,"%WeakRef%":typeof WeakRef>"u"?j:WeakRef,"%WeakSet%":typeof WeakSet>"u"?j:WeakSet,"%Function.prototype.call%":Dt,"%Function.prototype.apply%":Bi,"%Object.defineProperty%":df,"%Object.getPrototypeOf%":gf,"%Math.abs%":af,"%Math.floor%":sf,"%Math.max%":uf,"%Math.min%":ff,"%Math.pow%":lf,"%Math.round%":cf,"%Math.sign%":mf,"%Reflect.getPrototypeOf%":vf};if(re)try{null.error}catch(r){var hf=re(re(r));He["%Error.prototype%"]=hf}var bf=function r(e){var t;if(e==="%AsyncFunction%")t=Vr("async function () {}");else if(e==="%GeneratorFunction%")t=Vr("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=Vr("async function* () {}");else if(e==="%AsyncGenerator%"){var o=r("%AsyncGeneratorFunction%");o&&(t=o.prototype)}else if(e==="%AsyncIteratorPrototype%"){var n=r("%AsyncGenerator%");n&&re&&(t=re(n.prototype))}return He[e]=t,t},Nn={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Ft=Lt,Ir=Ne(),Tf=Ft.call(Dt,Array.prototype.concat),Sf=Ft.call(Bi,Array.prototype.splice),Un=Ft.call(Dt,String.prototype.replace),xr=Ft.call(Dt,String.prototype.slice),Ef=Ft.call(Dt,RegExp.prototype.exec),wf=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,If=/\\(\\)?/g,xf=function(e){var t=xr(e,0,1),o=xr(e,-1);if(t==="%"&&o!=="%")throw new ct("invalid intrinsic syntax, expected closing `%`");if(o==="%"&&t!=="%")throw new ct("invalid intrinsic syntax, expected opening `%`");var n=[];return Un(e,wf,function(a,i,s,u){n[n.length]=s?Un(u,If,"$1"):i||a}),n},Rf=function(e,t){var o=e,n;if(Ir(Nn,o)&&(n=Nn[o],o="%"+n[0]+"%"),Ir(He,o)){var a=He[o];if(a===nt&&(a=bf(o)),typeof a>"u"&&!t)throw new ut("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:o,value:a}}throw new ct("intrinsic "+e+" does not exist!")},ne=function(e,t){if(typeof e!="string"||e.length===0)throw new ut("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof t!="boolean")throw new ut('"allowMissing" argument must be a boolean');if(Ef(/^%?[^%]*%?$/,e)===null)throw new ct("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var o=xf(e),n=o.length>0?o[0]:"",a=Rf("%"+n+"%",t),i=a.name,s=a.value,u=!1,c=a.alias;c&&(n=c[0],Sf(o,Tf([0,1],c)));for(var d=1,p=!0;d<o.length;d+=1){var l=o[d],f=xr(l,0,1),m=xr(l,-1);if((f==='"'||f==="'"||f==="`"||m==='"'||m==="'"||m==="`")&&f!==m)throw new ct("property names with quotes must have matching quotes");if((l==="constructor"||!p)&&(u=!0),n+="."+l,i="%"+n+"%",Ir(He,i))s=He[i];else if(s!=null){if(!(l in s)){if(!t)throw new ut("base intrinsic for "+e+" exists, but the property is not available.");return}if(Ct&&d+1>=o.length){var v=Ct(s,l);p=!!v,p&&"get"in v&&!("originalValue"in v.get)?s=v.get:s=s[l]}else p=Ir(s,l),s=s[l];p&&!u&&(He[i]=s)}}return s},Pf=ne,Gn=bi,Af=Yo(),jn=pt,Vn=U,Mf=Pf("%Math.floor%"),$f=function(e,t){if(typeof e!="function")throw new Vn("`fn` is not a function");if(typeof t!="number"||t<0||t>4294967295||Mf(t)!==t)throw new Vn("`length` must be a positive 32-bit integer");var o=arguments.length>2&&!!arguments[2],n=!0,a=!0;if("length"in e&&jn){var i=jn(e,"length");i&&!i.configurable&&(n=!1),i&&!i.writable&&(a=!1)}return(n||a||!o)&&(Af?Gn(e,"length",t,!0,!0):Gn(e,"length",t)),e},kf=Lt,Cf=Jo,Bf=ki,Of=function(){return Bf(kf,Cf,arguments)};(function(r){var e=$f,t=_t,o=Qo,n=Of;r.exports=function(i){var s=o(arguments),u=i.length-(arguments.length-1);return e(s,1+(u>0?u:0),!0)},t?t(r.exports,"apply",{value:n}):r.exports.apply=n})(Ii);var Oi=Ii.exports,ie=function(e){return!!e&&(typeof e=="function"||typeof e=="object")},Zo=typeof Map=="function"&&Map.prototype,Wr=Object.getOwnPropertyDescriptor&&Zo?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Rr=Zo&&Wr&&typeof Wr.get=="function"?Wr.get:null,qn=Zo&&Map.prototype.forEach,en=typeof Set=="function"&&Set.prototype,Xr=Object.getOwnPropertyDescriptor&&en?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Pr=en&&Xr&&typeof Xr.get=="function"?Xr.get:null,Wn=en&&Set.prototype.forEach,_f=typeof WeakMap=="function"&&WeakMap.prototype,Rt=_f?WeakMap.prototype.has:null,Lf=typeof WeakSet=="function"&&WeakSet.prototype,Pt=Lf?WeakSet.prototype.has:null,Df=typeof WeakRef=="function"&&WeakRef.prototype,Xn=Df?WeakRef.prototype.deref:null,Ff=Boolean.prototype.valueOf,Nf=Object.prototype.toString,Uf=Function.prototype.toString,Gf=String.prototype.match,tn=String.prototype.slice,Le=String.prototype.replace,jf=String.prototype.toUpperCase,Hn=String.prototype.toLowerCase,_i=RegExp.prototype.test,Kn=Array.prototype.concat,Te=Array.prototype.join,Vf=Array.prototype.slice,Yn=Math.floor,Oo=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Hr=Object.getOwnPropertySymbols,_o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,mt=typeof Symbol=="function"&&typeof Symbol.iterator=="object",At=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===mt||!0)?Symbol.toStringTag:null,Li=Object.prototype.propertyIsEnumerable,zn=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(r){return r.__proto__}:null);function Jn(r,e){if(r===1/0||r===-1/0||r!==r||r&&r>-1e3&&r<1e3||_i.call(/e/,e))return e;var t=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof r=="number"){var o=r<0?-Yn(-r):Yn(r);if(o!==r){var n=String(o),a=tn.call(e,n.length+1);return Le.call(n,t,"$&_")+"."+Le.call(Le.call(a,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Le.call(e,t,"$&_")}var Lo=Cs,Qn=Lo.custom,Zn=Ni(Qn)?Qn:null,Di={__proto__:null,double:'"',single:"'"},qf={__proto__:null,double:/(["\\])/g,single:/(['\\])/g},Ce=function r(e,t,o,n){var a=t||{};if(Me(a,"quoteStyle")&&!Me(Di,a.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Me(a,"maxStringLength")&&(typeof a.maxStringLength=="number"?a.maxStringLength<0&&a.maxStringLength!==1/0:a.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var i=Me(a,"customInspect")?a.customInspect:!0;if(typeof i!="boolean"&&i!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Me(a,"indent")&&a.indent!==null&&a.indent!=="	"&&!(parseInt(a.indent,10)===a.indent&&a.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Me(a,"numericSeparator")&&typeof a.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var s=a.numericSeparator;if(typeof e>"u")return"undefined";if(e===null)return"null";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return Gi(e,a);if(typeof e=="number"){if(e===0)return 1/0/e>0?"0":"-0";var u=String(e);return s?Jn(e,u):u}if(typeof e=="bigint"){var c=String(e)+"n";return s?Jn(e,c):c}var d=typeof a.depth>"u"?5:a.depth;if(typeof o>"u"&&(o=0),o>=d&&d>0&&typeof e=="object")return Do(e)?"[Array]":"[Object]";var p=ul(a,o);if(typeof n>"u")n=[];else if(Ui(n,e)>=0)return"[Circular]";function l(Z,te,J){if(te&&(n=Vf.call(n),n.push(te)),J){var de={depth:a.depth};return Me(a,"quoteStyle")&&(de.quoteStyle=a.quoteStyle),r(Z,de,o+1,n)}return r(Z,a,o+1,n)}if(typeof e=="function"&&!ea(e)){var f=Zf(e),m=Qt(e,l);return"[Function"+(f?": "+f:" (anonymous)")+"]"+(m.length>0?" { "+Te.call(m,", ")+" }":"")}if(Ni(e)){var v=mt?Le.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):_o.call(e);return typeof e=="object"&&!mt?vt(v):v}if(al(e)){for(var b="<"+Hn.call(String(e.nodeName)),g=e.attributes||[],S=0;S<g.length;S++)b+=" "+g[S].name+"="+Fi(Wf(g[S].value),"double",a);return b+=">",e.childNodes&&e.childNodes.length&&(b+="..."),b+="</"+Hn.call(String(e.nodeName))+">",b}if(Do(e)){if(e.length===0)return"[]";var P=Qt(e,l);return p&&!sl(P)?"["+Fo(P,p)+"]":"[ "+Te.call(P,", ")+" ]"}if(Hf(e)){var A=Qt(e,l);return!("cause"in Error.prototype)&&"cause"in e&&!Li.call(e,"cause")?"{ ["+String(e)+"] "+Te.call(Kn.call("[cause]: "+l(e.cause),A),", ")+" }":A.length===0?"["+String(e)+"]":"{ ["+String(e)+"] "+Te.call(A,", ")+" }"}if(typeof e=="object"&&i){if(Zn&&typeof e[Zn]=="function"&&Lo)return Lo(e,{depth:d-o});if(i!=="symbol"&&typeof e.inspect=="function")return e.inspect()}if(el(e)){var E=[];return qn&&qn.call(e,function(Z,te){E.push(l(te,e,!0)+" => "+l(Z,e))}),ta("Map",Rr.call(e),E,p)}if(ol(e)){var M=[];return Wn&&Wn.call(e,function(Z){M.push(l(Z,e))}),ta("Set",Pr.call(e),M,p)}if(tl(e))return Kr("WeakMap");if(nl(e))return Kr("WeakSet");if(rl(e))return Kr("WeakRef");if(Yf(e))return vt(l(Number(e)));if(Jf(e))return vt(l(Oo.call(e)));if(zf(e))return vt(Ff.call(e));if(Kf(e))return vt(l(String(e)));if(typeof window<"u"&&e===window)return"{ [object Window] }";if(typeof globalThis<"u"&&e===globalThis||typeof se<"u"&&e===se)return"{ [object globalThis] }";if(!Xf(e)&&!ea(e)){var R=Qt(e,l),_=zn?zn(e)===Object.prototype:e instanceof Object||e.constructor===Object,V=e instanceof Object?"":"null prototype",z=!_&&At&&Object(e)===e&&At in e?tn.call(Ue(e),8,-1):V?"Object":"",Q=_||typeof e.constructor!="function"?"":e.constructor.name?e.constructor.name+" ":"",q=Q+(z||V?"["+Te.call(Kn.call([],z||[],V||[]),": ")+"] ":"");return R.length===0?q+"{}":p?q+"{"+Fo(R,p)+"}":q+"{ "+Te.call(R,", ")+" }"}return String(e)};function Fi(r,e,t){var o=t.quoteStyle||e,n=Di[o];return n+r+n}function Wf(r){return Le.call(String(r),/"/g,"&quot;")}function Ke(r){return!At||!(typeof r=="object"&&(At in r||typeof r[At]<"u"))}function Do(r){return Ue(r)==="[object Array]"&&Ke(r)}function Xf(r){return Ue(r)==="[object Date]"&&Ke(r)}function ea(r){return Ue(r)==="[object RegExp]"&&Ke(r)}function Hf(r){return Ue(r)==="[object Error]"&&Ke(r)}function Kf(r){return Ue(r)==="[object String]"&&Ke(r)}function Yf(r){return Ue(r)==="[object Number]"&&Ke(r)}function zf(r){return Ue(r)==="[object Boolean]"&&Ke(r)}function Ni(r){if(mt)return r&&typeof r=="object"&&r instanceof Symbol;if(typeof r=="symbol")return!0;if(!r||typeof r!="object"||!_o)return!1;try{return _o.call(r),!0}catch{}return!1}function Jf(r){if(!r||typeof r!="object"||!Oo)return!1;try{return Oo.call(r),!0}catch{}return!1}var Qf=Object.prototype.hasOwnProperty||function(r){return r in this};function Me(r,e){return Qf.call(r,e)}function Ue(r){return Nf.call(r)}function Zf(r){if(r.name)return r.name;var e=Gf.call(Uf.call(r),/^function\s*([\w$]+)/);return e?e[1]:null}function Ui(r,e){if(r.indexOf)return r.indexOf(e);for(var t=0,o=r.length;t<o;t++)if(r[t]===e)return t;return-1}function el(r){if(!Rr||!r||typeof r!="object")return!1;try{Rr.call(r);try{Pr.call(r)}catch{return!0}return r instanceof Map}catch{}return!1}function tl(r){if(!Rt||!r||typeof r!="object")return!1;try{Rt.call(r,Rt);try{Pt.call(r,Pt)}catch{return!0}return r instanceof WeakMap}catch{}return!1}function rl(r){if(!Xn||!r||typeof r!="object")return!1;try{return Xn.call(r),!0}catch{}return!1}function ol(r){if(!Pr||!r||typeof r!="object")return!1;try{Pr.call(r);try{Rr.call(r)}catch{return!0}return r instanceof Set}catch{}return!1}function nl(r){if(!Pt||!r||typeof r!="object")return!1;try{Pt.call(r,Pt);try{Rt.call(r,Rt)}catch{return!0}return r instanceof WeakSet}catch{}return!1}function al(r){return!r||typeof r!="object"?!1:typeof HTMLElement<"u"&&r instanceof HTMLElement?!0:typeof r.nodeName=="string"&&typeof r.getAttribute=="function"}function Gi(r,e){if(r.length>e.maxStringLength){var t=r.length-e.maxStringLength,o="... "+t+" more character"+(t>1?"s":"");return Gi(tn.call(r,0,e.maxStringLength),e)+o}var n=qf[e.quoteStyle||"single"];n.lastIndex=0;var a=Le.call(Le.call(r,n,"\\$1"),/[\x00-\x1f]/g,il);return Fi(a,"single",e)}function il(r){var e=r.charCodeAt(0),t={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return t?"\\"+t:"\\x"+(e<16?"0":"")+jf.call(e.toString(16))}function vt(r){return"Object("+r+")"}function Kr(r){return r+" { ? }"}function ta(r,e,t,o){var n=o?Fo(t,o):Te.call(t,", ");return r+" ("+e+") {"+n+"}"}function sl(r){for(var e=0;e<r.length;e++)if(Ui(r[e],`
`)>=0)return!1;return!0}function ul(r,e){var t;if(r.indent==="	")t="	";else if(typeof r.indent=="number"&&r.indent>0)t=Te.call(Array(r.indent+1)," ");else return null;return{base:t,prev:Te.call(Array(e+1),t)}}function Fo(r,e){if(r.length===0)return"";var t=`
`+e.prev+e.base;return t+Te.call(r,","+t)+`
`+e.prev}function Qt(r,e){var t=Do(r),o=[];if(t){o.length=r.length;for(var n=0;n<r.length;n++)o[n]=Me(r,n)?e(r[n],r):""}var a=typeof Hr=="function"?Hr(r):[],i;if(mt){i={};for(var s=0;s<a.length;s++)i["$"+a[s]]=a[s]}for(var u in r)Me(r,u)&&(t&&String(Number(u))===u&&u<r.length||mt&&i["$"+u]instanceof Symbol||(_i.call(/[^\w$]/,u)?o.push(e(u,r)+": "+e(r[u],r)):o.push(u+": "+e(r[u],r))));if(typeof Hr=="function")for(var c=0;c<a.length;c++)Li.call(r,a[c])&&o.push("["+e(a[c])+"]: "+e(r[a[c]],r));return o}var ji=ne,Vi=Qo,fl=Vi([ji("%String.prototype.indexOf%")]),le=function(e,t){var o=ji(e,!!t);return typeof o=="function"&&fl(e,".prototype.")>-1?Vi([o]):o},ll=ne,qi=ll("%Array%"),cl=!qi.isArray&&le("Object.prototype.toString"),rn=qi.isArray||function(e){return cl(e)==="[object Array]"},Wi=rn,ml=ne,dl=le,pl=U,gl=Wi,vl=ml("%Reflect.apply%",!0)||dl("Function.prototype.apply"),Nt=function(e,t){var o=arguments.length>2?arguments[2]:[];if(!gl(o))throw new pl("Assertion failed: optional `argumentsList`, if provided, must be a List");return vl(e,t,o)},Ye=function(e){return typeof e=="string"||typeof e=="symbol"},ra=U,yl=Ce,hl=Ye,bl=ie,Ut=function(e,t){if(!bl(e))throw new ra("Assertion failed: Type(O) is not Object");if(!hl(t))throw new ra("Assertion failed: P is not a Property Key, got "+yl(t));return e[t]},Yr,oa;function Xi(){return oa||(oa=1,Yr=function(e){return typeof e=="number"&&e>=55296&&e<=56319}),Yr}var zr,na;function Hi(){return na||(na=1,zr=function(e){return typeof e=="number"&&e>=56320&&e<=57343}),zr}var Jr,aa;function Tl(){if(aa)return Jr;aa=1;var r=ne,e=U,t=r("%String.fromCharCode%"),o=Xi(),n=Hi();return Jr=function(i,s){if(!o(i)||!n(s))throw new e("Assertion failed: `lead` must be a leading surrogate char code, and `trail` must be a trailing surrogate char code");return t(i)+t(s)},Jr}var Qr,ia;function Sl(){if(ia)return Qr;ia=1;var r=U,e=le,t=Xi(),o=Hi(),n=Tl(),a=e("String.prototype.charAt"),i=e("String.prototype.charCodeAt");return Qr=function(u,c){if(typeof u!="string")throw new r("Assertion failed: `string` must be a String");var d=u.length;if(c<0||c>=d)throw new r("Assertion failed: `position` must be >= 0, and < the length of `string`");var p=i(u,c),l=a(u,c),f=t(p),m=o(p);if(!f&&!m)return{"[[CodePoint]]":l,"[[CodeUnitCount]]":1,"[[IsUnpairedSurrogate]]":!1};if(m||c+1===d)return{"[[CodePoint]]":l,"[[CodeUnitCount]]":1,"[[IsUnpairedSurrogate]]":!0};var v=i(u,c+1);return o(v)?{"[[CodePoint]]":n(p,v),"[[CodeUnitCount]]":2,"[[IsUnpairedSurrogate]]":!1}:{"[[CodePoint]]":l,"[[CodeUnitCount]]":1,"[[IsUnpairedSurrogate]]":!0}},Qr}var Zr,sa;function El(){if(sa)return Zr;sa=1;var r=Ar;return Zr=function(t){return(typeof t=="number"||typeof t=="bigint")&&!r(t)&&t!==1/0&&t!==-1/0},Zr}var eo,ua;function wl(){if(ua)return eo;ua=1;var r=Ri,e=Pi,t=Ar,o=El();return eo=function(a){if(typeof a!="number"||t(a)||!o(a))return!1;var i=r(a);return e(i)===i},eo}var to,fa;function Il(){return fa||(fa=1,to=Number.MAX_SAFE_INTEGER||9007199254740991),to}var ro,la;function xl(){if(la)return ro;la=1;var r=Sl(),e=U,t=wl(),o=Il();return ro=function(a,i,s){if(typeof a!="string")throw new e("Assertion failed: `S` must be a String");if(!t(i)||i<0||i>o)throw new e("Assertion failed: `length` must be an integer >= 0 and <= 2**53");if(typeof s!="boolean")throw new e("Assertion failed: `unicode` must be a Boolean");if(!s)return i+1;var u=a.length;if(i+1>=u)return i+1;var c=r(a,i);return i+c["[[CodeUnitCount]]"]},ro}var oo,ca;function Ki(){if(ca)return oo;ca=1;var r=U;return oo=function(t,o){if(typeof o!="boolean")throw new r("Assertion failed: Type(done) is not Boolean");return{value:t,done:o}},oo}var Yi=function(e){return!!e},Rl=U,Pl=ie,Al=Ut,Ml=Yi,zi=function(e){if(!Pl(e))throw new Rl("Assertion failed: Type(iterResult) is not Object");return Ml(Al(e,"done"))},$l=U,kl=ie,Cl=Ut,Ji=function(e){if(!kl(e))throw new $l("Assertion failed: Type(iterResult) is not Object");return Cl(e,"value")},no,ma;function Bl(){if(ma)return no;ma=1;var r=ne,e=Oi,t=Fe,o=r("%Promise.resolve%",!0),n=o&&e(o);return no=function(i,s){if(!n)throw new t("This environment does not support Promises.");return n(i,s)},no}var ao,da;function Ol(){if(da)return ao;da=1;var r=ne,e=Fe,t=U,o=ie,n=r("%Promise%",!0),a=le,i=Ki(),s=zi,u=Ji,c=Bl(),d=a("Promise.prototype.then",!0);return ao=function(l){if(!o(l))throw new t("Assertion failed: Type(O) is not Object");if(arguments.length>1)throw new e("although AsyncFromSyncIteratorContinuation should take a second argument, it is not used in this implementation");if(!n)throw new e("This environment does not support Promises.");return new n(function(f){var m=s(l),v=u(l),b=c(n,v),g=function(S){return i(S,m)};f(d(b,g))})},ao}var _l=U,Ll=Ce,Dl=Ye,Fl=function(e,t){if(!Dl(t))throw new _l("Assertion failed: P is not a Property Key, got "+Ll(t));return e[t]},Qi=Function.prototype.toString,st=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,No,dr;if(typeof st=="function"&&typeof Object.defineProperty=="function")try{No=Object.defineProperty({},"length",{get:function(){throw dr}}),dr={},st(function(){throw 42},null,No)}catch(r){r!==dr&&(st=null)}else st=null;var Nl=/^\s*class\b/,Uo=function(e){try{var t=Qi.call(e);return Nl.test(t)}catch{return!1}},io=function(e){try{return Uo(e)?!1:(Qi.call(e),!0)}catch{return!1}},pr=Object.prototype.toString,Ul="[object Object]",Gl="[object Function]",jl="[object GeneratorFunction]",Vl="[object HTMLAllCollection]",ql="[object HTML document.all class]",Wl="[object HTMLCollection]",Xl=typeof Symbol=="function"&&!!Symbol.toStringTag,Hl=!(0 in[,]),Go=function(){return!1};if(typeof document=="object"){var Kl=document.all;pr.call(Kl)===pr.call(document.all)&&(Go=function(e){if((Hl||!e)&&(typeof e>"u"||typeof e=="object"))try{var t=pr.call(e);return(t===Vl||t===ql||t===Wl||t===Ul)&&e("")==null}catch{}return!1})}var Zi=st?function(e){if(Go(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;try{st(e,null,No)}catch(t){if(t!==dr)return!1}return!Uo(e)&&io(e)}:function(e){if(Go(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;if(Xl)return io(e);if(Uo(e))return!1;var t=pr.call(e);return t!==Gl&&t!==jl&&!/^\[object HTML/.test(t)?!1:io(e)},Gt=Zi,pa=U,Yl=Fl,zl=Gt,Jl=Ye,ga=Ce,on=function(e,t){if(!Jl(t))throw new pa("Assertion failed: P is not a Property Key");var o=Yl(e,t);if(o!=null){if(!zl(o))throw new pa(ga(t)+" is not a function: "+ga(o));return o}},so=Ne(),$r=function(e){return!!e&&typeof e=="object"&&so(e,"[[Iterator]]")&&so(e,"[[NextMethod]]")&&so(e,"[[Done]]")&&typeof e["[[Done]]"]=="boolean"},va=U,Ql=ie,ya=Nt,Zl=$r,es=function(e){if(!Zl(e))throw new va("Assertion failed: `iteratorRecord` must be an Iterator Record");var t;if(arguments.length<2?t=ya(e["[[NextMethod]]"],e["[[Iterator]]"]):t=ya(e["[[NextMethod]]"],e["[[Iterator]]"],[arguments[1]]),!Ql(t))throw new va("iterator next must return an object");return t},uo,ha;function ec(){return ha||(ha=1,uo=function(e,t){for(var o=0;o<e.length;o+=1)t(e[o],o,e)}),uo}var tc=Ce,rc=U,kr=function(r,e,t){for(var o=r,n;(n=o.next)!=null;o=n)if(n.key===e)return o.next=n.next,t||(n.next=r.next,r.next=n),n},oc=function(r,e){if(r){var t=kr(r,e);return t&&t.value}},nc=function(r,e,t){var o=kr(r,e);o?o.value=t:r.next={key:e,next:r.next,value:t}},ac=function(r,e){return r?!!kr(r,e):!1},ic=function(r,e){if(r)return kr(r,e,!0)},sc=function(){var e,t={assert:function(o){if(!t.has(o))throw new rc("Side channel does not contain "+tc(o))},delete:function(o){var n=e&&e.next,a=ic(e,o);return a&&n&&n===a&&(e=void 0),!!a},get:function(o){return oc(e,o)},has:function(o){return ac(e,o)},set:function(o,n){e||(e={next:void 0}),nc(e,o,n)}};return t},uc=ne,jt=le,fc=Ce,lc=U,ba=uc("%Map%",!0),cc=jt("Map.prototype.get",!0),mc=jt("Map.prototype.set",!0),dc=jt("Map.prototype.has",!0),pc=jt("Map.prototype.delete",!0),gc=jt("Map.prototype.size",!0),ts=!!ba&&function(){var e,t={assert:function(o){if(!t.has(o))throw new lc("Side channel does not contain "+fc(o))},delete:function(o){if(e){var n=pc(e,o);return gc(e)===0&&(e=void 0),n}return!1},get:function(o){if(e)return cc(e,o)},has:function(o){return e?dc(e,o):!1},set:function(o,n){e||(e=new ba),mc(e,o,n)}};return t},vc=ne,Cr=le,yc=Ce,Zt=ts,hc=U,tt=vc("%WeakMap%",!0),bc=Cr("WeakMap.prototype.get",!0),Tc=Cr("WeakMap.prototype.set",!0),Sc=Cr("WeakMap.prototype.has",!0),Ec=Cr("WeakMap.prototype.delete",!0),wc=tt?function(){var e,t,o={assert:function(n){if(!o.has(n))throw new hc("Side channel does not contain "+yc(n))},delete:function(n){if(tt&&n&&(typeof n=="object"||typeof n=="function")){if(e)return Ec(e,n)}else if(Zt&&t)return t.delete(n);return!1},get:function(n){return tt&&n&&(typeof n=="object"||typeof n=="function")&&e?bc(e,n):t&&t.get(n)},has:function(n){return tt&&n&&(typeof n=="object"||typeof n=="function")&&e?Sc(e,n):!!t&&t.has(n)},set:function(n,a){tt&&n&&(typeof n=="object"||typeof n=="function")?(e||(e=new tt),Tc(e,n,a)):Zt&&(t||(t=Zt()),t.set(n,a))}};return o}:Zt,Ic=U,xc=Ce,Rc=sc,Pc=ts,Ac=wc,Mc=Ac||Pc||Rc,$c=function(){var e,t={assert:function(o){if(!t.has(o))throw new Ic("Side channel does not contain "+xc(o))},delete:function(o){return!!e&&e.delete(o)},get:function(o){return e&&e.get(o)},has:function(o){return!!e&&e.has(o)},set:function(o,n){e||(e=Mc()),e.set(o,n)}};return t},kc=Ne(),yt=$c(),Ae=U,nn={assert:function(r,e){if(!r||typeof r!="object"&&typeof r!="function")throw new Ae("`O` is not an object");if(typeof e!="string")throw new Ae("`slot` must be a string");if(yt.assert(r),!nn.has(r,e))throw new Ae("`"+e+"` is not present on `O`")},get:function(r,e){if(!r||typeof r!="object"&&typeof r!="function")throw new Ae("`O` is not an object");if(typeof e!="string")throw new Ae("`slot` must be a string");var t=yt.get(r);return t&&t["$"+e]},has:function(r,e){if(!r||typeof r!="object"&&typeof r!="function")throw new Ae("`O` is not an object");if(typeof e!="string")throw new Ae("`slot` must be a string");var t=yt.get(r);return!!t&&kc(t,"$"+e)},set:function(r,e,t){if(!r||typeof r!="object"&&typeof r!="function")throw new Ae("`O` is not an object");if(typeof e!="string")throw new Ae("`slot` must be a string");var o=yt.get(r);o||(o={},yt.set(r,o)),o["$"+e]=t}};Object.freeze&&Object.freeze(nn);var an=nn,fo,Ta;function Cc(){if(Ta)return fo;Ta=1;var r={__proto__:null,foo:{}},e={__proto__:r}.foo===r.foo&&!(r instanceof Object);return fo=function(){return e},fo}var lo,Sa;function Bc(){if(Sa)return lo;Sa=1;var r=ne,e=r("%Object.create%",!0),t=U,o=Fe,n=ie,a=Wi,i=ec(),s=an,u=Cc()();return lo=function(d){if(d!==null&&!n(d))throw new t("Assertion failed: `proto` must be null or an object");var p=arguments.length<2?[]:arguments[1];if(!a(p))throw new t("Assertion failed: `additionalInternalSlotsList` must be an Array");var l;if(u)l={__proto__:d};else if(e)l=e(d);else{if(d===null)throw new o("native Object.create support is required to create null objects");var f=function(){};f.prototype=d,l=new f}return p.length>0&&i(p,function(m){s.set(l,m,void 0)}),l},lo}var co,Ea;function Oc(){if(Ea)return co;Ea=1;var r=ne,e=Fe,t=U,o=ie,n=r("%Promise%",!0),a=Ol(),i=Nt,s=Ki(),u=Ut,c=on,d=es,p=Bc(),l=$r,f=an,m=r("%AsyncFromSyncIteratorPrototype%",!0)||{next:function(b){if(!n)throw new e("This environment does not support Promises.");var g=this;f.assert(g,"[[SyncIteratorRecord]]");var S=arguments.length;return new n(function(P){var A=f.get(g,"[[SyncIteratorRecord]]"),E;S>0?E=d(A,b):E=d(A),P(a(E))})},return:function(){if(!n)throw new e("This environment does not support Promises.");var v=this;f.assert(v,"[[SyncIteratorRecord]]");var b=arguments.length>0,g=b?arguments[0]:void 0;return new n(function(S,P){var A=f.get(v,"[[SyncIteratorRecord]]")["[[Iterator]]"],E=c(A,"return");if(typeof E>"u"){var M=s(g,!0);i(S,void 0,[M]);return}var R;if(b?R=i(E,A,[g]):R=i(E,A),!o(R)){i(P,void 0,[new t("Iterator `return` method returned a non-object value.")]);return}S(a(R))})},throw:function(){if(!n)throw new e("This environment does not support Promises.");var v=this;f.assert(v,"[[SyncIteratorRecord]]");var b=arguments.length>0,g=b?arguments[0]:void 0;return new n(function(S,P){var A=f.get(v,"[[SyncIteratorRecord]]")["[[Iterator]]"],E=c(A,"throw");if(typeof E>"u"){i(P,void 0,[g]);return}var M;if(b?M=i(E,A,[g]):M=i(E,A),!o(M)){i(P,void 0,[new t("Iterator `throw` method returned a non-object value.")]);return}S(a(M))})}};return co=function(b){if(!l(b))throw new t("Assertion failed: `syncIteratorRecord` must be an Iterator Record");var g=p(m);f.set(g,"[[SyncIteratorRecord]]",b);var S=u(g,"next");return{"[[Iterator]]":g,"[[NextMethod]]":S,"[[Done]]":!1}},co}var mo,wa;function _c(){if(wa)return mo;wa=1;var r=U,e=ie,t=Nt,o=Ut,n=Gt;return mo=function(i,s){if(!n(s))throw new r("method must be a function");var u=t(s,i);if(!e(u))throw new r("iterator must return an object");var c=o(u,"next");return{"[[Iterator]]":u,"[[NextMethod]]":c,"[[Done]]":!1}},mo}var po,Ia;function sn(){if(Ia)return po;Ia=1;var r=Ai();return po=function(){return r()&&!!Symbol.toStringTag},po}var go,xa;function Lc(){if(xa)return go;xa=1;var r=le,e=r("String.prototype.valueOf"),t=function(s){try{return e(s),!0}catch{return!1}},o=r("Object.prototype.toString"),n="[object String]",a=sn()();return go=function(s){return typeof s=="string"?!0:!s||typeof s!="object"?!1:a?t(s):o(s)===n},go}var vo,Ra;function Dc(){if(Ra)return vo;Ra=1;var r=Mr()(),e=ne,t=le,o=Lc(),n=e("%Symbol.iterator%",!0),a=t("String.prototype.slice"),i=e("%String%"),s=rn;return vo=function(c,d){var p;return r?p=c.GetMethod(d,n):s(d)?p=function(){var l=-1,f=this;return{next:function(){return l+=1,{done:l>=f.length,value:f[l]}}}}:o(d)&&(p=function(){var l=0;return{next:function(){var f=c.AdvanceStringIndex(i(d),l,!0),m=a(d,l,f);l=f;var v=f>d.length;return{done:v,value:v?void 0:m}}}}),p},vo}var Fc=ne,yo=U,Pa=Fc("%Symbol.asyncIterator%",!0),Nc=Ce,Uc=Mr()(),Gc=xl(),jc=Oc(),Aa=_c(),rs=on,Vc={AdvanceStringIndex:Gc,GetMethod:rs},qc=Dc(),Wc=function(e,t){if(t!=="SYNC"&&t!=="ASYNC")throw new yo("Assertion failed: `kind` must be one of 'sync' or 'async', got "+Nc(t));var o;if(t==="ASYNC"&&Uc&&Pa&&(o=rs(e,Pa)),typeof o>"u"){var n=qc(Vc,e);if(t==="ASYNC"){if(typeof n>"u")throw new yo("iterator method is `undefined`");var a=Aa(e,n);return jc(a)}o=n}if(typeof o>"u")throw new yo("iterator method is `undefined`");return Aa(e,o)},os=Fe,De=an,Vt=function r(e,t){if(!(this instanceof r))return new r(e,t);if(e!=="normal"&&e!=="break"&&e!=="continue"&&e!=="return"&&e!=="throw")throw new os('Assertion failed: `type` must be one of "normal", "break", "continue", "return", or "throw"');De.set(this,"[[Type]]",e),De.set(this,"[[Value]]",t)};Vt.prototype.type=function(){return De.get(this,"[[Type]]")};Vt.prototype.value=function(){return De.get(this,"[[Value]]")};Vt.prototype["?"]=function(){var e=De.get(this,"[[Type]]"),t=De.get(this,"[[Value]]");if(e==="throw")throw t;return t};Vt.prototype["!"]=function(){var e=De.get(this,"[[Type]]");if(e!=="normal")throw new os('Assertion failed: Completion Record is not of type "normal"');return De.get(this,"[[Value]]")};var ns=Vt,er=U,Ma=ie,Xc=Nt,$a=ns,Hc=on,Kc=Gt,Yc=$r,zc=function(e,t){if(!Yc(e))throw new er("Assertion failed: `iteratorRecord` must be an Iterator Record");if(!Ma(e["[[Iterator]]"]))throw new er("Assertion failed: iteratorRecord.[[Iterator]] must be an Object");if(!Kc(t)&&!(t instanceof $a))throw new er("Assertion failed: completion is not a thunk representing a Completion Record, nor a Completion Record instance");var o=t instanceof $a?function(){return t["?"]()}:t,n=e["[[Iterator]]"],a;try{a=Hc(n,"return")}catch(u){throw o(),o=null,u}if(typeof a>"u")return o();var i;try{i=Xc(a,n,[])}catch(u){throw o(),o=null,u}var s=o();if(o=null,!Ma(i))throw new er("iterator .return must return an object");return s},Jc=U,Qc=zi,Zc=es,em=$r,tm=function(e){if(!em(e))throw new Jc("Assertion failed: `iteratorRecord` must be an Iterator Record");var t=Zc(e),o=Qc(t);return o===!0?!1:t},rm=ns,om=function(e){return new rm("throw",e)},ho=U,nm=ie,am=Ce,im=Nt,ka=Ut,sm=Wc,um=Gt,Ca=zc,fm=tm,lm=Ji,Ba=om,cm=function(e,t,o){if(!um(o))throw new ho("Assertion failed: `adder` is not callable");if(t==null)throw new ho("Assertion failed: `iterable` is present, and not nullish");for(var n=sm(t,"SYNC");;){var a=fm(n);if(!a)return e;var i=lm(a);if(!nm(i)){var s=Ba(new ho("iterator next must return an Object, got "+am(i)));return Ca(n,s)}try{var u=ka(i,"0"),c=ka(i,"1");im(o,e,[u,c])}catch(d){return Ca(n,Ba(d))}}},mm=U,ht=Ne(),dm={__proto__:null,"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Get]]":!0,"[[Set]]":!0,"[[Value]]":!0,"[[Writable]]":!0},ze=function(e){if(!e||typeof e!="object")return!1;for(var t in e)if(ht(e,t)&&!dm[t])return!1;var o=ht(e,"[[Value]]")||ht(e,"[[Writable]]"),n=ht(e,"[[Get]]")||ht(e,"[[Set]]");if(o&&n)throw new mm("Property Descriptors may not be both accessor and data descriptors");return!0},pm=U,Oa=Ne(),gm=ze,un=function(e){if(typeof e>"u")return!1;if(!gm(e))throw new pm("Assertion failed: `Desc` must be a Property Descriptor");return!(!Oa(e,"[[Get]]")&&!Oa(e,"[[Set]]"))},bo,_a;function vm(){return _a||(_a=1,bo=function(e){return e===null||typeof e!="function"&&typeof e!="object"}),bo}var as=ne,ym=as("%Object.preventExtensions%",!0),hm=as("%Object.isExtensible%",!0),La=vm(),bm=ym?function(e){return!La(e)&&hm(e)}:function(e){return!La(e)},ye=Ne(),tr=U,Tm=ie,Da=Gt,To=Yi,Sm=function(e){if(!Tm(e))throw new tr("ToPropertyDescriptor requires an object");var t={};if(ye(e,"enumerable")&&(t["[[Enumerable]]"]=To(e.enumerable)),ye(e,"configurable")&&(t["[[Configurable]]"]=To(e.configurable)),ye(e,"value")&&(t["[[Value]]"]=e.value),ye(e,"writable")&&(t["[[Writable]]"]=To(e.writable)),ye(e,"get")){var o=e.get;if(typeof o<"u"&&!Da(o))throw new tr("getter must be a function");t["[[Get]]"]=o}if(ye(e,"set")){var n=e.set;if(typeof n<"u"&&!Da(n))throw new tr("setter must be a function");t["[[Set]]"]=n}if((ye(t,"[[Get]]")||ye(t,"[[Set]]"))&&(ye(t,"[[Value]]")||ye(t,"[[Writable]]")))throw new tr("Invalid property descriptor. Cannot both specify accessors and a value or writable attribute");return t},Fa=Ar,is=function(e,t){return e===t?e===0?1/e===1/t:!0:Fa(e)&&Fa(t)},Em=Yo,Na=_t,ss=Em.hasArrayLengthDefineBug(),wm=ss&&rn,Im=le,xm=Im("Object.prototype.propertyIsEnumerable"),Rm=function(e,t,o,n,a,i){if(!Na){if(!e(i)||!i["[[Configurable]]"]||!i["[[Writable]]"]||a in n&&xm(n,a)!==!!i["[[Enumerable]]"])return!1;var s=i["[[Value]]"];return n[a]=s,t(n[a],s)}return ss&&a==="length"&&"[[Value]]"in i&&wm(n)&&n.length!==i["[[Value]]"]?(n.length=i["[[Value]]"],n.length===i["[[Value]]"]):(Na(n,a,o(i)),!0)},Pm=ze,Am=function(e,t){return Pm(t)&&"[[Enumerable]]"in t&&"[[Configurable]]"in t&&(e.IsAccessorDescriptor(t)||e.IsDataDescriptor(t))},Mm=function(e){if(typeof e>"u")return e;var t={};return"[[Value]]"in e&&(t.value=e["[[Value]]"]),"[[Writable]]"in e&&(t.writable=!!e["[[Writable]]"]),"[[Get]]"in e&&(t.get=e["[[Get]]"]),"[[Set]]"in e&&(t.set=e["[[Set]]"]),"[[Enumerable]]"in e&&(t.enumerable=!!e["[[Enumerable]]"]),"[[Configurable]]"in e&&(t.configurable=!!e["[[Configurable]]"]),t},$m=U,km=ze,Cm=Mm,Bm=function(e){if(typeof e<"u"&&!km(e))throw new $m("Assertion failed: `Desc` must be a Property Descriptor");return Cm(e)},Om=U,Ua=Ne(),_m=ze,us=function(e){if(typeof e>"u")return!1;if(!_m(e))throw new Om("Assertion failed: `Desc` must be a Property Descriptor");return!(!Ua(e,"[[Value]]")&&!Ua(e,"[[Writable]]"))},Lm=U,Dm=un,Fm=us,Nm=ze,Um=function(e){if(typeof e>"u")return!1;if(!Nm(e))throw new Lm("Assertion failed: `Desc` must be a Property Descriptor");return!Dm(e)&&!Fm(e)},rt=U,Gm=ie,bt=Rm,jm=Am,Ga=ze,Tt=Bm,Ve=un,Be=us,Vm=Um,qm=Ye,he=is,Wm=function(e,t,o,n,a){if(typeof e<"u"&&!Gm(e))throw new rt("Assertion failed: O must be undefined or an Object");if(!qm(t))throw new rt("Assertion failed: P must be a Property Key");if(typeof o!="boolean")throw new rt("Assertion failed: extensible must be a Boolean");if(!Ga(n))throw new rt("Assertion failed: Desc must be a Property Descriptor");if(typeof a<"u"&&!Ga(a))throw new rt("Assertion failed: current must be a Property Descriptor, or undefined");if(typeof a>"u")return o?typeof e>"u"?!0:Ve(n)?bt(Be,he,Tt,e,t,n):bt(Be,he,Tt,e,t,{"[[Configurable]]":!!n["[[Configurable]]"],"[[Enumerable]]":!!n["[[Enumerable]]"],"[[Value]]":n["[[Value]]"],"[[Writable]]":!!n["[[Writable]]"]}):!1;if(!jm({IsAccessorDescriptor:Ve,IsDataDescriptor:Be},a))throw new rt("`current`, when present, must be a fully populated and valid Property Descriptor");if(!a["[[Configurable]]"]){if("[[Configurable]]"in n&&n["[[Configurable]]"]||"[[Enumerable]]"in n&&!he(n["[[Enumerable]]"],a["[[Enumerable]]"])||!Vm(n)&&!he(Ve(n),Ve(a)))return!1;if(Ve(a)){if("[[Get]]"in n&&!he(n["[[Get]]"],a["[[Get]]"])||"[[Set]]"in n&&!he(n["[[Set]]"],a["[[Set]]"]))return!1}else if(!a["[[Writable]]"]&&("[[Writable]]"in n&&n["[[Writable]]"]||"[[Value]]"in n&&!he(n["[[Value]]"],a["[[Value]]"])))return!1}if(typeof e<"u"){var i,s;return Be(a)&&Ve(n)?(i=("[[Configurable]]"in n?n:a)["[[Configurable]]"],s=("[[Enumerable]]"in n?n:a)["[[Enumerable]]"],bt(Be,he,Tt,e,t,{"[[Configurable]]":!!i,"[[Enumerable]]":!!s,"[[Get]]":("[[Get]]"in n?n:a)["[[Get]]"],"[[Set]]":("[[Set]]"in n?n:a)["[[Set]]"]})):Ve(a)&&Be(n)?(i=("[[Configurable]]"in n?n:a)["[[Configurable]]"],s=("[[Enumerable]]"in n?n:a)["[[Enumerable]]"],bt(Be,he,Tt,e,t,{"[[Configurable]]":!!i,"[[Enumerable]]":!!s,"[[Value]]":("[[Value]]"in n?n:a)["[[Value]]"],"[[Writable]]":!!("[[Writable]]"in n?n:a)["[[Writable]]"]})):bt(Be,he,Tt,e,t,n)}return!0},ja=pt,Va=Fe,So=U,Xm=ie,Hm=ze,Km=un,Ym=bm,zm=Ye,Jm=Sm,Qm=is,Zm=Wm,ed=function(e,t,o){if(!Xm(e))throw new So("Assertion failed: O must be an Object");if(!zm(t))throw new So("Assertion failed: P must be a Property Key");if(!Hm(o))throw new So("Assertion failed: Desc must be a Property Descriptor");if(!ja){if(Km(o))throw new Va("This environment does not support accessor property descriptors.");var n=!(t in e)&&o["[[Writable]]"]&&o["[[Enumerable]]"]&&o["[[Configurable]]"]&&"[[Value]]"in o,a=t in e&&(!("[[Configurable]]"in o)||o["[[Configurable]]"])&&(!("[[Enumerable]]"in o)||o["[[Enumerable]]"])&&(!("[[Writable]]"in o)||o["[[Writable]]"])&&"[[Value]]"in o;if(n||a)return e[t]=o["[[Value]]"],Qm(e[t],o["[[Value]]"]);throw new Va("This environment does not support defining non-writable, non-enumerable, or non-configurable properties")}var i=ja(e,t),s=i&&Jm(i),u=Ym(e);return Zm(e,t,u,o,s)},qa=U,td=ie,rd=Ye,od=ed,nd=function(e,t,o){if(!td(e))throw new qa("Assertion failed: Type(O) is not Object");if(!rd(t))throw new qa("Assertion failed: P is not a Property Key");var n={"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Value]]":o,"[[Writable]]":!0};return od(e,t,n)},Eo=U,ad=ie,id=nd,sd=Ye,ud=function(e,t,o){if(!ad(e))throw new Eo("Assertion failed: Type(O) is not Object");if(!sd(t))throw new Eo("Assertion failed: P is not a Property Key");var n=id(e,t,o);if(!n)throw new Eo("unable to create data property")},fd=U,ld=function(e){if(e==null)throw new fd(arguments.length>0&&arguments[1]||"Cannot call method on "+e);return e},wo,Wa;function cd(){return Wa||(Wa=1,wo=function(e){return e===null||typeof e!="function"&&typeof e!="object"}),wo}var Io,Xa;function md(){if(Xa)return Io;Xa=1;var r=le,e=r("Date.prototype.getDay"),t=function(s){try{return e(s),!0}catch{return!1}},o=r("Object.prototype.toString"),n="[object Date]",a=sn()();return Io=function(s){return typeof s!="object"||s===null?!1:a?t(s):o(s)===n},Io}var rr={exports:{}},xo,Ha;function dd(){if(Ha)return xo;Ha=1;var r=le,e=sn()(),t=Ne(),o=pt,n;if(e){var a=r("RegExp.prototype.exec"),i={},s=function(){throw i},u={toString:s,valueOf:s};typeof Symbol.toPrimitive=="symbol"&&(u[Symbol.toPrimitive]=s),n=function(l){if(!l||typeof l!="object")return!1;var f=o(l,"lastIndex"),m=f&&t(f,"value");if(!m)return!1;try{a(l,u)}catch(v){return v===i}}}else{var c=r("Object.prototype.toString"),d="[object RegExp]";n=function(l){return!l||typeof l!="object"&&typeof l!="function"?!1:c(l)===d}}return xo=n,xo}var Ro,Ka;function pd(){if(Ka)return Ro;Ka=1;var r=le,e=dd(),t=r("RegExp.prototype.exec"),o=U;return Ro=function(a){if(!e(a))throw new o("`regex` must be a RegExp");return function(s){return t(a,s)!==null}},Ro}var Ya;function gd(){if(Ya)return rr.exports;Ya=1;var r=le,e=r("Object.prototype.toString"),t=Mr()(),o=pd();if(t){var n=r("Symbol.prototype.toString"),a=o(/^Symbol\(.*\)$/),i=function(u){return typeof u.valueOf()!="symbol"?!1:a(n(u))};rr.exports=function(u){if(typeof u=="symbol")return!0;if(!u||typeof u!="object"||e(u)!=="[object Symbol]")return!1;try{return i(u)}catch{return!1}}}else rr.exports=function(u){return!1};return rr.exports}var Po,za;function vd(){if(za)return Po;za=1;var r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol",e=cd(),t=Zi,o=md(),n=gd(),a=function(u,c){if(typeof u>"u"||u===null)throw new TypeError("Cannot call method on "+u);if(typeof c!="string"||c!=="number"&&c!=="string")throw new TypeError('hint must be "string" or "number"');var d=c==="string"?["toString","valueOf"]:["valueOf","toString"],p,l,f;for(f=0;f<d.length;++f)if(p=u[d[f]],t(p)&&(l=p.call(u),e(l)))return l;throw new TypeError("No default value")},i=function(u,c){var d=u[c];if(d!==null&&typeof d<"u"){if(!t(d))throw new TypeError(d+" returned for property "+String(c)+" of object "+u+" is not a function");return d}};return Po=function(u){if(e(u))return u;var c="default";arguments.length>1&&(arguments[1]===String?c="string":arguments[1]===Number&&(c="number"));var d;if(r&&(Symbol.toPrimitive?d=i(u,Symbol.toPrimitive):n(u)&&(d=Symbol.prototype.valueOf)),typeof d<"u"){var p=d.call(u,c);if(e(p))return p;throw new TypeError("unable to convert exotic object to primitive")}return c==="default"&&(o(u)||n(u))&&(c="string"),a(u,c==="default"?"number":c)},Po}var Ao,Ja;function yd(){if(Ja)return Ao;Ja=1;var r=vd();return Ao=function(t){return arguments.length>1?r(t,arguments[1]):r(t)},Ao}var Mo,Qa;function hd(){if(Qa)return Mo;Qa=1;var r=ne,e=r("%String%"),t=U;return Mo=function(n){if(typeof n=="symbol")throw new t("Cannot convert a Symbol value to a string");return e(n)},Mo}var bd=ne,Td=bd("%String%"),Sd=yd(),Ed=hd(),wd=function(e){var t=Sd(e,Td);return typeof t=="symbol"?t:Ed(t)},Id=cm,xd=ud,Rd=ld,Pd=wd,Ad=function(e,t){var o=this,n=Pd(e);xd(o,n,t)},fs=function(e){return Rd(e),Id({},e,Ad)},Md=fs,ls=function(){return typeof Object.fromEntries=="function"?Object.fromEntries:Md},$d=ls,kd=wi,Cd=function(){var e=$d();return kd(Object,{fromEntries:e},{fromEntries:function(){return Object.fromEntries!==e}}),e},Bd=wi,Od=Oi,_d=fs,cs=ls,Ld=Cd,ms=Od(cs(),Object);Bd(ms,{getPolyfill:cs,implementation:_d,shim:Ld});var Dd=ms,Fd=se&&se.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,n){o.__proto__=n}||function(o,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(o[a]=n[a])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}}(),jo=se&&se.__assign||function(){return jo=Object.assign||function(r){for(var e,t=1,o=arguments.length;t<o;t++){e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n])}return r},jo.apply(this,arguments)},Nd=se&&se.__createBinding||(Object.create?function(r,e,t,o){o===void 0&&(o=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,o,n)}:function(r,e,t,o){o===void 0&&(o=t),r[o]=e[t]}),Ud=se&&se.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Gd=se&&se.__importStar||function(){var r=function(e){return r=Object.getOwnPropertyNames||function(t){var o=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(o[o.length]=n);return o},r(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var o=r(e),n=0;n<o.length;n++)o[n]!=="default"&&Nd(t,e,o[n]);return Ud(t,e),t}}(),jd=se&&se.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ko,"__esModule",{value:!0});var ds=Ko.Scrubber=void 0,ge=Gd(O),Vd=jd(Dd),$o=function(r,e,t){return Math.min(Math.max(r,t),e)},or=function(r,e){return parseFloat(r.toFixed(e))},qd=function(r,e){return(0,Vd.default)(Object.entries(r).filter(function(t){var o=t[0],n=t[1];return e(o,n)}))},Wd=function(r){Fd(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.barRef=(0,ge.createRef)(),t.state={seeking:!1,mouseX:null,mouseY:null,touchId:null,touchX:null,touchY:null,hover:!1},t.getPositionFromMouseX=function(){var o=t.barRef.current;if(!o)return 0;var n=t.props,a=n.min,i=n.max,s=t.state,u=s.mouseX,c=s.touchX,d=o.getBoundingClientRect(),p=d.left,l=d.width,f=p+window.scrollX,m=typeof c=="number"?c:u||0,v=$o(f,f+l,m),b=or((v-f)/l,7);return or((i-a)*b,7)+a},t.getPositionFromMouseY=function(){var o=t.barRef.current;if(!o)return 0;var n=t.props,a=n.min,i=n.max,s=t.state,u=s.mouseY,c=s.touchY,d=o.getBoundingClientRect(),p=d.bottom,l=d.height,f=typeof c=="number"?c:u||0,m=p+window.scrollY,v=$o(m-l,m,f),b=or((m-v)/l,7);return or((i-a)*b,7)+a},t.getPositionFromCursor=function(){var o=t.props.vertical;return o?t.getPositionFromMouseY():t.getPositionFromMouseX()},t.handleMouseOver=function(o){t.setState({mouseX:o.pageX,mouseY:o.pageY,hover:!0},function(){t.props.onMouseOver&&t.props.onMouseOver(t.getPositionFromCursor())})},t.handleMouseLeave=function(o){t.setState({mouseX:o.pageX,mouseY:o.pageY,hover:!1},function(){t.props.onMouseLeave&&t.props.onMouseLeave(t.getPositionFromCursor())})},t.handleMouseMove=function(o){t.setState({mouseX:o.pageX,mouseY:o.pageY},function(){var n=void 0;t.state.hover&&t.props.onMouseMove&&(n=t.getPositionFromCursor(),t.props.onMouseMove(n)),t.state.seeking&&t.props.onScrubChange&&(n===void 0&&(n=t.getPositionFromCursor()),t.props.onScrubChange(n))})},t.handleTouchMove=function(o){t.state.seeking&&o.preventDefault();var n=Array.from(o.changedTouches).find(function(a){return a.identifier===t.state.touchId});n&&t.setState({touchX:n.pageX,touchY:n.pageY},function(){t.state.seeking&&t.props.onScrubChange&&t.props.onScrubChange(t.getPositionFromCursor())})},t.handleSeekStart=function(o){t.setState({seeking:!0,mouseX:o.pageX,mouseY:o.pageY},function(){t.props.onScrubStart&&t.props.onScrubStart(t.getPositionFromCursor())})},t.handleTouchStart=function(o){var n=o.changedTouches[0];t.setState({hover:!0,seeking:!0,touchId:n.identifier,touchX:n.pageX,touchY:n.pageY},function(){t.props.onScrubStart&&t.props.onScrubStart(t.getPositionFromCursor())})},t.handleSeekEnd=function(){t.state.seeking&&(t.props.onScrubEnd&&t.props.onScrubEnd(t.getPositionFromCursor()),t.setState({seeking:!1}))},t.handleTouchEnd=function(o){var n=Array.from(o.changedTouches).find(function(a){return a.identifier===t.state.touchId});n&&t.state.seeking&&(t.props.onScrubEnd&&t.props.onScrubEnd(t.getPositionFromCursor()),t.setState({hover:!1,seeking:!1,touchX:null,touchY:null,touchId:null}))},t.renderTooltip=function(){var o,n=t.props,a=n.tooltip,i=n.vertical;if(a){var s=!t.state.seeking&&t.state.hover,u=t.state.seeking,c=s&&(a==null?void 0:a.enabledOnHover)||u&&(a==null?void 0:a.enabledOnScrub);if(c){var d="bar__tooltip";a.className&&(d="".concat(d," ").concat(a.className));var p=t.getPositionFromCursor(),l=t.getValuePercent(p),f=a.formatString?a.formatString(p):p.toFixed().toString();return ge.default.createElement("div",{className:d,style:(o={},o[i?"bottom":"left"]="".concat(l,"%"),o)},ge.default.createElement("div",{className:"bar__tooltip-text"},f),ge.default.createElement("div",{className:"bar__tooltip-arrow"}))}}},t.renderMarkers=function(){var o=t.props,n=o.vertical,a=o.markers;return a?a.map(function(i,s){var u="bar__marker",c={};if(typeof i=="number"){var d=t.getValuePercent(i);n?c.bottom="".concat(d,"%"):c.left="".concat(d,"%")}else{var p=t.getValuePercent(i.start),l=i.end&&t.getValuePercent(i.end);n?(c.bottom="".concat(p,"%"),l&&(c.top="".concat(100-parseFloat(l),"%"),c.height="unset")):(c.left="".concat(p,"%"),l&&(c.right="".concat(100-parseFloat(l),"%"),c.width="unset")),i.className&&(u="".concat(u," ").concat(i.className))}return ge.default.createElement("div",{key:s,className:u,style:c})}):null},t.getValuePercent=function(o){var n=t.props,a=n.min,i=n.max;return(($o(a,i,o)-a)/(i-a)*100).toFixed(5)},t}return e.prototype.componentDidMount=function(){window.addEventListener("mousemove",this.handleMouseMove),window.addEventListener("mouseup",this.handleSeekEnd),window.addEventListener("touchmove",this.handleTouchMove),window.addEventListener("touchend",this.handleTouchEnd)},e.prototype.componentWillUnmount=function(){window.removeEventListener("mousemove",this.handleMouseMove),window.removeEventListener("mouseup",this.handleSeekEnd),window.removeEventListener("touchmove",this.handleTouchMove),window.removeEventListener("touchend",this.handleTouchEnd)},e.prototype.render=function(){var t,o,n,a=this.props,i=a.className,s=a.value,u=a.bufferPosition,c=u===void 0?0:u,d=a.vertical,p=this.getValuePercent(s),l=this.getValuePercent(c),f=["scrubber",d?"vertical":"horizontal"];this.state.hover&&f.push("hover"),this.state.seeking&&f.push("seeking"),i&&f.push(i);var m=["className","value","min","max","bufferPosition","vertical","onScrubStart","onScrubEnd","onScrubChange","onMouseMove","onMouseOver","onMouseLeave","tooltip","markers"],v=qd(this.props,function(b){return!m.includes(b)});return ge.default.createElement("div",jo({onMouseDown:this.handleSeekStart,onTouchStart:this.handleTouchStart,onTouchEnd:function(b){return b.preventDefault()},onMouseOver:this.handleMouseOver,onMouseLeave:this.handleMouseLeave},v,{className:f.join(" ")}),ge.default.createElement("div",{className:"bar",ref:this.barRef},ge.default.createElement("div",{className:"bar__buffer",style:(t={},t[d?"height":"width"]="".concat(l,"%"),t)}),this.renderMarkers(),ge.default.createElement("div",{className:"bar__progress",style:(o={},o[d?"height":"width"]="".concat(p,"%"),o)}),ge.default.createElement("div",{className:"bar__thumb",style:(n={},n[d?"bottom":"left"]="".concat(p,"%"),n)}),this.renderTooltip()))},e}(ge.Component);ds=Ko.Scrubber=Wd;const Xd=[{label:"Single",value:me.single},{label:"Random",value:me.random},{label:"Loop",value:me.loop},{label:"SingleLoop",value:me.singleloop}],fn=r=>{const{t:e}=di(),t=ke(r.entity,ce),o=()=>{t.paused.set(!t.paused.value)},[n,a]=Y.useState([]);O.useEffect(()=>{const p=t.paths.value;if(p.length===0)return;if(p.length===1){const m=p[0].split("/");a([{label:m[m.length-1],value:0}]),console.log("Setting labels: ",[{label:m[m.length-1],value:0}]);return}let l=p[0];for(let m=1;m<p.length;m++)for(;p[m].indexOf(l)!==0;)l=l.substring(0,l.length-1);const f=[];for(let m=0;m<p.length;m++)f.push({label:p[m].slice(l.length),value:m});a(f),console.log("Setting labels: ",f)},[t.paths]);const i=Ot(r.entity,oe),[s,u]=Y.useState([]);O.useEffect(()=>{if(i){const p=[];p.push({label:"auto",value:-1}),i.geometryInfo.targets.value.forEach((l,f)=>{p.push({label:l,value:f})}),u(p)}},[i==null?void 0:i.geometryInfo.targets]);const[c,d]=Y.useState({});return O.useEffect(()=>{if(!i)return;const p=i.textureInfo.textureTypes.value,l={};p.forEach(f=>{l[f]=[],l[f].push({label:"auto",value:-1}),i.textureInfo[f].targets.value.forEach((m,v)=>{l[f].push({label:m,value:v})})}),d(l)},[i==null?void 0:i.textureInfo.textureTypes,i==null?void 0:i.textureInfo.baseColor.targets,i==null?void 0:i.textureInfo.normal.targets,i==null?void 0:i.textureInfo.emissive.targets,i==null?void 0:i.textureInfo.metallicRoughness.targets,i==null?void 0:i.textureInfo.occlusion.targets]),Y.createElement(ks,{...r,name:e("editor:properties.volumetric.name"),description:e("editor:properties.volumetric.description"),Icon:fn.iconComponent},Y.createElement(qe,{name:"useLoadingEffect",label:e("editor:properties.volumetric.lbl-useLoadingEffect")},Y.createElement(hn,{onChange:Kt(ce,"useLoadingEffect"),checked:t.useLoadingEffect.value})),Y.createElement(qe,{name:"Autoplay",label:e("editor:properties.media.lbl-autoplay"),info:e("editor:properties.media.info-autoplay")},Y.createElement(hn,{onChange:Kt(ce,"autoplay"),checked:t.autoplay.value})),Y.createElement("div",{className:"w-auto"},Y.createElement(bn,{min:0,max:1,step:.01,value:t.volume.value,onChange:yn(ce,"volume"),onRelease:Kt(ce,"volume"),"aria-label":"Volume",label:e("editor:properties.media.lbl-volume")})),Y.createElement(Bs,{name:"Source Paths",values:t.paths.value,onChange:yn(ce,"paths")}),(we(r.entity,oe)||we(r.entity,xt))&&Y.createElement(Hd,{entity:r.entity}),Y.createElement("div",{className:"w-auto"},Y.createElement(bn,{value:t.currentTrackInfo.playbackRate.value,min:.5,max:4,step:.1,onChange:p=>{t.currentTrackInfo.playbackRate.set(p)},onRelease:()=>{},"aria-label":"Playback Rate",label:"Playback Rate"})),Y.createElement(qe,{name:"Play Mode",label:e("editor:properties.media.playmode")},Y.createElement(Yt,{key:r.entity,options:Xd,value:t.playMode.value,onChange:Kt(ce,"playMode")}),t.paths&&t.paths.length>0&&t.paths[0]&&Y.createElement("button",{style:{marginLeft:"5px",width:"60px"},type:"submit",onClick:o},t.paused.value?e("editor:properties.media.playtitle"):e("editor:properties.media.pausetitle"))),we(r.entity,oe)&&Y.createElement(Y.Fragment,null,Y.createElement(qe,{name:"Geometry Target",label:"Geometry Target"},Y.createElement(Yt,{key:r.entity,options:s,value:i==null?void 0:i.geometryInfo.userTarget.value,onChange:p=>{i&&i.geometryInfo.userTarget.set(p)}})),Object.keys(c).map((p,l)=>Y.createElement(qe,{name:`${p} target`,label:`${p} target`,key:l},Y.createElement(Yt,{key:r.entity,options:c[p],value:i==null?void 0:i.textureInfo[p].userTarget.value,onChange:f=>{i&&(i==null||i.textureInfo[p].userTarget.set(f))}})))),Y.createElement(qe,{name:"Current Track",label:"Current Track"},Y.createElement(Yt,{key:r.entity,options:n,value:n.length?t.track.value:"",onChange:p=>{t.track.set(p)}})))};function Hd(r){const{t:e}=di(),t=ke(r.entity,ce),o=Ot(r.entity,oe),[n,a]=Y.useState(!1);return Y.createElement(qe,{name:"CurrentTime",label:e("editor:properties.media.lbl-currentTime")},Y.createElement(ds,{min:0,max:t.currentTrackInfo.duration.value,value:t.currentTrackInfo.currentTime.value,onScrubStart:()=>{a(!0)},onScrubEnd:i=>{if(!n)return;const s=oi(r.entity,oe);if(s&&t.currentTrackInfo.currentTime.value<i&&i<s.bufferedUntil.value){const u=ee(wt);oe.setStartAndPlaybackTime(r.entity,i,u.elapsedSeconds)}a(!1)},onScrubChange:()=>{},tooltip:{enabledOnHover:!0},...we(r.entity,oe)?{bufferPosition:o==null?void 0:o.bufferedUntil.value}:{}}))}fn.iconComponent=$s;const Kd={},Yp={title:"Editor/Properties/Volumetric",component:fn,parameters:{componentSubtitle:"VolumetricNodeEditor",jest:"",design:{type:"figma",url:""}},argTypes:Kd},nr={args:{}};var Za,ei,ti;nr.parameters={...nr.parameters,docs:{...(Za=nr.parameters)==null?void 0:Za.docs,source:{originalSource:`{
  args: {}
}`,...(ti=(ei=nr.parameters)==null?void 0:ei.docs)==null?void 0:ti.source}}};const zp=["Default"];export{nr as Default,zp as __namedExportsOrder,Yp as default};
