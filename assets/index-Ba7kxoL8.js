import{s as F,w as Y,i as j,a as k,b as H,r as L,c as _,d as q,u as P,S as V}from"./useDrop-GcAn0hgk.js";import{u as B,N as S}from"./WebRTCTransportFunctions-mB_FREj1.js";import{r as g,R as a}from"./index-DPzuYzxM.js";import{D as W,H as X}from"./DndProvider-1KW6pMBo.js";import{b as $,c as z}from"./index-CkoKGIuM.js";import{j as J}from"./index-CO8llcWC.js";import{B as K}from"./index-Dls6AtJn.js";import{I as Q}from"./index-CvvRAf94.js";import{v as G}from"./v4-BOvFkHkt.js";import{t as C}from"./tw-merge-Ds6tgvmq.js";import{i as O}from"./index-TG03Y8s6.js";function Z(i){return g.useMemo(()=>i.hooks.dragSource(),[i])}function ee(i){return g.useMemo(()=>i.hooks.dragPreview(),[i])}let N=!1,x=!1;class te{receiveHandlerId(e){this.sourceId=e}getHandlerId(){return this.sourceId}canDrag(){O(!N,"You may not call monitor.canDrag() inside your canDrag() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return N=!0,this.internalMonitor.canDragSource(this.sourceId)}finally{N=!1}}isDragging(){if(!this.sourceId)return!1;O(!x,"You may not call monitor.isDragging() inside your isDragging() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return x=!0,this.internalMonitor.isDraggingSource(this.sourceId)}finally{x=!1}}subscribeToStateChange(e,t){return this.internalMonitor.subscribeToStateChange(e,t)}isDraggingSource(e){return this.internalMonitor.isDraggingSource(e)}isOverTarget(e,t){return this.internalMonitor.isOverTarget(e,t)}getTargetIds(){return this.internalMonitor.getTargetIds()}isSourcePublic(){return this.internalMonitor.isSourcePublic()}getSourceId(){return this.internalMonitor.getSourceId()}subscribeToOffsetChange(e){return this.internalMonitor.subscribeToOffsetChange(e)}canDragSource(e){return this.internalMonitor.canDragSource(e)}canDropOnTarget(e){return this.internalMonitor.canDropOnTarget(e)}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(e){this.sourceId=null,this.internalMonitor=e.getMonitor()}}class re{receiveHandlerId(e){this.handlerId!==e&&(this.handlerId=e,this.reconnect())}get connectTarget(){return this.dragSource}get dragSourceOptions(){return this.dragSourceOptionsInternal}set dragSourceOptions(e){this.dragSourceOptionsInternal=e}get dragPreviewOptions(){return this.dragPreviewOptionsInternal}set dragPreviewOptions(e){this.dragPreviewOptionsInternal=e}reconnect(){const e=this.reconnectDragSource();this.reconnectDragPreview(e)}reconnectDragSource(){const e=this.dragSource,t=this.didHandlerIdChange()||this.didConnectedDragSourceChange()||this.didDragSourceOptionsChange();return t&&this.disconnectDragSource(),this.handlerId?e?(t&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragSource=e,this.lastConnectedDragSourceOptions=this.dragSourceOptions,this.dragSourceUnsubscribe=this.backend.connectDragSource(this.handlerId,e,this.dragSourceOptions)),t):(this.lastConnectedDragSource=e,t):t}reconnectDragPreview(e=!1){const t=this.dragPreview,r=e||this.didHandlerIdChange()||this.didConnectedDragPreviewChange()||this.didDragPreviewOptionsChange();if(r&&this.disconnectDragPreview(),!!this.handlerId){if(!t){this.lastConnectedDragPreview=t;return}r&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragPreview=t,this.lastConnectedDragPreviewOptions=this.dragPreviewOptions,this.dragPreviewUnsubscribe=this.backend.connectDragPreview(this.handlerId,t,this.dragPreviewOptions))}}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didConnectedDragSourceChange(){return this.lastConnectedDragSource!==this.dragSource}didConnectedDragPreviewChange(){return this.lastConnectedDragPreview!==this.dragPreview}didDragSourceOptionsChange(){return!F(this.lastConnectedDragSourceOptions,this.dragSourceOptions)}didDragPreviewOptionsChange(){return!F(this.lastConnectedDragPreviewOptions,this.dragPreviewOptions)}disconnectDragSource(){this.dragSourceUnsubscribe&&(this.dragSourceUnsubscribe(),this.dragSourceUnsubscribe=void 0)}disconnectDragPreview(){this.dragPreviewUnsubscribe&&(this.dragPreviewUnsubscribe(),this.dragPreviewUnsubscribe=void 0,this.dragPreviewNode=null,this.dragPreviewRef=null)}get dragSource(){return this.dragSourceNode||this.dragSourceRef&&this.dragSourceRef.current}get dragPreview(){return this.dragPreviewNode||this.dragPreviewRef&&this.dragPreviewRef.current}clearDragSource(){this.dragSourceNode=null,this.dragSourceRef=null}clearDragPreview(){this.dragPreviewNode=null,this.dragPreviewRef=null}constructor(e){this.hooks=Y({dragSource:(t,r)=>{this.clearDragSource(),this.dragSourceOptions=r||null,j(t)?this.dragSourceRef=t:this.dragSourceNode=t,this.reconnectDragSource()},dragPreview:(t,r)=>{this.clearDragPreview(),this.dragPreviewOptions=r||null,j(t)?this.dragPreviewRef=t:this.dragPreviewNode=t,this.reconnectDragPreview()}}),this.handlerId=null,this.dragSourceRef=null,this.dragSourceOptionsInternal=null,this.dragPreviewRef=null,this.dragPreviewOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDragSource=null,this.lastConnectedDragSourceOptions=null,this.lastConnectedDragPreview=null,this.lastConnectedDragPreviewOptions=null,this.backend=e}}function ne(i,e){const t=k(),r=g.useMemo(()=>new re(t.getBackend()),[t]);return H(()=>(r.dragSourceOptions=i||null,r.reconnect(),()=>r.disconnectDragSource()),[r,i]),H(()=>(r.dragPreviewOptions=e||null,r.reconnect(),()=>r.disconnectDragPreview()),[r,e]),r}function ie(){const i=k();return g.useMemo(()=>new te(i),[i])}class se{beginDrag(){const e=this.spec,t=this.monitor;let r=null;return typeof e.item=="object"?r=e.item:typeof e.item=="function"?r=e.item(t):r={},r??null}canDrag(){const e=this.spec,t=this.monitor;return typeof e.canDrag=="boolean"?e.canDrag:typeof e.canDrag=="function"?e.canDrag(t):!0}isDragging(e,t){const r=this.spec,o=this.monitor,{isDragging:u}=r;return u?u(o):t===e.getSourceId()}endDrag(){const e=this.spec,t=this.monitor,r=this.connector,{end:o}=e;o&&o(t.getItem(),t),r.reconnect()}constructor(e,t,r){this.spec=e,this.monitor=t,this.connector=r}}function oe(i,e,t){const r=g.useMemo(()=>new se(i,e,t),[e,t]);return g.useEffect(()=>{r.spec=i},[i]),r}function ae(i){return g.useMemo(()=>{const e=i.type;return O(e!=null,"spec.type must be defined"),e},[i])}function ce(i,e,t){const r=k(),o=oe(i,e,t),u=ae(i);H(function(){if(u!=null){const[l,m]=L(u,o,r);return e.receiveHandlerId(l),t.receiveHandlerId(l),m}},[r,e,t,o,u])}function ue(i,e){const t=_(i,e);O(!t.begin,"useDrag::spec.begin was deprecated in v14. Replace spec.begin() with spec.item(). (see more here - https://react-dnd.github.io/react-dnd/docs/api/use-drag)");const r=ie(),o=ne(t.options,t.previewOptions);return ce(t,r,o),[q(t.collect,r,o),Z(o),ee(o)]}const T={inputElement:"inputElement"},le=({value:i,index:e,onChange:t,onSelect:r,dropTypes:o,SelectIcon:u,selected:w,inputElement:l,moveInputElement:m,findInputElement:D,renderFunction:v})=>{const c=()=>{if(D)return D(i).index},[{opacity:A},p,y]=ue({type:T.inputElement,item:{uuid:l==null?void 0:l.uuid,index:c},collect:n=>({opacity:n.isDragging()?0:1})}),[{isDroppable:M},b]=P(()=>({accept:T.inputElement,hover({uuid:n}){if(n!==l.uuid){const{index:s}=D(l.uuid);m(n,s)}},collect:n=>({isDroppable:n.canDrop()&&n.isOver()})})),[{isDroppable:E},R]=P(()=>({accept:o??[...V],drop:n=>{t(n.url,e)},collect:n=>({isDroppable:n.canDrop()&&n.isOver()})}));return a.createElement("div",{className:C(" flex w-full gap-2",M&&"outline outline-2 outline-white"),ref:n=>{b(y(n))}},a.createElement("div",{ref:R,className:C("flex w-full justify-end gap-1",E&&"outline outline-2 outline-white")},a.createElement("div",{ref:p,className:" flex h-full w-6 cursor-move items-center text-2xl text-text-inactive"},a.createElement(J,null)),v?v(i):a.createElement(Q,{fullWidth:!0,value:i,onChange:n=>t(n.target.value,e)}),u&&a.createElement(K,{className:C("h-8 w-9 rounded-md p-1",w?"bg-ui-primary text-text-primary-button":"bg-surface-2 text-text-inactive"),onClick:()=>{r&&r(e)}},a.createElement(u,{className:"h-6 w-6"}))))};function Ie({name:i,containerClassName:e,values:t,renderFunction:r,onChange:o,dropTypes:u,SelectIcon:w,onSelect:l,selectedIndex:m}){const D=()=>{const n=[];return t.forEach(function(s){n.push({uuid:G(),value:s})}),n},v=B(m);v.set(m);const c=B(D()),A=n=>{const s=[];return n.forEach(function(d){s.push(d.value)}),s},p=g.useCallback((n,s,d)=>{const f=c.get(S);let h=[];d==="add"?h=[...f,{uuid:G(),value:n}]:d==="remove"?h=f.filter((U,I)=>I!==s):h=f.map((U,I)=>I===s?{uuid:f[I].uuid,value:n}:U),c.set(h)},[o]),[{isGroupDroppable:y},M]=P(()=>({accept:u??[...V],drop:(n,s)=>{s.didDrop()||p(n.url,0,"add")},collect:n=>({isGroupDroppable:n.canDrop()&&n.isOver({shallow:!0})})}),[p]),b=n=>{for(let s=0;s<c.length;s++){const d=c.get(S)[s];if(d.uuid===n)return{inputElement:d,index:s}}return{inputElement:void 0,index:-1}},E=(n,s)=>{const{inputElement:d,index:f}=b(n);if(d&&f!==-1){const h=c.get(S);h.splice(f,1),h.splice(s,0,d),c.set(h)}},[,R]=P(()=>({accept:T.inputElement}));return g.useEffect(()=>{o(A(c.get(S)))},[c]),a.createElement("div",{ref:M,"aria-label":i,className:C("w-full ",e)},a.createElement("div",{className:`outline outline-2 transition-colors duration-200 ${y?"outline-white":"outline-transparent"}`},c.length>0&&a.createElement(W,{backend:X,key:"InputElementDropArea"},a.createElement("div",{ref:R,className:"grid w-full grid-cols-1 space-y-1 py-1.5 "},c.get(S).map((n,s)=>a.createElement(le,{key:n.value+s,value:n.value,index:s,onChange:p,dropTypes:u,SelectIcon:w,onSelect:l,selected:v.value===s,inputElement:n,moveInputElement:E,findInputElement:b,renderFunction:r})))),a.createElement("div",{className:"my-1 flex w-full justify-end gap-1"},c.length>0&&a.createElement("button",{className:" h-8 w-9 cursor-pointer rounded-md bg-surface-2 text-text-primary-button",onClick:()=>p("",c.length-1,"remove")},a.createElement($,{className:"m-auto"})),a.createElement("button",{className:" h-8 w-8 cursor-pointer rounded-md bg-surface-2 text-text-primary-button",onClick:()=>p("",0,"add")},a.createElement(z,{className:"m-auto"})))))}export{Ie as A};
