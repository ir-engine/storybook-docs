import{V as h,b as L,C as x,s as v,S as b,u as M,r as P,a as S,c as _}from"./EditorServices-BJKHmurs.js";import{r}from"./index-CBqU2yxZ.js";import{N as A,A as k,b as N,c as g,d as C}from"./three.module-D2RMN07C.js";import{S as n,c as y,e as z,f as B,i as E,h as F,b as O}from"./index-_wFD3GG2.js";import{i as I,c as R,N as u}from"./ActionFunctions-CxzuxLxN.js";const W=n.LiteralUnion([A,k],A),w=n.LiteralUnion([N,g,C],g),j=y({name:"LoopAnimationComponent",jsonID:"EE_loop_animation",schema:n.Object({activeClipIndex:n.Number(-1),animationPack:n.String(""),enabled:n.Bool(!0),paused:n.Bool(!1),time:n.Number(0),timeScale:n.Number(1),blendMode:W,loop:w,repetitions:n.Number(1/0),clampWhenFinished:n.Bool(!1),zeroSlopeAtStart:n.Bool(!0),zeroSlopeAtEnd:n.Bool(!0),weight:n.Number(1),_action:n.Nullable(n.Type())}),reactor:function(){if(!I)return null;const o=z(),e=B(o,j),a=E(o,S),s=E(o,_),t=e._action.value,m=R("");r.useEffect(()=>{var d;if(!((d=s==null?void 0:s.animations)!=null&&d.value))return;const i=s.animations.value[e.activeClipIndex.value],l=(a==null?void 0:a.asset.get(u))??null;if(!a||!(l!=null&&l.scene)||!i){e._action.set(null);return}s.mixer.time.set(0);const c=a.asset.get(u);try{const f=s.mixer.value.clipAction(c instanceof h?L(i,c):i);return e._action.set(f),()=>{f.stop()}}catch(f){console.warn("Failed to bind animation in LoopAnimationComponent",o,f)}},[e.activeClipIndex,a==null?void 0:a.asset,s==null?void 0:s.animations]),r.useEffect(()=>{t!=null&&t.isRunning()?t.paused=e.paused.value:!(t!=null&&t.isRunning())&&!e.paused.value&&(t==null||t.getMixer().stopAllAction(),t==null||t.reset(),t==null||t.play())},[e._action,e.paused]),r.useEffect(()=>{t&&(t.enabled=e.enabled.value)},[e._action,e.enabled]),r.useEffect(()=>{t&&(t.time=e.time.value,t.setLoop(e.loop.value,e.repetitions.value),t.clampWhenFinished=e.clampWhenFinished.value,t.zeroSlopeAtStart=e.zeroSlopeAtStart.value,t.zeroSlopeAtEnd=e.zeroSlopeAtEnd.value,t.blendMode=e.blendMode.value)},[e._action,e.blendMode,e.loop,e.clampWhenFinished,e.zeroSlopeAtStart,e.zeroSlopeAtEnd]),r.useEffect(()=>{t&&(t.setEffectiveWeight(e.weight.value),t.setEffectiveTimeScale(e.timeScale.value))},[e._action,e.weight,e.timeScale]),r.useEffect(()=>{if(F(o,x))return;const i=()=>{e.paused.set(!1)},l=()=>{e.paused.set(!0)};v(o,b.PLAY,i),v(o,b.PAUSE,l)},[]),r.useEffect(()=>{const i=(a==null?void 0:a.asset.get(u))??null;i!=null&&i.scene&&O(o,S)},[a==null?void 0:a.asset]);const[p]=M(e.animationPack.value,o);return r.useEffect(()=>{const i=(a==null?void 0:a.asset.get(u))??null;if(!p||!s||!(i!=null&&i.scene)||!e.animationPack.value||m.value===e.animationPack.value)return;s.mixer.time.set(0),s.mixer.value.stopAllAction();const l=p.animations;for(let c=0;c<l.length;c++)P(l[c],p.scene);m.set(e.animationPack.get(u)),s.animations.set(l)},[p,s,a==null?void 0:a.asset]),null}});export{j as L};
