import{r as s}from"./index-CBqU2yxZ.js";import{g as h,h as w,i as v,j as T}from"./three.module-D2RMN07C.js";import{k as b,c as j,S as t,e as R,f as k,h as M,s as o,r as O,l as x}from"./index-_wFD3GG2.js";import{a as A,c as D,b as i,g as I}from"./ActionFunctions-CxzuxLxN.js";import{R as N,s as V,h as l,j as B,k as p,l as G,T as L,m as U,n as H,o as Q,p as _,N as q,q as F,t as z,O as J}from"./EditorServices-BJKHmurs.js";import{a as K}from"./MathLerpFunctions-CYXVD2J2.js";import{A as m}from"./ArrowHelperComponent-C9MpZgBb.js";const u="Simple",f="Spherical",y=new Set;y.add(u);y.add(f);const d=new Map;d.set("None",null);const c=A({name:"PortalState",initial:{lastPortalTimeout:0,portalTimeoutDuration:5e3,activePortalEntity:b,portalReady:!1}}),W=j({name:"PortalComponent",jsonID:"EE_portal",schema:t.Object({linkedPortalId:t.EntityUUID(),location:t.String(""),effectType:t.String("None"),previewType:t.String(u),previewImageURL:t.String(""),redirect:t.Bool(!1),spawnPosition:t.Vec3(),spawnRotation:t.Quaternion(),remoteSpawnPosition:t.Vec3(),remoteSpawnRotation:t.Quaternion(),mesh:t.Nullable(t.Type())}),reactor:function(){const e=R(),a=D(i(N).nodeHelperVisibility),n=k(e,W);return s.useEffect(()=>{V(e,"teleport",(r,g)=>{if(g!==z.getSelfAvatarEntity())return;const S=Date.now(),{lastPortalTimeout:P,portalTimeoutDuration:C,activePortalEntity:E}=I(c);E||P+C>S||i(c).activePortalEntity.set(e)}),!M(e,l)&&(o(e,l,{type:"fixed"}),o(e,G,{shape:B.Sphere,collisionLayer:p.Trigger,collisionMask:p.Avatars}),o(e,L,{triggers:[{onEnter:"teleport",onExit:null,target:""}]}))},[]),s.useEffect(()=>(a.value&&o(e,m,{name:"portal-helper",length:1,dir:K,color:0}),()=>{O(e,m)}),[a]),s.useEffect(()=>{if(n.previewType.value!==f)return;const r=new h(new w(1,32,32),new v({side:T}));return U(r,J.Camera),n.mesh.set(r),H(e,r),()=>{Q(e,r)}},[n.previewType]),null},setPlayerInPortalEffect:e=>{const a=x();o(a,_),o(a,q,"portal-"+e),o(a,F),o(a,d.get(e))}});export{d as P,y as a,W as b,c};
