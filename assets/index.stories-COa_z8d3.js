import{r as _,R as N}from"./index-DPzuYzxM.js";import{d as st,S as j,u as it,a as me,c as rt,s as x,b as St,C as Ct,f as ct,g as C,E as B,i as K,A as De,h as Z,r as A,D as gt,p as xt,U as V,z as ve,w as lt,n as b,B as Pe,F as Le,y as mt,q as ht,k as wt,P as Mt,e as vt}from"./UUIDComponent-GqVY2Xw8.js";import{_ as Oe,b as It,$ as Tt,G as F,T as p,M as Fe,h as Nt,N as Dt,a as Pt,a0 as Lt,a1 as ie,a2 as Ot,U as Ft,O as kt,a3 as _t,a4 as ke,I as _e,a5 as Rt,a6 as Bt,a7 as Ut,a8 as zt,a9 as Wt,aa as jt,ab as J,A as Re}from"./resourceLoaderHooks-CRL4d032.js";import{u as k,g as w,d as ue,a as M,N as re,e as Be,n as Xt}from"./WebRTCTransportFunctions-mB_FREj1.js";import{b as Kt}from"./index-YWE9xQ_z.js";import{b as de,P as Ie,E as ce,c as Yt,u as Gt}from"./Util-D6kE0IP9.js";import{b as Ht,d as Q,a as s,B as Vt,Q as z,e as ut,q as Qt,E as qt,j as Ee}from"./three.module-BizNiMhn.js";import{S as D,a as $t}from"./index-Dp9Z83cc.js";import{N as Jt}from"./AuthService-CgpOViw1.js";import{F as Zt,A as Ue}from"./AssetType-CNZ47EUo.js";import{E as we}from"./EditorServices-5l66pnva.js";import{T as At}from"./useFeatureFlags-Dn9l-n2t.js";import"./index-Dls6AtJn.js";import{C as bt}from"./index-PchlGXp2.js";import"./index-B8Egbi3s.js";import"./index-C53TPVpl.js";import"./index-CvvRAf94.js";import"./ZoomOutSm-BKYTao-C.js";import"./index-BmZLy_Eh.js";import"./index-DNUDjAZy.js";import{E as en}from"./index-CEtgDdfg.js";import{I as te}from"./index-dk6FhMkf.js";import{N as tn}from"./index-DYUpM6SD.js";import{a as ze}from"./index-CwbrXKcR.js";import{u as nn}from"./useTranslation-CW9c4UDM.js";import"./_commonjsHelpers-C4iS2aBk.js";import"./v4-BOvFkHkt.js";import"./lodash-AQPfkADg.js";import"./___vite-browser-external_commonjs-proxy-BqV5D26a.js";import"./index-DYLXRpC5.js";import"./iconBase-qHBVS_PM.js";import"./ShadowComponent-DnhO6zHH.js";import"./utils-C_TihLnJ.js";import"./index-C0GIA9vz.js";import"./tw-merge-Ds6tgvmq.js";import"./FeathersHooks-Bcw5IzUg.js";import"./index-CO8llcWC.js";import"./index-D9X8Um7J.js";import"./index-Bs5DOUC-.js";function We(e,t,n){const o=[],a=new s;t.getSize(a);const r=t.min.z,l=t.max.z;for(let c=0;c<=n;c++){const S=c/n,f=t.min.x+S*a.x,y=t.min.y+S*a.y;o.push(new s(f,t.min.y,r),new s(f,t.max.y,r)),o.push(new s(f,t.min.y,l),new s(f,t.max.y,l)),o.push(new s(t.min.x,y,r),new s(t.max.x,y,r)),o.push(new s(t.min.x,y,l),new s(t.max.x,y,l))}const i=t.max.y,m=t.min.y;for(let c=0;c<=n;c++){const S=c/n,f=t.min.x+S*a.x,y=t.min.z+S*a.z;o.push(new s(f,i,t.min.z),new s(f,i,t.max.z)),o.push(new s(f,m,t.min.z),new s(f,m,t.max.z)),o.push(new s(t.min.x,i,y),new s(t.max.x,i,y)),o.push(new s(t.min.x,m,y),new s(t.max.x,m,y))}const u=t.min.x,d=t.max.x;for(let c=0;c<=n;c++){const S=c/n,f=t.min.y+S*a.y,y=t.min.z+S*a.z;o.push(new s(u,f,t.min.z),new s(u,f,t.max.z)),o.push(new s(d,f,t.min.z),new s(d,f,t.max.z)),o.push(new s(u,t.min.y,y),new s(u,t.max.y,y)),o.push(new s(d,t.min.y,y),new s(d,t.max.y,y))}for(let c=0;c<o.length;c++)o[c].applyMatrix4(e);return new Vt().setFromPoints(o)}const W=st({name:"BoundingBoxHelperComponent",schema:j.Object({bbox:j.Type({required:!0}),density:j.Number({default:2}),color:It.Color(16711680),layerMask:j.Type({default:Tt.NodeHelper}),helperEntity:j.Entity()}),reactor:function(){const e=it(),t=me(e,W),n=k(()=>{const a=rt(),r=t.bbox.value,l=t.density.value;return x(a,Oe,{name:"bbox-line-segment-"+e,geometry:We(new Q().identity(),r,l),material:new Ht({color:t.color.value}),layerMask:t.layerMask.value}),t.helperEntity.set(a),a}).value,o=me(n,Oe);return _.useEffect(()=>()=>{St(n)},[]),Ct(()=>{const a=t.bbox.value,r=t.density.value;o.geometry.set(We(new Q().identity(),a,r))},[t.bbox]),_.useEffect(()=>{o.color.set(t.color.value)},[t.color,o]),_.useEffect(()=>{o.layerMask.set(t.layerMask.value)},[t.layerMask,o]),null}}),on=new s(.5,.5,.5);new s;new s;const O=st({name:"ObjectGridSnapComponent",schema:j.Object({bbox:j.Class(()=>new ut)}),reactor:()=>{const e=it(),t=k(w(ct)),n=F.useSceneLoaded(e),o=me(e,O);return _.useEffect(()=>{if(!n)return;const a=new s,r=new z,l=new s,i=C(e,B).parentEntity,m=C(e,p);m.matrix.decompose(a,r,l),x(e,B,{parentEntity:K}),m.matrixWorld.identity(),p.updateFromWorldMatrix(e);const u=[];De(e,c=>{Z(c,p)&&(p.computeTransformMatrix(c),Z(c,Fe)&&u.push(C(c,Fe)))});const d=o.bbox.value.makeEmpty();if(u.length>0)for(let c=0;c<u.length;c++)d.expandByObject(u[c]);else d.set(Nt,on);x(e,B,{parentEntity:i}),x(e,p,{position:a,rotation:r,scale:l}),De(e,p.computeTransformMatrix,c=>Z(c,p)),o.bbox.set(d)},[n]),_.useEffect(()=>{if(!t.isEditing.value)return;const a=o.bbox.value;return x(e,W,{bbox:a}),()=>{A(e,W)}},[o.bbox,t.isEditing]),null}}),dt=new Array(32).fill(void 0);dt.push(void 0,null,!0,!1);dt.length;const an=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});an.decode();var je,Xe,Ke,Ye,Ge,He,Ve,Qe,qe,$e,Je,Ze;(function(e){e[e.Dynamic=0]="Dynamic",e[e.Fixed=1]="Fixed",e[e.KinematicPositionBased=2]="KinematicPositionBased",e[e.KinematicVelocityBased=3]="KinematicVelocityBased"})(je||(je={}));(function(e){e[e.Revolute=0]="Revolute",e[e.Fixed=1]="Fixed",e[e.Prismatic=2]="Prismatic",e[e.Spherical=3]="Spherical"})(Xe||(Xe={})),function(e){e[e.AccelerationBased=0]="AccelerationBased",e[e.ForceBased=1]="ForceBased"}(Ke||(Ke={}));(function(e){e[e.Average=0]="Average",e[e.Min=1]="Min",e[e.Multiply=2]="Multiply",e[e.Max=3]="Max"})(Ye||(Ye={}));(function(e){e[e.Vertex=0]="Vertex",e[e.Edge=1]="Edge",e[e.Face=2]="Face",e[e.Unknown=3]="Unknown"})(Ge||(Ge={}));class sn{constructor(t,n){this.origin=t,this.dir=n}pointAt(t){return{x:this.origin.x+this.dir.x*t,y:this.origin.y+this.dir.y*t,z:this.origin.z+this.dir.z*t}}}(function(e){e[e.Ball=0]="Ball",e[e.Cuboid=1]="Cuboid",e[e.Capsule=2]="Capsule",e[e.Segment=3]="Segment",e[e.Polyline=4]="Polyline",e[e.Triangle=5]="Triangle",e[e.TriMesh=6]="TriMesh",e[e.HeightField=7]="HeightField",e[e.ConvexPolyhedron=9]="ConvexPolyhedron",e[e.Cylinder=10]="Cylinder",e[e.Cone=11]="Cone",e[e.RoundCuboid=12]="RoundCuboid",e[e.RoundTriangle=13]="RoundTriangle",e[e.RoundCylinder=14]="RoundCylinder",e[e.RoundCone=15]="RoundCone",e[e.RoundConvexPolyhedron=16]="RoundConvexPolyhedron",e[e.HalfSpace=17]="HalfSpace"})(He||(He={}));(function(e){e[e.DYNAMIC_DYNAMIC=1]="DYNAMIC_DYNAMIC",e[e.DYNAMIC_KINEMATIC=12]="DYNAMIC_KINEMATIC",e[e.DYNAMIC_FIXED=2]="DYNAMIC_FIXED",e[e.KINEMATIC_KINEMATIC=52224]="KINEMATIC_KINEMATIC",e[e.KINEMATIC_FIXED=8704]="KINEMATIC_FIXED",e[e.FIXED_FIXED=32]="FIXED_FIXED",e[e.DEFAULT=15]="DEFAULT",e[e.ALL=60943]="ALL"})(Ve||(Ve={}));(function(e){e[e.Density=0]="Density",e[e.Mass=1]="Mass",e[e.MassProps=2]="MassProps"})(Qe||(Qe={}));(function(e){e[e.EXCLUDE_FIXED=1]="EXCLUDE_FIXED",e[e.EXCLUDE_KINEMATIC=2]="EXCLUDE_KINEMATIC",e[e.EXCLUDE_DYNAMIC=4]="EXCLUDE_DYNAMIC",e[e.EXCLUDE_SENSORS=8]="EXCLUDE_SENSORS",e[e.EXCLUDE_SOLIDS=16]="EXCLUDE_SOLIDS",e[e.ONLY_DYNAMIC=3]="ONLY_DYNAMIC",e[e.ONLY_KINEMATIC=5]="ONLY_KINEMATIC",e[e.ONLY_FIXED=6]="ONLY_FIXED"})(qe||(qe={}));(function(e){e[e.COLLISION_EVENTS=1]="COLLISION_EVENTS",e[e.CONTACT_FORCE_EVENTS=2]="CONTACT_FORCE_EVENTS"})($e||($e={}));(function(e){e[e.FILTER_CONTACT_PAIRS=1]="FILTER_CONTACT_PAIRS",e[e.FILTER_INTERSECTION_PAIRS=2]="FILTER_INTERSECTION_PAIRS"})(Je||(Je={})),function(e){e[e.EMPTY=0]="EMPTY",e[e.COMPUTE_IMPULSE=1]="COMPUTE_IMPULSE"}(Ze||(Ze={}));for(var lo={},rn=[],Me=[],mo=typeof Uint8Array<"u"?Uint8Array:Array,Se="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",H=0,cn=Se.length;H<cn;++H)rn[H]=Se[H],Me[Se.charCodeAt(H)]=H;Me[45]=62,Me[95]=63;const ln=(e,t=K)=>{const n=F.getSourceID(t)||"source",o=t?gt.get(t):xt.Simulation,a=rt(o);return x(a,V,{entitySourceID:n,entityID:V.generate()}),x(a,Dt,e),x(a,Pt),x(a,p),x(a,B),t!==K&&x(a,B,{parentEntity:t}),a};let pt=0;const v=ue({name:"ClickPlacementState",initial:{placementEntity:K,selectedAsset:"",yawOffset:0,pitchOffset:0,rollOffset:0,maxDistance:25,materialCache:[],metadata:{}},setSelectedAsset:e=>{const t=Zt(e);t&&(t===Ue.GLTF||t===Ue.GLB)?w(v).selectedAsset.set(e):M(de).placementMode===Ie.CLICK?v.assetError():v.resetSelectedAsset()},setSelectedAssetData:e=>{w(v).metadata.set(e)},resetSelectedAsset:()=>{w(v).selectedAsset.set("")},assetError:()=>{Jt.dispatchNotify("Selected asset is not valid for click placement",{variant:"warning"}),v.resetSelectedAsset()}}),mn=e=>{const{parentEntity:t}=e,n=k(w(v)),o=k(w(de)),a=F.useSceneLoaded(t),r=Bt.useComponentErrors(n.placementEntity.value,F);return _.useEffect(()=>{if(a)if(o.placementMode.value===Ie.CLICK){if(D.updateSelection([]),n.placementEntity.value)return;n.placementEntity.set(ft(t))}else{if(!n.placementEntity.value)return;const l=M(D).selectedEntities.filter(i=>i!==V.get(n.placementEntity.value));ce.removeObject([n.placementEntity.value]),n.placementEntity.set(K),D.updateSelection(l)}},[o.placementMode.value,a]),_.useEffect(()=>{var m;if(!n.placementEntity.value)return;const l=n.selectedAsset.get(re),i=n.placementEntity.value;((m=C(i,F))==null?void 0:m.src)!==l&&fn(i)},[n.selectedAsset.value,n.placementEntity.value]),_.useEffect(()=>{var l,i;!(r!=null&&r.value)||!n.selectedAsset.value||!n.placementEntity.value||!((l=C(n.placementEntity.value,F))!=null&&l.src)||((i=C(n.placementEntity.value,F))==null?void 0:i.src)===n.selectedAsset.value||v.assetError()},[r,n.selectedAsset.value]),N.createElement(un,{key:n.placementEntity.value,placementEntity:n.placementEntity.value})},un=e=>null,dn=ve([Lt[ie.Scene]]),pn=()=>M(we).rootEntity,fn=e=>{const t=M(v).selectedAsset;t?x(e,F,{src:t}):A(e,F)},yn=e=>{x(e,F,{src:M(v).selectedAsset})},ft=e=>{const t=ln("Placement-"+pt,e);return x(t,B,{parentEntity:e}),yn(t),t},En=()=>{const e=w(v);if(!e.selectedAsset.value)return;const t=pn();if(!t)return;const n=e.placementEntity.value;if(n){M(U).enabled?U.apply():p.updateFromWorldMatrix(n),pt+=1,e.placementEntity.set(ft(t));for(const[o,a]of e.materialCache.value)o.material=a;e.materialCache.set([])}};lt({uuid:"ee.studio.ClickPlacementSystem",insert:{after:Ot},reactor:()=>{const e=k(w(we)).rootEntity;return e.value?N.createElement(mn,{key:e.value,parentEntity:e.value}):null},execute:()=>{var $,R,ee,L,G;if(M(de).placementMode!==Ie.CLICK)return;const t=w(v),n=t.placementEntity;if(!n)return;const o=M(we).rootEntity,a=Ft.getWorld(o);if(!a)return;const r=[],l=dn();for(const h of l){const T=b(h,kt);T&&r.push(T)}const i=C(Pe.instance.cameraEntity,_t),m=new Qt;let u=null;const d=Pe.instance.viewerEntity,c=ke.getPointersForCamera(d)[0];if(!c)return;const S=_e.getButtons(d),y=_e.getAxes(d)[Rt.VerticalScroll];if(($=S.SecondaryClick)!=null&&$.pressed&&t.maxDistance.set(t.maxDistance.value-y),(R=S.KeyE)!=null&&R.up&&t.yawOffset.set(t.yawOffset.value+Math.PI/4),(ee=S.KeyQ)!=null&&ee.up&&t.yawOffset.set(t.yawOffset.value-Math.PI/4),(L=S.PrimaryClick)!=null&&L.up&&(En(),n!==t.placementEntity))return;const g=C(c,ke).position;m.setFromCamera(g,i);const E=m.ray.origin,P=m.ray.direction,I=a.castRayAndGetNormal(new sn(E,P),1e3,!1);if(I&&I.toi<t.maxDistance.value){const h=E.clone().add(P.clone().multiplyScalar(I.toi));I.collider.parent().entity;const T=new s(I.normal.x,I.normal.y,I.normal.z);u={point:h,normal:T}}const pe=m.intersectObjects(r,!1);for(let h=0;h<pe.length;h++){const T=pe[h];if(!(T.distance>t.maxDistance.value)&&!Sn(T.object.entity)){u={point:T.point,normal:((G=T.face)==null?void 0:G.normal)??new s(0,1,0)};break}}u||(u={point:E.clone().add(P.clone().multiplyScalar(t.maxDistance.value)),normal:new s(0,1,0)});const fe=u.point;let q=new z().setFromUnitVectors(new s,u.normal??new s(0,1,0));q=new z().setFromEuler(new qt(t.pitchOffset.value,t.yawOffset.value,t.rollOffset.value)).multiply(q),x(n.value,p,{position:fe,rotation:q})}});const Sn=e=>{var o;const t=M(v).placementEntity;if(!t)return!1;let n=e;for(;n;){if(n===t)return!0;n=((o=C(n,B))==null?void 0:o.parentEntity)??null}return!1};function Cn(e){var r;let t=e;const o=M(v).placementEntity,a=D.getSelectedEntities();for(;t;){if(o===t||a.includes(t))return t;t=((r=b(t,B))==null?void 0:r.parentEntity)??null}return!1}const ne=new s,oe=new s;function gn(e,t,n,o){n.decompose(new s,new z,ne),o.decompose(new s,new z,oe);const a=Math.max(Math.abs(ne.x),Math.abs(ne.y),Math.abs(ne.z)),r=Math.max(Math.abs(oe.x),Math.abs(oe.y),Math.abs(oe.z)),l=e.getCenter(new s),i=t.getCenter(new s),m=l.clone().applyMatrix4(n),u=i.clone().applyMatrix4(o),d=e.getSize(new s).length()*a/2,c=t.getSize(new s).length()*r/2;return m.distanceTo(u)-d-c}function Ce(e,t){let n=1/0,o=new s;for(const a of t){const r=e.angleTo(a);r<n&&(n=r,o=a)}return o}function Ae(e,t){const n=be(e),o=be(t),a=n[0],r=n[1],l=n[2],i=Ce(a,o);o.splice(o.indexOf(i),1);const m=o.filter(f=>Math.abs(f.dot(i))<Number.EPSILON),u=Ce(r,m);o.splice(o.indexOf(u),1);const d=o.filter(f=>Math.abs(f.dot(i))<Number.EPSILON&&Math.abs(f.dot(u))<Number.EPSILON),c=Ce(l,d),S=new Q;return S.makeBasis(c,u,i),S}function be(e){const t=new z().setFromRotationMatrix(e),n=new s(0,0,1).applyQuaternion(t),o=new s(0,1,0).applyQuaternion(t),a=new s(1,0,0).applyQuaternion(t),r=o.clone().negate(),l=a.clone().negate(),i=n.clone().negate();return[n,o,a,r,l,i]}function et(e,t,n,o){const a=tt(e,n),r=tt(t,o);return xn(a,r)}function tt(e,t){return[new s(e.min.x,e.min.y,e.min.z),new s(e.min.x,e.min.y,e.max.z),new s(e.min.x,e.max.y,e.min.z),new s(e.min.x,e.max.y,e.max.z),new s(e.max.x,e.min.y,e.min.z),new s(e.max.x,e.min.y,e.max.z),new s(e.max.x,e.max.y,e.min.z),new s(e.max.x,e.max.y,e.max.z)].reduce((o,a)=>(a.applyMatrix4(t),o.expandByPoint(a),o),new ut)}function xn(e,t){const n=new s;for(const o of["x","y","z"])if(e.max[o]<t.min[o])n[o]=t.min[o]-e.max[o];else if(e.min[o]>t.max[o])n[o]=t.max[o]-e.min[o];else{const a=[e.min[o],(e.min[o]+e.max[o])/2,e.max[o]],r=[t.min[o],(t.min[o]+t.max[o])/2,t.max[o]];let l=1/0,i=0,m=0;for(const u of a){for(const d of r){const c=Math.abs(u-d);if(c<l&&(l=c,i=u,m=d,c===0))break}if(l===0)break}n[o]=m-i}return n}function ge(e,t){const n=mt(e,W);if(n){const o=jt(t);if(!o)return;n.layerMask.set(o)}}function xe(e,t){const n=mt(e,W);n&&n.color.set(t)}function he(e){var n;const t=(n=b(e,W))==null?void 0:n.helperEntity;t&&x(t,p,{position:new s,rotation:new z().identity(),scale:new s(1,1,1)})}const U=ue({name:"ObjectGridSnapState",initial:{enabled:!1,selectedEntities:[],selectedParents:[]},apply:()=>{var o;const e=M(U),t=e.selectedEntities,n=e.selectedParents;for(let a=0;a<t.length;a++){const r=t[a],l=n[a],i=(o=b(r,W))==null?void 0:o.helperEntity;if(!i){console.warn(`ObjectGridSnapSystem:apply No Helper entity found for selected entity: ${r}`);continue}const m=C(i,p).matrixWorld,u=C(l,p).matrixWorld,d=u.clone().invert().multiply(m);u.multiply(d),p.updateFromWorldMatrix(l)}}}),hn=ve([O]),ae=ve([F,Le(Ut),Le(zt)]);lt({uuid:"ee.engine.scene.ObjectGridSnapSystem",insert:{after:Wt},reactor:()=>{const e=Be(U),t=Be(D);return _.useEffect(()=>{if(e.enabled.value){for(const n of ae())x(n,O);return()=>{for(const n of ae())A(n,O)}}},[e.enabled]),_.useEffect(()=>{const n=D.getSelectedEntities();return()=>{const o=D.getSelectedEntities();for(const a of n)o.includes(a)||Z(a,O)&&he(a)}},[t.selectedEntities]),null},execute:()=>{var l;if(!M(ct).isEditing||!M(U).enabled)return;for(const i of ae.enter())x(i,O);for(const i of ae.exit())A(i,O);const n=hn(),o=[],a=[],r=[];for(const i of n){const m=Cn(i);m?(o.push(i),a.push(m),ge(i,ie.Scene),xe(i,new Ee(1,1,1))):(r.push(i),he(i),ge(i,ie.NodeHelper),xe(i,new Ee(1,0,0)))}if(w(U).merge({selectedEntities:o,selectedParents:a}),o.length!==0)for(let i=0;i<o.length;i++){const m=o[i],u=a[i],d=C(m,O).bbox,c=C(m,p).matrixWorld,S=[],f=1;for(const L of r){const G=C(L,O).bbox,h=C(L,p).matrixWorld;gn(d,G,c,h)<=f&&(S.push(L),ge(L,ie.Scene))}const y=(l=b(m,W))==null?void 0:l.helperEntity,Y=()=>{he(m)};if(S.length===0){Y();continue}if(!y){Y();continue}let g=1/0,E=K;for(const L of S){const G=C(L,O).bbox,h=c.clone(),T=C(L,p).matrixWorld.clone(),yt=Ae(h,T),Et=new s(h.elements[12],h.elements[13],h.elements[14]);h.extractRotation(yt),h.setPosition(Et);const Ne=et(d,G,new Q().identity(),h.clone().invert().multiply(T)).length();Ne<g&&(g=Ne,E=L)}if(E===K){Y();continue}xe(E,new Ee(0,1,0));const P=C(E,O).bbox,I=C(E,p).matrixWorld,fe=C(u,p).matrixWorld.clone(),q=Ae(c,I),ye=new s,$=new s;fe.decompose(ye,new z,$);const R=C(y,p).matrixWorld;R.extractRotation(q),R.scale($),R.setPosition(ye),p.updateFromWorldMatrix(y);const ee=et(d,P,new Q().identity(),R.clone().invert().multiply(I));R.multiply(new Q().makeTranslation(ee)),p.updateFromWorldMatrix(y)}}});const le=ue({name:"ir.editor.EntityHierarchyLockState",initial:()=>({lockedEntities:{}}),updateLocked:(e,t)=>{w(le).lockedEntities[e].set(t)},isEntityLocked:e=>M(le).lockedEntities[e]??!1,clearLockedEntities:()=>{const e=M(le);e.lockedEntities={}}}),X=ue({name:"TransformUniformScaleState",initial:()=>({uniformScaleState:{}}),getEntityState:e=>{const t=V.get(e);return t?w(X).uniformScaleState.value[t]??!1:!1},addOrUpdateEntity:e=>{const t=V.get(e);if(!t)return;const n=w(X).uniformScaleState;n.value[t]||n[t].set(!0)},removeEntry:e=>{const t=V.get(e);if(!t)return;const n=w(X).uniformScaleState;n.value[t]&&n[t].set(Xt)},removeEntries:e=>{for(const t of e)X.removeEntry(t)}}),Te=e=>{const{t}=nn(),n=k(w(le).lockedEntities).value[e.entity]??!1,o=ht(e.entity,J),a=me(e.entity,p),r=k(w(de).transformSpace),l=k(a.position.get(re)),i=k(a.rotation.get(re)),m=k(a.scale.get(re));wt(()=>{if(!vt(e.entity)||!Z(e.entity,p))return;const g=C(e.entity,p),E=g.position,P=g.rotation,I=g.scale;l.value.equals(E)||l.set(E),i.value.equals(P)||i.set(P),m.value.equals(I)||m.set(I)},{after:Mt}),r.value===At.world&&a.matrixWorld.value.decompose(l.value,i.value,m.value);const u=()=>{M(U).enabled&&U.apply();const E=D.getSelectedEntities();Re.snapshotEntities(E)},d=g=>{const E=D.getSelectedEntities();for(const P of E)g===!0?x(P,J):A(P,J);Re.snapshotEntities(E)},c=g=>{const E=D.getSelectedEntities();ce.positionObject(E,[g])},S=g=>{const E=D.getSelectedEntities();ce.rotateObject(E,[g])},f=g=>{const E=D.getSelectedEntities();ce.scaleObject(E,[g],!0)},y=g=>{g?X.addOrUpdateEntity(e.entity):X.removeEntry(e.entity)},Y=()=>X.getEntityState(e.entity)??!1;return N.createElement($t,{name:t("editor:properties.transform.title"),description:t("editor:properties.transform.description"),Icon:Te.iconComponent,entity:e.entity},N.createElement("div",{className:"flex w-full gap-x-2 py-1.5 pl-8 pr-3.5"},N.createElement(bt,{checked:!!o,onChange:d,label:t("editor:properties.lbl-dynamicLoad")}),o&&N.createElement(te,{label:"Distance"},N.createElement(tn,{min:1,max:100,value:o.distance.value,onChange:Gt(J,"distance"),onRelease:Yt(J,"distance")}))),N.createElement(te,{name:"Position",label:t("editor:properties.transform.lbl-position"),className:"w-auto"},N.createElement(ze,{disabled:n,smallStep:.01,mediumStep:.1,largeStep:1,value:l.value,onChange:c,onRelease:u})),N.createElement(te,{name:"Rotation",label:t("editor:properties.transform.lbl-rotation"),className:"w-auto"},N.createElement(en,{disabled:n,quaternion:i.value,onChange:S,unit:"°",onRelease:u})),N.createElement(te,{name:"Scale",label:t("editor:properties.transform.lbl-scale"),className:"w-auto"},N.createElement(ze,{disabled:n,uniformScaling:Y(),smallStep:.01,mediumStep:.1,largeStep:1,value:m.value,onToggleUniformScale:y,onChange:f,onRelease:u})))};Te.iconComponent=Kt;const wn={},uo={title:"Editor/Properties/Transform",component:Te,parameters:{componentSubtitle:"TransformNodeEditor",jest:"transformNodeEditor.test.tsx",design:{type:"figma",url:""}},argTypes:wn},se={args:{}};var nt,ot,at;se.parameters={...se.parameters,docs:{...(nt=se.parameters)==null?void 0:nt.docs,source:{originalSource:`{
  args: {}
}`,...(at=(ot=se.parameters)==null?void 0:ot.docs)==null?void 0:at.source}}};const po=["Default"];export{se as Default,po as __namedExportsOrder,uo as default};
