import{l as W}from"./lodash-BYTxXjAY.js";import{r as U,R as u}from"./index-CBqU2yxZ.js";import{e as _}from"./index-vJCBmx79.js";import{d as K,b as n,l as Q,s as v,p as T,f as q}from"./index-_wFD3GG2.js";import{z as y,n as z,E as H,p as P,O as X,L as G,ai as Y,aj as J,y as Z,ak as $,al as h}from"./EditorServices-BJKHmurs.js";import{E as tt}from"./EditorControlFunctions-DO7c3hDV.js";import{S as N,a4 as et,p as k,a2 as L,R as ot,a5 as rt,a6 as at,q as nt}from"./three.module-D2RMN07C.js";import{g as st}from"./utils-DTErvVTk.js";import{S as g}from"./ScenePreviewCamera-C6tUz1E8.js";import{g as V}from"./ActionFunctions-CxzuxLxN.js";import{K as it}from"./WebContainer3D-CgDOwl0k.js";import{B as mt}from"./index-CGhkeU3i.js";import{I as pt}from"./index-tYKeBweK.js";import{N as ct}from"./index-BXX5lIfA.js";import{u as lt}from"./useTranslation-C8TD7CCW.js";import"./_commonjsHelpers-BosuxZz1.js";import"./iconBase-vdkxwKJc.js";import"./v4-Dz_GI0CC.js";import"./AssetType-LSGL9ANY.js";import"./NotificationService-BtHCxsFA.js";import"./index-DfU-XIjm.js";import"./index-DaaykCGs.js";import"./index-DJX7trsF.js";import"./XRState-BS8ja_cl.js";import"./MathLerpFunctions-CYXVD2J2.js";import"./client-DMi1NERe.js";import"./MediaSystem-C5w1lrFL.js";import"./MediaComponent-BbvQujMt.js";import"./iframe-BwaUBtZe.js";import"../sb-preview/runtime.js";import"./VideoComponent-TZ9Icu9Q.js";import"./PositionalAudioComponent-CGM_4wyN.js";import"./tw-merge-Ds6tgvmq.js";import"./index-B-xzzier.js";import"./useDrop-DvNNwWYR.js";import"./index--lohHrd2.js";import"./index-B6RCC45a.js";import"./assetFunctions-Bvb93VNm.js";import"./i18next-ntfi3Ha_.js";import"./nonIterableRest-Y-KoC6Zs.js";import"./setPrototypeOf-NYsvoNVB.js";import"./getPrototypeOf-BYVhAdwF.js";import"./miscUtils-D11F-TOL.js";import"./index-OAa3bMdv.js";import"./index-Dn0AHKmy.js";import"./index-CqRG3f1I.js";/* empty css                */import"./index-DVAwpzAq.js";import"./index-ChWBCYBM.js";import"./index-BqFAen_F.js";import"./index-DGVNGK2X.js";const dt=K([g]);new it;async function ut(t,o,R=.9,j="jpeg",B,e){if(!e){for(const r of dt())e=n(r,g).camera;if(!e){const r=Q();v(r,g),e=n(r,g).camera;const{position:l,rotation:I}=n(T.instance.cameraEntity,y);v(r,y,{position:l,rotation:I}),z(r,e),v(r,P,{parentEntity:V(H).rootEntity}),e.updateMatrixWorld(!0)}}const E=e.aspect;e.aspect=t/o,e.updateProjectionMatrix(),e.layers.disableAll(),e.layers.set(X.Scene);let d=null;const p=n(T.instance.viewerEntity,G),a=p.renderer;a.outputColorSpace=N;const s=new et(t,o,{minFilter:k,magFilter:k,wrapS:L,wrapT:L,colorSpace:N,format:ot,type:rt});a.setRenderTarget(s),Y(p,B,new at([e]),0,!1);const S=new Uint8Array(4*t*o);a.readRenderTargetPixels(s,0,0,t,o,S);const i=new ImageData(new Uint8ClampedArray(S),t,o),m=new Uint8ClampedArray(i.data.length);for(let r=0;r<o;r++)for(let l=0;l<t;l++){const I=o-r-1,C=(r*t+l)*4,b=(I*t+l)*4;m[b]=i.data[C],m[b+1]=i.data[C+1],m[b+2]=i.data[C+2],m[b+3]=i.data[C+3]}const D=new ImageData(m,t,o);a.setRenderTarget(null);const c=document.createElement("canvas"),F=c.getContext("2d");return c.width=t,c.height=o,F.putImageData(D,0,0),F.scale(1,-1),d=await st(c,"image/"+j,R),e.aspect=E,e.updateProjectionMatrix(),d}const f=new nt,A=t=>{const{t:o}=lt(),[R,j]=U.useState(""),B=q(T.instance.cameraEntity,y),e=()=>{const{position:p,rotation:a}=n(T.instance.cameraEntity,y),s=n(t.entity,y);s.position.copy(p),s.rotation.copy(a),J(t.entity),tt.commitTransformSave([t.entity])},E=async()=>{const p=V(Z).viewerEntity,a=n(p,G).scenes.map($).flat(),{background:s,environment:S,fog:i,children:m}=h(a);f.children=m,f.environment=S,f.fog=i,f.background=s;const D=await ut(512/2,320/2,.9,"jpeg",f,n(t.entity,g).camera),c=URL.createObjectURL(D);j(c)},d=U.useCallback(W.debounce(E,500),[]);return U.useEffect(()=>(d(),()=>{d.cancel()}),[B.position]),u.createElement(ct,{...t,name:o("editor:properties.sceneCamera.name"),description:o("editor:properties.sceneCamera.description"),icon:u.createElement(A.iconComponent,null)},u.createElement(pt,{value:R}),u.createElement("div",{className:"flex h-auto flex-col items-center"},u.createElement(mt,{onClick:()=>{e(),E()}},o("editor:properties.sceneCamera.lbl-setFromViewPort"))))};A.iconComponent=_;const ft={},de={title:"Editor/Properties/ScenePreviewCamera",component:A,parameters:{componentSubtitle:"ScenePreviewCameraNodeEditor",jest:"scenePreviewCameraNodeEditor.test.tsx",design:{type:"figma",url:""}},argTypes:ft},x={args:{}};var O,w,M;x.parameters={...x.parameters,docs:{...(O=x.parameters)==null?void 0:O.docs,source:{originalSource:`{
  args: {}
}`,...(M=(w=x.parameters)==null?void 0:w.docs)==null?void 0:M.source}}};const ue=["Default"];export{x as Default,ue as __namedExportsOrder,de as default};
