import{r as M,R as n}from"./index-DPzuYzxM.js";import{d as j,S as l,u as q,a as w,k as z,f as L,l as O,U as C,n as S,g as E,E as A,o as G}from"./UUIDComponent-GqVY2Xw8.js";import{E as W,a as H,Q as J,d as K}from"./three.module-BizNiMhn.js";import{a as N}from"./WebRTCTransportFunctions-mB_FREj1.js";import{P as Y,T as b,N as $}from"./resourceLoaderHooks-CRL4d032.js";import{S as k}from"./SplineComponent-CeDb1gsU.js";import{i as ee}from"./index-CO8llcWC.js";import{c,u as P}from"./Util-D6kE0IP9.js";import{N as te}from"./NodeEditor-SBboXx3y.js";import"./index-Dls6AtJn.js";import{C as h}from"./index-PchlGXp2.js";import"./index-B8Egbi3s.js";import"./index-C53TPVpl.js";import"./index-CvvRAf94.js";import"./ZoomOutSm-BKYTao-C.js";import"./index-BmZLy_Eh.js";import"./index-DNUDjAZy.js";import{I as d}from"./index-dk6FhMkf.js";import{N as oe}from"./index-DYUpM6SD.js";import{S as ne}from"./index-CYqQ2WW8.js";import{V as re}from"./index-CwbrXKcR.js";import{u as ae}from"./useTranslation-CW9c4UDM.js";import"./_commonjsHelpers-C4iS2aBk.js";import"./v4-BOvFkHkt.js";import"./index-DYLXRpC5.js";import"./lodash-AQPfkADg.js";import"./AssetType-CNZ47EUo.js";import"./___vite-browser-external_commonjs-proxy-BqV5D26a.js";import"./iconBase-qHBVS_PM.js";import"./ShadowComponent-DnhO6zHH.js";import"./useFeatureFlags-Dn9l-n2t.js";import"./FeathersHooks-Bcw5IzUg.js";import"./EditorServices-5l66pnva.js";import"./AuthService-CgpOViw1.js";import"./index-Dp9Z83cc.js";import"./index-C0GIA9vz.js";import"./tw-merge-Ds6tgvmq.js";import"./utils-C_TihLnJ.js";import"./index-D9X8Um7J.js";import"./index-YWE9xQ_z.js";import"./index-Bs5DOUC-.js";import"./index-DFnjDgZz.js";import"./fuse-Ch1WBRTM.js";import"./index-K3LPJkAj.js";const u=new W,R=new J,_=new H,r=j({name:"SplineTrackComponent",jsonID:"EE_spline_track",schema:l.Object({splineEntityUUID:l.EntityID(),velocity:l.Number({default:1}),enableRotation:l.Bool({default:!1}),lockToXZPlane:l.Bool({default:!0}),loop:l.Bool({default:!0}),alpha:l.Number({default:0,serialized:!1})}),reactor:function(y){const o=q(),e=w(o,r);return z(()=>{const{isEditing:a}=N(L),{deltaSeconds:s}=N(O);if(a||!e.splineEntityUUID.value)return;const p=C.getEntityFromSameSourceByID(o,e.splineEntityUUID.value);if(!p)return;const m=S(p,k);if(!m)return;const t=S(o,b);if(!t)return;const f=m.elements;if(f.length<1)return;if(Math.floor(e.alpha.value)>f.length-1){if(!e.loop.value)return;e.alpha.set(0)}e.alpha.set(V=>V+s*e.velocity.value/m.curve.getLength());const g=e.alpha.value,i=Math.floor(e.alpha.value),x=i+1>f.length-1?0:i+1;if(!e.loop.value&&i>x)return;const B=E(p,b);m.curve.getPointAt(g-i,_),t.position.copy(_);const T=f[i].rotation,U=f[x].rotation;e.enableRotation.value&&(e.lockToXZPlane.value?(u.setFromQuaternion(T),u.z=0,t.rotation.setFromEuler(u),u.setFromQuaternion(U),u.z=0,R.setFromEuler(u),t.rotation.fastSlerp(R,g-i)):t.rotation.copy(T).fastSlerp(U,g-i)),t.matrix.compose(t.position,t.rotation,t.scale),t.matrix.premultiply(B.matrix),t.matrix.decompose(t.position,t.rotation,t.scale);const D=E(o,A).parentEntity;if(!D)return;const Q=E(D,b);t.matrix.premultiply(ie.copy(Q.matrixWorld).invert()).decompose(t.position,t.rotation,t.scale)},{before:Y}),M.useEffect(()=>{if(!e.splineEntityUUID.value)return;const a=C.getEntityFromSameSourceByID(o,e.splineEntityUUID.value);if(!a)return;const s=S(a,k);s&&(s.curve.closed=e.loop.value)},[e.loop]),null}}),ie=new K,I=y=>{const{t:o}=ae(),e=w(y.entity,r),a=e.velocity;e.velocity;const s=G([k]).map(p=>{const m=E(p,$),t=E(p,C).entityID;return{label:m,value:t}});return n.createElement(te,{description:o("editor:properties.splinetrack.description"),Icon:I.iconComponent,...y},n.createElement(d,{name:"Spline",label:o("editor:properties.splinetrack.lbl-spline")},n.createElement(ne,{key:y.entity,options:s,value:e.splineEntityUUID.value,onChange:c(r,"splineEntityUUID")})),n.createElement(d,{name:"Velocity",label:o("editor:properties.splinetrack.lbl-velocity")},n.createElement(oe,{value:a.value,onChange:P(r,"velocity"),onRelease:c(r,"velocity"),prefix:n.createElement(re,{value:a.value,onChange:P(r,"velocity"),onRelease:c(r,"velocity")})})),n.createElement(d,{name:"Enable Rotation",label:o("editor:properties.splinetrack.lbl-enableRotation")},n.createElement(h,{checked:e.enableRotation.value,onChange:c(r,"enableRotation")})),n.createElement(d,{name:"Lock XZ",label:o("editor:properties.splinetrack.lbl-lockXZ")},n.createElement(h,{checked:e.lockToXZPlane.value,onChange:c(r,"lockToXZPlane")})),n.createElement(d,{name:"Loop",label:o("editor:properties.splinetrack.lbl-loop")},n.createElement(h,{checked:e.loop.value,onChange:c(r,"loop")})))};I.iconComponent=ee;const le={},Ye={title:"Editor/Properties/Spline/Track",component:I,parameters:{componentSubtitle:"SplineTrackNodeEditor",jest:"splineTrackNodeEditor.test.tsx",design:{type:"figma",url:""}},argTypes:le},v={args:{}};var F,X,Z;v.parameters={...v.parameters,docs:{...(F=v.parameters)==null?void 0:F.docs,source:{originalSource:`{
  args: {}
}`,...(Z=(X=v.parameters)==null?void 0:X.docs)==null?void 0:Z.source}}};const $e=["Default"];export{v as Default,$e as __namedExportsOrder,Ye as default};
