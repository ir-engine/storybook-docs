import{d as s,S as d,e as p}from"./UUIDComponent-GqVY2Xw8.js";import"./WebRTCTransportFunctions-mB_FREj1.js";import"./index-DPzuYzxM.js";import{i as f,D as y,F as P}from"./resourceLoaderHooks-CRL4d032.js";const w=s({name:"TweenComponent",schema:d.Type()}),A=u=>{const n=new Map,a=new Set;let c=0;const e={accumulatingPriorities:n,removeEntity:o=>{n.delete(o)},addPriority:(o,i)=>{n.has(o)||n.set(o,{normalizedPriority:0,accumulatedPriority:0});const r=n.get(o);r.accumulatedPriority+=i,c+=i},update:()=>{a.clear();for(const[o,i]of n){i.normalizedPriority+=i.accumulatedPriority*e.accumulationBudget/c,i.accumulatedPriority=0;const r=p(o);(i.normalizedPriority>=1||!r)&&(r&&a.add(o),e.removeEntity(o))}c=0},priorityEntities:a,accumulationBudget:u.accumulationBudget,reset:()=>{c=0,n.clear(),a.clear()}};return e},C=5*5,g=u=>!(y.squaredDistance[u]>C&&P.isCulled[u]),D=(u,n)=>{let a=0;return(c,e,o)=>{let i=!1;a+=o,a>1&&(i=!0,a=0);for(const t of u.enter())e.push(t),i=!0;for(const t of u.exit()){const l=e.indexOf(t);l>-1&&e.splice(l,1),i=!0,c.removeEntity(t)}i&&e.length>1&&f(e,n);const r=[];for(let t=0;t<e.length;t++)g(e[t])&&r.push(e[t]);for(let t=0;t<r.length;t++){const l=r[t],m=Math.min(Math.exp(1/(t+1))/3,1);c.addPriority(l,m*m)}c.update()}};export{w as T,D as a,A as c};
