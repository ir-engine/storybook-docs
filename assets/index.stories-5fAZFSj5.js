var et=Object.defineProperty;var nt=(t,o,e)=>o in t?et(t,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[o]=e;var R=(t,o,e)=>nt(t,typeof o!="symbol"?o+"":o,e);import{r as O,R as c}from"./index-DPzuYzxM.js";import{d as H,g as x,n as M,b as it,c as st,m as rt,e as at,h as T,a as j,N as mt}from"./WebRTCTransportFunctions-mB_FREj1.js";import{h as v,g as m,B as ut,W as ct,m as V,d as Y,S as g,u as pt,n as J,U as a,r as lt,i as W,s as dt,a as ft}from"./UUIDComponent-GqVY2Xw8.js";import{E as gt,c as A,u as K}from"./Util-D6kE0IP9.js";import{N as yt}from"./NodeEditor-SBboXx3y.js";import{A as Q,a as _,b as Z,I as S}from"./AvatarComponent-nx-CnC4v.js";import{a as n,d as P,E as Et}from"./three.module-BizNiMhn.js";import{J as d,K as Pt,L as $,U as I,W as k,T as y,l as q,X as Ct,Y as Mt,Z as bt,s as wt,b as Tt}from"./resourceLoaderHooks-CRL4d032.js";import{A as z,e as tt,p as ot}from"./AvatarNetworkActions-D8KEwxoM.js";import"./AvatarMovementSettingsState-H4HGqdaK.js";import"./index-Dls6AtJn.js";import{C as It}from"./index-PchlGXp2.js";import"./index-B8Egbi3s.js";import"./index-C53TPVpl.js";import"./index-CvvRAf94.js";import"./ZoomOutSm-BKYTao-C.js";import"./index-BmZLy_Eh.js";import"./index-DNUDjAZy.js";import{a as vt}from"./index-YWE9xQ_z.js";import{I as h}from"./index-dk6FhMkf.js";import{S as Dt}from"./index-CYqQ2WW8.js";import{a as Ut}from"./index-CwbrXKcR.js";import{u as At}from"./useTranslation-CW9c4UDM.js";import"./_commonjsHelpers-C4iS2aBk.js";import"./index-DYLXRpC5.js";import"./v4-BOvFkHkt.js";import"./ShadowComponent-DnhO6zHH.js";import"./useFeatureFlags-Dn9l-n2t.js";import"./FeathersHooks-Bcw5IzUg.js";import"./EditorServices-5l66pnva.js";import"./AuthService-CgpOViw1.js";import"./___vite-browser-external_commonjs-proxy-BqV5D26a.js";import"./index-CO8llcWC.js";import"./iconBase-qHBVS_PM.js";import"./index-Dp9Z83cc.js";import"./index-C0GIA9vz.js";import"./tw-merge-Ds6tgvmq.js";import"./utils-C_TihLnJ.js";import"./index-D9X8Um7J.js";import"./client-CcmnHNO9.js";import"./lodash-AQPfkADg.js";import"./AssetType-CNZ47EUo.js";import"./index-Bs5DOUC-.js";import"./index-DFnjDgZz.js";import"./fuse-Ch1WBRTM.js";import"./index-K3LPJkAj.js";import"./index-DYUpM6SD.js";const b={type:k.Closest,origin:new n,direction:new n(0,-1,0),maxDistance:2,groups:0};function ht(t,o,e=!0,i=new n(0,-1,0)){const s=e?d.Ground:Pt,p=$(d.Avatars,s);b.direction.copy(i),b.origin.copy(o),b.groups=p;const C=I.castRay(t,b);let l=!1,u=null;return C.length>0&&(u=C[0],(e||u.normal.y>.9)&&(l=!0)),{positionValid:l,raycastHit:u}}$(d.Avatars,d.Ground|d.Default);k.Closest,new n,new n;H({name:"autopilotMarkerState",initial:()=>({markerEntity:null,walkTarget:null})});new n;k.Closest,new n,bt.Down;new n;new n;new n;new n;new n;new n;new n;const Ot=(t,o)=>{m(ut.instance.localFloorEntity,y).position.add(o),Mt(),St(t)};new n;new n;new n;new P;new n;new P;new P;const St=t=>{const o=I.getWorld(t);if(!o||!o.Rigidbodies.get(t))return;const i=m(t,q),s=m(t,y);i.previousPosition.copy(i.targetKinematicPosition),i.position.copy(i.targetKinematicPosition),s.position.copy(i.targetKinematicPosition),I.setKinematicRigidbodyPose(o,t,i.targetKinematicPosition,i.rotation),y.dirty[t]=0};new Et;const kt=(t,o,e=!1)=>{if(!v(t,Q)){console.warn("Teleport avatar called on non-avatar entity");return}const i=o.clone();i.y+=.1;const s=I.getWorld(t);if(!s)return;const{raycastHit:p}=ht(s,i,!1);if(p||e){const C=m(t,y),l=m(t,q),u=p?p.position:o;l.targetKinematicPosition.copy(u),l.position.copy(u),Ct.isCameraAttachedToAvatar&&Ot(t,new n().subVectors(u,C.position))}};new n;new P;new P;new n;class D{}R(D,"mountInteraction",it({type:"ee.engine.interactions.MOUNT",mounted:rt.boolean,targetMount:V,mountedEntity:V,$topic:st.world}));const E=H({name:"MountPointState",initial:()=>({mountsToMountedEntities:{},mountedEntitiesToMounts:{}}),receptors:{onMountInteraction:D.mountInteraction.receive(t=>{const o=x(E);t.mounted?(o.mountsToMountedEntities[t.targetMount].set(t.mountedEntity),o.mountedEntitiesToMounts[t.mountedEntity].set(t.targetMount)):(o.mountsToMountedEntities[t.targetMount].set(M),o.mountedEntitiesToMounts[t.mountedEntity].set(M))}),onDestroyObject:ct.destroyEntity.receive(t=>{const o=x(E);if(t.entityUUID in o.mountedEntitiesToMounts.value){const e=o.mountedEntitiesToMounts[t.entityUUID].value;e&&(o.mountsToMountedEntities[e].set(M),o.mountedEntitiesToMounts[t.entityUUID].set(M))}})}}),f=Y({name:"SittingComponent",schema:g.Object({mountPointEntity:g.Entity()})}),U={seat:"seat"},Nt=g.LiteralUnion(Object.values(U),{default:"seat"}),Rt={[U.seat]:"editor:properties.mountPoint.interact-message-seat"},G="mountEntity",L=(t,o)=>{if(t===W||o===W)return;const e=j(E);if(a.get(o)in e.mountsToMountedEntities)return;const i=a.get(t),s=J(o,r);!s||s.type!==U.seat||a.get(o)in j(E).mountsToMountedEntities||v(t,f)||(dt(t,f,{mountPointEntity:o}),Z.captureMovement(t,o),T(z.setAnimationState({animationAsset:ot.emotes,clipName:tt.seated,loop:!0,layer:1,entityUUID:i})),T(D.mountInteraction({mounted:!0,mountedEntity:a.get(t),targetMount:a.get(o)})))},xt=t=>{if(!v(t,f))return;T(z.setAnimationState({animationAsset:ot.emotes,clipName:tt.seated,needsSkip:!0,entityUUID:a.get(t)}));const o=m(t,f);Z.releaseMovement(t,o.mountPointEntity),T(D.mountInteraction({mounted:!1,mountedEntity:a.get(t),targetMount:a.get(o.mountPointEntity)}));const e=m(o.mountPointEntity,y),i=m(o.mountPointEntity,r),s=new n().copy(i.dismountOffset).applyMatrix4(e.matrixWorld);kt(t,s,i.forceDismountPosition),lt(t,f)},r=Y({name:"MountPointComponent",jsonID:"EE_mount_point",schema:g.Object({type:Nt,dismountOffset:Tt.Vec3(new n(0,0,.75)),forceDismountPosition:g.Bool()}),mountEntity:L,unmountEntity:xt,mountCallbackName:G,mountPointInteractMessages:Rt,reactor:function(){const t=pt(),o=at(E);return O.useEffect(()=>{wt(t,G,()=>L(Q.getSelfAvatarEntity(),t))},[]),O.useEffect(()=>{const e=J(t,S);e&&(e.uiVisibilityOverride=a.get(t)in o.mountsToMountedEntities.value?_.off:_.none)},[o.mountsToMountedEntities]),null}}),N=t=>{const{t:o}=At(),e=ft(t.entity,r);return O.useEffect(()=>{if(!v(t.entity,S)){const i=m(t.entity,r);gt.addOrRemoveComponent([t.entity],S,!0,{label:o(r.mountPointInteractMessages[i.type]),callbacks:[{callbackID:r.mountCallbackName,target:m(t.entity,a).entityID}]})}},[]),c.createElement(yt,{...t,name:o("editor:properties.mountPoint.name"),description:o("editor:properties.mountPoint.description"),Icon:N.iconComponent},c.createElement(h,{name:"Mount Type",label:o("editor:properties.mountPoint.lbl-type")},c.createElement(Dt,{key:t.entity,value:e.type.value,options:Object.entries(U).map(([i,s])=>({label:i,value:s})),onChange:A(r,"type")})),c.createElement(h,{name:"Dismount Offset",label:o("editor:properties.mountPoint.lbl-dismount")},c.createElement(Ut,{value:e.dismountOffset.get(mt),onChange:K(r,"dismountOffset"),onRelease:A(r,"dismountOffset")})),c.createElement(h,{name:"Force Dismount Offset",label:o("editor:properties.mountPoint.lbl-force-dismount"),info:o("editor:properties.mountPoint.lbl-force-dismount-info")},c.createElement(It,{checked:e.forceDismountPosition.value,onChange:K(r,"forceDismountPosition"),onBlur:()=>A(r,"forceDismountPosition")(e.forceDismountPosition.value)})))};N.iconComponent=vt;const jt={},No={title:"Editor/Properties/MountPoint",component:N,parameters:{componentSubtitle:"MountPointNodeEditor",jest:"mountPointNodeEditor.test.tsx",design:{type:"figma",url:""}},argTypes:jt},w={args:{}};var B,F,X;w.parameters={...w.parameters,docs:{...(B=w.parameters)==null?void 0:B.docs,source:{originalSource:`{
  args: {}
}`,...(X=(F=w.parameters)==null?void 0:F.docs)==null?void 0:X.source}}};const Ro=["Default"];export{w as Default,Ro as __namedExportsOrder,No as default};
